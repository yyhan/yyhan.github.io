<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>YFHan的博客</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://yyhan.github.io/"/>
  <updated>2017-12-25T13:43:27.822Z</updated>
  <id>https://yyhan.github.io/</id>
  
  <author>
    <name>YFHan</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Java 重入锁源码分析</title>
    <link href="https://yyhan.github.io/2017/12/24/Java-%E9%87%8D%E5%85%A5%E9%94%81%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    <id>https://yyhan.github.io/2017/12/24/Java-重入锁源码分析/</id>
    <published>2017-12-24T06:47:25.000Z</published>
    <updated>2017-12-25T13:43:27.822Z</updated>
    
    <content type="html"><![CDATA[<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Written by Doug Lea with assistance from members of JCP JSR-166</span></span><br><span class="line"><span class="comment"> * Expert Group and released to the public domain, as explained at</span></span><br><span class="line"><span class="comment"> * http://creativecommons.org/publicdomain/zero/1.0/</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> java.util.concurrent.locks;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A reentrant mutual exclusion {<span class="doctag">@link</span> Lock} with the same basic</span></span><br><span class="line"><span class="comment"> * behavior and semantics as the implicit monitor lock accessed using</span></span><br><span class="line"><span class="comment"> * {<span class="doctag">@code</span> synchronized} methods and statements, but with extended</span></span><br><span class="line"><span class="comment"> * capabilities.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.5</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Doug Lea</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReentrantLock</span> <span class="keyword">implements</span> <span class="title">Lock</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">7373984872572414699L</span>;</span><br><span class="line">    <span class="comment">/** Synchronizer providing all implementation mechanics */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Sync sync;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Base of synchronization control for this lock. Subclassed</span></span><br><span class="line"><span class="comment">     * into fair and nonfair versions below. Uses AQS state to</span></span><br><span class="line"><span class="comment">     * represent the number of holds on the lock.</span></span><br><span class="line"><span class="comment">     * &#x9488;&#x5BF9;&#x8FD9;&#x4E2A;&#x9501;&#x7684;&#x57FA;&#x672C;&#x7684;&#x540C;&#x6B65;&#x63A7;&#x5236;&#x5668;&#x3002;&#x6709;&#x516C;&#x5E73;&#x548C;&#x975E;&#x516C;&#x5E73;&#x4E24;&#x4E2A;&#x7248;&#x672C;&#x7684;&#x5B50;&#x7C7B;&#x3002;&#x4F7F;&#x7528; AQS &#x7684; state &#x8868;&#x793A;&#x9501;&#x7684;&#x6301;&#x6709;&#x6570;&#x91CF;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Sync</span> <span class="keyword">extends</span> <span class="title">AbstractQueuedSynchronizer</span> </span>{</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">5179523762034025860L</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Performs {<span class="doctag">@link</span> Lock#lock}. The main reason for subclassing</span></span><br><span class="line"><span class="comment">         * is to allow fast path for nonfair version.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Performs non-fair tryLock.  tryAcquire is implemented in</span></span><br><span class="line"><span class="comment">         * subclasses, but both need nonfair try for trylock method.</span></span><br><span class="line"><span class="comment">         * &#x6267;&#x884C;&#x4E0D;&#x516C;&#x5E73;&#x7684;tryLock&#x3002; tryAcquire&#x662F;&#x5728;&#x5B50;&#x7C7B;&#x4E2D;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x4F46;&#x90FD;&#x9700;&#x8981;&#x4E0D;&#x516C;&#x5E73;&#x7684;&#x5C1D;&#x8BD5;trylock&#x65B9;&#x6CD5;&#x3002;</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">nonfairTryAcquire</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>{</span><br><span class="line">            <span class="keyword">final</span> Thread current = Thread.currentThread();</span><br><span class="line">            <span class="keyword">int</span> c = getState();</span><br><span class="line">            <span class="keyword">if</span> (c == <span class="number">0</span>) {</span><br><span class="line">                <span class="comment">// &#x5982;&#x679C; state == 0 &#x8868;&#x793A;&#x9501;&#x5C1A;&#x672A;&#x88AB;&#x5176;&#x5B83;&#x7EBF;&#x7A0B;&#x6301;&#x6709;&#xFF0C;&#x76F4;&#x63A5;&#x8BBE;&#x7F6E;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4E3A;&#x72EC;&#x5360;&#x7EBF;&#x7A0B;</span></span><br><span class="line">                <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, acquires)) {</span><br><span class="line">                    setExclusiveOwnerThread(current);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (current == getExclusiveOwnerThread()) {</span><br><span class="line">                <span class="comment">// &#x5982;&#x679C;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x5DF2;&#x7ECF;&#x6301;&#x6709;&#x4E86;&#x9501;</span></span><br><span class="line">                <span class="keyword">int</span> nextc = c + acquires;</span><br><span class="line">                <span class="keyword">if</span> (nextc &lt; <span class="number">0</span>) <span class="comment">// overflow</span></span><br><span class="line">                    <span class="comment">// &#x8D85;&#x8FC7;&#x6700;&#x5927;&#x9501;&#x5B9A;&#x8BA1;&#x6570;</span></span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">&quot;Maximum lock count exceeded&quot;</span>);</span><br><span class="line">                <span class="comment">// &#x66F4;&#x65B0; state</span></span><br><span class="line">                setState(nextc);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// &#x8FD4;&#x56DE; false&#xFF0C;&#x8868;&#x793A;&#x83B7;&#x53D6;&#x9501;&#x5931;&#x8D25;</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// &#x5C1D;&#x8BD5;&#x91CA;&#x653E;&#x9501;</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">tryRelease</span><span class="params">(<span class="keyword">int</span> releases)</span> </span>{</span><br><span class="line">            <span class="keyword">int</span> c = getState() - releases;</span><br><span class="line">            <span class="comment">// &#x5224;&#x65AD;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x662F;&#x4E0D;&#x662F;&#x9501;&#x7684;&#x6301;&#x6709;&#x8005;</span></span><br><span class="line">            <span class="keyword">if</span> (Thread.currentThread() != getExclusiveOwnerThread())</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalMonitorStateException();</span><br><span class="line">            <span class="keyword">boolean</span> free = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (c == <span class="number">0</span>) {</span><br><span class="line">                <span class="comment">// c == 0 &#x8BF4;&#x660E;&#x5DF2;&#x7ECF;&#x6CA1;&#x6709;&#x7EBF;&#x7A0B;&#x6301;&#x6709;&#x9501;</span></span><br><span class="line">                free = <span class="keyword">true</span>;</span><br><span class="line">                <span class="comment">// &#x8BBE;&#x7F6E;&#x72EC;&#x5360;&#x6301;&#x6709;&#x7EBF;&#x7A0B;&#x4E3A;null</span></span><br><span class="line">                setExclusiveOwnerThread(<span class="keyword">null</span>);</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// &#x66F4;&#x65B0; state</span></span><br><span class="line">            setState(c);</span><br><span class="line">            <span class="keyword">return</span> free;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// &#x5224;&#x65AD;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x662F;&#x4E0D;&#x662F;&#x72EC;&#x5360;&#x6301;&#x6709;&#x8BE5;&#x9501;</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">isHeldExclusively</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="comment">// While we must in general read state before owner,</span></span><br><span class="line">            <span class="comment">// we don&apos;t need to do so to check if current thread is owner</span></span><br><span class="line">            <span class="comment">// &#x6211;&#x4EEC;&#x4E0D;&#x9700;&#x8981;&#x8FD9;&#x6837;&#x505A;&#x6765;&#x68C0;&#x67E5;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x662F;&#x5426;&#x662F;&#x6240;&#x6709;&#x8005;</span></span><br><span class="line">            <span class="keyword">return</span> getExclusiveOwnerThread() == Thread.currentThread();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">final</span> ConditionObject <span class="title">newCondition</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ConditionObject();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Methods relayed from outer class</span></span><br><span class="line">        <span class="comment">// &#x83B7;&#x53D6;&#x5F53;&#x524D;&#x9501;&#x7684;&#x6301;&#x6709;&#x8005;</span></span><br><span class="line">        <span class="function"><span class="keyword">final</span> Thread <span class="title">getOwner</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> getState() == <span class="number">0</span> ? <span class="keyword">null</span> : getExclusiveOwnerThread();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">final</span> <span class="keyword">int</span> <span class="title">getHoldCount</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> isHeldExclusively() ? getState() : <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// &#x8BE5;&#x9501;&#x662F;&#x4E0D;&#x662F;&#x9501;&#x4E0A;&#x4E86;</span></span><br><span class="line">        <span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">isLocked</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> getState() != <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Reconstitutes the instance from a stream (that is, deserializes it).</span></span><br><span class="line"><span class="comment">         * &#x8986;&#x76D6; readObject&#x65B9;&#x6CD5;</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(java.io.ObjectInputStream s)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> java.io.IOException, ClassNotFoundException </span>{</span><br><span class="line">            s.defaultReadObject();</span><br><span class="line">            <span class="comment">// &#x53CD;&#x5E8F;&#x5217;&#x5316;&#x9501;&#x540E;&#xFF0C;&#x5F3A;&#x5236;&#x5C06;&#x9501;&#x91CA;&#x653E;</span></span><br><span class="line">            setState(<span class="number">0</span>); <span class="comment">// reset to unlocked state</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x975E;&#x516C;&#x5E73;&#x9501;&#x540C;&#x6B65;&#x63A7;&#x5236;&#x5668;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">NonfairSync</span> <span class="keyword">extends</span> <span class="title">Sync</span> </span>{</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">7316153563782823691L</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Performs lock.  Try immediate barge, backing up to normal</span></span><br><span class="line"><span class="comment">         * acquire on failure.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="comment">// &#x539F;&#x5B50;&#x65B9;&#x5F0F;&#x8BBE;&#x7F6E;state&#x4E3A;1&#xFF0C;&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x6210;&#x529F;&#xFF0C;&#x5219;&#x8BF4;&#x660E;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x6210;&#x529F;&#x83B7;&#x53D6;&#x4E86;&#x9501;&#xFF08;&#x5F53;&#x524D;&#x9501;&#x6CA1;&#x6709;&#x88AB;&#x5176;&#x5B83;&#x7EBF;&#x7A0B;&#x62E5;&#x6709;&#xFF09;</span></span><br><span class="line">            <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">                setExclusiveOwnerThread(Thread.currentThread());</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="comment">// &#x5426;&#x5219;&#x7684;&#x8BDD;&#xFF0C;&#x5C06;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x52A0;&#x5165;&#x5230;&#x6392;&#x961F;&#x961F;&#x5217;</span></span><br><span class="line">                acquire(<span class="number">1</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> nonfairTryAcquire(acquires);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x516C;&#x5E73;&#x9501;&#x540C;&#x6B65;&#x63A7;&#x5236;&#x5668;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">FairSync</span> <span class="keyword">extends</span> <span class="title">Sync</span> </span>{</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">3000897897090466540L</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>{</span><br><span class="line">            acquire(<span class="number">1</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Fair version of tryAcquire.  Don&apos;t grant access unless</span></span><br><span class="line"><span class="comment">         * recursive call or no waiters or is first.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>{</span><br><span class="line">            <span class="keyword">final</span> Thread current = Thread.currentThread();</span><br><span class="line">            <span class="keyword">int</span> c = getState();</span><br><span class="line">            <span class="keyword">if</span> (c == <span class="number">0</span>) {</span><br><span class="line">                <span class="keyword">if</span> (!hasQueuedPredecessors() &amp;&amp;</span><br><span class="line">                    compareAndSetState(<span class="number">0</span>, acquires)) {</span><br><span class="line">                    setExclusiveOwnerThread(current);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (current == getExclusiveOwnerThread()) {</span><br><span class="line">                <span class="keyword">int</span> nextc = c + acquires;</span><br><span class="line">                <span class="keyword">if</span> (nextc &lt; <span class="number">0</span>)</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">&quot;Maximum lock count exceeded&quot;</span>);</span><br><span class="line">                setState(nextc);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x9ED8;&#x8BA4;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x3002;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x975E;&#x516C;&#x5E73;&#x9501;&#x3002;&#x7B49;&#x540C;&#x4E8E; ReentrantLock(false)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ReentrantLock</span><span class="params">()</span> </span>{</span><br><span class="line">        sync = <span class="keyword">new</span> NonfairSync();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x6839;&#x636E;&#x6307;&#x5B9A;&#x7684;&#x7B56;&#x7565;&#x6784;&#x9020;&#x4E00;&#x4E2A;&#x53EF;&#x91CD;&#x5165;&#x9501;&#x3002;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fair true ? &#x516C;&#x5E73; : &#x975E;&#x516C;&#x5E73;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ReentrantLock</span><span class="params">(<span class="keyword">boolean</span> fair)</span> </span>{</span><br><span class="line">        sync = fair ? <span class="keyword">new</span> FairSync() : <span class="keyword">new</span> NonfairSync();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x83B7;&#x53D6;&#x9501;.</span></span><br><span class="line"><span class="comment">     * &#x83B7;&#x53D6;&#x9501;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x5176;&#x5B83;&#x7EBF;&#x7A0B;&#x6301;&#x6709;&#x9501;&#x5C06;&#x4F1A;&#x7ACB;&#x5373;&#x8FD4;&#x56DE;&#xFF0C;&#x540C;&#x65F6;&#x5C06;&#x6301;&#x6709;&#x9501;&#x7684;&#x8BA1;&#x6570;&#x5668;&#x8BBE;&#x7F6E;&#x4F4D; 1.</span></span><br><span class="line"><span class="comment">     * &#x5982;&#x679C;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x5DF2;&#x7ECF;&#x6301;&#x6709;&#x4E86;&#x8FD9;&#x4E2A;&#x9501;&#xFF0C;&#x90A3;&#x4E48;&#x5C06;&#x6301;&#x6709;&#x9501;&#x7684;&#x8BA1;&#x6570;&#x5668;&#x52A0; 1&#xFF0C;&#x7136;&#x540E;&#x7ACB;&#x5373;&#x8FD4;&#x56DE;&#x3002;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>{</span><br><span class="line">        sync.lock();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Acquires the lock unless the current thread is</span></span><br><span class="line"><span class="comment">     * {<span class="doctag">@linkplain</span> Thread#interrupt interrupted}.</span></span><br><span class="line"><span class="comment">     * &#x83B7;&#x53D6;&#x9501;&#x9664;&#x975E;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x662F;&#x4E2D;&#x65AD;&#x7684;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> InterruptedException if the current thread is interrupted</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lockInterruptibly</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        sync.acquireInterruptibly(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x83B7;&#x53D6;&#x9501;&#xFF0C;&#x53EA;&#x6709;&#x5F53;&#x8C03;&#x7528;&#x7684;&#x65F6;&#x5019;&#x8FD9;&#x4E2A;&#x9501;&#x6CA1;&#x6709;&#x88AB;&#x5176;&#x5B83;&#x7EBF;&#x7A0B;&#x6301;&#x6709;&#x3002;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> timeout the time to wait for the lock</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unit the time unit of the timeout argument</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> {<span class="doctag">@code</span> true} if the lock was free and was acquired by the</span></span><br><span class="line"><span class="comment">     *         current thread, or the lock was already held by the current</span></span><br><span class="line"><span class="comment">     *         thread; and {<span class="doctag">@code</span> false} if the waiting time elapsed before</span></span><br><span class="line"><span class="comment">     *         the lock could be acquired</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> InterruptedException if the current thread is interrupted</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if the time unit is null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        <span class="keyword">return</span> sync.tryAcquireNanos(<span class="number">1</span>, unit.toNanos(timeout));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x91CA;&#x653E;&#x9501;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &#x5982;&#x679C;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x662F;&#x8FD9;&#x4E2A;&#x9501;&#x7684;&#x6301;&#x6709;&#x8005;&#xFF0C;&#x90A3;&#x4E48;&#x9501;&#x7684;&#x6301;&#x6709;&#x8BA1;&#x6570;&#x5668;&#x5C06;&#x4F1A;&#x51CF; 1. &#x5982;&#x679C;&#x9501;&#x7684;&#x6301;&#x6709;&#x8BA1;&#x6570;&#x5668;&#x73B0;&#x5728;&#x662F; 0 &#x7684;&#x8BDD;&#xFF0C;&#x9501;&#x5C06;&#x88AB;&#x91CA;&#x653E;&#x3002;</span></span><br><span class="line"><span class="comment">     * &#x5982;&#x679C;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4E0D;&#x662F;&#x8FD9;&#x4E2A;&#x9501;&#x7684;&#x6301;&#x6709;&#x8005;&#xFF0C;&#x90A3;&#x4E48;&#x5C06;&#x4F1A;&#x629B;&#x51FA; {<span class="doctag">@link</span> IllegalMonitorStateException} &#x5F02;&#x5E38;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalMonitorStateException &#x5982;&#x679C;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4E0D;&#x662F;&#x8FD9;&#x4E2A;&#x9501;&#x7684;&#x6301;&#x6709;&#x8005;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>{</span><br><span class="line">        sync.release(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a {<span class="doctag">@link</span> Condition} instance for use with this</span></span><br><span class="line"><span class="comment">     * {<span class="doctag">@link</span> Lock} instance.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the Condition object</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Condition <span class="title">newCondition</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> sync.newCondition();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Queries the number of holds on this lock by the current thread.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;A thread has a hold on a lock for each lock action that is not</span></span><br><span class="line"><span class="comment">     * matched by an unlock action.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;The hold count information is typically only used for testing and</span></span><br><span class="line"><span class="comment">     * debugging purposes. For example, if a certain section of code should</span></span><br><span class="line"><span class="comment">     * not be entered with the lock already held then we can assert that</span></span><br><span class="line"><span class="comment">     * fact:</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  &lt;pre&gt; {<span class="doctag">@code</span></span></span><br><span class="line"><span class="comment">     * class X {</span></span><br><span class="line"><span class="comment">     *   ReentrantLock lock = new ReentrantLock();</span></span><br><span class="line"><span class="comment">     *   // ...</span></span><br><span class="line"><span class="comment">     *   public void m() {</span></span><br><span class="line"><span class="comment">     *     assert lock.getHoldCount() == 0;</span></span><br><span class="line"><span class="comment">     *     lock.lock();</span></span><br><span class="line"><span class="comment">     *     try {</span></span><br><span class="line"><span class="comment">     *       // ... method body</span></span><br><span class="line"><span class="comment">     *     } finally {</span></span><br><span class="line"><span class="comment">     *       lock.unlock();</span></span><br><span class="line"><span class="comment">     *     }</span></span><br><span class="line"><span class="comment">     *   }</span></span><br><span class="line"><span class="comment">     * }}&lt;/pre&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the number of holds on this lock by the current thread,</span></span><br><span class="line"><span class="comment">     *         or zero if this lock is not held by the current thread</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getHoldCount</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> sync.getHoldCount();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Queries if this lock is held by the current thread.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;Analogous to the {<span class="doctag">@link</span> Thread#holdsLock(Object)} method for</span></span><br><span class="line"><span class="comment">     * built-in monitor locks, this method is typically used for</span></span><br><span class="line"><span class="comment">     * debugging and testing. For example, a method that should only be</span></span><br><span class="line"><span class="comment">     * called while a lock is held can assert that this is the case:</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  &lt;pre&gt; {<span class="doctag">@code</span></span></span><br><span class="line"><span class="comment">     * class X {</span></span><br><span class="line"><span class="comment">     *   ReentrantLock lock = new ReentrantLock();</span></span><br><span class="line"><span class="comment">     *   // ...</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *   public void m() {</span></span><br><span class="line"><span class="comment">     *       assert lock.isHeldByCurrentThread();</span></span><br><span class="line"><span class="comment">     *       // ... method body</span></span><br><span class="line"><span class="comment">     *   }</span></span><br><span class="line"><span class="comment">     * }}&lt;/pre&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;It can also be used to ensure that a reentrant lock is used</span></span><br><span class="line"><span class="comment">     * in a non-reentrant manner, for example:</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  &lt;pre&gt; {<span class="doctag">@code</span></span></span><br><span class="line"><span class="comment">     * class X {</span></span><br><span class="line"><span class="comment">     *   ReentrantLock lock = new ReentrantLock();</span></span><br><span class="line"><span class="comment">     *   // ...</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *   public void m() {</span></span><br><span class="line"><span class="comment">     *       assert !lock.isHeldByCurrentThread();</span></span><br><span class="line"><span class="comment">     *       lock.lock();</span></span><br><span class="line"><span class="comment">     *       try {</span></span><br><span class="line"><span class="comment">     *           // ... method body</span></span><br><span class="line"><span class="comment">     *       } finally {</span></span><br><span class="line"><span class="comment">     *           lock.unlock();</span></span><br><span class="line"><span class="comment">     *       }</span></span><br><span class="line"><span class="comment">     *   }</span></span><br><span class="line"><span class="comment">     * }}&lt;/pre&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> {<span class="doctag">@code</span> true} if current thread holds this lock and</span></span><br><span class="line"><span class="comment">     *         {<span class="doctag">@code</span> false} otherwise</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isHeldByCurrentThread</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> sync.isHeldExclusively();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Queries if this lock is held by any thread. This method is</span></span><br><span class="line"><span class="comment">     * designed for use in monitoring of the system state,</span></span><br><span class="line"><span class="comment">     * not for synchronization control.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> {<span class="doctag">@code</span> true} if any thread holds this lock and</span></span><br><span class="line"><span class="comment">     *         {<span class="doctag">@code</span> false} otherwise</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isLocked</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> sync.isLocked();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns {<span class="doctag">@code</span> true} if this lock has fairness set true.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> {<span class="doctag">@code</span> true} if this lock has fairness set true</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">isFair</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> sync <span class="keyword">instanceof</span> FairSync;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the thread that currently owns this lock, or</span></span><br><span class="line"><span class="comment">     * {<span class="doctag">@code</span> null} if not owned. When this method is called by a</span></span><br><span class="line"><span class="comment">     * thread that is not the owner, the return value reflects a</span></span><br><span class="line"><span class="comment">     * best-effort approximation of current lock status. For example,</span></span><br><span class="line"><span class="comment">     * the owner may be momentarily {<span class="doctag">@code</span> null} even if there are</span></span><br><span class="line"><span class="comment">     * threads trying to acquire the lock but have not yet done so.</span></span><br><span class="line"><span class="comment">     * This method is designed to facilitate construction of</span></span><br><span class="line"><span class="comment">     * subclasses that provide more extensive lock monitoring</span></span><br><span class="line"><span class="comment">     * facilities.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the owner, or {<span class="doctag">@code</span> null} if not owned</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Thread <span class="title">getOwner</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> sync.getOwner();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Queries whether any threads are waiting to acquire this lock. Note that</span></span><br><span class="line"><span class="comment">     * because cancellations may occur at any time, a {<span class="doctag">@code</span> true}</span></span><br><span class="line"><span class="comment">     * return does not guarantee that any other thread will ever</span></span><br><span class="line"><span class="comment">     * acquire this lock.  This method is designed primarily for use in</span></span><br><span class="line"><span class="comment">     * monitoring of the system state.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> {<span class="doctag">@code</span> true} if there may be other threads waiting to</span></span><br><span class="line"><span class="comment">     *         acquire the lock</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">hasQueuedThreads</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> sync.hasQueuedThreads();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Queries whether the given thread is waiting to acquire this</span></span><br><span class="line"><span class="comment">     * lock. Note that because cancellations may occur at any time, a</span></span><br><span class="line"><span class="comment">     * {<span class="doctag">@code</span> true} return does not guarantee that this thread</span></span><br><span class="line"><span class="comment">     * will ever acquire this lock.  This method is designed primarily for use</span></span><br><span class="line"><span class="comment">     * in monitoring of the system state.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> thread the thread</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> {<span class="doctag">@code</span> true} if the given thread is queued waiting for this lock</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if the thread is null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">hasQueuedThread</span><span class="params">(Thread thread)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> sync.isQueued(thread);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns an estimate of the number of threads waiting to</span></span><br><span class="line"><span class="comment">     * acquire this lock.  The value is only an estimate because the number of</span></span><br><span class="line"><span class="comment">     * threads may change dynamically while this method traverses</span></span><br><span class="line"><span class="comment">     * internal data structures.  This method is designed for use in</span></span><br><span class="line"><span class="comment">     * monitoring of the system state, not for synchronization</span></span><br><span class="line"><span class="comment">     * control.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the estimated number of threads waiting for this lock</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">getQueueLength</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> sync.getQueueLength();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a collection containing threads that may be waiting to</span></span><br><span class="line"><span class="comment">     * acquire this lock.  Because the actual set of threads may change</span></span><br><span class="line"><span class="comment">     * dynamically while constructing this result, the returned</span></span><br><span class="line"><span class="comment">     * collection is only a best-effort estimate.  The elements of the</span></span><br><span class="line"><span class="comment">     * returned collection are in no particular order.  This method is</span></span><br><span class="line"><span class="comment">     * designed to facilitate construction of subclasses that provide</span></span><br><span class="line"><span class="comment">     * more extensive monitoring facilities.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the collection of threads</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Collection&lt;Thread&gt; <span class="title">getQueuedThreads</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> sync.getQueuedThreads();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Queries whether any threads are waiting on the given condition</span></span><br><span class="line"><span class="comment">     * associated with this lock. Note that because timeouts and</span></span><br><span class="line"><span class="comment">     * interrupts may occur at any time, a {<span class="doctag">@code</span> true} return does</span></span><br><span class="line"><span class="comment">     * not guarantee that a future {<span class="doctag">@code</span> signal} will awaken any</span></span><br><span class="line"><span class="comment">     * threads.  This method is designed primarily for use in</span></span><br><span class="line"><span class="comment">     * monitoring of the system state.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> condition the condition</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> {<span class="doctag">@code</span> true} if there are any waiting threads</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalMonitorStateException if this lock is not held</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalArgumentException if the given condition is</span></span><br><span class="line"><span class="comment">     *         not associated with this lock</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if the condition is null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasWaiters</span><span class="params">(Condition condition)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (condition == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">        <span class="keyword">if</span> (!(condition <span class="keyword">instanceof</span> AbstractQueuedSynchronizer.ConditionObject))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;not owner&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> sync.hasWaiters((AbstractQueuedSynchronizer.ConditionObject)condition);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns an estimate of the number of threads waiting on the</span></span><br><span class="line"><span class="comment">     * given condition associated with this lock. Note that because</span></span><br><span class="line"><span class="comment">     * timeouts and interrupts may occur at any time, the estimate</span></span><br><span class="line"><span class="comment">     * serves only as an upper bound on the actual number of waiters.</span></span><br><span class="line"><span class="comment">     * This method is designed for use in monitoring of the system</span></span><br><span class="line"><span class="comment">     * state, not for synchronization control.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> condition the condition</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the estimated number of waiting threads</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalMonitorStateException if this lock is not held</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalArgumentException if the given condition is</span></span><br><span class="line"><span class="comment">     *         not associated with this lock</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if the condition is null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getWaitQueueLength</span><span class="params">(Condition condition)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (condition == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">        <span class="keyword">if</span> (!(condition <span class="keyword">instanceof</span> AbstractQueuedSynchronizer.ConditionObject))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;not owner&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> sync.getWaitQueueLength((AbstractQueuedSynchronizer.ConditionObject)condition);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a collection containing those threads that may be</span></span><br><span class="line"><span class="comment">     * waiting on the given condition associated with this lock.</span></span><br><span class="line"><span class="comment">     * Because the actual set of threads may change dynamically while</span></span><br><span class="line"><span class="comment">     * constructing this result, the returned collection is only a</span></span><br><span class="line"><span class="comment">     * best-effort estimate. The elements of the returned collection</span></span><br><span class="line"><span class="comment">     * are in no particular order.  This method is designed to</span></span><br><span class="line"><span class="comment">     * facilitate construction of subclasses that provide more</span></span><br><span class="line"><span class="comment">     * extensive condition monitoring facilities.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> condition the condition</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the collection of threads</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalMonitorStateException if this lock is not held</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalArgumentException if the given condition is</span></span><br><span class="line"><span class="comment">     *         not associated with this lock</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if the condition is null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Collection&lt;Thread&gt; <span class="title">getWaitingThreads</span><span class="params">(Condition condition)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (condition == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">        <span class="keyword">if</span> (!(condition <span class="keyword">instanceof</span> AbstractQueuedSynchronizer.ConditionObject))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;not owner&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> sync.getWaitingThreads((AbstractQueuedSynchronizer.ConditionObject)condition);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a string identifying this lock, as well as its lock state.</span></span><br><span class="line"><span class="comment">     * The state, in brackets, includes either the String {<span class="doctag">@code</span> &quot;Unlocked&quot;}</span></span><br><span class="line"><span class="comment">     * or the String {<span class="doctag">@code</span> &quot;Locked by&quot;} followed by the</span></span><br><span class="line"><span class="comment">     * {<span class="doctag">@linkplain</span> Thread#getName name} of the owning thread.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a string identifying this lock, as well as its lock state</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>{</span><br><span class="line">        Thread o = sync.getOwner();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.toString() + ((o == <span class="keyword">null</span>) ?</span><br><span class="line">                                   <span class="string">&quot;[Unlocked]&quot;</span> :</span><br><span class="line">                                   <span class="string">&quot;[Locked by thread &quot;</span> + o.getName() + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span cla
      
    
    </summary>
    
      <category term="java" scheme="https://yyhan.github.io/categories/java/"/>
    
    
      <category term="源码" scheme="https://yyhan.github.io/tags/%E6%BA%90%E7%A0%81/"/>
    
      <category term="锁" scheme="https://yyhan.github.io/tags/%E9%94%81/"/>
    
      <category term="重入锁" scheme="https://yyhan.github.io/tags/%E9%87%8D%E5%85%A5%E9%94%81/"/>
    
  </entry>
  
  <entry>
    <title>npm 常用命令</title>
    <link href="https://yyhan.github.io/2017/12/03/npm-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <id>https://yyhan.github.io/2017/12/03/npm-常用命令/</id>
    <published>2017-12-03T09:23:04.000Z</published>
    <updated>2017-12-03T09:40:03.380Z</updated>
    
    <content type="html"><![CDATA[<h2>&#x5168;&#x5C40;&#x6A21;&#x5757;</h2><ul class="ui list"><li>&#x5168;&#x5C40;&#x5B89;&#x88C5;&#x6A21;&#x5757;&#xFF1A; <code>npm install -g &lt;&#x6A21;&#x5757;&#x540D;&gt;</code></li><li>&#x66F4;&#x65B0;&#x5168;&#x5C40;&#x5B89;&#x88C5;&#x7684;&#x6A21;&#x5757;&#xFF1A; <code>npm update -g &lt;&#x6A21;&#x5757;&#x540D;&gt;</code></li><li>&#x5378;&#x8F7D;&#x5168;&#x5C40;&#x5B89;&#x88C5;&#x7684;&#x6A21;&#x5757;&#xFF1A; <code>npm uninstall -g &lt;&#x6A21;&#x5757;&#x540D;&gt;</code></li></ul><h2>&#x5E38;&#x89C1;&#x95EE;&#x9898;</h2><h3>&#x66F4;&#x65B0;npm&#x7248;&#x672C;</h3><p>&#x901A;&#x8FC7;&#x91CD;&#x65B0;&#x5B89;&#x88C5;npm&#x6765;&#x5347;&#x7EA7;npm&#x81EA;&#x8EAB;&#x7248;&#x672C;</p><p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g npm</span><br></pre></td></tr></table></figure></p><h3>npm&#x6307;&#x4EE4;&#x7F29;&#x5199;</h3><ul class="ui list"><li>-v: --version</li><li>-h, -?, --help, -H: --usage</li><li>-s, --silent: --loglevel silent</li><li>-q, --quiet: --loglevel warn</li><li>-d: --loglevel info</li><li>-dd, --verbose: --loglevel verbose</li><li>-ddd: --loglevel silly</li><li>-g: --global</li><li>-C: --prefix</li><li>-l: --long</li><li>-m: --message</li><li>-p, --porcelain: --parseable</li><li>-reg: --registry</li><li>-f: --force</li><li>-desc: --description</li><li>-S: --save</li><li>-P: --save-prod</li><li>-D: --save-dev</li><li>-O: --save-optional</li><li>-B: --save-bundle</li><li>-E: --save-exact</li><li>-y: --yes</li><li>-n: --yes false</li><li>ll and la commands: ls --long</li><li></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2&gt;&amp;#x5168;&amp;#x5C40;&amp;#x6A21;&amp;#x5757;&lt;/h2&gt;
&lt;ul class=&quot;ui list&quot;&gt;
&lt;li&gt;&amp;#x5168;&amp;#x5C40;&amp;#x5B89;&amp;#x88C5;&amp;#x6A21;&amp;#x5757;&amp;#xFF1A; &lt;code&gt;npm instal
      
    
    </summary>
    
    
      <category term="npm" scheme="https://yyhan.github.io/tags/npm/"/>
    
  </entry>
  
  <entry>
    <title>jQuery DataTables 插件</title>
    <link href="https://yyhan.github.io/2017/08/09/jQuery-DataTables-%E6%8F%92%E4%BB%B6/"/>
    <id>https://yyhan.github.io/2017/08/09/jQuery-DataTables-插件/</id>
    <published>2017-08-09T14:34:09.000Z</published>
    <updated>2017-08-12T17:24:31.550Z</updated>
    
    <content type="html"><![CDATA[<h1>&#x7B80;&#x4ECB;</h1><p>Datatables&#x662F;&#x4E00;&#x6B3E;jquery&#x8868;&#x683C;&#x63D2;&#x4EF6;&#x3002;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x9AD8;&#x5EA6;&#x7075;&#x6D3B;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x4EFB;&#x4F55;HTML&#x8868;&#x683C;&#x6DFB;&#x52A0;&#x9AD8;&#x7EA7;&#x7684;&#x4EA4;&#x4E92;&#x529F;&#x80FD;&#x3002;</p><ul class="ui list"><li><a href="https://datatables.net/" target="_blank" rel="noopener">&#x5B98;&#x7F51;</a></li><li><a href="http://www.datatables.club/" target="_blank" rel="noopener">Datatables&#x4E2D;&#x6587;&#x7F51;</a></li></ul><p>&#x7279;&#x6027;&#xFF1A;</p><ul class="ui list"><li>&#x5206;&#x9875;&#xFF0C;&#x5373;&#x65F6;&#x641C;&#x7D22;&#x548C;&#x6392;&#x5E8F;</li><li>&#x51E0;&#x4E4E;&#x652F;&#x6301;&#x4EFB;&#x4F55;&#x6570;&#x636E;&#x6E90;&#xFF1A;DOM&#xFF0C; javascript&#xFF0C; Ajax &#x548C; &#x670D;&#x52A1;&#x5668;&#x5904;&#x7406;</li><li>&#x652F;&#x6301;&#x4E0D;&#x540C;&#x4E3B;&#x9898; DataTables, jQuery UI, Bootstrap, Foundation</li><li>&#x5404;&#x5F0F;&#x5404;&#x6837;&#x7684;&#x6269;&#x5C55;: Editor, TableTools, FixedColumns &#x2026;&#x2026;</li><li>&#x4E30;&#x5BCC;&#x591A;&#x6837;&#x7684;option&#x548C;&#x5F3A;&#x5927;&#x7684;API</li><li>&#x652F;&#x6301;&#x56FD;&#x9645;&#x5316;</li><li>&#x8D85;&#x8FC7;2900+&#x4E2A;&#x5355;&#x5143;&#x6D4B;&#x8BD5;</li><li>&#x514D;&#x8D39;&#x5F00;&#x6E90; &#xFF08; MIT license &#xFF09;&#xFF01; &#x5546;&#x4E1A;&#x652F;&#x6301;</li><li>&#x66F4;&#x591A;&#x7279;&#x6027;&#x8BF7;&#x5230;&#x5B98;&#x7F51;&#x67E5;&#x770B;</li></ul><h1>&#x914D;&#x7F6E;</h1><p>html &#x914D;&#x7F6E;&#x6A21;&#x677F;<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Bootstrap --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- &#x5F15;&#x5165;dataTables&#x63D2;&#x4EF6;&#x9ED8;&#x8BA4;&#x6837;&#x5F0F;&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x4E86;&#x4E3B;&#x9898;&#x6837;&#x5F0F;&#xFF0C;&#x5C31;&#x4E0D;&#x9700;&#x8981;&#x5F15;&#x5165;&#x9ED8;&#x8BA4;&#x6837;&#x5F0F;&#x4E86; --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;link href=&quot;https://cdn.bootcss.com/datatables/1.10.15/css/jquery.dataTables.min.css&quot; rel=&quot;stylesheet&quot;&gt; --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &#x5F15;&#x5165;bootstrap&#x4E3B;&#x9898;css --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;https://cdn.bootcss.com/datatables/1.10.15/css/dataTables.bootstrap.min.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- &#x5F15;&#x5165;jQuery&#x4F9D;&#x8D56; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js&quot;</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &#x5F15;&#x5165;dataTables &#x63D2;&#x4EF6; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcss.com/datatables/1.10.15/js/jquery.dataTables.min.js&quot;</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &#x5F15;&#x5165;bootstrap&#x4E3B;&#x9898;js --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcss.com/datatables/1.10.15/js/dataTables.bootstrap.js&quot;</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- &#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x666E;&#x901A;&#x7684;table&#x5143;&#x7D20; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">&quot;dtTable&quot;</span> <span class="attr">class</span>=<span class="string">&quot;table table-striped&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    /**</span></span><br><span class="line"><span class="undefined">    * &#x6839;&#x636E;&#x4E2A;&#x4EBA;&#x7ECF;&#x9A8C;&#x603B;&#x7ED3;&#x7684;&#x5DE5;&#x4F5C;&#x4E2D;&#x5E38;&#x7528;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x80FD;&#x591F;&#x6EE1;&#x8DB3;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x3002;</span></span><br><span class="line"><span class="undefined">    **/</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> $dtTable = $(<span class="string">&quot;#dtTable&quot;</span>).DataTable({</span></span><br><span class="line"><span class="javascript">        serverSide: <span class="literal">true</span>, <span class="comment">// &#x5F00;&#x542F;&#x670D;&#x52A1;&#x7AEF;&#x5904;&#x7406;</span></span></span><br><span class="line"><span class="javascript">        stateSave: <span class="literal">false</span>, <span class="comment">// &#x5173;&#x95ED;&#x72B6;&#x6001;&#x4FDD;&#x5B58;</span></span></span><br><span class="line"><span class="javascript">        dom: <span class="string">&apos;&lt;&quot;row&quot; &lt;&quot;col-md-12&quot; t&gt;&gt;&lt;&quot;row&quot; &lt;&quot;col-md-6&quot; i&gt;&lt;&quot;col-md-6&quot; p&gt;&gt;&apos;</span>,</span></span><br><span class="line"><span class="javascript">        pageLength: <span class="number">10</span>, <span class="comment">// &#x6BCF;&#x9875;&#x5BB9;&#x91CF;</span></span></span><br><span class="line"><span class="javascript">        ordering: <span class="literal">true</span>, <span class="comment">// &#x662F;&#x5426;&#x5F00;&#x542F;&#x6392;&#x5E8F;&#xFF0C;&#x9ED8;&#x8BA4;true</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// &#x5EF6;&#x8FDF;&#x8BF7;&#x6C42;&#x52A0;&#x8F7D;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x76F4;&#x5230;&#x8868;&#x683C;&#x7B2C;&#x4E8C;&#x6B21;&#x7ED8;&#x5236; (http://www.datatables.club/reference/option/deferLoading.html)</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// &#x5982;&#x679C;&#x4E0D;&#x914D;&#x7F6E;&#x7684;&#x8BDD;&#xFF0C;datatables&#x4F1A;&#x5728;&#x521D;&#x59CB;&#x5316;&#x65F6;&#x53BB;&#x52A0;&#x8F7D;&#x6570;&#x636E;&#xFF0C;&#x6B64;&#x65F6;&#x6574;&#x4E2A;&#x9875;&#x9762;&#x53EF;&#x80FD;&#x5C1A;&#x672A;&#x5168;&#x90E8;&#x52A0;&#x8F7D;&#x5B8C;&#xFF0C;&#x67D0;&#x4E9B;&#x573A;&#x666F;&#x4E0B;&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x73B0;&#x5F02;&#x5E38;&#x3002;</span></span></span><br><span class="line"><span class="undefined">        deferLoading: 0, </span></span><br><span class="line"><span class="javascript">        ajax: <span class="function"><span class="keyword">function</span> (<span class="params">params, callback, obj</span>) </span>{</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> reqParams = {</span></span><br><span class="line"><span class="undefined">                draw: params.draw,</span></span><br><span class="line"><span class="undefined">                length: params.length,</span></span><br><span class="line"><span class="undefined">                start: params.start,</span></span><br><span class="line"><span class="javascript">                orderField: params.columns[params.order[<span class="number">0</span>].column].name, <span class="comment">// &#x6392;&#x5E8F;&#x5B57;&#x6BB5;</span></span></span><br><span class="line"><span class="javascript">                orderDir: params.order[<span class="number">0</span>].dir <span class="comment">// &#x6392;&#x5E8F;&#x65B9;&#x5411;</span></span></span><br><span class="line"><span class="undefined">            }</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="comment">// &#x5982;&#x679C;&#x9700;&#x8981;&#x5176;&#x5B83;&#x67E5;&#x8BE2;&#x53C2;&#x6570;&#x7684;&#xFF0C;&#x8BF7;&#x9644;&#x52A0;&#x5728;reqParams&#x4E2D;&#x3002;</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            $.post(<span class="string">&quot;/example/datatables/ajax.htm&quot;</span>, reqParams, <span class="function"><span class="keyword">function</span>(<span class="params">res, status, xhr</span>) </span>{</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">if</span> (res.success) {</span></span><br><span class="line"><span class="undefined">                        callback(res);</span></span><br><span class="line"><span class="javascript">                    } <span class="keyword">else</span> {</span></span><br><span class="line"><span class="undefined">                        callback({</span></span><br><span class="line"><span class="undefined">                            data: [],</span></span><br><span class="line"><span class="undefined">                            draw: params.draw,</span></span><br><span class="line"><span class="undefined">                            recordsFiltered: 0,</span></span><br><span class="line"><span class="undefined">                            recordsTotal: 0</span></span><br><span class="line"><span class="undefined">                        });</span></span><br><span class="line"><span class="undefined">                        alert(res.message);</span></span><br><span class="line"><span class="undefined">                    }</span></span><br><span class="line"><span class="javascript">                }, <span class="string">&apos;json&apos;</span>);</span></span><br><span class="line"><span class="undefined">        },</span></span><br><span class="line"><span class="undefined">        order: [</span></span><br><span class="line"><span class="javascript">            [<span class="number">0</span>, <span class="string">&apos;desc&apos;</span>]</span></span><br><span class="line"><span class="undefined">        ],</span></span><br><span class="line"><span class="javascript">        <span class="comment">// &#x5217;&#x7ED1;&#x5B9A;&#xFF0C;&#x901A;&#x8FC7;data&#x548C;&#x6570;&#x636E;&#x91CC;&#x7684;&#x5C5E;&#x6027;&#x7ED1;&#x5B9A;</span></span></span><br><span class="line"><span class="undefined">        columns: [</span></span><br><span class="line"><span class="javascript">            {<span class="attr">name</span>: <span class="string">&quot;id&quot;</span>, <span class="attr">data</span>: <span class="string">&quot;id&quot;</span>, <span class="attr">title</span>: <span class="string">&quot;id&quot;</span>},</span></span><br><span class="line"><span class="javascript">            {<span class="attr">name</span>: <span class="string">&quot;name&quot;</span>, <span class="attr">data</span>: <span class="string">&quot;name&quot;</span>, <span class="attr">title</span>: <span class="string">&quot;&#x59D3;&#x540D;&quot;</span>, <span class="attr">orderable</span>: <span class="literal">false</span>},</span></span><br><span class="line"><span class="undefined">            {</span></span><br><span class="line"><span class="javascript">                name: <span class="string">&quot;sex&quot;</span>, <span class="attr">data</span>: <span class="string">&quot;sex&quot;</span>, <span class="attr">title</span>: <span class="string">&quot;&#x6027;&#x522B;&quot;</span>,</span></span><br><span class="line"><span class="javascript">                render: <span class="function"><span class="keyword">function</span>(<span class="params">data, type, row, meta</span>) </span>{</span></span><br><span class="line"><span class="javascript">                    <span class="comment">// &#x5982;&#x679C;&#x672A;&#x6307;&#x5B9A; &#x201C; data: &apos;sex&apos; &#x201D;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;data&#x53C2;&#x6570;&#x5C06;&#x4F1A;&#x662F; undefined</span></span></span><br><span class="line"><span class="javascript">                    <span class="comment">// row&#xFF1A;&#x670D;&#x52A1;&#x7AEF;&#x8FD4;&#x56DE;&#x7684;&#x884C;&#x6570;&#x636E;</span></span></span><br><span class="line"><span class="javascript">                    <span class="comment">// meta&#xFF1A;{col: &quot;&#x5217;&#x53F7;&#xFF0C;&#x4ECE;0&#x5F00;&#x59CB;&quot;, row: &quot;&#x884C;&#x53F7;&#xFF0C;&#x4ECE;0&#x5F00;&#x59CB;&quot;, settings: &quot;datatables&#x914D;&#x7F6E;&quot;}</span></span></span><br><span class="line"><span class="javascript">                    <span class="keyword">if</span> (data == <span class="string">&quot;MAN&quot;</span>) {</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">return</span> <span class="string">&quot;&#x7537;&quot;</span>;</span></span><br><span class="line"><span class="javascript">                    } <span class="keyword">else</span> <span class="keyword">if</span> (data == <span class="string">&quot;WOMAN&quot;</span>) {</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">return</span> <span class="string">&quot;&#x5973;&quot;</span>;</span></span><br><span class="line"><span class="javascript">                    } <span class="keyword">else</span> {</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">return</span> <span class="string">&quot;&#x592A;&#x76D1;&quot;</span>;</span></span><br><span class="line"><span class="undefined">                    }</span></span><br><span class="line"><span class="undefined">                }</span></span><br><span class="line"><span class="undefined">            },</span></span><br><span class="line"><span class="undefined">            {</span></span><br><span class="line"><span class="javascript">                title: <span class="string">&quot;&#x64CD;&#x4F5C;&quot;</span>,</span></span><br><span class="line"><span class="javascript">                orderable: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">                render: <span class="function"><span class="keyword">function</span>(<span class="params">data, type, row, meta</span>) </span>{</span></span><br><span class="line"><span class="xml">                    return &apos;<span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm btn-success js-update-btn&quot;</span>&gt;</span>&#x7F16;&#x8F91;<span class="tag">&lt;/<span class="name">button</span>&gt;</span>&apos; +</span></span><br><span class="line"><span class="xml">                            &apos; <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm btn-warning js-delete-btn&quot;</span>&gt;</span>&#x5220;&#x9664;<span class="tag">&lt;/<span class="name">button</span>&gt;</span>&apos;;</span></span><br><span class="line"><span class="undefined">                }</span></span><br><span class="line"><span class="undefined">            }</span></span><br><span class="line"><span class="undefined">        ],</span></span><br><span class="line"><span class="undefined">        language: {</span></span><br><span class="line"><span class="javascript">            sEmptyTable: <span class="string">&quot;&#x6682;&#x65E0;&#x6570;&#x636E;...&quot;</span>,</span></span><br><span class="line"><span class="javascript">            sInfo: <span class="string">&quot;_START_ &#x5230; _END_, &#x603B;&#x5171; _TOTAL_ &#x6761;&#x8BB0;&#x5F55;&quot;</span>,</span></span><br><span class="line"><span class="javascript">            sInfoEmpty: <span class="string">&quot;0 &#x5230; 0 &#x603B;&#x5171; 0 &#x6761;&#x8BB0;&#x5F55;&quot;</span>,</span></span><br><span class="line"><span class="javascript">            sInfoFiltered: <span class="string">&quot;(&#x603B;&#x5171; _MAX_ &#x6761;&#x8BB0;&#x5F55;)&quot;</span>,</span></span><br><span class="line"><span class="javascript">            sInfoPostFix: <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="javascript">            sInfoThousands: <span class="string">&quot;.&quot;</span>,</span></span><br><span class="line"><span class="javascript">            sLengthMenu: <span class="string">&quot;_MENU_  &#x6761; / &#x6BCF;&#x9875;&quot;</span>,</span></span><br><span class="line"><span class="javascript">            sLoadingRecords: <span class="string">&quot;&#x6B63;&#x5728;&#x52A0;&#x8F7D;&#x4E2D;...&quot;</span>,</span></span><br><span class="line"><span class="javascript">            sProcessing: <span class="string">&quot;&#x6B63;&#x5728;&#x52A0;&#x8F7D;&#x4E2D;...&quot;</span>,</span></span><br><span class="line"><span class="javascript">            sSearch: <span class="string">&quot;&#x641C;&#x7D22;&quot;</span>,</span></span><br><span class="line"><span class="javascript">            sZeroRecords: <span class="string">&quot;&#x672A;&#x627E;&#x5230;&#x4EFB;&#x4F55;&#x76F8;&#x5173;&#x8BB0;&#x5F55;.&quot;</span>,</span></span><br><span class="line"><span class="undefined">            oPaginate: {</span></span><br><span class="line"><span class="javascript">                sFirst: <span class="string">&quot;&#x9996;&#x9875;&quot;</span>,</span></span><br><span class="line"><span class="javascript">                sPrevious: <span class="string">&quot;&#x4E0A;&#x4E00;&#x9875;&quot;</span>,</span></span><br><span class="line"><span class="javascript">                sNext: <span class="string">&quot;&#x4E0B;&#x4E00;&#x9875;&quot;</span>,</span></span><br><span class="line"><span class="javascript">                sLast: <span class="string">&quot;&#x6700;&#x540E;&#x4E00;&#x9875;&quot;</span></span></span><br><span class="line"><span class="undefined">            }</span></span><br><span class="line"><span class="undefined">        },</span></span><br><span class="line"><span class="javascript">        initComplete: <span class="function"><span class="keyword">function</span>(<span class="params">settings, json</span>) </span>{</span></span><br><span class="line"><span class="javascript">            <span class="comment">// &#x8868;&#x683C;&#x521D;&#x59CB;&#x5316;&#x5B8C;&#x6210;&#x65F6;&#x56DE;&#x8C03;</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log( <span class="string">&apos;DataTables has finished its initialisation.&apos;</span> );</span></span><br><span class="line"><span class="undefined">        },</span></span><br><span class="line"><span class="javascript">        drawCallback: <span class="function"><span class="keyword">function</span>(<span class="params">settings</span>)</span>{</span></span><br><span class="line"><span class="javascript">            <span class="comment">// &#x8868;&#x683C;&#x7ED8;&#x5236;&#x5B8C;&#x6210;&#x65F6;&#x56DE;&#x8C03;</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&quot;draw finish&quot;</span>);</span></span><br><span class="line"><span class="undefined">        }</span></span><br><span class="line"><span class="undefined">    });</span></span><br><span class="line"><span class="javascript">    $(<span class="string">&quot;#dtTable&quot;</span>).on(<span class="string">&quot;click&quot;</span>, <span class="string">&quot;.js-update-btn&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>{</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> tr = $(<span class="keyword">this</span>).parent().parent();</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> row = $dtTable.row(tr); <span class="comment">// &#x83B7;&#x53D6;&#x884C;&#x6570;&#x636E;</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(row);</span></span><br><span class="line"><span class="undefined">    });</span></span><br><span class="line"><span class="javascript">    <span class="comment">// &#x5982;&#x679C;&#x914D;&#x7F6E;&#x4E86; deferLoading&#xFF0C;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x6839;&#x636E;&#x9700;&#x8981;&#x624B;&#x52A8;&#x52A0;&#x8F7D;&#x4E00;&#x6B21;&#x6570;&#x636E;&#x3002;</span></span></span><br><span class="line"><span class="javascript">    $dtTable.draw();<span class="comment">//&#x624B;&#x52A8;&#x6E32;&#x67D3;&#x6570;&#x636E;</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>java &#x8BF7;&#x6C42;&#x5B9E;&#x4F53;&#xFF0C;&#x8FD9;&#x91CC;&#x53EA;&#x662F;&#x7B80;&#x5355;&#x5C01;&#x88C5;&#x4E86;&#x5206;&#x9875;&#x548C;&#x6392;&#x5E8F;&#x53C2;&#x6570;&#x3002;<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * jQuery DataTables &#x63D2;&#x4EF6;&#x8BF7;&#x6C42;&#x5B9E;&#x4F53;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> &lt;a href=&quot;https://datatables.net/&quot;&gt;DataTables&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DTRequest</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x91CD;&#x7ED8;&#x6B21;&#x6570;&#xFF08;&#x63D2;&#x4EF6;&#x6807;&#x51C6;&#x5B57;&#x6BB5;&#xFF09;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer draw;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x6570;&#x636E;&#x8D77;&#x59CB;&#x4F4D;&#x7F6E;&#xFF0C;&#x4ECE;0&#x5F00;&#x59CB;&#xFF08;&#x63D2;&#x4EF6;&#x6807;&#x51C6;&#x5B57;&#x6BB5;&#xFF09;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer start;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x9700;&#x8981;&#x7684;&#x6570;&#x636E;&#x6761;&#x6570;&#xFF0C;&#x5373;&#x6BCF;&#x9875;&#x5BB9;&#x91CF;&#xFF08;&#x63D2;&#x4EF6;&#x6807;&#x51C6;&#x5B57;&#x6BB5;&#xFF09;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer length;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String orderField; <span class="comment">// &#x6392;&#x5E8F;&#x5B57;&#x6BB5;</span></span><br><span class="line">    <span class="keyword">private</span> String orderDir; <span class="comment">// &#x6392;&#x5E8F;&#x65B9;&#x5411;&#xFF1A;&apos;asc&apos;&#x3001;&apos;desc&apos;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getDraw</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> draw;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDraw</span><span class="params">(Integer draw)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.draw = draw;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getStart</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> start;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStart</span><span class="params">(Integer start)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.start = start;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getLength</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> length;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLength</span><span class="params">(Integer length)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.length = length;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getOrderField</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> orderField;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderField</span><span class="params">(String orderField)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.orderField = orderField;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getOrderDir</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> orderDir;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderDir</span><span class="params">(String orderDir)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.orderDir = orderDir;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p><p>java &#x54CD;&#x5E94;&#x5B9E;&#x4F53;&#xFF0C;&#x8FD9;&#x91CC;&#x591A;&#x5C01;&#x88C5;&#x4E86;success&#x548C;message&#x5B57;&#x6BB5;&#xFF0C;&#x7528;&#x4E8E;&#x5224;&#x65AD;&#x8BF7;&#x6C42;&#x662F;&#x5426;&#x6210;&#x529F;&#xFF0C;&#x4EE5;&#x53CA;&#x9519;&#x8BEF;message&#xFF0C;&#x4EE5;&#x63D0;&#x5347;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x3002;&#x6807;&#x6CE8;<code>&#x63D2;&#x4EF6;&#x6807;&#x51C6;&#x5B57;&#x6BB5;</code>&#x7684;&#x662F;&#x63D2;&#x4EF6;&#x5FC5;&#x987B;&#x7684;&#x5B57;&#x6BB5;&#xFF0C;&#x4E0D;&#x80FD;&#x4E3A;&#x7A7A;&#x3002;<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * jQuery DataTables &#x63D2;&#x4EF6;&#x54CD;&#x5E94;&#x5B9E;&#x4F53;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> &lt;a href=&quot;https://datatables.net/&quot;&gt;DataTables&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DTResponse</span>&lt;<span class="title">T</span>&gt; </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> success;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x6570;&#x636E;&#xFF08;&#x63D2;&#x4EF6;&#x6807;&#x51C6;&#x5B57;&#x6BB5;&#xFF09;&#x3002;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; data;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x91CD;&#x7ED8;&#x6B21;&#x6570;&#xFF08;&#x63D2;&#x4EF6;&#x6807;&#x51C6;&#x5B57;&#x6BB5;&#xFF09;&#x3002;&#x8BE5;&#x503C;&#x6765;&#x81EA;&#x4E8E; {<span class="doctag">@link</span> DTRequest#draw }</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer draw;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x603B;&#x8BB0;&#x5F55;&#x6570;&#xFF08;&#x63D2;&#x4EF6;&#x6807;&#x51C6;&#x5B57;&#x6BB5;&#xFF09;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer recordsTotal;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x7B5B;&#x9009;&#x5230;&#x7684;&#x8BB0;&#x5F55;&#x6570;&#xFF08;&#x63D2;&#x4EF6;&#x6807;&#x51C6;&#x5B57;&#x6BB5;&#xFF09;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer recordsFiltered;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DTResponse</span><span class="params">()</span> </span>{</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DTResponse</span><span class="params">(List&lt;T&gt; data, Integer draw, Integer recordsFiltered)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.success = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">        <span class="keyword">this</span>.recordsFiltered = recordsFiltered;</span><br><span class="line">        <span class="keyword">this</span>.recordsTotal = recordsFiltered;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DTResponse</span><span class="params">(List&lt;T&gt; data, Integer draw, Integer recordsFiltered, Integer recordsTotal)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.success = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">        <span class="keyword">this</span>.recordsFiltered = recordsFiltered;</span><br><span class="line">        <span class="keyword">this</span>.recordsTotal = recordsTotal;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSuccess</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> success;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSuccess</span><span class="params">(<span class="keyword">boolean</span> success)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.success = success;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMessage</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMessage</span><span class="params">(String message)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.message = message;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;T&gt; <span class="title">getData</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(List&lt;T&gt; data)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getDraw</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> draw;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDraw</span><span class="params">(Integer draw)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.draw = draw;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getRecordsTotal</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> recordsTotal;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRecordsTotal</span><span class="params">(Integer recordsTotal)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.recordsTotal = recordsTotal;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getRecordsFiltered</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> recordsFiltered;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRecordsFiltered</span><span class="params">(Integer recordsFiltered)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.recordsFiltered = recordsFiltered;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1&gt;&amp;#x7B80;&amp;#x4ECB;&lt;/h1&gt;
&lt;p&gt;Datatables&amp;#x662F;&amp;#x4E00;&amp;#x6B3E;jquery&amp;#x8868;&amp;#x683C;&amp;#x63D2;&amp;#x4EF6;&amp;#x3002;&amp;#x5B83;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A
      
    
    </summary>
    
      <category term="jQuery" scheme="https://yyhan.github.io/categories/jQuery/"/>
    
    
      <category term="DataTables" scheme="https://yyhan.github.io/tags/DataTables/"/>
    
      <category term="jQuery" scheme="https://yyhan.github.io/tags/jQuery/"/>
    
  </entry>
  
  <entry>
    <title>log4j 使用指南</title>
    <link href="https://yyhan.github.io/2017/07/23/log4j-%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"/>
    <id>https://yyhan.github.io/2017/07/23/log4j-使用指南/</id>
    <published>2017-07-23T08:21:26.000Z</published>
    <updated>2017-12-03T14:05:16.971Z</updated>
    
    <content type="html"><![CDATA[<h1>&#x4F9D;&#x8D56;</h1><p>&#x7248;&#x672C;&#xFF1A; 2.10.0</p><p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- log4j &#x6838;&#x5FC3;jar&#x5305; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.10.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- log4j &#x6838;&#x5FC3;jar&#x5305; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.10.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- &#x5C06; common-logging &#x7684;&#x65E5;&#x5FD7;&#x6865;&#x63A5;&#x5230; log4j --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-jcl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.10.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- &#x5C06; log4j 1.x &#x7684;&#x65E5;&#x5FD7;&#x6865;&#x63A5;&#x5230; log4j 2.x --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-1.2-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.10.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- &#x5C06; java.util.logging &#x7684;&#x65E5;&#x5FD7;&#x6865;&#x63A5;&#x5230; log4j 2.x --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-jul<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.10.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- &#x5C06; slf4j &#x7684;&#x65E5;&#x5FD7;&#x6865;&#x63A5;&#x5230; log4j 2.x&#x3002;&#x4E0D;&#x8981;&#x540C;&#x65F6;&#x5F15;&#x7528; log4j-to-slf4j --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-slf4j-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.10.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &#x5C06; log4j 2.x &#x7684;&#x65E5;&#x5FD7;&#x6865;&#x63A5;&#x5230; slf4j&#x3002;&#x4E0D;&#x8981;&#x540C;&#x65F6;&#x5F15;&#x7528; log4j-slf4j-impl --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-to-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.10.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- &#x5728;servlet&#x6216;jsp&#x5BB9;&#x5668;&#x4E2D;&#x5F3A;&#x70C8;&#x5EFA;&#x8BAE;&#x5F15;&#x5165;&#x8BE5;&#x4F9D;&#x8D56;&#xFF0C;&#x4EE5;&#x89E3;&#x51B3;log4j&#x542F;&#x52A8;&#x548C;&#x5378;&#x8F7D;&#x65F6;&#x7684;&#x8D44;&#x6E90;&#x6E05;&#x7406;&#x95EE;&#x9898; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.10.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h1>&#x914D;&#x7F6E;</h1><h2>&#x57FA;&#x672C;&#x914D;&#x7F6E;</h2><p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">&quot;WARN&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Properties</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &#x81EA;&#x5B9A;&#x4E49;&#x5C5E;&#x6027; --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &#x8BBE;&#x7F6E; log &#x76EE;&#x5F55; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Property</span> <span class="attr">name</span>=<span class="string">&quot;log.dir&quot;</span>&gt;</span>D:/logs/demo<span class="tag">&lt;/<span class="name">Property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &#x8BBE;&#x7F6E;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x7F16;&#x7801; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Property</span> <span class="attr">name</span>=<span class="string">&quot;charset.&quot;</span>&gt;</span>D:/logs/demo<span class="tag">&lt;/<span class="name">Property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &#x63A7;&#x5236;&#x53F0;appender --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">&quot;Console&quot;</span> <span class="attr">target</span>=<span class="string">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">charset</span>=<span class="string">&quot;${log.charset}&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level %logger - %msg %ex %n&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">&quot;appFileLog&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;${log.dir}/app.log&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">filePattern</span>=<span class="string">&quot;${log.dir}/%d{yyyy-MM-dd}/app.log&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level %logger - %msg %ex %n&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &#x9ED8;&#x8BA4;&#x65E5;&#x5FD7;&#x7EA7;&#x522B; debug --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">&quot;debug&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- &#x9ED8;&#x8BA4;&#x65E5;&#x5FD7;&#x8F93;&#x51FA;&#x5230; &#x63A7;&#x5236;&#x53F0; --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;Console&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;appFileLog&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &#x6253;&#x5370;spring info&#x65E5;&#x5FD7; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.springframework&quot;</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h2>web&#x73AF;&#x5883;&#x914D;&#x7F6E;</h2><h3>&#x6307;&#x5B9A;log4j&#x65E5;&#x5FD7;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</h3><p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>log4jConfiguration<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/WEB-INF/log4j.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h3>servlet 3.0</h3><p>&#x5728;servlet 3.0 &#x73AF;&#x5883;&#x4E2D;&#xFF0C;log4j2 &#x53EF;&#x4EE5;&#x81EA;&#x52A8;&#x6CE8;&#x518C;&#x542F;&#x52A8;&#x548C;&#x5378;&#x8F7D;&#x76D1;&#x542C;&#x5668;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x9700;&#x8981;&#x81EA;&#x52A8;&#x6CE8;&#x518C;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x914D;&#x7F6E;&#x7981;&#x7528;&#x3002;</p><p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>isLog4jAutoInitializationDisabled<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h3>servlet 2.5</h3><p>&#x5728;servlet 2.5 &#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x5FC5;&#x987B;&#x624B;&#x52A8;&#x6307;&#x5B9A; <code>Log4jServletContextListener</code> &#x4EE5;&#x6CE8;&#x518C; log4j &#x542F;&#x52A8;&#x548C;&#x5378;&#x8F7D;&#x76D1;&#x542C;&#x5668;</p><p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.apache.logging.log4j.web.Log4jServletContextListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h1>&#x4F7F;&#x7528;</h1><p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.LogManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.Logger;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LogManager.getLogger(<span class="string">&quot;HelloWorld&quot;</span>);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        logger.info(<span class="string">&quot;Hello, World!&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (logger.isDebugEnabled()) {</span><br><span class="line">          logger.debug(<span class="string">&quot;args[0]={}&quot;</span>, args[<span class="number">0</span>]);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1&gt;&amp;#x4F9D;&amp;#x8D56;&lt;/h1&gt;
&lt;p&gt;&amp;#x7248;&amp;#x672C;&amp;#xFF1A; 2.10.0&lt;/p&gt;
&lt;p&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span c
      
    
    </summary>
    
      <category term="log4j" scheme="https://yyhan.github.io/categories/log4j/"/>
    
    
      <category term="java" scheme="https://yyhan.github.io/tags/java/"/>
    
      <category term="log4j2" scheme="https://yyhan.github.io/tags/log4j2/"/>
    
      <category term="log4j" scheme="https://yyhan.github.io/tags/log4j/"/>
    
  </entry>
  
  <entry>
    <title>spring mvc项目搭建</title>
    <link href="https://yyhan.github.io/2017/07/23/spring-mvc%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/"/>
    <id>https://yyhan.github.io/2017/07/23/spring-mvc项目搭建/</id>
    <published>2017-07-23T07:22:29.000Z</published>
    <updated>2017-07-23T07:22:29.223Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Idea Ant编译项目内存溢出问题</title>
    <link href="https://yyhan.github.io/2017/07/23/Idea-Ant%E7%BC%96%E8%AF%91%E9%A1%B9%E7%9B%AE%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%E9%97%AE%E9%A2%98/"/>
    <id>https://yyhan.github.io/2017/07/23/Idea-Ant编译项目内存溢出问题/</id>
    <published>2017-07-23T05:22:15.000Z</published>
    <updated>2017-07-23T05:26:53.084Z</updated>
    
    <content type="html"><![CDATA[<p>idea&#x9ED8;&#x8BA4;&#x5728;&#x7F16;&#x8BD1;ant&#x9879;&#x76EE;&#x65F6;&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x5185;&#x5B58;&#x8F83;&#x5C0F;&#xFF0C;&#x5F53;&#x9879;&#x76EE;&#x8F83;&#x5927;&#x65F6;&#xFF0C;&#x5BB9;&#x6613;&#x51FA;&#x73B0;&#x5185;&#x5B58;&#x6EA2;&#x51FA;&#x95EE;&#x9898;&#xFF0C;&#x53EF;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x65B9;&#x5F0F;&#x8BBE;&#x7F6E;ant&#x7F16;&#x8BD1;&#x65F6;&#x5185;&#x5B58;&#xFF1A;</p><p>&#x8BBE;&#x7F6E;&#x5165;&#x53E3;&#xFF1A;<a class="magnific-img" href="/img/idea/idea-ant-1.png"><img src="/img/idea/idea-ant-1.png" alt="Image of Idea Ant" class="ui centered image"></a></p><p>&#x914D;&#x7F6E;&#x8BF4;&#x660E;&#xFF1A;<a class="magnific-img" href="/img/idea/idea-ant-2.png"><img src="/img/idea/idea-ant-2.png" alt="Image of Idea Ant" class="ui centered image"></a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;idea&amp;#x9ED8;&amp;#x8BA4;&amp;#x5728;&amp;#x7F16;&amp;#x8BD1;ant&amp;#x9879;&amp;#x76EE;&amp;#x65F6;&amp;#xFF0C;&amp;#x4F7F;&amp;#x7528;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x8F83;&amp;#x5C0F;&amp;#
      
    
    </summary>
    
      <category term="工具使用" scheme="https://yyhan.github.io/categories/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/"/>
    
    
      <category term="idea" scheme="https://yyhan.github.io/tags/idea/"/>
    
      <category term="ant" scheme="https://yyhan.github.io/tags/ant/"/>
    
      <category term="内存溢出" scheme="https://yyhan.github.io/tags/%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA/"/>
    
  </entry>
  
  <entry>
    <title>tomcat双向认证</title>
    <link href="https://yyhan.github.io/2017/07/06/tomcat%E5%8F%8C%E5%90%91%E8%AE%A4%E8%AF%81/"/>
    <id>https://yyhan.github.io/2017/07/06/tomcat双向认证/</id>
    <published>2017-07-06T14:26:22.000Z</published>
    <updated>2017-07-06T15:30:59.041Z</updated>
    
    <content type="html"><![CDATA[<h1>&#x6570;&#x5B57;&#x8BC1;&#x4E66;&#x76F8;&#x5173;&#x7684;&#x6807;&#x51C6;&#x548C;&#x534F;&#x8BAE;</h1><p>&#x53C2;&#x8003;&#xFF1A;<a href="https://en.wikipedia.org/wiki/PKCS" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/PKCS</a></p><table><thead><tr><th>&#x5173;&#x952E;&#x8BCD;</th><th>&#x63CF;&#x8FF0;</th></tr></thead><tbody><tr><td>PEM</td><td>PKIX, PKCS, and CMS &#x7ED3;&#x6784;&#x7684;&#x6587;&#x672C;&#x7F16;&#x7801;&#x683C;&#x5F0F;&#x3002;PEM&#x6700;&#x65E9;&#x662F;&#x57FA;&#x4E8E;&#x201C;&#x9690;&#x79C1;&#x589E;&#x5F3A;&#x90AE;&#x4EF6;&#x201D;&#x7684;1993&#x5E74;IETF&#x6807;&#x51C6;&#x96C6;&#x7684;&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x548C;&#x53D1;&#x9001;&#x52A0;&#x5BC6;&#x5BC6;&#x94A5;&#xFF0C;&#x8BC1;&#x4E66;&#x548C;&#x5176;&#x4ED6;&#x6570;&#x636E;&#x7684;&#x4E8B;&#x5B9E;&#x4E0A;&#x7684;&#x6587;&#x4EF6;&#x683C;&#x5F0F;&#x3002; &#x539F;&#x6807;&#x51C6;&#x672A;&#x88AB;&#x91C7;&#x7528;&#xFF0C;&#x4F46;&#x5176;&#x5B9A;&#x4E49;&#x7684;&#x6587;&#x672C;&#x7F16;&#x7801;&#x975E;&#x5E38;&#x53D7;&#x6B22;&#x8FCE;&#xFF0C;&#x6700;&#x7EC8;&#x7531;IETF&#x5728;RFC 7468&#x4E2D;&#x5F62;&#x5F0F;&#x5316;&#x3002;&#x53C2;&#x8003;&#xFF1A;https:tools.ietf.org/html/rfc7468</td></tr><tr><td>DER</td><td>&#x53EF;&#x533A;&#x5206;&#x7F16;&#x7801;&#x89C4;&#x5219; (Distinguished Encoding Rules) &#x3002;&#x53EF;&#x5305;&#x542B;&#x6240;&#x6709;&#x79C1;&#x94A5;&#x3001;&#x516C;&#x94A5;&#x548C;&#x8BC1;&#x4E66;&#x3002;&#x5B83;&#x662F;&#x5927;&#x591A;&#x6570;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x7F3A;&#x7701;&#x683C;&#x5F0F;&#xFF0C;&#x5E76;&#x6309; ASN1 DER &#x683C;&#x5F0F;&#x5B58;&#x50A8;&#x3002;&#x5B83;&#x662F;&#x65E0;&#x62A5;&#x5934;&#x7684;(PEM &#x662F;&#x7528;&#x6587;&#x672C;&#x62A5;&#x5934;&#x5305;&#x56F4;&#x7684; DER)&#x3002;&#x4E00;&#x822C;&#x4F7F;&#x7528;&quot;.cer&quot;&#x505A;&#x6587;&#x4EF6;&#x540E;&#x7F00;</td></tr><tr><td>JKS</td><td>&#x901A;&#x5E38;&#x53EF;&#x4EE5;&#x5C06;Apache/OpenSSL&#x4F7F;&#x7528;&#x7684;&#x201C;KEY&#x6587;&#x4EF6; + CRT&#x6587;&#x4EF6;&#x201D;&#x683C;&#x5F0F;&#x201D;&#x8F6C;&#x6362;&#x4E3A;&#x6807;&#x51C6;&#x7684;Java Key Store(JKS)&#x6587;&#x4EF6;&#x3002;&#x4E00;&#x822C;&#x4EE5;&quot;.keystore&quot;&#x4F5C;&#x4E3A;&#x6587;&#x4EF6;&#x540E;&#x7F00;&#x3002;</td></tr><tr><td>CSR</td><td>&#x8BC1;&#x4E66;&#x7B7E;&#x540D;&#x8BF7;&#x6C42;(Certificate Signing Request)&#x3002;&#x53D1;&#x9001;&#x7ED9;CA&#x7B7E;&#x540D;&#x7684;&#x8BF7;&#x6C42;&#x5185;&#x5BB9;&#x6807;&#x51C6;&#xFF0C;&#x4E00;&#x822C;&#x5B58;&#x50A8;&#x5728;&#x4E00;&#x4E2A;&quot;.csr&quot;&#x540E;&#x7F00;&#x7684;&#x6587;&#x4EF6;&#x4E2D;&#x3002;</td></tr><tr><td>CRT</td><td>&#x8BC1;&#x4E66;&#x6587;&#x4EF6;&#x4E00;&#x822C;&#x4EE5;&quot;.crt&quot;&#x4F5C;&#x4E3A;&#x6587;&#x4EF6;&#x540E;&#x7F00;&#x3002;</td></tr><tr><td>KEY</td><td>PEM&#x683C;&#x5F0F;&#x7684;&#x79C1;&#x94A5;&#x6587;&#x4EF6;&#x4E00;&#x822C;&#x4EE5;&quot;.key&quot;&#x4F5C;&#x4E3A;&#x6587;&#x4EF6;&#x540E;&#x7F00;&#x3002;</td></tr><tr><td>CRL</td><td>&#x8BC1;&#x4E66;&#x540A;&#x9500;&#x5217;&#x8868; (Certification Revocation List) &#x3002;</td></tr><tr><td>PKCS7</td><td>&#x52A0;&#x5BC6;&#x6D88;&#x606F;&#x8BED;&#x6CD5;&#x6807;&#x51C6;&#x3002;&#xFF08;&#x53C2;&#x8003;&#xFF1A;https:www.ietf.org/rfc/rfc2315.txt&#xFF09;</td></tr><tr><td>PKCS12</td><td>&#x4E2A;&#x4EBA;&#x4FE1;&#x606F;&#x4EA4;&#x6362;&#x8BED;&#x6CD5;&#x6807;&#x51C6;&#x3002;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;&#x901A;&#x7528;&#x7684;&#x6587;&#x4EF6;&#x683C;&#x5F0F;&#x6807;&#x51C6;&#xFF0C;&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x9644;&#x5E26;&#x516C;&#x94A5;&#x8BC1;&#x4E66;&#x7684;&#x79C1;&#x94A5;&#xFF0C;&#x5E76;&#x4F7F;&#x7528;&#x57FA;&#x4E8E;&#x5BC6;&#x7801;&#x7684;&#x5BF9;&#x79F0;&#x5BC6;&#x94A5;&#x52A0;&#x5BC6;&#x3002;&#x524D;&#x8EAB;&#x662F;PFX&#x3002;&#x4E00;&#x822C;&#x4EE5;&quot;.p12&quot;&#x4F5C;&#x4E3A;&#x6587;&#x4EF6;&#x540E;&#x7F00;&#x3002;</td></tr><tr><td>X.509</td><td>&#x516C;&#x94A5;&#x8BC1;&#x4E66;&#x6807;&#x51C6;</td></tr></tbody></table><h1>&#x751F;&#x6210;&#x8BC1;&#x4E66;</h1><p>&#x4F7F;&#x7528;java&#x81EA;&#x5E26;&#x7684;keytool&#x5DE5;&#x5177;&#x751F;&#x6210;&#x8BC1;&#x4E66;&#x3002;&#x5982;&#x679C;&#x6587;&#x7AE0;&#x4E2D;&#x6709;&#x54EA;&#x4E9B;&#x53C2;&#x6570;&#x4E0D;&#x660E;&#x767D;&#x7684;&#x53EF;&#x4EE5;&#x53C2;&#x8003;<a href="http://docs.oracle.com/javase/7/docs/technotes/tools/windows/keytool.html" target="_blank" rel="noopener">keytool&#x5B98;&#x65B9;&#x6587;&#x6863;</a></p><h2>&#x524D;&#x671F;&#x89C4;&#x5212;</h2><p>&#x6D89;&#x53CA;&#x7684;&#x540D;&#x79F0;&#x6BD4;&#x8F83;&#x591A;&#xFF0C;&#x5148;&#x89C4;&#x5212;&#x4E00;&#x4E0B;&#xFF0C;&#x540E;&#x9762;&#x4F1A;&#x4F5C;&#x8BF4;&#x660E;&#xFF08;&#x4EE5;&#x4E0B;&#x6570;&#x636E;&#x7EAF;&#x5C5E;&#x6D4B;&#x8BD5;&#xFF0C;&#x5982;&#x6709;&#x96F7;&#x540C;&#xFF0C;&#x8BF7;&#x77E5;&#x4F1A;&#xFF09;&#x3002;</p><p>&#x7EC4;&#x7EC7;&#x673A;&#x6784;&#xFF08;&#x516C;&#x53F8;&#x540D;&#x79F0;&#xFF09;&#xFF1A;XTBaBa&#x7EC4;&#x7EC7;&#x673A;&#x6784;&#x90E8;&#x95E8;&#xFF1A;XTBaBa CA&#x6839;&#x8BC1;&#x4E66;&#x540D;&#x79F0;&#xFF1A;XTBaBa Root CA&#x57DF;&#x540D;&#xFF1A;a.xtbaba.com | b.xtbaba.com</p><p>&#x670D;&#x52A1;&#x7AEF;&#x8BC1;&#x4E66;&#x5BC6;&#x94A5;&#x5E93;&#xFF1A;<code>tomcat.keystore</code>&#x670D;&#x52A1;&#x7AEF;&#x4FE1;&#x4EFB;&#x8BC1;&#x4E66;&#x5217;&#x8868;&#x5BC6;&#x94A5;&#x5E93;&#xFF1A;<code>tomcat_trust.keystore</code>&#x6839;&#x8BC1;&#x4E66;&#x5BC6;&#x94A5;&#x5E93;&#xFF1A;<code>root.keystore</code>&#x5BA2;&#x6237;&#x8BC1;&#x4E66;&#xFF1A;<code>xiaotian.p12</code></p><p>&#x6839;&#x8BC1;&#x4E66;&#x5728;&#x5BC6;&#x94A5;&#x5E93;&#x4E2D;&#x7684;&#x522B;&#x540D;&#xFF1A;root&#x6240;&#x6709;&#x5BC6;&#x94A5;&#x5E93;&amp;&#x5BC6;&#x94A5;&#x7684;&#x5BC6;&#x7801;&#xFF1A;123456</p><h2>&#x77E5;&#x8BC6;&#x626B;&#x76F2;</h2><ul class="ui list"><li>keytool &#x662F;java&#x81EA;&#x5E26;&#x7684;&#x63D0;&#x4F9B;&#x751F;&#x6210;&#x8BC1;&#x4E66;&#x3001;&#x6570;&#x5B57;&#x7B7E;&#x540D;&#x7B49;&#x529F;&#x80FD;&#x7684;&#x5C0F;&#x5DE5;&#x5177;</li><li>keytool &#x751F;&#x6210;&#x7684;&#x5BC6;&#x94A5;&#x5E93;<code>&#x4E0D;&#x80FD;&#x5BFC;&#x51FA;&#x975E;&#x5BF9;&#x79F0;&#x7B97;&#x6CD5;&#x7684;&#x79C1;&#x94A5;</code></li><li>keytool &#x5BFC;&#x5165;&#x516C;&#x94A5;&#x8BC1;&#x4E66;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x522B;&#x540D;&#xFF08;alias&#xFF09;&#x76F8;&#x540C;&#xFF0C;&#x5219;&#x8BA4;&#x4E3A;&#x5BFC;&#x5165;&#x7684;&#x662F;CA&#x7B7E;&#x540D;&#x540E;&#x7684;&#x8BC1;&#x4E66;</li><li>https &#x5355;&#x5411;&#x8BA4;&#x8BC1;&#x6307;&#x5BA2;&#x6237;&#x7AEF;&#x9A8C;&#x8BC1;&#x670D;&#x52A1;&#x7AEF;&#x8EAB;&#x4EFD;&#xFF0C;&#x6211;&#x4EEC;&#x5E73;&#x5E38;&#x89C1;&#x7684;https&#x7AD9;&#x70B9;&#xFF0C;&#x90FD;&#x5C5E;&#x4E8E;<code>&#x5355;&#x5411;&#x8BA4;&#x8BC1;</code></li><li><code>&#x53CC;&#x5411;&#x8BA4;&#x8BC1;</code>&#x65F6;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x8BA9;&#x7528;&#x6237;&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x8BC1;&#x4E66;&#x4F20;&#x9012;&#x7ED9;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x7531;&#x670D;&#x52A1;&#x5668;&#x6838;&#x9A8C;&#x5BA2;&#x6237;&#x7684;&#x8BC1;&#x4E66;</li></ul><p>&#x66F4;&#x591A;&#x77E5;&#x8BC6;&#xFF0C;&#x8BF7;&#x53C2;&#x8003;<a href="http://docs.oracle.com/javase/7/docs/technotes/tools/windows/keytool.html" target="_blank" rel="noopener">keytool&#x5B98;&#x65B9;&#x6587;&#x6863;</a></p><h2>&#x751F;&#x6210;&#x6839;&#x8BC1;&#x4E66;</h2><p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x751F;&#x6210;&#x6839;&#x8BC1;&#x4E66;&#x5BC6;&#x94A5;&#x5BF9;&#x5E76;&#x4FDD;&#x5B58;&#x5230;tomcat.keystore&#x5BC6;&#x94A5;&#x5E93;&#x4E2D;</span></span><br><span class="line">keytool -genkeypair -keystore root.keystore -storepass 123456 -keyalg RSA -keypass 123456 -<span class="built_in">alias</span> root -dname <span class="string">&quot;CN=XTBaBa Root CA, OU=XTBaBa CA, O=XTBaBa, L=Hangzhou, S=Zhejiang, C=CN&quot;</span></span><br><span class="line"><span class="comment"># &#x5BFC;&#x51FA;&#x6839;&#x8BC1;&#x4E66;</span></span><br><span class="line">keytool -exportcert -keystore root.keystore -storepass 123456 -file root.crt -<span class="built_in">alias</span> root -v</span><br></pre></td></tr></table></figure></p><p>&#x5BA2;&#x6237;&#x9700;&#x8981;&#x5C06;<code>root.crt</code>&#x5BFC;&#x5165;&#x5230;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;<code>&#x53D7;&#x4FE1;&#x4EFB;&#x7684;&#x6839;&#x8BC1;&#x4E66;&#x9881;&#x53D1;&#x673A;&#x6784;</code>&#x8BC1;&#x4E66;&#x5206;&#x7C7B;&#x4E2D;&#xFF0C;&#x5426;&#x5219; https &#x5355;&#x5411;&#x8BA4;&#x8BC1;&#x4E0D;&#x901A;&#x8FC7;</p><h2>&#x751F;&#x6210;&#x670D;&#x52A1;&#x7AEF;&#x8BC1;&#x4E66;</h2><p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x751F;&#x6210;&#x670D;&#x52A1;&#x7AEF;&#x8BC1;&#x4E66;&#x5BC6;&#x94A5;&#x5BF9;</span></span><br><span class="line">keytool -genkeypair -keystore tomcat.keystore -storepass 123456 -keyalg RSA -keypass 123456 -<span class="built_in">alias</span> xtbaba_site -dname <span class="string">&quot;CN=XTBaBa Customer Site, OU=XTBaBa RD, O=XTBaBa, L=Hangzhou, S=Zhejiang, C=CN&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x751F;&#x6210;&#x670D;&#x52A1;&#x7AEF;&#x8BC1;&#x4E66;&#x7B7E;&#x540D;&#x8BF7;&#x6C42;</span></span><br><span class="line">keytool -certreq -keystore tomcat.keystore -storepass 123456 -<span class="built_in">alias</span> xtbaba_site -file xtbaba_site.csr</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x4F7F;&#x7528;&#x6839;&#x8BC1;&#x4E66;&#x5BF9;&#x670D;&#x52A1;&#x7AEF;&#x8BC1;&#x4E66;&#x7B7E;&#x540D;&#xFF0C;&#x7B7E;&#x540D;&#x65F6;&#x6307;&#x5B9A;&#x4E86;&#x4E24;&#x4E2A;&#x57DF;&#x540D;</span></span><br><span class="line">keytool -gencert -keystore tomcat.keystore -storepass 123456 -<span class="built_in">alias</span> root -infile xtbaba_site.csr -outfile xtbaba_site.cer -ext <span class="string">&quot;san=dns:a.xtbaba.com,dns:b.xtbaba.com&quot;</span> -ext eku=<span class="string">&quot;serverAuth,clientAuth&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x5C06;&#x6839;&#x8BC1;&#x4E66;&#x4E34;&#x65F6;&#x5BFC;&#x5165;&#x5230;tomcat.keystore&#x5BC6;&#x94A5;&#x5E93;&#x4E2D;</span></span><br><span class="line">keytool -importkeystore -srckeystore root.keystore -srcstorepass 123456 -srcalias root -destkeystore tomcat.keystore -deststorepass 123456 -destalias root</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x5C06;&#x7B7E;&#x540D;&#x540E;&#x7684;&#x670D;&#x52A1;&#x7AEF;&#x8BC1;&#x4E66;&#x5BFC;&#x5165;&#x5230;&#x670D;&#x52A1;&#x7AEF;&#x5BC6;&#x94A5;&#x5E93;</span></span><br><span class="line">keytool -import -keystore tomcat.keystore -storepass 123456 -file xtbaba_site.cer -<span class="built_in">alias</span> xtbaba_site</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x79FB;&#x9664;&#x6839;&#x8BC1;&#x4E66;&#xFF0C;&#x5207;&#x8BB0;&#x79FB;&#x9664;&#x6389;&#x554A;</span></span><br><span class="line">keytool -delete -keystore tomcat.keystore -storepass 123456 -<span class="built_in">alias</span> root</span><br></pre></td></tr></table></figure></p><h2>&#x751F;&#x6210;&#x5BA2;&#x6237;&#x8BC1;&#x4E66;</h2><p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x751F;&#x6210;&#x5BA2;&#x6237;&#x8BC1;&#x4E66;&#x5BC6;&#x94A5;&#x5BF9;&#xFF0C;&#x5BA2;&#x6237;&#x8BC1;&#x4E66;&#x9700;&#x8981;&#x4F7F;&#x7528;&quot;PKCS12&quot;&#x683C;&#x5F0F;</span></span><br><span class="line">keytool -genkeypair -keystore xiaotian.p12 -storepass 123456 -storetype PKCS12 -keyalg RSA -keypass 123456 -<span class="built_in">alias</span> xiaotian -dname <span class="string">&quot;CN=Xiaotian, OU=XTBaBa User, O=XTBaBa, L=Hangzhou, S=Zhejiang, C=CN&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x751F;&#x6210;&#x5BA2;&#x6237;&#x8BC1;&#x4E66;&#x7B7E;&#x540D;&#x8BF7;&#x6C42;</span></span><br><span class="line">keytool -certreq -keystore xiaotian.p12 -storepass 123456 -<span class="built_in">alias</span> xiaotian -file xiaotian.csr</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x4F7F;&#x7528;&#x6839;&#x8BC1;&#x4E66;&#x5BF9;&#x5BA2;&#x6237;&#x8BC1;&#x4E66;&#x7B7E;&#x540D;</span></span><br><span class="line">keytool -gencert -keystore root.keystore -storepass 123456 -<span class="built_in">alias</span> root -infile xiaotian.csr -outfile xiaotian.cer -ext eku=<span class="string">&quot;serverAuth,clientAuth&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x5BFC;&#x5165;&#x7B7E;&#x540D;&#x540E;&#x7684;&#x5BA2;&#x6237;&#x8BC1;&#x4E66;&#x5230;&#x5BC6;&#x94A5;&#x5E93;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. &#x9996;&#x5148;&#x5C06;&#x6839;&#x8BC1;&#x4E66;&#x5BFC;&#x5165;&#x5230;&#x5BA2;&#x6237;&#x8BC1;&#x4E66;&#x5BC6;&#x94A5;&#x5E93;&#x4E2D;</span></span><br><span class="line">keytool -importkeystore -srckeystore root.keystore -srcstorepass 123456 -srcalias root -destkeystore xiaotian.p12 -deststorepass 123456 -destalias root</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. &#x5C06;&#x7B7E;&#x540D;&#x540E;&#x7684;&#x5BA2;&#x6237;&#x8BC1;&#x4E66;&#x5BFC;&#x5165;&#x5230;&#x5BA2;&#x6237;&#x8BC1;&#x4E66;&#x5BC6;&#x94A5;&#x5E93;&#x4E2D;&#x3002;&#x5BFC;&#x5165;&#x7B7E;&#x540D;&#x540E;&#x7684;&#x8BC1;&#x4E66;&#x65F6;&#xFF0C;keytool&#x8981;&#x4ECE;&#x5BC6;&#x94A5;&#x5E93;&#x4E2D;&#x627E;&#x5230;&#x4E00;&#x4E2A;&#x8BC1;&#x4E66;&#x6765;&#x9A8C;&#x8BC1;&#x8BE5;&#x7B7E;&#x540D;&#xFF0C;&#x6240;&#x4EE5;&#x5FC5;&#x987B;&#x5C06;&#x6839;&#x8BC1;&#x4E66;&#x4E34;&#x65F6;&#x5BFC;&#x5165;&#x5230;&#x5BA2;&#x6237;&#x8BC1;&#x4E66;&#x5BC6;&#x94A5;&#x5E93;&#x4E2D;&#x3002;</span></span><br><span class="line">keytool -import -keystore xiaotian.p12 -storepass 123456 -file xiaotian.cer -<span class="built_in">alias</span> xiaotian</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. &#x4ECE;&#x5BA2;&#x6237;&#x8BC1;&#x4E66;&#x5BC6;&#x94A5;&#x5E93;&#x4E2D;&#x79FB;&#x9664;&#x6839;&#x8BC1;&#x4E66;&#x3002;&#x5343;&#x4E07;&#x522B;&#x628A;&#x6839;&#x8BC1;&#x4E66;&#x53D1;&#x7ED9;&#x7528;&#x6237;&#x4E86;</span></span><br><span class="line">keytool -delete -keystore xiaotian.p12 -storepass 123456 -<span class="built_in">alias</span> root</span><br></pre></td></tr></table></figure></p><ol class="ui list"><li>&#x5BFC;&#x5165;&#x7B7E;&#x540D;&#x540E;&#x7684;&#x8BC1;&#x4E66;&#x65F6;&#xFF0C;keytool&#x8981;&#x4ECE;&#x5BC6;&#x94A5;&#x5E93;&#x4E2D;&#x627E;&#x5230;&#x4E00;&#x4E2A;&#x8BC1;&#x4E66;&#x6765;&#x9A8C;&#x8BC1;&#x8BE5;&#x7B7E;&#x540D;&#xFF0C;&#x6240;&#x4EE5;&#x5FC5;&#x987B;&#x5C06;&#x6839;&#x8BC1;&#x4E66;&#x4E34;&#x65F6;&#x5BFC;&#x5165;&#x5230;&#x5BA2;&#x6237;&#x8BC1;&#x4E66;&#x5BC6;&#x94A5;&#x5E93;&#x4E2D;</li><li>&#x751F;&#x6210;&#x5B8C;&#x6BD5;&#x540E;&#xFF0C;&#x5C06; xiaotian.p12 &#x6587;&#x4EF6;&#x53D1;&#x9001;&#x7ED9;&#x5BA2;&#x6237;&#xFF0C;&#x5BA2;&#x6237;&#x5C06;&#x8BE5;&#x8BC1;&#x4E66;&#x5BFC;&#x5165;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x8BC1;&#x4E66;&#x5E93;&#x5373;&#x53EF;&#xFF08;&#x4E00;&#x822C;&#x5BFC;&#x5165;&#x5728;&#x4E2A;&#x4EBA;&#x8BC1;&#x4E66;&#x5206;&#x7C7B;&#x91CC;&#xFF09;&#x3002;</li><li>&#x7ED9;&#x5BA2;&#x6237;&#x751F;&#x6210;&#x5B8C;&#x8BC1;&#x4E66;&#x540E;&#xFF0C;&#x4E00;&#x5B9A;&#x8981;&#x4ECE; xiaotian.p12 &#x4E2D;&#x5220;&#x9664;&#x6839;&#x8BC1;&#x4E66;&#xFF0C;&#x5343;&#x4E07;&#x522B;&#x628A;&#x6839;&#x8BC1;&#x4E66;&#x53D1;&#x7ED9;&#x7528;&#x6237;&#x4E86;</li></ol><h2>&#x5C06;&#x5BA2;&#x6237;&#x8BC1;&#x4E66;&#x6DFB;&#x52A0;&#x5230;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x4FE1;&#x4EFB;&#x8BC1;&#x4E66;&#x5BC6;&#x94A5;&#x5E93;</h2><p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x5BFC;&#x5165;&#x6839;&#x8BC1;&#x4E66;</span></span><br><span class="line">keytool -importkeystore -srckeystore root.keystore -srcstorepass 123456 -srcalias root -destkeystore tomcat_trust.keystore -deststorepass 123456 -destalias root</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x5BFC;&#x5165;&#x5BA2;&#x6237;&#x8BC1;&#x4E66;</span></span><br><span class="line">keytool -import -keystore tomcat_trust.keystore -storepass 123456 -file xiaotian.cer -<span class="built_in">alias</span> xiaotian</span><br></pre></td></tr></table></figure></p><blockquote><p>&#x5FC5;&#x987B;&#x5C06;&#x6839;&#x8BC1;&#x4E66;&#x5BFC;&#x5165;&#x5230;<code>tomcat_trust.keystore</code>&#x5BC6;&#x94A5;&#x5E93;&#x4E2D;&#xFF0C;tomcat&#x5C06;&#x7528;&#x6B64;&#x6839;&#x8BC1;&#x4E66;&#x6765;&#x9A8C;&#x8BC1;&#x6D4F;&#x89C8;&#x5668;&#x63D0;&#x4EA4;&#x7684;&#x6839;&#x8BC1;&#x4E66;</p></blockquote><h2>keytool &#x5176;&#x5B83;&#x5E38;&#x7528;&#x547D;&#x4EE4;</h2><p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x67E5;&#x770B;&#x5BC6;&#x94A5;&#x5E93;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x5BC6;&#x94A5;</span></span><br><span class="line">keytool -list -keystore tomcat.keystore -storepass 123456 -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x67E5;&#x770B;&#x8BC1;&#x4E66;&#x5185;&#x5BB9;</span></span><br><span class="line">keytool -printcert -file xiaotian.cer</span><br></pre></td></tr></table></figure></p><h2>&#x914D;&#x7F6E;tomcat</h2><p>&#x4FEE;&#x6539;server.xml<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">!-</span> &#x8BBE;&#x7F6E;&#x7AEF;&#x53E3;&#x4E3A;<span class="attr">80</span>&#xFF0C;<span class="attr">redirectPort</span> &#x91CD;&#x5B9A;&#x5411;&#x5230;<span class="attr">https</span>&#x7AEF;&#x53E3; <span class="attr">--</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;80&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;HTTP/1.1&quot;</span> <span class="attr">connectionTimeout</span>=<span class="string">&quot;20000&quot;</span> <span class="attr">redirectPort</span>=<span class="string">&quot;443&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;443&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;org.apache.coyote.http11.Http11NioProtocol&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">maxThreads</span>=<span class="string">&quot;100&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">scheme</span>=<span class="string">&quot;https&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">secure</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">SSLEnabled</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">keyAlias</span>=<span class="string">&quot;xtbaba_site&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">keystoreFile</span>=<span class="string">&quot;D:/www/keys/tomcat.keystore&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">keystorePass</span>=<span class="string">&quot;123456&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">truststoreFile</span>=<span class="string">&quot;D:/www/keys/tomcat_trust.keystore&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">truststorePass</span>=<span class="string">&quot;123456&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">clientAuth</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">sslProtocol</span>=<span class="string">&quot;TLS&quot;</span></span></span><br><span class="line"><span class="tag">   /&gt;</span></span><br></pre></td></tr></table></figure></p><p>xml&#x6587;&#x4EF6;&#x914D;&#x7F6E;&#x8BF4;&#x660E;&#xFF1A;</p><ul class="ui list"><li><code>protocol</code> &#x5FC5;&#x987B;&#x914D;&#x7F6E;&#x4E3A;<code>org.apache.coyote.http11.Http11NioProtocol</code></li><li><code>keyAlias</code> &#x670D;&#x52A1;&#x5668;&#x8BC1;&#x4E66;&#x522B;&#x540D;</li><li><code>keystoreFile</code> &#x670D;&#x52A1;&#x5668;&#x8BC1;&#x4E66;&#x5BC6;&#x94A5;&#x5E93;</li><li><code>keystorePass</code> &#x670D;&#x52A1;&#x5668;&#x8BC1;&#x4E66;&#x5BC6;&#x94A5;&#x5E93;&#x5BC6;&#x7801;</li><li><code>truststoreFile</code> &#x670D;&#x52A1;&#x5668;&#x4FE1;&#x4EFB;&#x8BC1;&#x4E66;&#x5217;&#x8868;&#x5BC6;&#x94A5;&#x5E93;</li><li><code>truststorePass</code> &#x670D;&#x52A1;&#x5668;&#x4FE1;&#x4EFB;&#x8BC1;&#x4E66;&#x5217;&#x8868;&#x5BC6;&#x94A5;&#x5E93;&#x5BC6;&#x7801;</li><li><code>clientAuth</code> &#x5BA2;&#x6237;&#x7AEF;&#x8BA4;&#x8BC1;&#xFF1A;<ul><li><code>true</code>&#xFF1A;&#x5BA2;&#x6237;&#x7AEF;&#x5FC5;&#x987B;&#x63D0;&#x4F9B;&#x8BC1;&#x4E66;&#xFF1B;</li><li><code>false</code>&#xFF1A;&#x5BA2;&#x6237;&#x7AEF;&#x4E0D;&#x5FC5;&#x63D0;&#x4F9B;&#x8BC1;&#x4E66;&#xFF1B;</li><li><code>want</code>&#xFF1A;&#x5BA2;&#x6237;&#x7AEF;&#x63D0;&#x4E0D;&#x63D0;&#x4F9B;&#x8BC1;&#x4E66;&#x90FD;&#x53EF;&#x4EE5;</li></ul></li><li><code>sslProtocol</code> SSL&#x534F;&#x8BAE;</li></ul><h2>&#x8BFB;&#x53D6;&#x5BA2;&#x6237;&#x8BC1;&#x4E66;&#x5185;&#x5BB9;</h2><p>maven&#x4F9D;&#x8D56;&#x914D;&#x7F6E;&#xFF1A;<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-coyote<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.0.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>&#x901A;&#x8FC7;HttpServletRequest&#x63D0;&#x53D6;&#x8BC1;&#x4E66;&#x5185;&#x5BB9;&#x65F6;&#x9700;&#x8981;&#x4F9D;&#x8D56;<code>tomcat-coyote</code>jar&#x5305;&#xFF0C;&#x8BE5;jar&#x5305;&#x7531;tomcat&#x63D0;&#x4F9B;&#xFF0C;&#x5FC5;&#x987B;&#x6307;&#x5B9A;<code>scope</code>&#x4E3A;<code>provided</code>&#x3002;&#x5426;&#x5219;&#x8FD0;&#x884C;&#x65F6;&#x4F1A;&#x62A5;&#x9519;&#xFF08;&#x62A5;&#x9519;&#x5185;&#x5BB9;&#x4E3A;&#x627E;&#x4E0D;&#x5230;<code>SSLSupport</code>&#xFF09;&#x3002;java&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">X509Certificate[] certificates = (X509Certificate[]) request.getAttribute(SSLSupport.CERTIFICATE_KEY);</span><br><span class="line"><span class="keyword">if</span>(certificates != <span class="keyword">null</span> &amp;&amp; certificates.length &gt; <span class="number">0</span>){</span><br><span class="line">    X509Certificate certificate = certificates[<span class="number">0</span>];</span><br><span class="line">    logger.debug(<span class="string">&quot;&#x4F7F;&#x7528;&#x8005;&#x552F;&#x4E00;&#x540D;&#x79F0; = {}&quot;</span>, certificate.getSubjectDN());</span><br><span class="line">    logger.debug(<span class="string">&quot;&#x9881;&#x5E03;&#x8005;&#x552F;&#x4E00;&#x540D;&#x79F0; = {}&quot;</span>, certificate.getIssuerDN());</span><br><span class="line">    logger.debug(<span class="string">&quot;&#x8BC1;&#x4E66;&#x5E8F;&#x5217;&#x53F7; = {}&quot;</span>, certificate.getSerialNumber());</span><br><span class="line">    logger.debug(<span class="string">&quot;&#x8BC1;&#x4E66;&#x7C7B;&#x578B; = {}&quot;</span>, certificate.getType());</span><br><span class="line">    logger.debug(<span class="string">&quot;&#x8BC1;&#x4E66;&#x6709;&#x6548;&#x671F; &#xFF1A; {}&quot;</span>, DateFormatUtils.format(certificate.getNotBefore(), <span class="string">&quot;yyyy-MM-dd HH:mm:ss.SSS&quot;</span>),</span><br><span class="line">                    DateFormatUtils.format(certificate.getNotAfter(), <span class="string">&quot;yyyy-MM-dd HH:mm:ss.SSS&quot;</span>));</span><br><span class="line">    logger.debug(<span class="string">&quot;&#x8BC1;&#x4E66;&#x7B7E;&#x540D; = {}&quot;</span>, Hex.encodeHexString(certificate.getSignature()));</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p><p>&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2017-07-04 18:14:29.480 HomeController - &#x4F7F;&#x7528;&#x8005;&#x552F;&#x4E00;&#x540D;&#x79F0; = CN=Xiaotian, OU=XTBaBa User, O=XTBaBa, L=Hangzhou, ST=Zhejiang, C=CN</span><br><span class="line">2017-07-04 18:14:29.480 HomeController - &#x9881;&#x5E03;&#x8005;&#x552F;&#x4E00;&#x540D;&#x79F0; = CN=XTBaBa Root CA, OU=XTBaBa CA, O=XTBaBa, L=Hangzhou, ST=Zhejiang, C=CN</span><br><span class="line">2017-07-04 18:14:29.480 HomeController - &#x8BC1;&#x4E66;&#x5E8F;&#x5217;&#x53F7; = 1327706204</span><br><span class="line">2017-07-04 18:14:29.480 HomeController - &#x8BC1;&#x4E66;&#x7C7B;&#x578B; = X.509</span><br><span class="line">2017-07-04 18:14:29.480 HomeController - &#x8BC1;&#x4E66;&#x6709;&#x6548;&#x671F; = 2017-07-04 15:46:18.000</span><br><span class="line">2017-07-04 18:14:29.920 HomeController - &#x8BC1;&#x4E66;&#x7B7E;&#x540D; = 9c2fc47626621378f0f47d62e2b337265d3042495a259b5230ea2336ec990e9e2073fa817f2bb3d72a64565601b5f0171c77685d3ca616df4fcc46b8d6c4aed0101c21e0eaa22fd747b311eea5a781f721d47d621b0543bc3de442830e1c34a272b7960a97766df23f7955c6bdbf13013cf76b9e4233270ad78514d3afc59d442e4298b4fb2c19ab656a38d41ace261f24f4ba63e14c9d368aa7393b808b91ca19115c6578903bfeb3feb3173d68ff</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1&gt;&amp;#x6570;&amp;#x5B57;&amp;#x8BC1;&amp;#x4E66;&amp;#x76F8;&amp;#x5173;&amp;#x7684;&amp;#x6807;&amp;#x51C6;&amp;#x548C;&amp;#x534F;&amp;#x8BAE;&lt;/h1&gt;
&lt;p&gt;&amp;#x53C2;&amp;#x8003;&amp;#xFF1A;&lt;a href
      
    
    </summary>
    
      <category term="工具使用" scheme="https://yyhan.github.io/categories/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/"/>
    
    
      <category term="tomcat" scheme="https://yyhan.github.io/tags/tomcat/"/>
    
      <category term="keytool" scheme="https://yyhan.github.io/tags/keytool/"/>
    
      <category term="数字证书" scheme="https://yyhan.github.io/tags/%E6%95%B0%E5%AD%97%E8%AF%81%E4%B9%A6/"/>
    
      <category term="双向认证" scheme="https://yyhan.github.io/tags/%E5%8F%8C%E5%90%91%E8%AE%A4%E8%AF%81/"/>
    
  </entry>
  
  <entry>
    <title>java 加密体系架构参考指南</title>
    <link href="https://yyhan.github.io/2017/06/30/java-%E5%8A%A0%E5%AF%86%E4%BD%93%E7%B3%BB%E6%9E%B6%E6%9E%84%E5%8F%82%E8%80%83%E6%8C%87%E5%8D%97/"/>
    <id>https://yyhan.github.io/2017/06/30/java-加密体系架构参考指南/</id>
    <published>2017-06-29T16:22:34.000Z</published>
    <updated>2017-07-09T05:58:55.003Z</updated>
    
    <content type="html"><![CDATA[<p>&#x539F;&#x6587;&#x5730;&#x5740;&#xFF1A;<a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/crypto/CryptoSpec.html" target="_blank" rel="noopener">Java Cryptography Architecture (JCA) Reference Guide</a></p><h1>&#x4ECB;&#x7ECD;</h1><p>The Java platform strongly emphasizes security, including language safety, cryptography, public key infrastructure, authentication, secure communication, and access control.</p><p>The JCA is a major piece of the platform, and contains a &quot;provider&quot; architecture and a set of APIs for digital signatures, message digests (hashes), certificates and certificate validation, encryption (symmetric/asymmetric block/stream ciphers), key generation and management, and secure random number generation, to name a few. These APIs allow developers to easily integrate security into their application code. The architecture was designed around the following principles:</p><p>Implementation independence: Applications do not need to implement security algorithms. Rather, they can request security services from the Java platform. Security services are implemented in providers (see below), which are plugged into the Java platform via a standard interface. An application may rely on multiple independent providers for security functionality.</p><p>Implementation interoperability: Providers are interoperable across applications. Specifically, an application is not bound to a specific provider, and a provider is not bound to a specific application.</p><p>Algorithm extensibility: The Java platform includes a number of built-in providers that implement a basic set of security services that are widely used today. However, some applications may rely on emerging standards not yet implemented, or on proprietary services. The Java platform supports the installation of custom providers that implement such services.</p><p>Other cryptographic communication libraries available in the JDK use the JCA provider architecture, but are described elsewhere. The Java Secure Socket Extension (JSSE) provides access to Secure Socket Layer (SSL) and Transport Layer Security (TLS) implementations. The Java Generic Security Services (JGSS) (via Kerberos) APIs, and the Simple Authentication and Security Layer (SASL) can also be used for securely exchanging messages between communicating applications.</p><p>Notes on Terminology</p><p>Prior to JDK 1.4, the JCE was an unbundled product, and as such, the JCA and JCE were regularly referred to as separate, distinct components. As JCE is now bundled in the JDK, the distinction is becoming less apparent. Since the JCE uses the same architecture as the JCA, the JCE should be more properly thought of as a part of the JCA.</p><p>The JCA within the JDK includes two software components:</p><p>the framework that defines and supports cryptographic services for which providers supply implementations. This framework includes packages such as java.security, javax.crypto, javax.crypto.spec, and javax.crypto.interfaces.the actual providers such as Sun, SunRsaSign, SunJCE, which contain the actual cryptographic implementations.Whenever a specific JCA provider is mentioned, it will be referred to explicitly by the provider&apos;s name.</p><p>WARNING: The JCA makes it easy to incorporate security features into your application. However, this document does not cover the theory of security/cryptography beyond an elementary introduction to concepts necessary to discuss the APIs. This document also does not cover the strengths/weaknesses of specific algorithms, not does it cover protocol design. Cryptography is an advanced topic and one should consult a solid, preferably recent, reference in order to make best use of these tools.</p><p>You should always understand what you are doing and why: DO NOT simply copy random code and expect it to fully solve your usage scenario. Many applications have been deployed that contain significant security or performance problems because the wrong tool or algorithm was selected.</p><h1>&#x8BBE;&#x8BA1;&#x539F;&#x5219;</h1><p>The JCA was designed around these principles:</p><p>implementation independence and interoperabilityalgorithm independence and extensibilityImplementation independence and algorithm independence are complementary; you can use cryptographic services, such as digital signatures and message digests, without worrying about the implementation details or even the algorithms that form the basis for these concepts. While complete algorithm-independence is not possible, the JCA provides standardized, algorithm-specific APIs. When implementation-independence is not desirable, the JCA lets developers indicate a specific implementation.</p><p>Algorithm independence is achieved by defining types of cryptographic &quot;engines&quot; (services), and defining classes that provide the functionality of these cryptographic engines. These classes are called engine classes, and examples are the MessageDigest, Signature, KeyFactory, KeyPairGenerator, and Cipher classes.</p><p>Implementation independence is achieved using a &quot;provider&quot;-based architecture. The term Cryptographic Service Provider (CSP) (used interchangeably with &quot;provider&quot; in this document) refers to a package or set of packages that implement one or more cryptographic services, such as digital signature algorithms, message digest algorithms, and key conversion services. A program may simply request a particular type of object (such as a Signature object) implementing a particular service (such as the DSA signature algorithm) and get an implementation from one of the installed providers. If desired, a program may instead request an implementation from a specific provider. Providers may be updated transparently to the application, for example when faster or more secure versions are available.</p><p>Implementation interoperability means that various implementations can work with each other, use each other&apos;s keys, or verify each other&apos;s signatures. This would mean, for example, that for the same algorithms, a key generated by one provider would be usable by another, and a signature generated by one provider would be verifiable by another.</p><p>Algorithm extensibility means that new algorithms that fit in one of the supported engine classes can be added easily.</p><h1>&#x67B6;&#x6784;</h1><h2>&#x52A0;&#x5BC6;&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x8005;</h2><p><code>java.security.Provider</code> is the base class for all security providers. Each CSP contains an instance of this class which contains the provider&apos;s name and lists all of the security services/algorithms it implements. When an instance of a particular algorithm is needed, the JCA framework consults the provider&apos;s database, and if a suitable match is found, the instance is created.</p><p>Providers contain a package (or a set of packages) that supply concrete implementations for the advertised cryptographic algorithms. Each JDK installation has one or more providers installed and configured by default. Additional providers may be added statically or dynamically (see the Provider and Security classes). Clients may configure their runtime environment to specify the provider preference order. The preference order is the order in which providers are searched for requested services when no specific provider is requested.</p><p>To use the JCA, an application simply requests a particular type of object (such as a MessageDigest) and a particular algorithm or service (such as the &quot;MD5&quot; algorithm), and gets an implementation from one of the installed providers. Alternatively, the program can request the objects from a specific provider. Each provider has a name used to refer to it.<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">md = MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">md = MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>, <span class="string">&quot;ProviderC&quot;</span>);</span><br></pre></td></tr></table></figure></p><p>The following figure illustrates requesting an &quot;MD5&quot; message digest implementation. The figure show three different providers that implement various message digest algorithms (&quot;SHA-1&quot;, &quot;MD5&quot;, &quot;SHA-256&quot;, and &quot;SHA-512&quot;). The providers are ordered by preference from left to right (1-3). In the first illustration, an application requests an MD5 algorithm implementation without specifying a provider name. The providers are searched in preference order and the implementation from the first provider supplying that particular algorithm, ProviderB, is returned. In the second figure, the application requests the MD5 algorithm implementation from a specific provider, ProviderC. This time the implementation from ProviderC is returned, even though a provider with a higher preference order, ProviderB, also supplies an MD5 implementation.</p><p><a class="magnific-img" href="/img/java/security/Overview.gif"><img src="/img/java/security/Overview.gif" alt="Image of Yaktocat" class="ui centered image"></a></p><p>MD5 Message Digest ImplementationDescription of Figure MD5 Message Digest Implementation</p><p>Cryptographic implementations in the JDK are distributed via several different providers (Sun, SunJSSE, SunJCE, SunRsaSign) primarily for historical reasons, but to a lesser extent by the type of functionality and algorithms they provide. Other Java runtime environments may not necessarily contain these Sun providers, so applications should not request an provider-specific implementation unless it is known that a particular provider will be available.</p><p>The JCA offers a set of APIs that allow users to query which providers are installed and what services they support.</p><p>This architecture also makes it easy for end-users to add additional providers. Many third party provider implementations are already available. See The Provider Class for more information on how providers are written, installed, and registered.</p><h2>How Providers Are Actually Implemented</h2><p>As mentioned earlier, algorithm independence is achieved by defining a generic high-level Application Programming Interface (API) that all applications use to access a service type. Implementation independence is achieved by having all provider implementations conform to well-defined interfaces. Instances of engine classes are thus &quot;backed&quot; by implementation classes which have the same method signatures. Application calls are routed through the engine class and are delivered to the underlying backing implementation. The implementation handles the request and return the proper results.</p><p>The application API methods in each engine class are routed to the provider&apos;s implementations through classes that implement the corresponding Service Provider Interface (SPI). That is, for each engine class, there is a corresponding abstract SPI class which defines the methods that each cryptographic service provider&apos;s algorithm must implement. The name of each SPI class is the same as that of the corresponding engine class, followed by Spi. For example, the Signature engine class provides access to the functionality of a digital signature algorithm. The actual provider implementation is supplied in a subclass of SignatureSpi. Applications call the engine class&apos; API methods, which in turn call the SPI methods in the actual implementation.</p><p>Each SPI class is abstract. To supply the implementation of a particular type of service for a specific algorithm, a provider must subclass the corresponding SPI class and provide implementations for all the abstract methods.</p><p>For each engine class in the API, implementation instances are requested and instantiated by calling the getInstance() factory method in the engine class. A factory method is a static method that returns an instance of a class. The engine classes use the framework provider selection mechanism described above to obtain the actual backing implementation (SPI), and then creates the actual engine object. Each instance of the engine class encapsulates (as a private field) the instance of the corresponding SPI class, known as the SPI object. All API methods of an API object are declared final and their implementations invoke the corresponding SPI methods of the encapsulated SPI object.</p><p>To make this clearer, review the following code and illustration:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.crypto.*;</span><br><span class="line"></span><br><span class="line">Cipher c = Cipher.getInstance(<span class="string">&quot;AES&quot;</span>);</span><br><span class="line">c.init(ENCRYPT_MODE, key);</span><br></pre></td></tr></table></figure></p><p>Example of How Application Retrieves AES Cipher IntstanceDescription of Example of How Application Retrieves &quot;AES&quot; Cipher Instance</p><p>Here an application wants an &quot;AES&quot; javax.crypto.Cipher instance, and doesn&apos;t care which provider is used. The application calls the getInstance() factory methods of the Cipher engine class, which in turn asks the JCA framework to find the first provider instance that supports &quot;AES&quot;. The framework consults each installed provider, and obtains the provider&apos;s instance of the Provider class. (Recall that the Provider class is a database of available algorithms.) The framework searches each provider, finally finding a suitable entry in CSP3. This database entry points to the implementation class com.foo.AESCipher which extends CipherSpi, and is thus suitable for use by the Cipher engine class. An instance of com.foo.AESCipher is created, and is encapsulated in a newly-created instance of javax.crypto.Cipher, which is returned to the application. When the application now does the init() operation on the Cipher instance, the Cipher engine class routes the request into the corresponding engineInit() backing method in the com.foo.AESCipher class.</p><p>Appendix A lists the Standard Names defined for the Java environment. Other third-party providers may define their own implementations of these services, or even additional services.</p><h2>Key Management</h2><p>A database called a &quot;keystore&quot; can be used to manage a repository of keys and certificates. Keystores are available to applications that need data for authentication, encryption, or signing purposes.</p><p>Applications can access a keystore via an implementation of the KeyStore class, which is in the java.security package. A default KeyStore implementation is provided by Sun Microsystems. It implements the keystore as a file, using a proprietary keystore type (format) named &quot;jks&quot;. Other keystore formats are available, such as &quot;jceks&quot; which is an alternate proprietary keystore format with much stronger encryption than &quot;jks&quot;, and &quot;pkcs12&quot;, which is based on the RSA PKCS12 Personal Information Exchange Syntax Standard.</p><p>Applications can choose different keystore implementations from different providers, using the same provider mechanism described above.</p><p>See the Key Management section for more information.</p><h1>JCA &#x6982;&#x5FF5;</h1><p>&#x8FD9;&#x5757;&#x4ECB;&#x7ECD;JCA &#x91CD;&#x8981;&#x7684; API.</p><h2>&#x5F15;&#x64CE;&#x7C7B;&#x548C;&#x7B97;&#x6CD5;</h2><p>An engine class provides the interface to a specific type of cryptographic service, independent of a particular cryptographic algorithm or provider. The engines either provide:</p><p>cryptographic operations (encryption, digital signatures, message digests, etc.),generators or converters of cryptographic material (keys and algorithm parameters), orobjects (keystores or certificates) that encapsulate the cryptographic data and can be used at higher layers of abstraction.&#x4E0B;&#x9762;&#x7684;&#x5F15;&#x64CE;&#x7C7B;&#x90FD;&#x662F;&#x53EF;&#x7528;&#x7684;:</p><ul class="ui list"><li>SecureRandom: used to generate random or pseudo-random numbers.</li><li>MessageDigest: used to calculate the message digest (hash) of specified data.</li><li>Signature: initialized with keys, these are used to sign data and verify digital signatures.</li><li>Cipher: initialized with keys, these used for encrypting/decrypting data. There are various types of algorithms: symmetric bulk + encryption (e.g. AES, DES, DESede, Blowfish, IDEA), stream encryption (e.g. RC4), asymmetric encryption (e.g. RSA), and + password-based encryption (PBE).</li><li>Message Authentication Codes (MAC): like MessageDigests, these also generate hash values, but are first initialized with keys + to protect the integrity of messages.</li><li>KeyFactory: used to convert existing opaque cryptographic keys of type Key into key specifications (transparent representations + of the underlying key material), and vice versa.</li><li>SecretKeyFactory: used to convert existing opaque cryptographic keys of type SecretKey into key specifications (transparent + representations of the underlying key material), and vice versa. SecretKeyFactorys are specialized KeyFactorys that create + secret (symmetric) keys only.</li><li>KeyPairGenerator: used to generate a new pair of public and private keys suitable for use with a specified algorithm.</li><li>KeyGenerator: used to generate new secret keys for use with a specified algorithm.</li><li>KeyAgreement: used by two or more parties to agree upon and establish a specific key to use for a particular cryptographic + operation.</li><li>AlgorithmParameters: used to store the parameters for a particular algorithm, including parameter encoding and decoding.</li><li>AlgorithmParameterGenerator : used to generate a set of AlgorithmParameters suitable for a specified algorithm.</li><li>KeyStore: used to create and manage a keystore. A keystore is a database of keys. Private keys in a keystore have a certificate + chain associated with them, which authenticates the corresponding public key. A keystore also contains certificates from + trusted entities.</li><li>CertificateFactory: used to create public key certificates and Certificate Revocation Lists (CRLs).</li><li>CertPathBuilder: used to build certificate chains (also known as certification paths).</li><li>CertPathValidator: used to validate certificate chains.</li><li>CertStore: used to retrieve Certificates and CRLs from a repository.</li></ul><p>NOTE: A generator creates objects with brand-new contents, whereas a factory creates objects from existing material (for example, an encoding).</p><h2>&#x6838;&#x5FC3;&#x7684;&#x7C7B;&#x548C;&#x63A5;&#x53E3;</h2><p>&#x8FD9;&#x5757;&#x8BA8;&#x8BBA;JCA&#x63D0;&#x4F9B;&#x7684;&#x6838;&#x5FC3;&#x7C7B;&#x548C;&#x63A5;&#x53E3;.</p><ul class="ui list"><li>the Provider and Security classes,</li><li>the SecureRandom, MessageDigest, Signature, Cipher, Mac, KeyFactory, SecretKeyFactory, KeyPairGenerator, KeyGenerator, + KeyAgreement, AlgorithmParameters, AlgorithmParameterGenerator , KeyStore, and CertificateFactory, engine classes,</li><li>the Key interfaces and classes,</li><li>the Algorithm Parameter Specification Interfaces and Classes and the Key Specification Interfaces and Classes, and</li><li>miscellaneous support and convenience interfaces and classes.</li></ul><p>NOTE: For more information on the CertPathBuilder, CertPathValidator, and CertStore engine classes, please see the Java PKI Programmer&apos;s Guide.</p><p>The guide will cover the most useful high-level classes first (Provider, Security, SecureRandom, MessageDigest, Signature, Cipher, and Mac), then delve into the various support classes. For now, it is sufficient to simply say that Keys (public, private, and secret) are generated and represented by the various JCA classes, and are used by the high-level classes as part of their operation.</p><p>This section shows the signatures of the main methods in each class and interface. Examples for some of these classes (MessageDigest, Signature, KeyPairGenerator, SecureRandom, KeyFactory, and key specification classes) are supplied in the corresponding Examples sections.</p><p>The complete reference documentation for the relevant Security API packages can be found in the package summaries:</p><ul class="ui list"><li>java.security</li><li>javax.crypto</li><li>java.security.cert</li><li>java.security.spec</li><li>javax.crypto.spec</li><li>java.security.interfaces</li><li>javax.crypto.interfaces</li></ul><h2>&#x63D0;&#x4F9B;&#x8005;&#x7C7B;</h2><p>The term &quot;Cryptographic Service Provider&quot; (used interchangeably with &quot;provider&quot; in this document) refers to a package or set of packages that supply a concrete implementation of a subset of the JDK Security API cryptography features. The Provider class is the interface to such a package or set of packages. It has methods for accessing the provider name, version number, and other information. Please note that in addition to registering implementations of cryptographic services, the Provider class can also be used to register implementations of other security services that might get defined as part of the JDK Security API or one of its extensions.</p><p>To supply implementations of cryptographic services, an entity (e.g., a development group) writes the implementation code and creates a subclass of the Provider class. The constructor of the Provider subclass sets the values of various properties; the JDK Security API uses these values to look up the services that the provider implements. In other words, the subclass specifies the names of the classes implementing the services.</p><p>Example of Provider SubclassDescription of Figure Example of Provider Subclass</p><p>There are several types of services that can be implemented by provider packages; for more information, see Engine Classes and Algorithms.</p><p>The different implementations may have different characteristics. Some may be software-based, while others may be hardware-based. Some may be platform-independent, while others may be platform-specific. Some provider source code may be available for review and evaluation, while some may not. The JCA lets both end-users and developers decide what their needs are.</p><p>In this section we explain how end-users install the cryptography implementations that fit their needs, and how developers request the implementations that fit theirs.</p><p>NOTE: For information about implementing a provider, see the guide How To Implement a Provider for the Java Cryptography Architecture.</p><h2>How Provider Implementations Are Requested and Supplied</h2><p>For each engine class in the API, a implementation instance is requested and instantiated by calling one of the getInstance methods on the engine class, specifying the name of the desired algorithm and, optionally, the name of the provider (or the Provider class) whose implementation is desired.<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> EngineClassName <span class="title">getInstance</span><span class="params">(String algorithm)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> NoSuchAlgorithmException</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> EngineClassName <span class="title">getInstance</span><span class="params">(String algorithm, String provider)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> NoSuchAlgorithmException, NoSuchProviderException</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> EngineClassName <span class="title">getInstance</span><span class="params">(String algorithm, Provider provider)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> NoSuchAlgorithmException</span></span><br></pre></td></tr></table></figure></p><p>where EngineClassName is the desired engine type (MessageDigest/Cipher/etc). For example:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MessageDigest md = MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">KeyAgreement ka = KeyAgreement.getInstance(<span class="string">&quot;DH&quot;</span>, <span class="string">&quot;SunJCE&quot;</span>);</span><br></pre></td></tr></table></figure></p><p>return an instance of the &quot;MD5&quot; MessageDigest and &quot;DH&quot; KeyAgreement objects, respectively.Appendix A contains the list of names that have been standardized for use with the Java environment. Some providers may choose to also include alias names that also refer to the same algorithm. For example, the &quot;SHA-1&quot; algorithm might be referred to as &quot;SHA1&quot;. Applications should use standard names instead of an alias, as not all providers may alias algorithm names in the same way.</p><p>NOTE: The algorithm name is not case-sensitive. For example, all the following calls are equivalent:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MessageDigest.getInstance(<span class="string">&quot;SHA-1&quot;</span>)</span><br><span class="line">MessageDigest.getInstance(<span class="string">&quot;sha-1&quot;</span>)</span><br><span class="line">MessageDigest.getInstance(<span class="string">&quot;sHa-1&quot;</span>)</span><br></pre></td></tr></table></figure></p><p>If no provider is specified, getInstance searches the registered providers for an implementation of the requested cryptographic service associated with the named algorithm. In any given Java Virtual Machine (JVM), providers are installed in a given preference order, the order in which the provider list is searched if a specific provider is not requested. For example, suppose there are two providers installed in a JVM, PROVIDER_1 and PROVIDER_2. Assume that:</p><ul class="ui list"><li>PROVIDER_1 implements SHA1withDSA, SHA-1, MD5, DES, and DES3.<br>PROVIDER_1 has preference order 1 (the highest priority).</li><li>PROVIDER_2 implements SHA1withDSA, MD5withRSA, MD2withRSA, MD2, MD5, RC4, RC5, DES, and RSA.<br>PROVIDER_2 has preference order 2.</li></ul><p>Now let&apos;s look at three scenarios:</p><ol class="ui list"><li>If we are looking for an MD5 implementation. Both providers supply such an implementation. The PROVIDER_1 implementation is returned since PROVIDER_1 has the highest priority and is searched first.</li><li>If we are looking for an MD5withRSA signature algorithm, PROVIDER_1 is first searched for it. No implementation is found, so PROVIDER_2 is searched. Since an implementation is found, it is returned.</li><li>Suppose we are looking for a SHA1withRSA signature algorithm. Since no installed provider implements it, a NoSuchAlgorithmException is thrown.</li></ol><p>The getInstance methods that include a provider argument are for developers who want to specify which provider they want an algorithm from. A federal agency, for example, will want to use a provider implementation that has received federal certification. Let&apos;s assume that the SHA1withDSA implementation from PROVIDER_1 has not received such certification, while the DSA implementation of PROVIDER_2 has received it.A federal agency program would then have the following call, specifying PROVIDER_2 since it has the certified implementation:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Signature dsa = Signature.getInstance(<span class="string">&quot;SHA1withDSA&quot;</span>, <span class="string">&quot;PROVIDER_2&quot;</span>);</span><br></pre></td></tr></table></figure></p><p>In this case, if PROVIDER_2 was not installed, a NoSuchProviderException would be thrown, even if another installed provider implements the algorithm requested.</p><p>A program also has the option of getting a list of all the installed providers (using the getProviders method in the Security class) and choosing one from the list.</p><p>NOTE: General purpose applications SHOULD NOT request cryptographic services from specific providers. Otherwise, applications are tied to specific providers which may not be available on other Java implementations. They also might not be able to take advantage of available optimized providers (for example hardware accelerators via PKCS11 or native OS implementations such as Microsoft&apos;s MSCAPI) that have a higher preference order than the specific requested provider.</p><h2>&#x5B89;&#x88C5; Providers</h2><p>In order to be used, a cryptographic provider must first be installed, then registered either statically or dynamically. There are a variety of Sun providers shipped with this release (SUN, SunJCE, SunJSSE, SunRsaSign, etc.) that are already installed and registered. The following sections describe how to install and register additional providers.</p><h3>&#x5B89;&#x88C5; Provider Classes</h3><p>There are two possible ways to install the provider classes:</p><p>On the normal Java classpathPlace a zip or JAR file containing the classes anywhere in your classpath. Some algorithms types (Ciphers) require the provider be a signed Jar file.</p><p>As an Installed/Bundled ExtensionThe provider will be considered an installed extension if it is placed in the standard extension directory. In the JDK, that would be located in:</p><p>Solaris, Linux, or Mac OS X: <code>&lt;java-home&gt;/lib/ext</code><br>Windows: <code>&lt;java-home&gt;\lib\ext</code><br>Here <code>&lt;java-home&gt;</code> refers to the directory where the runtime software is installed, which is the top-level directory of the Java Runtime Environment (JRE) or the jre directory in the Java JDK software. For example, if you have JDK 6 installed on Solaris in a directory named <code>/home/user1/JDK1.6.0</code>, or on Microsoft Windows in a directory named <code>C:\Java\JDK1.6.0</code>, then you need to install the JAR file in the following directory:</p><p>Solaris, Linux, or Mac OS X: <code>/home/user1/JDK1.6.0/jre/lib/ext</code><br>Windows: <code>C:\JDK1.6.0\jre\lib\ext</code><br>Similarly, if you have the JRE 6 installed on Solaris in a directory named /home/user1/jre1.6.0, or on Microsoft Windows in a directory named C:\jre1.6.0, you need to install the JAR file in the following directory:</p><p>Solaris, Linux, or Mac OS X: <code>/home/user1/jre1.6.0/lib/ext</code><br>Windows: <code>C:\jre1.6.0\lib\ext</code><br>For more information on how to deploy an extension, see How is an extension deployed?</p><h3>&#x6CE8;&#x518C; Provider</h3><p>The next step is to add the provider to your list of registered providers. Providers can be registered statically by editing a security properties configuration file before running a Java application, or dynamically by calling a method at runtime. To prevent the installation of rogue providers being added to the runtime environment, applications attempting to dynamically register a provider must possess the appropriate runtime privilege.</p><h3>Static Registration</h3><p>The configuration file is located in the following location:</p><p>Solaris, Linux, or Mac OS X: &lt;java-home&gt;/lib/security/java.securityWindows: &lt;java-home&gt;\lib\security\java.securityFor each registered provider, this file should have a statement of the following form:</p><pre><code>security.provider.n=masterClassName</code></pre><p>This declares a provider, and specifies its preference order n. The preference order is the order in which providers are searched for requested algorithms (when no specific provider is requested). The order is 1-based: 1 is the most preferred, followed by 2, and so on.</p><p>masterClassName must specify the fully qualified name of provider&apos;s master class. The provider&apos;s documentation will specify its master class. This class is always a subclass of the Provider class. The subclass constructor sets the values of various properties that are required for the Java Cryptography API to look up the algorithms or other facilities the provider implements.</p><p>The JDK comes standard with automatically installed and configured providers such as &quot;SUN&quot; and &quot;SunJCE&quot;. The &quot;SUN&quot; provider&apos;s master class is the SUN class in the sun.security.provider package, and the corresponding java.security file entry is as follows:</p><pre><code>security.provider.5=sun.security.provider.Sun</code></pre><p>To utilize another JCA provider, add a line referencing the alternate provider, specify the preference order ( making corresponding adjustments to the other providers&apos; orders, if needed).</p><p>Suppose that the master class of CompanyX&apos;s provider is com.companyx.provider.ProviderX, and that you would like to configure this provider as the eighth most-preferred. To do so, you would add the following line to the java.security file:</p><pre><code>security.provider.8=com.companyx.provider.ProviderX</code></pre><h3>Dynamic Registration</h3><p>To register providers dynamically, applications call either the addProvider or insertProviderAt method in the Security class. This type of registration is not persistent across VM instances, and can only be done by &quot;trusted&quot; programs with the appropriate privilege. See Security.Setting Provider PermissionsWhenever encryption providers are used (that is, those that supply implementations of Cipher, KeyAgreement, KeyGenerator, Mac, or SecretKeyFactory), and the provider is not an installed extension Permissions may need to be granted for when applets or applications using JCA are run while a security manager is installed. There is typically a security manager installed whenever an applet is running, and a security manager may be installed for an application either via code in the application itself or via a command-line argument. Permissions do not need to be granted to installed extensions, since the default system policy configuration file grants all permissions to installed extensions (that is, installed in the extensions directory).</p><p>The documentation from the vendor of each provider you will be using should include information as to which permissions it requires, and how to grant such permissions. For example, the following permissions may be needed by a provider if it is not an installed extension and a security manager is installed:</p><p>java.lang.RuntimePermission &quot;getProtectionDomain&quot; to get class protection domains. The provider may need to get its own protection domain in the process of doing self-integrity checking.java.security.SecurityPermission &quot;putProviderProperty.{name}&quot; to set provider properties, where {name} is replaced by the actual provider name.For example, a sample statement granting permissions to a provider whose name is &quot;MyJCE&quot; and whose code is in myjce_provider.jar appears below. Such a statement could appear in a policy file. In this example, the myjce_provider.jar file is assumed to be in the /localWork directory.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">grant codeBase <span class="string">&quot;file:/localWork/myjce_provider.jar&quot;</span> {</span><br><span class="line">    permission java.lang.RuntimePermission <span class="string">&quot;getProtectionDomain&quot;</span>;</span><br><span class="line">    permission java.security.SecurityPermission</span><br><span class="line">        <span class="string">&quot;putProviderProperty.MyJCE&quot;</span>;</span><br><span class="line"> };</span><br></pre></td></tr></table></figure></p><h3>Provider Class Methods</h3><p>Each Provider class instance has a (currently case-sensitive) name, a version number, and a string description of the provider and its services. You can query the Provider instance for this information by calling the following methods:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getVersion</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getInfo</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure></p><h3>The Security Class</h3><p>The Security class manages installed providers and security-wide properties. It only contains static methods and is never instantiated. The methods for adding or removing providers, and for setting Security properties, can only be executed by a trusted program. Currently, a &quot;trusted program&quot; is either</p><p>a local application not running under a security manager, oran applet or application with permission to execute the specified method (see below).The determination that code is considered trusted to perform an attempted action (such as adding a provider) requires that the applet is granted the proper permission(s) for that particular action. The policy configuration file(s) for a JDK installation specify what permissions (which types of system resource accesses) are allowed by code from specified code sources. (See below and the &quot;Default Policy Implementation and Policy File Syntax&quot; and &quot;Java Security Architecture Specification&quot; files for more information.)Code being executed is always considered to come from a particular &quot;code source&quot;. The code source includes not only the location (URL) where the code originated from, but also a reference to any public key(s) corresponding to the private key(s) that may have been used to sign the code. Public keys in a code source are referenced by (symbolic) alias names from the user&apos;s keystore.</p><p>In a policy configuration file, a code source is represented by two components: a code base (URL), and an alias name (preceded by signedBy), where the alias name identifies the keystore entry containing the public key that must be used to verify the code&apos;s signature.</p><p>Each &quot;grant&quot; statement in such a file grants a specified code source a set of permissions, specifying which actions are allowed.</p><p>&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x7B56;&#x7565;&#x914D;&#x7F6E;&#x6587;&#x4EF6;:<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">grant codeBase <span class="string">&quot;file:/home/sysadmin/&quot;</span>, signedBy <span class="string">&quot;sysadmin&quot;</span> {</span><br><span class="line">    permission java.security.SecurityPermission <span class="string">&quot;insertProvider.*&quot;</span>;</span><br><span class="line">    permission java.security.SecurityPermission <span class="string">&quot;removeProvider.*&quot;</span>;</span><br><span class="line">    permission java.security.SecurityPermission <span class="string">&quot;putProviderProperty.*&quot;</span>;</span><br><span class="line">};</span><br></pre></td></tr></table></figure></p><p>This configuration file specifies that code loaded from a signed JAR file from beneath the /home/sysadmin/ directory on the local file system can add or remove providers or set provider properties. (Note that the signature of the JAR file can be verified using the public key referenced by the alias name sysadmin in the user&apos;s keystore.)Either component of the code source (or both) may be missing. Here&apos;s an example of a configuration file where the codeBase is omitted:<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grant signedBy <span class="string">&quot;sysadmin&quot;</span> {</span><br><span class="line">    permission java.security.SecurityPermission <span class="string">&quot;insertProvider.*&quot;</span>;</span><br><span class="line">    permission java.security.SecurityPermission <span class="string">&quot;removeProvider.*&quot;</span>;</span><br><span class="line">};</span><br></pre></td></tr></table></figure></p><p>If this policy is in effect, code that comes in a JAR File signed by sysadmin can add/remove providers--regardless of where the JAR File originated.Here&apos;s an example without a signer:<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grant codeBase <span class="string">&quot;file:/home/sysadmin/&quot;</span> {</span><br><span class="line">    permission java.security.SecurityPermission <span class="string">&quot;insertProvider.*&quot;</span>;</span><br><span class="line">    permission java.security.SecurityPermission <span class="string">&quot;removeProvider.*&quot;</span>;</span><br><span class="line">};</span><br></pre></td></tr></table></figure></p><p>In this case, code that comes from anywhere within the /home/sysadmin/ directory on the local filesystem can add/remove providers. The code does not need to be signed.An example where neither codeBase nor signedBy is included is:<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grant {</span><br><span class="line">    permission java.security.SecurityPermission <span class="string">&quot;insertProvider.*&quot;</span>;</span><br><span class="line">    permission java.security.SecurityPermission <span class="string">&quot;removeProvider.*&quot;</span>;</span><br><span class="line">};</span><br></pre></td></tr></table></figure></p><p>Here, with both code source components missing, any code (regardless of where it originates, or whether or not it is signed, or who signed it) can add/remove providers. Obviously, this is definitely NOT recommended, as this grant could open a security hole. Untrusted code could install a Provider, thus affecting later code that is depending on a properly functioning implementation. (For example, a rogue Cipher object might capture and store the sensitive information it receives.)</p><h2>Managing Providers</h2><p>The following tables summarize the methods in the Security class you can use to query which Providers are installed, as well as to install or remove providers at runtime.</p><h3>Querying Providers</h3><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody><tr><td>static Provider[] getProviders()</td><td>Returns an array containing all the installed providers (technically, the Provider subclass for each package provider). The order of the Providers in the array is their preference order.</td></tr><tr><td>static Provider getProvider(String providerName)</td><td>Returns the Provider named providerName. It returns null if the Provider is not found.</td></tr></tbody></table><p>Adding Providers</p><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody><tr><td>static int addProvider(Provider provider)</td><td>Adds a Provider to the end of the list of installed Providers. It returns the preference position in which the Provider was added, or -1 if the Provider was not added because it was already installed.</td></tr><tr><td>static int insertProviderAt (Provider provider, int position)</td><td>Adds a new Provider at a specified position. If the given provider is installed at the requested position, the provider formerly at that position and all providers with a position greater than position are shifted up one position (towards the end of the list). This method returns the preference position in which the Provider was added, or -1 if the Provider was not added because it was already installed.</td></tr></tbody></table><p>Removing Providers</p><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody><tr><td>static void removeProvider(String name)</td><td>Removes the Provider with the specified name. It returns silently if the provider is not installed. When the specified provider is removed, all providers located at a position greater than where the specified provider was are shifted down one position (towards the head of the list of installed providers).</td></tr></tbody></table><p>NOTE: If you want to change the preference position of a provider, you must first remove it, and then insert it back in at the new preference position.</p><h3>Security Properties</h3><p>The Security class maintains a list of system-wide security properties. These properties are similar to the System properties, but are security-related. These properties can be set statically or dynamically. We have already seen an example of static security properties (that is, registering a provider statically via the <code>&quot;security.provider.i&quot;</code> security property). If you want to set properties dynamically, trusted programs can use the following methods:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> String <span class="title">getProperty</span><span class="params">(String key)</span></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setProperty</span><span class="params">(String key, String datum)</span></span></span><br></pre></td></tr></table></figure></p><p>Note: the list of security providers is established during VM startup, therefore the methods described above must be used to alter the provider list.As a reminder, the configuration file is located in the following location:</p><p>Solaris, Linux, or Mac OS X: &lt;java-home&gt;/lib/security/java.securityWindows: &lt;java-home&gt;\lib\security\java.securityThe SecureRandom ClassThe SecureRandom class is an engine class that provides the functionality of a Random Number Generator (RNG). It differs from the java.lang.Random class in that it produces cryptographically strong random numbers. If there is insufficient randomness in a generator, it makes it much easier to compromise your protection mechanisms. Random numbers are used throughout cryptography, such as generating cryptographic keys, algorithmic parameters, and so on.</p><p>All Java SE implementations must indicate the strongest (most random) implementation of SecureRandom that they provide in the securerandom.strongAlgorithms property of the java.security.Security class. This implementation can be used when a particularly strong random value is required.</p><h2>The SecureRandom Class</h2><p>Description of The SecureRandom Class</p><h3>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5B89;&#x5168;&#x968F;&#x673A;&#x6570;&#x751F;&#x6210;&#x5668;&#x5BF9;&#x8C61;</h3><p>There are several ways to obtain an instance of SecureRandom:</p><p>All Java SE implementations provide a default SecureRandom using the no-argument constructor: new SecureRandom().</p><p>To get a specific implementation of SecureRandom, use one of the getInstance() static factory methods.</p><p>Use the getInstanceStrong() method to obtain a strong SecureRandom implementation as defined by the securerandom.strongAlgorithms property of the java.security.Security class. This property lists platform implementations that are suitable for generating important values.</p><h3>Seeding or Re-Seeding the SecureRandom Object</h3><p>The SecureRandom implementation attempts to completely randomize the internal state of the generator itself unless the caller follows the call to a getInstance method with a call to one of the setSeed methods:</p><p>synchronized public void setSeed(byte[] seed)public void setSeed(long seed)Once the SecureRandom object has been seeded, it will produce bits as random as the original seeds.</p><p>At any time a SecureRandom object may be re-seeded using one of the setSeed methods. The given seed supplements, rather than replaces, the existing seed; therefore, repeated calls are guaranteed never to reduce randomness.</p><h3>Using a SecureRandom Object</h3><p>To get random bytes, a caller simply passes an array of any length, which is then filled with random bytes:</p><p>synchronized public void nextBytes(byte[] bytes)</p><h3>Generating Seed Bytes</h3><p>If desired, it is possible to invoke the generateSeed method to generate a given number of seed bytes (to seed other random number generators, for example):</p><p>byte[] generateSeed(int numBytes)The MessageDigest ClassThe MessageDigest class is an engine class designed to provide the functionality of cryptographically secure message digests such as SHA-1 or MD5. A cryptographically secure message digest takes arbitrary-sized input (a byte array), and generates a fixed-size output, called a digest or hash.</p><h2>The MessageDigest Class</h2><p>Description of Figure The MessageDigest Class</p><p>For example, the MD5 algorithm produces a 16 byte digest, and SHA1&apos;s is 20 bytes.</p><p>A digest has two properties:</p><ul class="ui list"><li>It should be computationally infeasible to find two messages that hash to the same value.</li><li>The digest should not reveal anything about the input that was used to generate it.</li></ul><p>Message digests are used to produce unique and reliable identifiers of data. They are sometimes called &quot;checksums&quot; or the <code>&quot;digital fingerprints&quot;</code> of the data. Changes to just one bit of the message should produce a different digest value.</p><p>Message digests have many uses and can determine when data has been modified, intentionally or not. Recently, there has been considerable effort to determine if there are any weaknesses in popular algorithms, with mixed results. When selecting a digest algorithm, one should always consult a recent reference to determine its status and appropriateness for the task at hand.</p><h3>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#x7B7E;&#x540D;&#x5BF9;&#x8C61;</h3><p>The first step for computing a digest is to create a message digest instance. MessageDigest objects are obtained by using one of the <code>getInstance() static factory methods</code> in the <code>MessageDigest class</code>. The factory method returns an initialized message digest object. It thus does not need further initialization.</p><h3>&#x66F4;&#x65B0;&#x6D88;&#x606F;&#x7B7E;&#x540D;&#x5BF9;&#x8C61;</h3><p>The next step for calculating the digest of some data is to supply the data to the initialized message digest object. It can be provided all at once, or in chunks. Pieces can be fed to the message digest by calling one of the update methods:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">byte</span> input)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">byte</span>[] input)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">byte</span>[] input, <span class="keyword">int</span> offset, <span class="keyword">int</span> len)</span></span></span><br></pre></td></tr></table></figure></p><h3>&#x8BA1;&#x7B97;&#x7B7E;&#x540D;</h3><p>After the data chunks have been supplied by calls to update, the digest is computed using a call to one of the digest methods:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] digest()</span><br><span class="line"><span class="keyword">byte</span>[] digest(<span class="keyword">byte</span>[] input)</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">digest</span><span class="params">(<span class="keyword">byte</span>[] buf, <span class="keyword">int</span> offset, <span class="keyword">int</span> len)</span></span></span><br></pre></td></tr></table></figure></p><p>The first method return the computed digest. The second method does a final update(input) with the input byte array before calling digest(), which returns the digest byte array. The last method stores the computed digest in the provided buffer buf, starting at offset. len is the number of bytes in buf allotted for the digest, the method returns the number of bytes actually stored in buf. If there is not enough room in the buffer, the method will throw an exception.</p><p>Please see the Computing a MessageDigest example in the Code Examples section for more details.</p><h2>The Signature Class</h2><p>The Signature class is an engine class designed to provide the functionality of a cryptographic digital signature algorithm such as DSA or RSAwithMD5. A cryptographically secure signature algorithm takes arbitrary-sized input and a private key and generates a relatively short (often fixed-size) string of bytes, called the signature, with the following properties:</p><p>Only the owner of a private/public key pair is able to create a signature. It should be computationally infeasible for anyone having a public key to recover the private key.Given the public key corresponding to the private key used to generate the signature, it should be possible to verify the authenticity and integrity of the input.The signature and the public key do not reveal anything about the private key.It can also be used to verify whether or not an alleged signature is in fact the authentic signature of the data associated with it.</p><p>The Signature ClassDescription of Figure The Signature Class</p><p>A Signature object is initialized for signing with a Private Key and is given the data to be signed. The resulting signature bytes are typically kept with the signed data. When verification is needed, another Signature object is created and initialized for verification and given the corresponding Public Key. The data and the signature bytes are fed to the signature object, and if the data and signature match, the Signature object reports success.</p><p>Even though a signature seems similar to a message digest, they have very different purposes in the type of protection they provide. In fact, algorithms such as &quot;SHA1WithRSA&quot; use the message digest &quot;SHA1&quot; to initially &quot;compress&quot; the large data sets into a more manageable form, then sign the resulting 20 byte message digest with the &quot;RSA&quot; algorithm.</p><p>Please see the Examples section for an example of signing and verifying data.</p><h3>Signature Object States</h3><p>Signature objects are modal objects. This means that a Signature object is always in a given state, where it may only do one type of operation. States are represented as final integer constants defined in their respective classes.</p><p>&#x7B7E;&#x540D;&#x5BF9;&#x8C61;&#x53EF;&#x80FD;&#x5904;&#x4E8E;&#x7684;&#x4E09;&#x79CD;&#x72B6;&#x6001;:</p><ul class="ui list"><li>&#x672A;&#x521D;&#x59CB;&#x5316;(UNINITIALIZED)</li><li>&#x7B7E;&#x540D;(SIGN)</li><li>&#x9A8C;&#x8BC1;(VERIFY)</li></ul><p>When it is first created, a Signature object is in the UNINITIALIZED state. The Signature class defines two initialization methods, initSign and initVerify, which change the state to SIGN and VERIFY, respectively.Creating a Signature Object</p><p>The first step for signing or verifying a signature is to create a Signature instance. Signature objects are obtained by using one of the Signature getInstance() static factory methods.</p><h3>Initializing a Signature Object</h3><p>A Signature object must be initialized before it is used. The initialization method depends on whether the object is going to be used for signing or for verification.</p><p>If it is going to be used for signing, the object must first be initialized with the private key of the entity whose signature is going to be generated. This initialization is done by calling the method:</p><p>final void initSign(PrivateKey privateKey)This method puts the Signature object in the SIGN state.If instead the Signature object is going to be used for verification, it must first be initialized with the public key of the entity whose signature is going to be verified. This initialization is done by calling either of these methods:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">initVerify</span><span class="params">(PublicKey publicKey)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">initVerify</span><span class="params">(Certificate certificate)</span></span></span><br></pre></td></tr></table></figure></p><p>This method puts the Signature object in the VERIFY state.</p><h3>Signing</h3><p>If the Signature object has been initialized for signing (if it is in the SIGN state), the data to be signed can then be supplied to the object. This is done by making one or more calls to one of the update methods:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">byte</span> b)</span></span></span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">byte</span>[] data)</span></span></span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">byte</span>[] data, <span class="keyword">int</span> off, <span class="keyword">int</span> len)</span></span></span><br></pre></td></tr></table></figure></p><p>Calls to the update method(s) should be made until all the data to be signed has been supplied to the Signature object.</p><p>To generate the signature, simply call one of the sign methods:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">byte</span>[] sign()</span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">int</span> <span class="title">sign</span><span class="params">(<span class="keyword">byte</span>[] outbuf, <span class="keyword">int</span> offset, <span class="keyword">int</span> len)</span></span></span><br></pre></td></tr></table></figure></p><p>The first method returns the signature result in a byte array. The second stores the signature result in the provided buffer outbuf, starting at offset. len is the number of bytes in outbuf allotted for the signature. The method returns the number of bytes actually stored.</p><p>Signature encoding is algorithm specific. See the Standard Names document for more information about the use of ASN.1 encoding in the Java Cryptography Architecture.</p><p>A call to a sign method resets the signature object to the state it was in when previously initialized for signing via a call to initSign. That is, the object is reset and available to generate another signature with the same private key, if desired, via new calls to update and sign.</p><p>Alternatively, a new call can be made to initSign specifying a different private key, or to initVerify (to initialize the Signature object to verify a signature).</p><h3>Verifying</h3><p>If the Signature object has been initialized for verification (if it is in the VERIFY state), it can then verify if an alleged signature is in fact the authentic signature of the data associated with it. To start the process, the data to be verified (as opposed to the signature itself) is supplied to the object. The data is passed to the object by calling one of the update methods:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">byte</span> b)</span></span></span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">byte</span>[] data)</span></span></span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">byte</span>[] data, <span class="keyword">int</span> off, <span class="keyword">int</span> len)</span></span></span><br></pre></td></tr></table></figure></p><p>Calls to the update method(s) should be made until all the data to be verified has been supplied to the Signature object. The signature can now be verified by calling one of the verify methods:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">verify</span><span class="params">(<span class="keyword">byte</span>[] signature)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">verify</span><span class="params">(<span class="keyword">byte</span>[] signature, <span class="keyword">int</span> offset, <span class="keyword">int</span> length)</span></span></span><br></pre></td></tr></table></figure></p><p>The argument must be a byte array containing the signature. This byte array would hold the signature bytes which were returned by a previous call to one of the sign methods.</p><p>The verify method returns a boolean indicating whether or not the encoded signature is the authentic signature of the data supplied to the update method(s).</p><p>A call to the verify method resets the signature object to its state when it was initialized for verification via a call to initVerify. That is, the object is reset and available to verify another signature from the identity whose public key was specified in the call to initVerify.</p><p>Alternatively, a new call can be made to initVerify specifying a different public key (to initialize the Signature object for verifying a signature from a different entity), or to initSign (to initialize the Signature object for generating a signature).</p><h2>The Cipher Class</h2><p>The Cipher class provides the functionality of a cryptographic cipher used for encryption and decryption. Encryption is the process of taking data (called cleartext) and a key, and producing data (ciphertext) meaningless to a third-party who does not know the key. Decryption is the inverse process: that of taking ciphertext and a key and producing cleartext.</p><p>The Cipher ClassDescription of Figure The Cipher Class</p><h3>Symmetric vs. Asymmetric Cryptography</h3><p>There are two major types of encryption: symmetric (also known as secret key), and asymmetric (or public key cryptography). In symmetric cryptography, the same secret key to both encrypt and decrypt the data. Keeping the key private is critical to keeping the data confidential. On the other hand, asymmetric cryptography uses a public/private key pair to encrypt data. Data encrypted with one key is decrypted with the other. A user first generates a public/private key pair, and then publishes the public key in a trusted database that anyone can access. A user who wishes to communicate securely with that user encrypts the data using the retrieved public key. Only the holder of the private key will be able to decrypt. Keeping the private key confidential is critical to this scheme.</p><p>Asymmetric algorithms (such as RSA) are generally much slower than symmetric ones. These algorithms are not designed for efficiently protecting large amounts of data. In practice, asymmetric algorithms are used to exchange smaller secret keys which are used to initialize symmetric algorithms.</p><h3>Stream vs. Block Ciphers</h3><p>There are two major types of ciphers: block and stream. Block ciphers process entire blocks at a time, usually many bytes in length. If there is not enough data to make a complete input block, the data must be padded: that is, before encryption, dummy bytes must be added to make a multiple of the cipher&apos;s block size. These bytes are then stripped off during the decryption phase. The padding can either be done by the application, or by initializing a cipher to use a padding type such as <code>&quot;PKCS5PADDING&quot;</code>. In contrast, stream ciphers process incoming data one small unit (typically a byte or even a bit) at a time. This allows for ciphers to process an arbitrary amount of data without padding.</p><h3>&#x5DE5;&#x4F5C;&#x6A21;&#x5F0F;</h3><p>When encrypting using a simple block cipher, two identical blocks of plaintext will always produce an identical block of cipher text. Cryptanalysts trying to break the ciphertext will have an easier job if they note blocks of repeating text. In order to add more complexity to the text, feedback modes use the previous block of output to alter the input blocks before applying the encryption algorithm. The first block will need an initial value, and this value is called the initialization vector (IV). Since the IV simply alters the data before any encryption, the IV should be random but does not necessarily need to be kept secret. There are a variety of modes, such as <code>CBC (Cipher Block Chaining)</code>, <code>CFB (Cipher Feedback Mode)</code>, and <code>OFB (Output Feedback Mode)</code>. <code>ECB (Electronic Cookbook Mode)</code> is a mode with no feedback.</p><p>Some algorithms such as <code>AES</code> and <code>RSA</code> allow for keys of different lengths, but others are fixed, such as <code>DES</code> and <code>3DES</code>. Encryption using a longer key generally implies a stronger resistance to message recovery. As usual, there is a trade off between security and time, so choose the key length appropriately.</p><p>Most algorithms use binary keys. Most humans do not have the ability to remember long sequences of binary numbers, even when represented in hexadecimal. Character passwords are much easier to recall. Because character passwords are generally chosen from a small number of characters (for example, [a-zA-Z0-9]), protocols such as <code>&quot;Password-Based Encryption&quot; (PBE)</code> have been defined which take character passwords and generate strong binary keys. In order to make the task of getting from password to key very time-consuming for an attacker (via so-called &quot;dictionary attacks&quot; where common dictionary word-&gt;value mappings are precomputed), most PBE implementations will mix in a random number, known as a salt, to increase the key randomness.</p><p>Newer cipher modes such as Authenticated Encryption with Associated Data (AEAD) (for example, Galois/Counter Mode (GCM)) encrypt data and authenticate the resulting message simultaneously. Additional Associated Data (AAD) can be used during the calculation of the resulting AEAD tag (Mac), but this AAD data is not output as ciphertext. (For example, some data might not need to be kept confidential, but should figure into the tag calculation to detect modifications.) The <code>Cipher.updateAAD()</code> methods can be used to include AAD in the tag calculations.</p><h3>Using an AES Cipher with GCM Mode</h3><p>AES Cipher with GCM is an AEAD Cipher which has different usage patterns than the non-AEAD ciphers. Apart from the regular data, it also takes AAD which is optional for encryption/decryption but AAD must be supplied before data for encryption/decryption. In addition, in order to use GCM securely, callers should not re-use key and IV combinations for encryption. This means that the cipher object should be explicitly re-initialized with a different set of parameters every time for each encryption operation.<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">SecretKey myKey = ...</span><br><span class="line"><span class="keyword">byte</span>[] myAAD = ...</span><br><span class="line"><span class="keyword">byte</span>[] plainText = ...</span><br><span class="line">   <span class="keyword">int</span> myTLen = ... </span><br><span class="line">   <span class="keyword">byte</span>[] myIv = ...</span><br><span class="line"></span><br><span class="line">GCMParameterSpec myParams = <span class="keyword">new</span> GCMParameterSpec(myTLen, myIv);</span><br><span class="line">Cipher c = Cipher.getInstance(<span class="string">&quot;AES/GCM/NoPadding&quot;</span>);</span><br><span class="line">c.init(Cipher.ENCRYPT_MODE, myKey, myParams);</span><br><span class="line"></span><br><span class="line"><span class="comment">// AAD is optional, if present, it must be supplied before any update/doFinal calls.</span></span><br><span class="line">c.updateAAD(myAAD);  <span class="comment">// if AAD is non-null</span></span><br><span class="line"><span class="keyword">byte</span>[] cipherText = <span class="keyword">new</span> <span class="keyword">byte</span>[c.getOutputSize(plainText.length)];</span><br><span class="line">c.doFinal(plainText, <span class="number">0</span>, plainText.length, cipherText);    <span class="comment">// conclusion of encryption operation</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// To decrypt, same AAD and GCM parameters must be supplied</span></span><br><span class="line">c.init(Cipher.DECRYPT_MODE, myKey, myParams);</span><br><span class="line">c.updateAAD(myAAD);</span><br><span class="line"><span class="keyword">byte</span>[] recoveredText = c.doFinal(cipherText);</span><br><span class="line"></span><br><span class="line"><span class="comment">// MUST CHANGE IV VALUE if the same key were to be used again for encryption</span></span><br><span class="line">   <span class="keyword">byte</span>[] newIv = ...;</span><br><span class="line">myParams = <span class="keyword">new</span> GCMParameterSpec(myTLen, newIv);</span><br></pre></td></tr></table></figure></p><h3>Creating a Cipher Object</h3><p>Cipher objects are obtained by using one of the Cipher <code>getInstance()</code> static factory methods. Here, the algorithm name is slightly different than with other engine classes, in that it specifies not just an algorithm name, but a &quot;transformation&quot;. A transformation is a string that describes the operation (or set of operations) to be performed on the given input to produce some output. A transformation always includes the name of a cryptographic algorithm (e.g., DES), and may be followed by a mode and padding scheme.</p><p>A transformation is of the form:</p><ul class="ui list"><li>&quot;algorithm/mode/padding&quot; or</li><li>&quot;algorithm&quot;</li></ul><p>For example, the following are valid transformations:</p><ul class="ui list"><li>&quot;DES/CBC/PKCS5Padding&quot;</li><li>&quot;DES&quot;</li></ul><p>If just a transformation name is specified, the system will determine if there is an implementation of the requested transformation available in the environment, and if there is more than one, returns there is a preferred one.</p><p>If both a transformation name and a package provider are specified, the system will determine if there is an implementation of the requested transformation in the package requested, and throw an exception if there is not.</p><p>It is recommended to use a transformation that fully specifies the algorithm, mode, and padding. By not doing so, the provider will use a default. For example, the <code>SunJCE</code> and <code>SunPKCS11</code> providers use <code>ECB</code> as the default mode, and <code>PKCS5Padding</code> as the default padding for many symmetric ciphers.</p><p>This means that in the case of the SunJCE provider:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cipher c1 = Cipher.getInstance(<span class="string">&quot;DES/ECB/PKCS5Padding&quot;</span>);</span><br></pre></td></tr></table></figure></p><p>and<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cipher c1 = Cipher.getInstance(<span class="string">&quot;DES&quot;</span>);</span><br></pre></td></tr></table></figure></p><p>are equivalent statements.</p><blockquote><p>Note: <code>ECB</code> mode is the easiest block cipher mode to use and is the default in the JDK/JRE. ECB works well for single blocks of data, but absolutely should not be used for multiple data blocks.</p></blockquote><p>Using modes such as <code>CFB</code> and <code>OFB</code>, block ciphers can encrypt data in units smaller than the cipher&apos;s actual block size. When requesting such a mode, you may optionally specify the number of bits to be processed at a time by appending this number to the mode name as shown in the <code>&quot;DES/CFB8/NoPadding&quot;</code> and <code>&quot;DES/OFB32/PKCS5Padding&quot;</code> transformations. If no such number is specified, a provider-specific default is used. (For example, the SunJCE provider uses a default of 64 bits for DES.) Thus, block ciphers can be turned into byte-oriented stream ciphers by using an 8 bit mode such as CFB8 or OFB8.</p><p>Appendix A of this document contains a list of standard names that can be used to specify the algorithm name, mode, and padding scheme components of a transformation.</p><p>The objects returned by factory methods are uninitialized, and must be initialized before they become usable.</p><h3>Initializing a Cipher Object</h3><p>A Cipher object obtained via getInstance must be initialized for one of four modes, which are defined as final integer constants in the Cipher class. The modes can be referenced by their symbolic names, which are shown below along with a description of the purpose of each mode:</p><ul class="ui list"><li><code>ENCRYPT_MODE</code> Encryption of data.</li><li><code>DECRYPT_MODE</code> Decryption of data.</li><li><code>WRAP_MODE</code> Wrapping a java.security.Key into bytes so that the key can be securely transported.</li><li><code>UNWRAP_MODE</code> Unwrapping of a previously wrapped key into a java.security.Key object.</li></ul><p>Each of the Cipher initialization methods takes an operational mode parameter (opmode), and initializes the Cipher object for that mode. Other parameters include the key (key) or certificate containing the key (certificate), algorithm parameters (params), and a source of randomness (random).</p><p>To initialize a Cipher object, call one of the following init methods:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> opmode, Key key)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> opmode, Certificate certificate)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> opmode, Key key, SecureRandom random)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> opmode, Certificate certificate, SecureRandom random)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> opmode, Key key, AlgorithmParameterSpec params)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> opmode, Key key, AlgorithmParameterSpec params, SecureRandom random)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> opmode, Key key, AlgorithmParameters params)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> opmode, Key key, AlgorithmParameters params, SecureRandom random)</span></span>;</span><br></pre></td></tr></table></figure></p><p>If a Cipher object that requires parameters (e.g., an initialization vector) is initialized for encryption, and no parameters are supplied to the init method, the underlying cipher implementation is supposed to supply the required parameters itself, either by generating random parameters or by using a default, provider-specific set of parameters.</p><p>However, if a Cipher object that requires parameters is initialized for decryption, and no parameters are supplied to the init method, an InvalidKeyException or InvalidAlgorithmParameterException exception will be raised, depending on the init method that has been used.</p><p>See the section about Managing Algorithm Parameters for more details.</p><p>The same parameters that were used for encryption must be used for decryption.</p><p>Note that when a Cipher object is initialized, it loses all previously-acquired state. In other words, initializing a Cipher is equivalent to creating a new instance of that Cipher, and initializing it. For example, if a Cipher is first initialized for decryption with a given key, and then initialized for encryption, it will lose any state acquired while in decryption mode.</p><h3>&#x52A0;&#x5BC6;&#x548C;&#x89E3;&#x5BC6;&#x6570;&#x636E;</h3><p>Data can be encrypted or decrypted in one step (single-part operation) or in multiple steps (multiple-part operation). A multiple-part operation is useful if you do not know in advance how long the data is going to be, or if the data is too long to be stored in memory all at once.</p><p>To encrypt or decrypt data in a single step, call one of the doFinal methods:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">byte</span>[] doFinal(<span class="keyword">byte</span>[] input);</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">byte</span>[] doFinal(<span class="keyword">byte</span>[] input, <span class="keyword">int</span> inputOffset, <span class="keyword">int</span> inputLen);</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doFinal</span><span class="params">(<span class="keyword">byte</span>[] input, <span class="keyword">int</span> inputOffset, <span class="keyword">int</span> inputLen, <span class="keyword">byte</span>[] output)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doFinal</span><span class="params">(<span class="keyword">byte</span>[] input, <span class="keyword">int</span> inputOffset, <span class="keyword">int</span> inputLen, <span class="keyword">byte</span>[] output, <span class="keyword">int</span> outputOffset)</span></span></span><br></pre></td></tr></table></figure></p><p>To encrypt or decrypt data in multiple steps, call one of the update methods:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">byte</span>[] update(<span class="keyword">byte</span>[] input);</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">byte</span>[] update(<span class="keyword">byte</span>[] input, <span class="keyword">int</span> inputOffset, <span class="keyword">int</span> inputLen);</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">update</span><span class="params">(<span class="keyword">byte</span>[] input, <span class="keyword">int</span> inputOffset, <span class="keyword">int</span> inputLen, <span class="keyword">byte</span>[] output)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">update</span><span class="params">(<span class="keyword">byte</span>[] input, <span class="keyword">int</span> inputOffset, <span class="keyword">int</span> inputLen, <span class="keyword">byte</span>[] output, <span class="keyword">int</span> outputOffset)</span></span></span><br></pre></td></tr></table></figure></p><p>A multiple-part operation must be terminated by one of the above doFinal methods (if there is still some input data left for the last step), or by one of the following doFinal methods (if there is no input data left for the last step):<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">byte</span>[] doFinal();</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doFinal</span><span class="params">(<span class="keyword">byte</span>[] output, <span class="keyword">int</span> outputOffset)</span></span>;</span><br></pre></td></tr></table></figure></p><p>All the doFinal methods take care of any necessary padding (or unpadding), if padding (or unpadding) has been requested as part of the specified transformation.</p><p>A call to doFinal resets the Cipher object to the state it was in when initialized via a call to init. That is, the Cipher object is reset and available to encrypt or decrypt (depending on the operation mode that was specified in the call to init) more data.</p><h3>&#x5305;&#x88C5;&#x548C;&#x89E3;&#x5305;&#x5BC6;&#x94A5;</h3><p>Wrapping a key enables secure transfer of the key from one place to another.</p><p>The wrap/unwrap API makes it more convenient to write code since it works with key objects directly. These methods also enable the possibility of secure transfer of hardware-based keys.</p><p>To wrap a Key, first initialize the Cipher object for <code>WRAP_MODE</code>, and then call the following:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">byte</span>[] wrap(Key key);</span><br></pre></td></tr></table></figure></p><p>If you are supplying the wrapped key bytes (the result of calling wrap) to someone else who will unwrap them, be sure to also send additional information the recipient will need in order to do the unwrap:</p><p>the name of the key algorithm, andthe type of the wrapped key (one of <code>Cipher.SECRET_KEY</code>, <code>Cipher.PRIVATE_KEY</code>, or <code>Cipher.PUBLIC_KEY</code>).The key algorithm name can be determined by calling the getAlgorithm method from the Key interface:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getAlgorithm</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure></p><p>To unwrap the bytes returned by a previous call to wrap, first initialize a Cipher object for <code>UNWRAP_MODE</code>, then call the following:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Key <span class="title">unwrap</span><span class="params">(<span class="keyword">byte</span>[] wrappedKey, String wrappedKeyAlgorithm, <span class="keyword">int</span> wrappedKeyType)</span>)</span>;</span><br></pre></td></tr></table></figure></p><p>Here, wrappedKey is the bytes returned from the previous call to wrap, wrappedKeyAlgorithm is the algorithm associated with the wrapped key, and wrappedKeyType is the type of the wrapped key. This must be one of Cipher.SECRET_KEY, Cipher.PRIVATE_KEY, or Cipher.PUBLIC_KEY.</p><h3>&#x7BA1;&#x7406;&#x7B97;&#x6CD5;&#x53C2;&#x6570;</h3><p>The parameters being used by the underlying Cipher implementation, which were either explicitly passed to the init method by the application or generated by the underlying implementation itself, can be retrieved from the Cipher object by calling its getParameters method, which returns the parameters as a java.security.AlgorithmParameters object (or null if no parameters are being used). If the parameter is an <code>initialization vector (IV)</code>, it can also be retrieved by calling the <code>getIV</code> method.</p><p>In the following example, a Cipher object implementing password-based encryption (PBE) is initialized with just a key and no parameters. However, the selected algorithm for password-based encryption requires two parameters - a salt and an iteration count. Those will be generated by the underlying algorithm implementation itself. The application can retrieve the generated parameters from the Cipher object as follows:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.crypto.*;</span><br><span class="line"><span class="keyword">import</span> java.security.AlgorithmParameters;</span><br><span class="line"></span><br><span class="line"><span class="comment">// get cipher object for password-based encryption</span></span><br><span class="line">Cipher c = Cipher.getInstance(<span class="string">&quot;PBEWithHmacSHA256AndAES_256&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// initialize cipher for encryption, without supplying</span></span><br><span class="line"><span class="comment">// any parameters. Here, &quot;myKey&quot; is assumed to refer</span></span><br><span class="line"><span class="comment">// to an already-generated key.</span></span><br><span class="line">c.init(Cipher.ENCRYPT_MODE, myKey);</span><br><span class="line"></span><br><span class="line"><span class="comment">// encrypt some data and store away ciphertext</span></span><br><span class="line"><span class="comment">// for later decryption</span></span><br><span class="line"><span class="keyword">byte</span>[] cipherText = c.doFinal(<span class="string">&quot;This is just an example&quot;</span>.getBytes());</span><br><span class="line"></span><br><span class="line"><span class="comment">// retrieve parameters generated by underlying cipher</span></span><br><span class="line"><span class="comment">// implementation</span></span><br><span class="line">AlgorithmParameters algParams = c.getParameters();</span><br><span class="line"></span><br><span class="line"><span class="comment">// get parameter encoding and store it away</span></span><br><span class="line"><span class="keyword">byte</span>[] encodedAlgParams = algParams.getEncoded();</span><br></pre></td></tr></table></figure></p><p>The same parameters that were used for encryption must be used for decryption. They can be instantiated from their encoding and used to initialize the corresponding Cipher object for decryption, as follows:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.crypto.*;</span><br><span class="line"><span class="keyword">import</span> java.security.AlgorithmParameters;</span><br><span class="line"></span><br><span class="line"><span class="comment">// get parameter object for password-based encryption</span></span><br><span class="line">AlgorithmParameters algParams;</span><br><span class="line">algParams = AlgorithmParameters.getInstance(<span class="string">&quot;PBEWithHmacSHA256AndAES_256&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// initialize with parameter encoding from above</span></span><br><span class="line">algParams.init(encodedAlgParams);</span><br><span class="line"></span><br><span class="line"><span class="comment">// get cipher object for password-based encryption</span></span><br><span class="line">Cipher c = Cipher.getInstance(<span class="string">&quot;PBEWithHmacSHA256AndAES_256&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// initialize cipher for decryption, using one of the</span></span><br><span class="line"><span class="comment">// init() methods that takes an AlgorithmParameters</span></span><br><span class="line"><span class="comment">// object, and pass it the algParams object from above</span></span><br><span class="line">c.init(Cipher.DECRYPT_MODE, myKey, algParams);</span><br></pre></td></tr></table></figure></p><p>If you did not specify any parameters when you initialized a Cipher object, and you are not sure whether or not the underlying implementation uses any parameters, you can find out by simply calling the getParameters method of your Cipher object and checking the value returned. A return value of null indicates that no parameters were used.</p><p>The following cipher algorithms implemented by the SunJCE provider use parameters:</p><p><code>DES, DES-EDE, and Blowfish</code>, when used in feedback (i.e., <code>CBC, CFB, OFB, or PCBC</code>) mode, use an <code>initialization vector (IV)</code>. The <code>javax.crypto.spec.IvParameterSpec</code> class can be used to initialize a Cipher object with a given IV.PBE Cipher algorithms use a set of parameters, comprising of a salt and an iteration count. The javax.crypto.spec.PBEParameterSpec class can be used to initialize a Cipher object implementing a PBE algorithm (for example: PBEWithHmacSHA256AndAES_256) with a given salt and iteration count.Note that you do not have to worry about storing or transferring any algorithm parameters for use by the decryption operation if you use the SealedObject class. This class attaches the parameters used for sealing (encryption) to the encrypted object contents, and uses the same parameters for unsealing (decryption).</p><h3>Cipher Output Considerations</h3><p>Some of the update and doFinal methods of Cipher allow the caller to specify the output buffer into which to encrypt or decrypt the data. In these cases, it is important to pass a buffer that is large enough to hold the result of the encryption or decryption operation.</p><p>The following method in Cipher can be used to determine how big the output buffer should be:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOutputSize</span><span class="params">(<span class="keyword">int</span> inputLen)</span></span></span><br></pre></td></tr></table></figure></p><h3>Other Cipher-based Classes</h3><p>There are some helper classes which internally use Ciphers to provide easy access to common cipher uses.</p><h4>The Cipher Stream Classes</h4><p>The CipherInputStream ClassThis class is a FilterInputStream that encrypts or decrypts the data passing through it. It is composed of an InputStream, or one of its subclasses, and a Cipher. CipherInputStream represents a secure input stream into which a Cipher object has been interposed. The read methods of CipherInputStream return data that are read from the underlying InputStream but have additionally been processed by the embedded Cipher object. The Cipher object must be fully initialized before being used by a CipherInputStream.</p><p>For example, if the embedded Cipher has been initialized for decryption, the CipherInputStream will attempt to decrypt the data it reads from the underlying InputStream before returning them to the application.</p><p>This class adheres strictly to the semantics, especially the failure semantics, of its ancestor classes java.io.FilterInputStream and java.io.InputStream. This class has exactly those methods specified in its ancestor classes, and overrides them all, so that the data are additionally processed by the embedded cipher. Moreover, this class catches all exceptions that are not thrown by its ancestor classes. In particular, the skip(long) method skips only data that has been processed by the Cipher.</p><p>It is crucial for a programmer using this class not to use methods that are not defined or overridden in this class (such as a new method or constructor that is later added to one of the super classes), because the design and implementation of those methods are unlikely to have considered security impact with regard to CipherInputStream.</p><p>As an example of its usage, suppose cipher1 has been initialized for encryption. The code below demonstrates how to use a CipherInputStream containing that cipher and a FileInputStream in order to encrypt input stream data:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">FileInputStream fis;</span><br><span class="line">FileOutputStream fos;</span><br><span class="line">CipherInputStream cis;</span><br><span class="line"></span><br><span class="line">fis = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;/tmp/a.txt&quot;</span>);</span><br><span class="line">cis = <span class="keyword">new</span> CipherInputStream(fis, cipher1);</span><br><span class="line">fos = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;/tmp/b.txt&quot;</span>);</span><br><span class="line"><span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">8</span>];</span><br><span class="line"><span class="keyword">int</span> i = cis.read(b);</span><br><span class="line"><span class="keyword">while</span> (i != -<span class="number">1</span>) {</span><br><span class="line">    fos.write(b, <span class="number">0</span>, i);</span><br><span class="line">    i = cis.read(b);</span><br><span class="line">}</span><br><span class="line">fos.close();</span><br></pre></td></tr></table></figure></p><p>The above program reads and encrypts the content from the file /tmp/a.txt and then stores the result (the encrypted bytes) in /tmp/b.txt.</p><p>The following example demonstrates how to easily connect several instances of CipherInputStream and FileInputStream. In this example, assume that cipher1 and cipher2 have been initialized for encryption and decryption (with corresponding keys), respectively.<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">FileInputStream fis;</span><br><span class="line">FileOutputStream fos;</span><br><span class="line">CipherInputStream cis1, cis2;</span><br><span class="line"></span><br><span class="line">fis = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;/tmp/a.txt&quot;</span>);</span><br><span class="line">cis1 = <span class="keyword">new</span> CipherInputStream(fis, cipher1);</span><br><span class="line">cis2 = <span class="keyword">new</span> CipherInputStream(cis1, cipher2);</span><br><span class="line">fos = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;/tmp/b.txt&quot;</span>);</span><br><span class="line"><span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">8</span>];</span><br><span class="line"><span class="keyword">int</span> i = cis2.read(b);</span><br><span class="line"><span class="keyword">while</span> (i != -<span class="number">1</span>) {</span><br><span class="line">    fos.write(b, <span class="number">0</span>, i);</span><br><span class="line">    i = cis2.read(b);</span><br><span class="line">}</span><br><span class="line">fos.close();</span><br></pre></td></tr></table></figure></p><p>The above program copies the content from file /tmp/a.txt to /tmp/b.txt, except that the content is first encrypted and then decrypted back when it is read from /tmp/a.txt. Of course since this program simply encrypts text and decrypts it back right away, it&apos;s actually not very useful except as a simple way of illustrating chaining of CipherInputStreams.</p><p>Note that the read methods of the CipherInputStream will block until data is returned from the underlying cipher. If a block cipher is used, a full block of cipher text will have to be obtained from the underlying InputStream.</p><h3>The CipherOutputStream Class</h3><p>This class is a FilterOutputStream that encrypts or decrypts the data passing through it. It is composed of an OutputStream, or one of its subclasses, and a Cipher. CipherOutputStream represents a secure output stream into which a Cipher object has been interposed. The write methods of CipherOutputStream first process the data with the embedded Cipher object before writing them out to the underlying OutputStream. The Cipher object must be fully initialized before being used by a CipherOutputStream.</p><p>For example, if the embedded Cipher has been initialized for encryption, the CipherOutputStream will encrypt its data, before writing them out to the underlying output stream.</p><p>This class adheres strictly to the semantics, especially the failure semantics, of its ancestor classes java.io.OutputStream and java.io.FilterOutputStream. This class has exactly those methods specified in its ancestor classes, and overrides them all, so that all data are additionally processed by the embedded cipher. Moreover, this class catches all exceptions that are not thrown by its ancestor classes.</p><p>It is crucial for a programmer using this class not to use methods that are not defined or overridden in this class (such as a new method or constructor that is later added to one of the super classes), because the design and implementation of those methods are unlikely to have considered security impact with regard to CipherOutputStream.</p><p>As an example of its usage, suppose cipher1 has been initialized for encryption. The code below demonstrates how to use a CipherOutputStream containing that cipher and a FileOutputStream in order to encrypt data to be written to an output stream:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">FileInputStream fis;</span><br><span class="line">FileOutputStream fos;</span><br><span class="line">CipherOutputStream cos;</span><br><span class="line"></span><br><span class="line">fis = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;/tmp/a.txt&quot;</span>);</span><br><span class="line">fos = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;/tmp/b.txt&quot;</span>);</span><br><span class="line">cos = <span class="keyword">new</span> CipherOutputStream(fos, cipher1);</span><br><span class="line"><span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">8</span>];</span><br><span class="line"><span class="keyword">int</span> i = fis.read(b);</span><br><span class="line"><span class="keyword">while</span> (i != -<span class="number">1</span>) {</span><br><span class="line">    cos.write(b, <span class="number">0</span>, i);</span><br><span class="line">    i = fis.read(b);</span><br><span class="line">}</span><br><span class="line">cos.flush();</span><br></pre></td></tr></table></figure></p><p>The above program reads the content from the file /tmp/a.txt, then encrypts and stores the result (the encrypted bytes) in /tmp/b.txt.</p><p>The following example demonstrates how to easily connect several instances of CipherOutputStream and FileOutputStream. In this example, assume that cipher1 and cipher2 have been initialized for decryption and encryption (with corresponding keys), respectively:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">FileInputStream fis;</span><br><span class="line">FileOutputStream fos;</span><br><span class="line">CipherOutputStream cos1, cos2;</span><br><span class="line"></span><br><span class="line">fis = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;/tmp/a.txt&quot;</span>);</span><br><span class="line">fos = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;/tmp/b.txt&quot;</span>);</span><br><span class="line">cos1 = <span class="keyword">new</span> CipherOutputStream(fos, cipher1);</span><br><span class="line">cos2 = <span class="keyword">new</span> CipherOutputStream(cos1, cipher2);</span><br><span class="line"><span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">8</span>];</span><br><span class="line"><span class="keyword">int</span> i = fis.read(b);</span><br><span class="line"><span class="keyword">while</span> (i != -<span class="number">1</span>) {</span><br><span class="line">    cos2.write(b, <span class="number">0</span>, i);</span><br><span class="line">    i = fis.read(b);</span><br><span class="line">}</span><br><span class="line">cos2.flush();</span><br></pre></td></tr></table></figure></p><p>The above program copies the content from file /tmp/a.txt to /tmp/b.txt, except that the content is first encrypted and then decrypted back before it is written to /tmp/b.txt.</p><p>One thing to keep in mind when using block cipher algorithms is that a full block of plaintext data must be given to the CipherOutputStream before the data will be encrypted and sent to the underlying output stream.</p><p>There is one other important difference between the flush and close methods of this class, which becomes even more relevant if the encapsulated Cipher object implements a block cipher algorithm with padding turned on:</p><ul class="ui list"><li>flush flushes the underlying OutputStream by forcing any buffered output bytes that have already been processed by the encapsulated Cipher object to be written out. Any bytes buffered by the encapsulated Cipher object and waiting to be processed by it will not be written out.</li><li>close closes the underlying OutputStream and releases any system resources associated with it. It invokes the doFinal method of the encapsulated Cipher object, causing any bytes buffered by it to be processed and written out to the underlying stream by calling its flush method.</li></ul><h2>The SealedObject Class</h2><p>This class enables a programmer to create an object and protect its confidentiality with a cryptographic algorithm.</p><p>Given any object that implements the java.io.Serializable interface, one can create a SealedObject that encapsulates the original object, in serialized format (i.e., a &quot;deep copy&quot;), and seals (encrypts) its serialized contents, using a cryptographic algorithm such as DES, to protect its confidentiality. The encrypted content can later be decrypted (with the corresponding algorithm using the correct decryption key) and de-serialized, yielding the original object.</p><p>A typical usage is illustrated in the following code segment: In order to seal an object, you create a SealedObject from the object to be sealed and a fully initialized Cipher object that will encrypt the serialized object contents. In this example, the String &quot;This is a secret&quot; is sealed using the DES algorithm. Note that any algorithm parameters that may be used in the sealing operation are stored inside of SealedObject:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create Cipher object</span></span><br><span class="line"><span class="comment">// <span class="doctag">NOTE:</span> sKey is assumed to refer to an already-generated</span></span><br><span class="line"><span class="comment">// secret DES key.</span></span><br><span class="line">Cipher c = Cipher.getInstance(<span class="string">&quot;DES&quot;</span>);</span><br><span class="line">c.init(Cipher.ENCRYPT_MODE, sKey);</span><br><span class="line"></span><br><span class="line"><span class="comment">// do the sealing</span></span><br><span class="line">SealedObject so = <span class="keyword">new</span> SealedObject(<span class="string">&quot;This is a secret&quot;</span>, c);</span><br></pre></td></tr></table></figure></p><p>The original object that was sealed can be recovered in two different ways:</p><p>by using a Cipher object that has been initialized with the exact same algorithm, key, padding scheme, etc., that were used to seal the object:c.init(Cipher.DECRYPT_MODE, sKey);try {String s = (String)so.getObject(c);} catch (Exception e) {// do something};This approach has the advantage that the party who unseals the sealed object does not require knowledge of the decryption key. For example, after one party has initialized the cipher object with the required decryption key, it could hand over the cipher object to another party who then unseals the sealed object.</p><p>by using the appropriate decryption key (since DES is a symmetric encryption algorithm, we use the same key for sealing and unsealing):try {String s = (String)so.getObject(sKey);} catch (Exception e) {// do something};In this approach, the getObject method creates a cipher object for the appropriate decryption algorithm and initializes it with the given decryption key and the algorithm parameters (if any) that were stored in the sealed object. This approach has the advantage that the party who unseals the object does not need to keep track of the parameters (e.g., the IV) that were used to seal the object.</p><p>The Mac ClassSimilar to a MessageDigest, a Message Authentication Code (MAC) provides a way to check the integrity of information transmitted over or stored in an unreliable medium, but includes a secret key in the calculation. Only someone with the proper key will be able to verify the received message. Typically, message authentication codes are used between two parties that share a secret key in order to validate information transmitted between these parties.</p><p>The Mac ClassDescription of Figure 8: The Mac Class</p><p>A MAC mechanism that is based on cryptographic hash functions is referred to as HMAC. HMAC can be used with any cryptographic hash function, e.g., MD5 or SHA-1, in combination with a secret shared key.</p><p>The Mac class provides the functionality of a Message Authentication Code (MAC). Please refer to the code example.</p><p>Creating a Mac Object</p><p>Mac objects are obtained by using one of the Mac getInstance() static factory methods.</p><p>Initializing a Mac Object</p><p>A Mac object is always initialized with a (secret) key and may optionally be initialized with a set of parameters, depending on the underlying MAC algorithm.</p><p>To initialize a Mac object, call one of its init methods:</p><pre><code>public void init(Key key);public void init(Key key, AlgorithmParameterSpec params);</code></pre><p>You can initialize your Mac object with any (secret-)key object that implements the javax.crypto.SecretKey interface. This could be an object returned by javax.crypto.KeyGenerator.generateKey(), or one that is the result of a key agreement protocol, as returned by javax.crypto.KeyAgreement.generateSecret(), or an instance of javax.crypto.spec.SecretKeySpec.</p><p>With some MAC algorithms, the (secret-)key algorithm associated with the (secret-)key object used to initialize the Mac object does not matter (this is the case with the HMAC-MD5 and HMAC-SHA1 implementations of the SunJCE provider). With others, however, the (secret-)key algorithm does matter, and an InvalidKeyException is thrown if a (secret-)key object with an inappropriate (secret-)key algorithm is used.</p><p>Computing a MAC</p><p>A MAC can be computed in one step (single-part operation) or in multiple steps (multiple-part operation). A multiple-part operation is useful if you do not know in advance how long the data is going to be, or if the data is too long to be stored in memory all at once.</p><p>To compute the MAC of some data in a single step, call the following doFinal method:</p><pre><code>public byte[] doFinal(byte[] input);</code></pre><p>To compute the MAC of some data in multiple steps, call one of the update methods:</p><pre><code>public void update(byte input);public void update(byte[] input);public void update(byte[] input, int inputOffset, int inputLen);</code></pre><p>A multiple-part operation must be terminated by the above doFinal method (if there is still some input data left for the last step), or by one of the following doFinal methods (if there is no input data left for the last step):</p><pre><code>public byte[] doFinal();public void doFinal(byte[] output, int outOffset);</code></pre><p>Key InterfacesTo this point, we have focused the high-level uses of the JCA without getting lost in the details of what keys are and how they are generated/represented. It is now time to turn our attention to keys.</p><p>The java.security.Key interface is the top-level interface for all opaque keys. It defines the functionality shared by all opaque key objects.</p><p>An opaque key representation is one in which you have no direct access to the key material that constitutes a key. In other words: &quot;opaque&quot; gives you limited access to the key--just the three methods defined by the Key interface (see below): getAlgorithm, getFormat, and getEncoded.</p><p>This is in contrast to a transparent representation, in which you can access each key material value individually, through one of the get methods defined in the corresponding specification class.</p><p>All opaque keys have three characteristics:</p><p>An AlgorithmThe key algorithm for that key. The key algorithm is usually an encryption or asymmetric operation algorithm (such as AES, DSA or RSA), which will work with those algorithms and with related algorithms (such as MD5withRSA, SHA1withRSA, etc.) The name of the algorithm of a key is obtained using this method:String getAlgorithm()An Encoded FormThe external encoded form for the key used when a standard representation of the key is needed outside the Java Virtual Machine, as when transmitting the key to some other party. The key is encoded according to a standard format (such as X.509 or PKCS8), and is returned using the method:byte[] getEncoded()A FormatThe name of the format of the encoded key. It is returned by the method:String getFormat()Keys are generally obtained through key generators such as KeyGenerator and KeyPairGenerator, certificates, key specifications (using a KeyFactory), or a KeyStore implementation accessing a keystore database used to manage keys. It is possible to parse encoded keys, in an algorithm-dependent manner, using a KeyFactory.It is also possible to parse certificates, using a CertificateFactory.</p><p>Here is a list of interfaces which extend the Key interface in the java.security.interfaces and javax.crypto.interfaces packages:</p><p>SecretKeyPBEKeyPrivateKeyDHPrivateKeyDSAPrivateKeyECPrivateKeyRSAMultiPrimePrivateCrtKeyRSAPrivateCrtKeyRSAPrivateKeyPublicKeyDHPublicKeyDSAPublicKeyECPublicKeyRSAPublicKeyThe PublicKey and PrivateKey Interfaces</p><p>The PublicKey and PrivateKey interfaces (which both extend the Key interface) are methodless interfaces, used for type-safety and type-identification.</p><p>The KeyPair ClassThe KeyPair class is a simple holder for a key pair (a public key and a private key). It has two public methods, one for returning the private key, and the other for returning the public key:</p><p>PrivateKey getPrivate()PublicKey getPublic()Key Specification Interfaces and ClassesKey objects and key specifications (KeySpecs) are two different representations of key data. Ciphers use Key objects to initialize their encryption algorithms, but keys may need to be converted into a more portable format for transmission or storage.</p><p>A transparent representation of keys means that you can access each key material value individually, through one of the get methods defined in the corresponding specification class. For example, DSAPrivateKeySpec defines getX, getP, getQ, and getG methods, to access the private key x, and the DSA algorithm parameters used to calculate the key: the prime p, the sub-prime q, and the base g. If the key is stored on a hardware device, its specification may contain information that helps identify the key on the device.</p><p>This representation is contrasted with an opaque representation, as defined by the Key interface, in which you have no direct access to the key material fields. In other words, an &quot;opaque&quot; representation gives you limited access to the key--just the three methods defined by the Key interface: getAlgorithm, getFormat, and getEncoded.</p><p>A key may be specified in an algorithm-specific way, or in an algorithm-independent encoding format (such as ASN.1). For example, a DSA private key may be specified by its components x, p, q, and g (see DSAPrivateKeySpec), or it may be specified using its DER encoding (see PKCS8EncodedKeySpec).</p><p>The KeyFactory and SecretKeyFactory classes can be used to convert between opaque and transparent key representations (that is, between Keys and KeySpecs, assuming that the operation is possible. (For example, private keys on smart cards might not be able leave the card. Such Keys are not convertible.)</p><p>In the following sections, we discuss the key specification interfaces and classes in the java.security.spec package.</p><p>The KeySpec Interface</p><p>This interface contains no methods or constants. Its only purpose is to group and provide type safety for all key specifications. All key specifications must implement this interface.</p><p>The KeySpec Subinterfaces</p><p>Like the Key interface, there are a similar set of KeySpec interfaces.</p><p>SecretKeySpecEncodedKeySpecPKCS8EncodedKeySpecX509EncodedKeySpecDESKeySpecDESedeKeySpecPBEKeySpecDHPrivateKeySpecDSAPrivateKeySpecECPrivateKeySpecRSAPrivateKeySpecRSAMultiPrimePrivateCrtKeySpecRSAPrivateCrtKeySpecDHPublicKeySpecDSAPublicKeySpecECPublicKeySpecRSAPublicKeySpecThe EncodedKeySpec Class</p><p>This abstract class (which implements the KeySpec interface) represents a public or private key in encoded format. Its getEncoded method returns the encoded key:</p><p>abstract byte[] getEncoded();and its getFormat method returns the name of the encoding format:abstract String getFormat();See the next sections for the concrete implementations PKCS8EncodedKeySpec and X509EncodedKeySpec.</p><p>The PKCS8EncodedKeySpec ClassThis class, which is a subclass of EncodedKeySpec, represents the DER encoding of a private key, according to the format specified in the PKCS8 standard. Its getEncoded method returns the key bytes, encoded according to the PKCS8 standard. Its getFormat method returns the string &quot;PKCS#8&quot;.</p><p>The X509EncodedKeySpec ClassThis class, which is a subclass of EncodedKeySpec, represents the DER encoding of a public key, according to the format specified in the X.509 standard. Its getEncoded method returns the key bytes, encoded according to the X.509 standard. Its getFormat method returns the string &quot;X.509&quot;.</p><p>Of Generators and FactoriesNewcomers to Java and the JCA APIs in particular sometimes do not grasp the distinction between generators and factories.</p><p>Differences Between Generators and FactoriesDescription of Figure Differences Between Generators and Factories</p><p>Generators are used to generate brand new objects. Generators can be initialized in either an algorithm-dependent or algorithm-independent way. For example, to create a Diffie-Hellman (DH) keypair, an application could specify the necessary P and G values, or the generator could simply be initialized with the appropriate key length, and the generator will select appropriate P and G values. In both cases, the generator will produce brand new keys based on the parameters.</p><p>On the other hand, factories are used to convert data from one existing object type to another. For example, an application might have available the components of a DH private key and can package them as a KeySpec, but needs to convert them into a PrivateKey object that can be used by a KeyAgreement object, or vice-versa. Or they might have the byte array of a certificate, but need to use a CertificateFactory to convert it into a X509Certificate object. Applications use factory objects to do the conversion.</p><p>The KeyFactory ClassThe KeyFactory class is an engine class designed to perform conversions between opaque cryptographic Keys and key specifications (transparent representations of the underlying key material).</p><p>The KeyFactory Class&lt;Description of Figure The KeyFactory Class</p><p>Key factories are bi-directional. They allow you to build an opaque key object from a given key specification (key material), or to retrieve the underlying key material of a key object in a suitable format.</p><p>Multiple compatible key specifications can exist for the same key. For example, a DSA public key may be specified by its components y, p, q, and g (see java.security.spec.DSAPublicKeySpec), or it may be specified using its DER encoding according to the X.509 standard (see X509EncodedKeySpec).</p><p>A key factory can be used to translate between compatible key specifications. Key parsing can be achieved through translation between compatible key specifications, e.g., when you translate from X509EncodedKeySpec to DSAPublicKeySpec, you basically parse the encoded key into its components. For an example, see the end of the Generating/Verifying Signatures Using Key Specifications and KeyFactory section.</p><p>Creating a KeyFactory Object</p><p>KeyFactory objects are obtained by using one of the KeyFactory getInstance() static factory methods.</p><p>Converting Between a Key Specification and a Key Object</p><p>If you have a key specification for a public key, you can obtain an opaque PublicKey object from the specification by using the generatePublic method:</p><p>PublicKey generatePublic(KeySpec keySpec)Similarly, if you have a key specification for a private key, you can obtain an opaque PrivateKey object from the specification by using the generatePrivate method:</p><p>PrivateKey generatePrivate(KeySpec keySpec)Converting Between a Key Object and a Key Specification</p><p>If you have a Key object, you can get a corresponding key specification object by calling the getKeySpec method:</p><p>KeySpec getKeySpec(Key key, Class keySpec)keySpec identifies the specification class in which the key material should be returned. It could, for example, be DSAPublicKeySpec.class, to indicate that the key material should be returned in an instance of the DSAPublicKeySpec class.Please see the Examples section for more details.</p><p>The SecretKeyFactory ClassThis class represents a factory for secret keys. Unlike KeyFactory, a javax.crypto.SecretKeyFactory object operates only on secret (symmetric) keys, whereas a java.security.KeyFactory object processes the public and private key components of a key pair.</p><p>The SecretKeyFactory ClassDescription of The SecretKeyFactory Class</p><p>Key factories are used to convert Keys (opaque cryptographic keys of type java.security.Key) into key specifications (transparent representations of the underlying key material in a suitable format), and vice versa.</p><p>Objects of type java.security.Key, of which java.security.PublicKey, java.security.PrivateKey, and javax.crypto.SecretKey are subclasses, are opaque key objects, because you cannot tell how they are implemented. The underlying implementation is provider-dependent, and may be software or hardware based. Key factories allow providers to supply their own implementations of cryptographic keys.</p><p>For example, if you have a key specification for a Diffie Hellman public key, consisting of the public value y, the prime modulus p, and the base g, and you feed the same specification to Diffie-Hellman key factories from different providers, the resulting PublicKey objects will most likely have different underlying implementations.</p><p>A provider should document the key specifications supported by its secret key factory. For example, the SecretKeyFactory for DES keys supplied by the SunJCE provider supports DESKeySpec as a transparent representation of DES keys, the SecretKeyFactory for DES-EDE keys supports DESedeKeySpec as a transparent representation of DES-EDE keys, and the SecretKeyFactory for PBE supports PBEKeySpec as a transparent representation of the underlying password.</p><p>The following is an example of how to use a SecretKeyFactory to convert secret key data into a SecretKey object, which can be used for a subsequent Cipher operation:</p><pre><code>// Note the following bytes are not realistic secret key data// bytes but are simply supplied as an illustration of using data// bytes (key material) you already have to build a DESKeySpec.byte[] desKeyData = { (byte)0x01, (byte)0x02, (byte)0x03,(byte)0x04, (byte)0x05, (byte)0x06, (byte)0x07, (byte)0x08 };DESKeySpec desKeySpec = new DESKeySpec(desKeyData);SecretKeyFactory keyFactory = SecretKeyFactory.getInstance(&quot;DES&quot;);SecretKey secretKey = keyFactory.generateSecret(desKeySpec);</code></pre><p>In this case, the underlying implementation of SecretKey is based on the provider of KeyFactory.</p><p>An alternative, provider-independent way of creating a functionally equivalent SecretKey object from the same key material is to use the javax.crypto.spec.SecretKeySpec class, which implements the javax.crypto.SecretKey interface:</p><pre><code>byte[] desKeyData = { (byte)0x01, (byte)0x02, ...};SecretKeySpec secretKey = new SecretKeySpec(desKeyData, &quot;DES&quot;);</code></pre><p>Creating a SecretKeyFactory Object</p><p>SecretKeyFactory objects are obtained by using one of the SecretKeyFactory getInstance() static factory methods.</p><p>Converting Between a Key Specification and a Secret Key Object</p><p>If you have a key specification for a secret key, you can obtain an opaque SecretKey object from the specification by using the generateSecret method:</p><p>SecretKey generateSecret(KeySpec keySpec)Converting Between a Secret Key Object and a Key Specification</p><p>If you have a Secret Key object, you can get a corresponding key specification object by calling the getKeySpec method:</p><p>KeySpec getKeySpec(Key key, Class keySpec)keySpec identifies the specification class in which the key material should be returned. It could, for example, be DESKeySpec.class, to indicate that the key material should be returned in an instance of the DESKeySpec class.The KeyPairGenerator ClassThe KeyPairGenerator class is an engine class used to generate pairs of public and private keys.</p><p>The KeyPairGenerator ClassDescription of The KeyPairGenerator Class</p><p>There are two ways to generate a key pair: in an algorithm-independent manner, and in an algorithm-specific manner. The only difference between the two is the initialization of the object.</p><p>Please see the Examples section for examples of calls to the methods documented below.</p><p>Creating a KeyPairGenerator</p><p>All key pair generation starts with a KeyPairGenerator. KeyPairGenerator objects are obtained by using one of the KeyPairGenerator getInstance() static factory methods.</p><p>Initializing a KeyPairGenerator</p><p>A key pair generator for a particular algorithm creates a public/private key pair that can be used with this algorithm. It also associates algorithm-specific parameters with each of the generated keys.</p><p>A key pair generator needs to be initialized before it can generate keys. In most cases, algorithm-independent initialization is sufficient. But in other cases, algorithm-specific initialization can be used.</p><p>Algorithm-Independent InitializationAll key pair generators share the concepts of a keysize and a source of randomness. The keysize is interpreted differently for different algorithms. For example, in the case of the DSA algorithm, the keysize corresponds to the length of the modulus. (See the Standard Names document for information about the keysizes for specific algorithms.)</p><p>An initialize method takes two universally shared types of arguments:</p><p>void initialize(int keysize, SecureRandom random)Another initialize method takes only a keysize argument; it uses a system-provided source of randomness:void initialize(int keysize)Since no other parameters are specified when you call the above algorithm-independent initialize methods, it is up to the provider what to do about the algorithm-specific parameters (if any) to be associated with each of the keys.</p><p>If the algorithm is a &quot;DSA&quot; algorithm, and the modulus size (keysize) is 512, 768, or 1024, then the SUN provider uses a set of precomputed values for the p, q, and g parameters. If the modulus size is not one of the above values, the SUN provider creates a new set of parameters. Other providers might have precomputed parameter sets for more than just the three modulus sizes mentioned above. Still others might not have a list of precomputed parameters at all and instead always create new parameter sets.</p><p>Algorithm-Specific InitializationFor situations where a set of algorithm-specific parameters already exists (such as &quot;community parameters&quot; in DSA), there are two initialize methods that have an AlgorithmParameterSpec argument. One also has a SecureRandom argument, while the source of randomness is system-provided for the other:</p><p>void initialize(AlgorithmParameterSpec params,SecureRandom random)</p><p>void initialize(AlgorithmParameterSpec params)See the Examples section for more details.Generating a Key Pair</p><p>The procedure for generating a key pair is always the same, regardless of initialization (and of the algorithm). You always call the following method from KeyPairGenerator:</p><p>KeyPair generateKeyPair()Multiple calls to generateKeyPair will yield different key pairs.The KeyGenerator ClassA key generator is used to generate secret keys for symmetric algorithms.</p><p>The KeyGenerator ClassDescription of Figure The KeyGenerator Class</p><p>Creating a KeyGenerator</p><p>KeyGenerator objects are obtained by using one of the KeyGenerator getInstance() static factory methods.Initializing a KeyGenerator Object</p><p>A key generator for a particular symmetric-key algorithm creates a symmetric key that can be used with that algorithm. It also associates algorithm-specific parameters (if any) with the generated key.</p><p>There are two ways to generate a key: in an algorithm-independent manner, and in an algorithm-specific manner. The only difference between the two is the initialization of the object:</p><p>Algorithm-Independent InitializationAll key generators share the concepts of a keysize and a source of randomness. There is an init method that takes these two universally shared types of arguments. There is also one that takes just a keysize argument, and uses a system-provided source of randomness, and one that takes just a source of randomness:</p><pre><code>public void init(SecureRandom random);public void init(int keysize);public void init(int keysize, SecureRandom random);</code></pre><p>Since no other parameters are specified when you call the above algorithm-independent init methods, it is up to the provider what to do about the algorithm-specific parameters (if any) to be associated with the generated key.</p><p>Algorithm-Specific InitializationFor situations where a set of algorithm-specific parameters already exists, there are two init methods that have an AlgorithmParameterSpec argument. One also has a SecureRandom argument, while the source of randomness is system-provided for the other:</p><pre><code>public void init(AlgorithmParameterSpec params);public void init(AlgorithmParameterSpec params, SecureRandom random);</code></pre><p>In case the client does not explicitly initialize the KeyGenerator (via a call to an init method), each provider must supply (and document) a default initialization.</p><p>Creating a Key</p><p>The following method generates a secret key:</p><pre><code>public SecretKey generateKey();</code></pre><p>The KeyAgreement ClassKey agreement is a protocol by which 2 or more parties can establish the same cryptographic keys, without having to exchange any secret information.</p><p>The KeyAgreement ClassDescription of Figure The KeyAgreement Class</p><p>Each party initializes their key agreement object with their private key, and then enters the public keys for each party that will participate in the communication. In most cases, there are just two parties, but algorithms such as Diffie-Hellman allow for multiple parties (3 or more) to participate. When all the public keys have been entered, each KeyAgreement object will generate (agree upon) the same key.</p><p>The KeyAgreement class provides the functionality of a key agreement protocol. The keys involved in establishing a shared secret are created by one of the key generators (KeyPairGenerator or KeyGenerator), a KeyFactory, or as a result from an intermediate phase of the key agreement protocol.</p><p>Creating a KeyAgreement Object</p><p>Each party involved in the key agreement has to create a KeyAgreement object. KeyAgreement objects are obtained by using one of the KeyAgreement getInstance() static factory methods.</p><p>Initializing a KeyAgreement Object</p><p>You initialize a KeyAgreement object with your private information. In the case of Diffie-Hellman, you initialize it with your Diffie-Hellman private key. Additional initialization information may contain a source of randomness and/or a set of algorithm parameters. Note that if the requested key agreement algorithm requires the specification of algorithm parameters, and only a key, but no parameters are provided to initialize the KeyAgreement object, the key must contain the required algorithm parameters. (For example, the Diffie-Hellman algorithm uses a prime modulus p and a base generator g as its parameters.)</p><p>To initialize a KeyAgreement object, call one of its init methods:</p><pre><code>public void init(Key key);public void init(Key key, SecureRandom random);public void init(Key key, AlgorithmParameterSpec params);public void init(Key key, AlgorithmParameterSpec params,                 SecureRandom random);</code></pre><p>Executing a KeyAgreement Phase</p><p>Every key agreement protocol consists of a number of phases that need to be executed by each party involved in the key agreement.</p><p>To execute the next phase in the key agreement, call the doPhase method:</p><pre><code>public Key doPhase(Key key, boolean lastPhase);</code></pre><p>The key parameter contains the key to be processed by that phase. In most cases, this is the public key of one of the other parties involved in the key agreement, or an intermediate key that was generated by a previous phase. doPhase may return an intermediate key that you may have to send to the other parties of this key agreement, so they can process it in a subsequent phase.</p><p>The lastPhase parameter specifies whether or not the phase to be executed is the last one in the key agreement: A value of FALSE indicates that this is not the last phase of the key agreement (there are more phases to follow), and a value of TRUE indicates that this is the last phase of the key agreement and the key agreement is completed, i.e., generateSecret can be called next.</p><p>In the example of Diffie-Hellman between two parties , you call doPhase once, with lastPhase set to TRUE. In the example of Diffie-Hellman between three parties, you call doPhase twice: the first time with lastPhase set to FALSE, the 2nd time with lastPhase set to TRUE.</p><p>Generating the Shared Secret</p><p>After each party has executed all the required key agreement phases, it can compute the shared secret by calling one of the generateSecret methods:</p><pre><code>public byte[] generateSecret();public int generateSecret(byte[] sharedSecret, int offset);public SecretKey generateSecret(String algorithm);</code></pre><p>Key ManagementA database called a &quot;keystore&quot; can be used to manage a repository of keys and certificates. (A certificate is a digitally signed statement from one entity, saying that the public key of some other entity has a particular value.)</p><p>Keystore Location</p><p>The user keystore is by default stored in a file named .keystore in the user&apos;s home directory, as determined by the &quot;user.home&quot; system property. On Solaris systems &quot;user.home&quot; defaults to the user&apos;s home directory. On Win32 systems, given user name uName, &quot;user.home&quot; defaults to:</p><p>C:\Winnt\Profiles\uName on multi-user Windows NT systemsC:\Windows\Profiles\uName on multi-user Windows 95/98/2000 systemsC:\Windows on single-user Windows 95/98/2000 systemsOf course, keystore files can be located as desired. In some environments, it may make sense for multiple keystores to exist. For example, in JSSE (SSL/TLS), one keystore might hold a user&apos;s private keys, and another might hold certificates used to establish trust relationships.</p><p>In addition to the user&apos;s keystore, the JDK also maintains a system-wide keystore which is used to store trusted certificates from a variety of Certificate Authorities (CA&apos;s). These CA certificates can be used to help make trust decisions. For example, in SSL/TLS when the SunJSSE provider is presented with certificates from a remote peer, the default trustmanager will consult the:</p><p>Solaris, Linux, or Mac OS X: &lt;java-home&gt;/lib/ext/cacertsWindows: &lt;java-home&gt;\lib\ext\cacertsfile to determine if the connection is to be trusted. Instead of using the system-wide cacerts keystore, applications can set up and use their own keystores, or even use the user keystore described above.</p><p>Keystore Implementation</p><p>The KeyStore class supplies well-defined interfaces to access and modify the information in a keystore. It is possible for there to be multiple different concrete implementations, where each implementation is that for a particular type of keystore.</p><p>Currently, there are two command-line tools that make use of KeyStore: keytool and jarsigner, and also a GUI-based tool named policytool. It is also used by the Policy reference implementation when it processes policy files specifying the permissions (allowed accesses to system resources) to be granted to code from various sources. Since KeyStore is publicly available, JDK users can write additional security applications that use it.</p><p>Applications can choose different types of keystore implementations from different providers, using the getInstance factory method in the KeyStore class. A keystore type defines the storage and data format of the keystore information, and the algorithms used to protect private keys in the keystore and the integrity of the keystore itself. Keystore implementations of different types are not compatible.</p><p>There is a built-in default keystore implementation type known as &quot;jks&quot; that is provided by Sun Microsystems. It implements the keystore as a file, utilizing a proprietary keystore type (format). It protects each private key with its own individual password, and also protects the integrity of the entire keystore with a (possibly different) password. The default is specified by the following line in the security properties file:</p><pre><code>keystore.type=jks</code></pre><p>To have tools and other applications use a different default keystore implementation, you can change that line to specify a default type. If you have a provider package that supplies a keystore implementation for a keystore type called &quot;jceks&quot;, change the line to:</p><pre><code>keystore.type=jceks</code></pre><p>Some applications, such as keytool, also let you override the default keystore type (via the -storetype command-line parameter).</p><p>NOTE: Keystore type designations are case-insensitive. For example, &quot;jks&quot; would be considered the same as &quot;JKS&quot;.There are three other types of keystores that come with the JDK implementation.</p><p>&quot;jceks&quot; is an alternate proprietary keystore format to &quot;jks&quot; that uses much stronger encryption in the form of Password-Based Encryption with Triple-DES.The Sun &quot;jceks&quot; implementation can parse and convert a &quot;jks&quot; keystore file to the &quot;jceks&quot; format. You may upgrade your keystore of type &quot;jks&quot; to a keystore of type &quot;jceks&quot; by changing the password of a private-key entry in your keystore and specifying &quot;-storetype jceks&quot; as the keystore type. To apply the cryptographically strong(er) key protection supplied to a private key named &quot;signkey&quot; in your default keystore, use the following command, which will prompt you for the old and new key passwords:</p><pre><code>keytool -keypasswd -alias signkey -storetype jceks</code></pre><p>See Security Tools for more information about keytool and about keystores and how they are managed.NOTE: Keystore type designations are case-insensitive. For example, &quot;jceks&quot; would be considered the same as &quot;JCEKS&quot;.&quot;pkcs12&quot; is another option. This is a cross platform keystore based on the RSA PKCS12 Personal Information Exchange Syntax Standard. This standard is primarily meant for storing or transporting a user&apos;s private keys, certificates, and miscellaneous secrets. As of JDK 8, arbitrary attributes can be associated with individual entries in a PKCS12 keystore.&quot;dks&quot; is a domain keystore. It is a collection of keystores presented as a single logical keystore. The keystores that comprise a given domain are specified by configuration data whose syntax is described in DomainLoadStoreParameter.Keystore implementations are provider-based. Developers interested in writing their own KeyStore implementations should consult How to Implement a Provider for the Java Cryptography Architecture for more information on this topic.</p><p>The KeyStore Class</p><p>The KeyStore class is an engine class that supplies well-defined interfaces to access and modify the information in a keystore.</p><p>The KeyStore ClassDescription of Figure The KeyStore Class</p><p>This class represents an in-memory collection of keys and certificates. KeyStore manages two types of entries:</p><p>Key EntryThis type of keystore entry holds very sensitive cryptographic key information, which is stored in a protected format to prevent unauthorized access. Typically, a key stored in this type of entry is a secret key, or a private key accompanied by the certificate chain authenticating the corresponding public key.</p><p>Private keys and certificate chains are used by a given entity for self-authentication using digital signatures. For example, software distribution organizations digitally sign JAR files as part of releasing and/or licensing software.</p><p>Trusted Certificate EntryThis type of entry contains a single public key certificate belonging to another party. It is called a trusted certificate because the keystore owner trusts that the public key in the certificate indeed belongs to the identity identified by the subject (owner) of the certificate.</p><p>This type of entry can be used to authenticate other parties.</p><p>Each entry in a keystore is identified by an &quot;alias&quot; string. In the case of private keys and their associated certificate chains, these strings distinguish among the different ways in which the entity may authenticate itself. For example, the entity may authenticate itself using different certificate authorities, or using different public key algorithms.</p><p>Whether keystores are persistent, and the mechanisms used by the keystore if it is persistent, are not specified here. This convention allows use of a variety of techniques for protecting sensitive (e.g., private or secret) keys. Smart cards or other integrated cryptographic engines (SafeKeyper) are one option, and simpler mechanisms such as files may also be used (in a variety of formats).</p><p>The main KeyStore methods are described below.</p><p>Creating a KeyStore Object</p><p>KeyStore objects are obtained by using one of the KeyStore getInstance() static factory methods.</p><p>Loading a Particular Keystore into Memory</p><p>Before a KeyStore object can be used, the actual keystore data must be loaded into memory via the load method:</p><p>final void load(InputStream stream, char[] password)The optional password is used to check the integrity of the keystore data. If no password is supplied, no integrity check is performed.</p><p>To create an empty keystore, you pass null as the InputStream argument to the load method.</p><p>A DKS keystore is loaded by passing a DomainLoadStoreParameter to the alternative load method:</p><p>final void load(KeyStore.LoadStoreParameter param)Getting a List of the Keystore Aliases</p><p>All keystore entries are accessed via unique aliases. The aliases method returns an enumeration of the alias names in the keystore:</p><p>final Enumeration aliases()Determining Keystore Entry Types</p><p>As stated in The KeyStore Class, there are two different types of entries in a keystore. The following methods determine whether the entry specified by the given alias is a key/certificate or a trusted certificate entry, respectively:</p><p>final boolean isKeyEntry(String alias)final boolean isCertificateEntry(String alias)Adding/Setting/Deleting Keystore Entries</p><p>The setCertificateEntry method assigns a certificate to a specified alias:</p><p>final void setCertificateEntry(String alias, Certificate cert)If alias doesn&apos;t exist, a trusted certificate entry with that alias is created. If alias exists and identifies a trusted certificate entry, the certificate associated with it is replaced by cert.</p><p>The setKeyEntry methods add (if alias doesn&apos;t yet exist) or set key entries:</p><p>final void setKeyEntry(String alias,Key key,char[] password,Certificate[] chain)</p><p>final void setKeyEntry(String alias,byte[] key,Certificate[] chain)In the method with key as a byte array, it is the bytes for a key in protected format. For example, in the keystore implementation supplied by the SUN provider, the key byte array is expected to contain a protected private key, encoded as an EncryptedPrivateKeyInfo as defined in the PKCS8 standard. In the other method, the password is the password used to protect the key.</p><p>The deleteEntry method deletes an entry:</p><p>final void deleteEntry(String alias)PKCS #12 keystores support entries containing arbitrary attributes. Use the java.security.PKCS12Attribute class to create the attributes. When creating the new keystore entry use a constructor method that accepts attributes. Finally, use the following method to add the entry to the keystore:</p><p>final void setEntry(String alias, Entry entry,ProtectionParameter protParam)Getting Information from the Keystore</p><p>The getKey method returns the key associated with the given alias. The key is recovered using the given password:</p><p>final Key getKey(String alias, char[] password)The following methods return the certificate, or certificate chain, respectively, associated with the given alias:</p><p>final Certificate getCertificate(String alias)final Certificate[] getCertificateChain(String alias)You can determine the name (alias) of the first entry whose certificate matches a given certificate via the following:</p><p>final String getCertificateAlias(Certificate cert)PKCS #12 keystores support entries containing arbitrary attributes. Use the following method to retrieve an entry that may contain attributes:</p><p>final Entry getEntry(String alias, ProtectionParameter protParam)and then use the KeyStore.Entry.getAttributes method to extract such attributes and use the methods of the KeyStore.Entry.Attribute interface to examine them.</p><p>Saving the KeyStore</p><p>The in-memory keystore can be saved via the store method:</p><p>final void store(OutputStream stream, char[] password)The password is used to calculate an integrity checksum of the keystore data, which is appended to the keystore data.</p><p>A DKS keystore is stored by passing a DomainLoadStoreParameter to the alternative store method:</p><p>final void store(KeyStore.LoadStoreParameter param)Algorithm Parameters ClassesLike Keys and Keyspecs, an algorithm&apos;s initialization parameters are represented by either AlgorithmParameters or AlgorithmParameterSpecs. Depending on the use situation, algorithms can use the parameters directly, or the parameters might need to be converted into a more portable format for transmission or storage.</p><p>A transparent representation of a set of parameters (via AlgorithmParameterSpec) means that you can access each parameter value in the set individually. You can access these values through one of the get methods defined in the corresponding specification class (e.g., DSAParameterSpec defines getP, getQ, and getG methods, to access p, q, and g, respectively).</p><p>In contrast, the AlgorithmParameters class supplies an opaque representation, in which you have no direct access to the parameter fields. You can only get the name of the algorithm associated with the parameter set (via getAlgorithm) and some kind of encoding for the parameter set (via getEncoded).</p><p>The AlgorithmParameterSpec Interface</p><p>AlgorithmParameterSpec is an interface to a transparent specification of cryptographic parameters. This interface contains no methods or constants. Its only purpose is to group (and provide type safety for) all parameter specifications. All parameter specifications must implement this interface.</p><p>The algorithm parameter specification interfaces and classes in the java.security.spec and javax.crypto.spec packages are described in the JDK javadocs:</p><p>DHParameterSpecDHGenParameterSpecDSAParameterSpecECGenParameterSpecECParameterSpecGCMParameterSpecIvParameterSpecMGF1ParameterSpecOAEPParameterSpecPBEParameterSpecPSSParameterSpecRC2ParameterSpecRC5ParameterSpecRSAKeyGenParameterSpecThe following algorithm parameter specs are used specifically for digital signatures, as part of JSR 105.</p><p>C14NMethodParameterSpecDigestMethodParameterSpecSignatureMethodParameterSpecTransformParameterSpecExcC14NParameterSpecHMACParameterSpecXPathFilter2ParameterSpecXPathFilterParameterSpecXSLTTransformParameterSpecThe AlgorithmParameters Class</p><p>The AlgorithmParameters class is an engine class that provides an opaque representation of cryptographic parameters. You can initialize the AlgorithmParameters class using a specific AlgorithmParameterSpec object, or by encoding the parameters in a recognized format. You can retrieve the resulting specification with the getParameterSpec method (see the following section).</p><p>Creating an AlgorithmParameters Object</p><p>AlgorithmParameters objects are obtained by using one of the AlgorithmParameters getInstance() static factory methods.</p><p>Initializing an AlgorithmParameters Object</p><p>Once an AlgorithmParameters object is instantiated, it must be initialized via a call to init, using an appropriate parameter specification or parameter encoding:</p><p>void init(AlgorithmParameterSpec paramSpec)void init(byte[] params)void init(byte[] params, String format)In these init methods, params is an array containing the encoded parameters, and format is the name of the decoding format. In the init method with a params argument but no format argument, the primary decoding format for parameters is used. The primary decoding format is ASN.1, if an ASN.1 specification for the parameters exists.</p><p>NOTE: AlgorithmParameters objects can be initialized only once. They are not reusable.Obtaining the Encoded Parameters</p><p>A byte encoding of the parameters represented in an AlgorithmParameters object may be obtained via a call to getEncoded:</p><p>byte[] getEncoded()This method returns the parameters in their primary encoding format. The primary encoding format for parameters is ASN.1, if an ASN.1 specification for this type of parameters exists.</p><p>If you want the parameters returned in a specified encoding format, use</p><p>byte[] getEncoded(String format)If format is null, the primary encoding format for parameters is used, as in the other getEncoded method.NOTE: In the default AlgorithmParameters implementation, supplied by the SUN provider, the format argument is currently ignored.Converting an AlgorithmParameters Object to a Transparent Specification</p><p>A transparent parameter specification for the algorithm parameters may be obtained from an AlgorithmParameters object via a call to getParameterSpec:</p><p>AlgorithmParameterSpec getParameterSpec(Class paramSpec)paramSpec identifies the specification class in which the parameters should be returned. The specification class could be, for example, DSAParameterSpec.class to indicate that the parameters should be returned in an instance of the DSAParameterSpec class. (This class is in the java.security.spec package.)</p><p>The AlgorithmParameterGenerator Class</p><p>The AlgorithmParameterGenerator class is an engine class used to generate a set of brand-new parameters suitable for a certain algorithm (the algorithm is specified when an AlgorithmParameterGenerator instance is created). This object is used when you do not have an existing set of algorithm parameters, and want to generate one from scratch.</p><p>Creating an AlgorithmParameterGenerator Object</p><p>AlgorithmParameterGenerator objects are obtained by using one of the AlgorithmParameterGenerator getInstance() static factory methods.</p><p>Initializing an AlgorithmParameterGenerator Object</p><p>The AlgorithmParameterGenerator object can be initialized in two different ways: an algorithm-independent manner or an algorithm-specific manner.</p><p>The algorithm-independent approach uses the fact that all parameter generators share the concept of a &quot;size&quot; and a source of randomness. The measure of size is universally shared by all algorithm parameters, though it is interpreted differently for different algorithms. For example, in the case of parameters for the DSA algorithm, &quot;size&quot; corresponds to the size of the prime modulus, in bits. (See the Standard Names document for information about the sizes for specific algorithms.) When using this approach, algorithm-specific parameter generation values--if any--default to some standard values. One init method that takes these two universally shared types of arguments:</p><p>void init(int size, SecureRandom random);Another init method takes only a size argument and uses a system-provided source of randomness:</p><p>void init(int size)A third approach initializes a parameter generator object using algorithm-specific semantics, which are represented by a set of algorithm-specific parameter generation values supplied in an AlgorithmParameterSpec object:</p><p>void init(AlgorithmParameterSpec genParamSpec,SecureRandom random)</p><p>void init(AlgorithmParameterSpec genParamSpec)To generate Diffie-Hellman system parameters, for example, the parameter generation values usually consist of the size of the prime modulus and the size of the random exponent, both specified in number of bits.</p><p>Generating Algorithm Parameters</p><p>Once you have created and initialized an AlgorithmParameterGenerator object, you can use the generateParameters method to generate the algorithm parameters:</p><p>AlgorithmParameters generateParameters()The CertificateFactory ClassThe CertificateFactory class is an engine class that defines the functionality of a certificate factory, which is used to generate certificate and certificate revocation list (CRL) objects from their encodings.</p><p>A certificate factory for X.509 must return certificates that are an instance of java.security.cert.X509Certificate, and CRLs that are an instance of java.security.cert.X509CRL.</p><p>Creating a CertificateFactory Object</p><p>CertificateFactory objects are obtained by using one of the getInstance() static factory methods.</p><p>Generating Certificate Objects</p><p>To generate a certificate object and initialize it with the data read from an input stream, use the generateCertificate method:</p><p>final Certificate generateCertificate(InputStream inStream)To return a (possibly empty) collection view of the certificates read from a given input stream, use the generateCertificates method:</p><p>final Collection generateCertificates(InputStream inStream)Generating CRL Objects</p><p>To generate a certificate revocation list (CRL) object and initialize it with the data read from an input stream, use the generateCRL method:</p><p>final CRL generateCRL(InputStream inStream)To return a (possibly empty) collection view of the CRLs read from a given input stream, use the generateCRLs method:final Collection generateCRLs(InputStream inStream)Generating CertPath Objects</p><p>The certificate path builder and validator for PKIX is defined by the Internet X.509 Public Key Infrastructure Certificate and CRL Profile, RFC 3280.</p><p>A certificate store implementation for retrieving certificates and CRLs from Collection and LDAP directories, using the PKIX LDAP V2 Schema is also available from the IETF as RFC 2587.</p><p>To generate a CertPath object and initialize it with data read from an input stream, use one of the following generateCertPath methods (with or without specifying the encoding to be used for the data):</p><p>final CertPath generateCertPath(InputStream inStream)</p><p>final CertPath generateCertPath(InputStream inStream,String encoding)To generate a CertPath object and initialize it with a list of certificates, use the following method:</p><p>final CertPath generateCertPath(List certificates)To retrieve a list of the CertPath encodings supported by this certificate factory, you can call the getCertPathEncodings method:</p><p>final Iterator getCertPathEncodings()The default encoding will be listed first.How the JCA Might Be Used in a SSL/TLS ImplementationWith an understanding of the JCA classes, consider how these classes might be combined to implement an advanced network protocol like SSL/TLS. The SSL/TLS Overview section in the JSSE Reference Guide describes at a high level how the protocols work. As asymmetric (public key) cipher operations are much slower than symmetric operations (secret key), public key cryptography is used to establish secret keys which are then used to protect the actual application data. Vastly simplified, the SSL/TLS handshake involves exchanging initialization data, performing some public key operations to arrive at a secret key, and then using that key to encrypt further traffic.</p><p>NOTE: The details presented here simply show how some of the above classes might be employed. This section will not present sufficient information for building a SSL/TLS implementation. For more details, please see the JSSE Reference Guide and RFC 2246: The TLS Protocol.Assume that this SSL/TLS implementation will be made available as a JSSE provider. A concrete implementation of the Provider class is first written that will eventually be registered in the Security class&apos; list of providers. This provider mainly provides a mapping from algorithm names to actual implementation classes. (that is: &quot;SSLContext.TLS&quot;-&gt;&quot;com.foo.TLSImpl&quot;) When an application requests an &quot;TLS&quot; instance (via SSLContext.getInstance(&quot;TLS&quot;), the provider&apos;s list is consulted for the requested algorithm, and an appropriate instance is created.</p><p>Before discussing details of the actual handshake, a quick review of some of the JSSE&apos;s architecture is needed. The heart of the JSSE architecture is the SSLContext. The context eventually creates end objects (SSLSocket and SSLEngine) which actually implement the SSL/TLS protocol. SSLContexts are initialized with two callback classes, KeyManager and TrustManager, which allow applications to first select authentication material to send and second to verify credentials sent by a peer.</p><p>A JSSE KeyManager is responsible for choosing which credentials to present to a peer. Many algorithms are possible, but a common strategy is to maintain a RSA or DSA public/private key pair along with a X509Certificate in a KeyStore backed by a disk file. When a KeyStore object is initialized and loaded from the file, the file&apos;s raw bytes are converted into PublicKey and PrivateKey objects using a KeyFactory, and a certificate chain&apos;s bytes are converted using a CertificateFactory. When a credential is needed, the KeyManager simply consults this KeyStore object and determines which credentials to present.</p><p>A KeyStore&apos;s contents might have originally been created using a utility such as keytool. keytool creates a RSA or DSA KeyPairGenerator and initializes it with an appropriate keysize. This generator is then used to create a KeyPair which keytool would store along with the newly-created certificate in the KeyStore, which is eventually written to disk.</p><p>A JSSE TrustManager is responsible for verifying the credentials received from a peer. There are many ways to verify credentials: one of them is to create a CertPath object, and let the JDK&apos;s built-in Public Key Infrastructure (PKI) framework handle the validation. Internally, the CertPath implementation might create a Signature object, and use that to verify that the each of the signatures in the certificate chain.</p><p>With this basic understanding of the architecture, we can look at some of the steps in the SSL/TLS handshake. The client begins by sending a ClientHello message to the server. The server selects a ciphersuite to use, and sends that back in a ServerHello message, and begins creating JCA objects based on the suite selection. We&apos;ll use server-only authentication in the following examples.</p><p>SSL MessagesDescription of Figure SSL Messages</p><p>In the first example, the server tries to use a RSA-based ciphersuite such as TLS_RSA_WITH_AES_128_CBC_SHA. The server&apos;s KeyManager is queried, and returns an appropriate RSA entry. The server&apos;s credentials (that is: certificate/public key) are sent in the server&apos;s Certificate message. The client&apos;s TrustManager verifies the server&apos;s certificate, and if accepted, the client generates some random bytes using a SecureRandom object. This is then encrypted using an encrypting asymmetric RSA Cipher object that has been initialized with the PublicKey found in the server&apos;s certificate. This encrypted data is sent in a Client Key Exchange message. The server would use its corresponding PrivateKey to recover the bytes using a similar Cipher in decrypt mode. These bytes are then used to establish the actual encryption keys.</p><p>In a different example, an ephemeral Diffie-Hellman key agreement algorithm along with the DSA signature algorithm is chosen, such as TLS_DHE_DSS_WITH_AES_128_CBC_SHA. The two sides must each establish a new temporary DH public/private keypair using a KeyPairGenerator. Each generator creates DH keys which can then be further converted into pieces using the KeyFactory and DHPublicKeySpec classes. Each side then creates a KeyAgreement object and initializes it with their respective DH PrivateKeys. The server sends its public key pieces in a ServerKeyExchange message (protected by the DSA signature algorithm, and the client sends its public key in a ClientKeyExchange message. When the public keys are reassembled using another KeyFactory, they are fed into the agreement objects. The KeyAgreement objects then generate agreed-upon bytes that are then used to establish the actual encryption keys.</p><p>Once the actual encryption keys have been established, the secret key is used to initialize a symmetric Cipher object, and this cipher is used to protect all data in transit. To help determine if the data has been modified, a MessageDigest is created and receives a copy of the data destined for the network. When the packet is complete, the digest (hash) is appended to data, and the entire packet is encrypted by the Cipher. If a block cipher such as AES is used, the data must be padded to make a complete block. On the remote side, the steps are simply reversed.</p><p>Again, this is vastly simplified, but gives one an idea of how these classes might be combined to create a higher level protocol.</p><p>How to Make Applications &quot;Exempt&quot; from Cryptographic RestrictionsNote 1: This section should be ignored by most application developers. It is only for people whose applications may be exported to those few countries whose governments mandate cryptographic restrictions, if it is desired that such applications have fewer cryptographic restrictions than those mandated. Note 2: Throughout this section, the term &quot;application&quot; is meant to encompass both applications and applets.]The JCA framework includes an ability to enforce restrictions regarding the cryptographic algorithms and maximum cryptographic strengths available to applets/applications in different jurisdiction contexts (locations). Any such restrictions are specified in &quot;jurisdiction policy files&quot;.</p><p>Due to import control restrictions by the governments of a few countries, the jurisdiction policy files shipped with the Java SE Development Kit 6 specify that &quot;strong&quot; but limited cryptography may be used. An &quot;unlimited strength&quot; version of these files indicating no restrictions on cryptographic strengths is available for those living in eligible countries (which is most countries). But only the &quot;strong&quot; version can be imported into those countries whose governments mandate restrictions. The JCA framework will enforce the restrictions specified in the installed jurisdiction policy files.</p><p>It is possible that the governments of some or all such countries may allow certain applications to become exempt from some or all cryptographic restrictions. For example, they may consider certain types of applications as &quot;special&quot; and thus exempt. Or they may exempt any application that utilizes an &quot;exemption mechanism,&quot; such as key recovery. Applications deemed to be exempt could get access to stronger cryptography than that allowed for non-exempt applications in such countries.</p><p>In order for an application to be recognized as &quot;exempt&quot; at runtime, it must meet the following conditions:</p><p>It must have a permission policy file bundled with it in a JAR file. The permission policy file specifies what cryptography-related permissions the application has, and under what conditions (if any).The JAR file containing the application and the permission policy file must have been signed using a code-signing certificate issued after the application was accepted as exempt.Below are sample steps required in order to make an application exempt from some or all cryptographic restrictions. This is a basic outline that includes information about what is required by JCA in order to recognize and treat applications as being exempt. You will need to know the exemption requirements of the particular country or countries in which you would like your application to be able to be run but whose governments require cryptographic restrictions. You will also need to know the requirements of a JCA framework vendor that has a process in place for handling exempt applications. Consult such a vendor for further information. (NOTE: The SunJCE provider does not supply an implementation of the ExemptionMechanismSpi class.)</p><p>Step 1: Write and Compile Your Application CodeStep 2: Create a Permission Policy File Granting Appropriate Cryptographic PermissionsStep 3: Prepare for TestingStep 3a: Apply for Government Approval From the Government Mandating Restrictions.Step 3b: Get a Code-Signing CertificateStep 3c: Bundle the Application and Permission Policy File into a JAR fileStep 3d: Sign the JAR fileStep 3e: Set Up Your Environment Like That of a User in a Restricted CountryStep 3f: (only for applications using exemption mechanisms) Install a Provider Implementing the Exemption Mechanism Specified by the entry in the Permission Policy FileStep 4: Test Your ApplicationStep 5: Apply for U.S. Government Export Approval If RequiredStep 6: Deploy Your Application</p><p>Special Code Requirements for Applications that Use Exemption MechanismsWhen an application has a permission policy file associated with it (in the same JAR file) and that permission policy file specifies an exemption mechanism, then when the Cipher getInstance method is called to instantiate a Cipher, the JCA code searches the installed providers for one that implements the specified exemption mechanism. If it finds such a provider, JCA instantiates an ExemptionMechanism API object associated with the provider&apos;s implementation, and then associates the ExemptionMechanism object with the Cipher returned by getInstance.</p><p>After instantiating a Cipher, and prior to initializing it (via a call to the Cipher init method), your code must call the following Cipher method:</p><pre><code>public ExemptionMechanism getExemptionMechanism()</code></pre><p>This call returns the ExemptionMechanism object associated with the Cipher. You must then initialize the exemption mechanism implementation by calling the following method on the returned ExemptionMechanism:</p><pre><code>public final void init(Key key)</code></pre><p>The argument you supply should be the same as the argument of the same types that you will subsequently supply to a Cipher init method.</p><p>Once you have initialized the ExemptionMechanism, you can proceed as usual to initialize and use the Cipher.</p><p>Permission Policy FilesIn order for an application to be recognized at runtime as being &quot;exempt&quot; from some or all cryptographic restrictions, it must have a permission policy file bundled with it in a JAR file. The permission policy file specifies what cryptography-related permissions the application has, and under what conditions (if any).</p><p>NOTE: The permission policy file bundled with an application must be named cryptoPerms.The format of a permission entry in a permission policy file that accompanies an exempt application is the same as the format for a jurisdiction policy file downloaded with the JDK, which is:</p><pre><code>permission &lt;crypto permission class name&gt;[ &lt;alg_name&gt;    [[, &lt;exemption mechanism name&gt;][, &lt;maxKeySize&gt;    [, &lt;AlgorithmParameterSpec class name&gt;,    &lt;parameters for constructing an AlgorithmParameterSpec object&gt;    ]]]];</code></pre><p>See Appendix B for more information about the jurisdiction policy file format.</p><p>Permission Policy Files for Exempt Applications</p><p>Some applications may be allowed to be completely unrestricted. Thus, the permission policy file that accompanies such an application usually just needs to contain the following:</p><pre><code>grant {    // There are no restrictions to any algorithms.    permission javax.crypto.CryptoAllPermission;};</code></pre><p>If an application just uses a single algorithm (or several specific algorithms), then the permission policy file could simply mention that algorithm (or algorithms) explicitly, rather than granting CryptoAllPermission. For example, if an application just uses the Blowfish algorithm, the permission policy file doesn&apos;t have to grant CryptoAllPermission to all algorithms. It could just specify that there is no cryptographic restriction if the Blowfish algorithm is used. In order to do this, the permission policy file would look like the following:</p><pre><code>grant {    permission javax.crypto.CryptoPermission &quot;Blowfish&quot;;};</code></pre><p>Permission Policy Files for Applications Exempt Due to Exemption Mechanisms</p><p>If an application is considered &quot;exempt&quot; if an exemption mechanism is enforced, then the permission policy file that accompanies the application must specify one or more exemption mechanisms. At runtime, the application will be considered exempt if any of those exemption mechanisms is enforced. Each exemption mechanism must be specified in a permission entry that looks like the following:</p><pre><code>// No algorithm restrictions if specified// exemption mechanism is enforced.permission javax.crypto.CryptoPermission *,    &quot;&lt;ExemptionMechanismName&gt;&quot;;</code></pre><p>where &lt;ExemptionMechanismName&gt; specifies the name of an exemption mechanism. The list of possible exemption mechanism names includes:</p><p>KeyRecoveryKeyEscrowKeyWeakeningAs an example, suppose your application is exempt if either key recovery or key escrow is enforced. Then your permission policy file should contain the following:grant {// No algorithm restrictions if KeyRecovery is enforced.permission javax.crypto.CryptoPermission *,&quot;KeyRecovery&quot;;// No algorithm restrictions if KeyEscrow is enforced.permission javax.crypto.CryptoPermission *,&quot;KeyEscrow&quot;;};NOTE: Permission entries that specify exemption mechanisms should not also specify maximum key sizes. The allowed key sizes are actually determined from the installed exempt jurisdiction policy files, as described in the next section.</p><p>How Bundled Permission Policy Files Affect Cryptographic Permissions</p><p>At runtime, when an application instantiates a Cipher (via a call to its getInstance method) and that application has an associated permission policy file, JCA checks to see whether the permission policy file has an entry that applies to the algorithm specified in the getInstance call. If it does, and the entry grants CryptoAllPermission or does not specify that an exemption mechanism must be enforced, it means there is no cryptographic restriction for this particular algorithm.</p><p>If the permission policy file has an entry that applies to the algorithm specified in the getInstance call and the entry does specify that an exemption mechanism must be enforced, then the exempt jurisdiction policy file(s) are examined. If the exempt permissions include an entry for the relevant algorithm and exemption mechanism, and that entry is implied by the permissions in the permission policy file bundled with the application, and if there is an implementation of the specified exemption mechanism available from one of the registered providers, then the maximum key size and algorithm parameter values for the Cipher are determined from the exempt permission entry.</p><p>If there is no exempt permission entry implied by the relevant entry in the permission policy file bundled with the application, or if there is no implementation of the specified exemption mechanism available from any of the registered providers, then the application is only allowed the standard default cryptographic permissions.</p><p>Code ExamplesHere are some short examples which illustrate use of several of the JCA mechanisms. In addition, complete working examples can be found in Appendix D.</p><p>Computing a MessageDigest ObjectFirst create the message digest object, as in the following example:</p><p>MessageDigest sha = MessageDigest.getInstance(&quot;SHA-1&quot;);This call assigns a properly initialized message digest object to the sha variable. The implementation implements the Secure Hash Algorithm (SHA-1), as defined in the National Institute for Standards and Technology&apos;s (NIST) FIPS 180-2 document. See Appendix A for a complete discussion of standard names and algorithms.Next, suppose we have three byte arrays, i1, i2 and i3, which form the total input whose message digest we want to compute. This digest (or &quot;hash&quot;) could be calculated via the following calls:</p><p>sha.update(i1);sha.update(i2);sha.update(i3);byte[] hash = sha.digest();An equivalent alternative series of calls would be:</p><p>sha.update(i1);sha.update(i2);byte[] hash = sha.digest(i3);After the message digest has been calculated, the message digest object is automatically reset and ready to receive new data and calculate its digest. All former state (i.e., the data supplied to update calls) is lost.Some hash implementations may support intermediate hashes through cloning. Suppose we want to calculate separate hashes for:</p><p>i1i1 and i2i1, i2, and i3A way to do it is:</p><p>/* compute the hash for i1 */sha.update(i1);byte[] i1Hash = sha.clone().digest();</p><p>/* compute the hash for i1 and i2 */sha.update(i2);byte[] i12Hash = sha.clone().digest();</p><p>/* compute the hash for i1, i2 and i3 <em>/sha.update(i3);byte[] i123hash = sha.digest();This code works only if the SHA-1 implementation is cloneable. While some implementations of message digests are cloneable, others are not. To determine whether or not cloning is possible, attempt to clone the MessageDigest object and catch the potential exception as follows:try {// try and clone it/</em> compute the hash for i1 */sha.update(i1);byte[] i1Hash = sha.clone().digest();// ...byte[] i123hash = sha.digest();} catch (CloneNotSupportedException cnse) {// do something else, such as the code shown below}If a message digest is not cloneable, the other, less elegant way to compute intermediate digests is to create several digests. In this case, the number of intermediate digests to be computed must be known in advance:MessageDigest sha1 = MessageDigest.getInstance(&quot;SHA-1&quot;);MessageDigest sha12 = MessageDigest.getInstance(&quot;SHA-1&quot;);MessageDigest sha123 = MessageDigest.getInstance(&quot;SHA-1&quot;);</p><p>byte[] i1Hash = sha1.digest(i1);</p><p>sha12.update(i1);byte[] i12Hash = sha12.digest(i2);</p><p>sha123.update(i1);sha123.update(i2);byte[] i123Hash = sha123.digest(i3);Generating a Pair of KeysIn this example we will generate a public-private key pair for the algorithm named &quot;DSA&quot; (Digital Signature Algorithm), and use this keypair in future examples. We will generate keys with a 1024-bit modulus. We don&apos;t care which provider supplies the algorithm implementation.</p><p>Creating the Key Pair Generator</p><p>The first step is to get a key pair generator object for generating keys for the DSA algorithm:</p><p>KeyPairGenerator keyGen = KeyPairGenerator.getInstance(&quot;DSA&quot;);Initializing the Key Pair Generator</p><p>The next step is to initialize the key pair generator. In most cases, algorithm-independent initialization is sufficient, but in some cases, algorithm-specific initialization is used.</p><p>Algorithm-Independent InitializationAll key pair generators share the concepts of a keysize and a source of randomness. The KeyPairGenerator class initialization methods at a minimum needs a keysize. If the source of randomness is not explicitly provided, a SecureRandom implementation of the highest-priority installed provider will be used. Thus to generate keys with a keysize of 1024, simply call:</p><p>SecureRandom random = SecureRandom.getInstance(&quot;SHA1PRNG&quot;, &quot;SUN&quot;);keyGen.initialize(1024, random);The following code illustrates how to use a specific, additionally seeded SecureRandom object:SecureRandom random = SecureRandom.getInstance(&quot;SHA1PRNG&quot;, &quot;SUN&quot;);random.setSeed(userSeed);keyGen.initialize(1024, random);Since no other parameters are specified when you call the above algorithm-independent initialize method, it is up to the provider what to do about the algorithm-specific parameters (if any) to be associated with each of the keys. The provider may use precomputed parameter values or may generate new values.Algorithm-Specific InitializationFor situations where a set of algorithm-specific parameters already exists (such as &quot;community parameters&quot; in DSA), there are two initialize methods that have an AlgorithmParameterSpec argument. Suppose your key pair generator is for the &quot;DSA&quot; algorithm, and you have a set of DSA-specific parameters, p, q, and g, that you would like to use to generate your key pair. You could execute the following code to initialize your key pair generator (recall that DSAParameterSpec is an AlgorithmParameterSpec):</p><p>DSAParameterSpec dsaSpec = new DSAParameterSpec(p, q, g);SecureRandom random = SecureRandom.getInstance(&quot;SHA1PRNG&quot;, &quot;SUN&quot;);random.setSeed(userSeed);keyGen.initialize(dsaSpec, random);NOTE: The parameter named p is a prime number whose length is the modulus length (&quot;size&quot;). Therefore, you don&apos;t need to call any other method to specify the modulus length.Generating the Pair of Keys</p><p>The final step is actually generating the key pair. No matter which type of initialization was used (algorithm-independent or algorithm-specific), the same code is used to generate the key pair:</p><p>KeyPair pair = keyGen.generateKeyPair();Generating and Verifying a Signature Using Generated Keys</p><p>The following signature generation and verification examples use the KeyPair generated in the key pair example above.</p><p>Generating a SignatureWe first create a signature object:</p><p>Signature dsa = Signature.getInstance(&quot;SHA1withDSA&quot;);Next, using the key pair generated in the key pair example, we initialize the object with the private key, then sign a byte array called data.</p><p>/* Initializing the object with a private key */PrivateKey priv = pair.getPrivate();dsa.initSign(priv);</p><p>/* Update and sign the data */dsa.update(data);byte[] sig = dsa.sign();Verifying a SignatureVerifying the signature is straightforward. (Note that here we also use the key pair generated in the key pair example.)</p><p>/* Initializing the object with the public key */PublicKey pub = pair.getPublic();dsa.initVerify(pub);</p><p>/* Update and verify the data */dsa.update(data);boolean verifies = dsa.verify(sig);System.out.println(&quot;signature verifies: &quot; + verifies);Generating/Verifying Signatures Using Key Specifications and KeyFactory</p><p>Suppose that, rather than having a public/private key pair (as, for example, was generated in the key pair example above), you simply have the components of your DSA private key: x (the private key), p (the prime), q (the sub-prime), and g (the base).</p><p>Further suppose you want to use your private key to digitally sign some data, which is in a byte array named someData. You would do the following steps, which also illustrate creating a key specification and using a key factory to obtain a PrivateKey from the key specification (initSign requires a PrivateKey):</p><p>DSAPrivateKeySpec dsaPrivKeySpec = new DSAPrivateKeySpec(x, p, q, g);</p><p>KeyFactory keyFactory = KeyFactory.getInstance(&quot;DSA&quot;);PrivateKey privKey = keyFactory.generatePrivate(dsaPrivKeySpec);</p><p>Signature sig = Signature.getInstance(&quot;SHA1withDSA&quot;);sig.initSign(privKey);sig.update(someData);byte[] signature = sig.sign();Suppose Alice wants to use the data you signed. In order for her to do so, and to verify your signature, you need to send her three things:</p><p>the data,the signature, andthe public key corresponding to the private key you used to sign the data.You can store the someData bytes in one file, and the signature bytes in another, and send those to Alice.</p><p>For the public key, assume, as in the signing example above, you have the components of the DSA public key corresponding to the DSA private key used to sign the data. Then you can create a DSAPublicKeySpec from those components:</p><p>DSAPublicKeySpec dsaPubKeySpec = new DSAPublicKeySpec(y, p, q, g);You still need to extract the key bytes so that you can put them in a file. To do so, you can first call the generatePublic method on the DSA key factory already created in the example above:</p><p>PublicKey pubKey = keyFactory.generatePublic(dsaPubKeySpec);Then you can extract the (encoded) key bytes via the following:byte[] encKey = pubKey.getEncoded();You can now store these bytes in a file, and send it to Alice along with the files containing the data and the signature.</p><p>Now, assume Alice has received these files, and she copied the data bytes from the data file to a byte array named data, the signature bytes from the signature file to a byte array named signature, and the encoded public key bytes from the public key file to a byte array named encodedPubKey.</p><p>Alice can now execute the following code to verify the signature. The code also illustrates how to use a key factory in order to instantiate a DSA public key from its encoding (initVerify requires a PublicKey).</p><pre><code>X509EncodedKeySpec pubKeySpec = new X509EncodedKeySpec(encodedPubKey);KeyFactory keyFactory = KeyFactory.getInstance(&quot;DSA&quot;);PublicKey pubKey = keyFactory.generatePublic(pubKeySpec);Signature sig = Signature.getInstance(&quot;SHA1withDSA&quot;);sig.initVerify(pubKey);sig.update(data);sig.verify(signature);</code></pre><p>NOTE: In the above, Alice needed to generate a PublicKey from the encoded key bits, since initVerify requires a PublicKey. Once she has a PublicKey, she could also use the KeyFactory getKeySpec method to convert it to a DSAPublicKeySpec so that she can access the components, if desired, as in:DSAPublicKeySpec dsaPubKeySpec =(DSAPublicKeySpec)keyFactory.getKeySpec(pubKey,DSAPublicKeySpec.class)Now she can access the DSA public key components y, p, q, and g through the corresponding &quot;get&quot; methods on the DSAPublicKeySpec class (getY, getP, getQ, and getG).</p><p>Determining If Two Keys Are Equal</p><p>In many cases you would like to know if two keys are equal; however, the default method java.lang.Object.equals may not give the desired result. The most provider-independent approach is to compare the encoded keys. If this comparison isn&apos;t appropriate (for example, when comparing an RSAPrivateKey and an RSAPrivateCrtKey), you should compare each component. The following code demonstrates this idea:</p><p>static boolean keysEqual(Key key1, Key key2) {if (key1.equals(key2)) {return true;}</p><pre><code>if (Arrays.equals(key1.getEncoded(), key2.getEncoded())) {    return true;}// More code for different types of keys here.// For example, the following code can check if// an RSAPrivateKey and an RSAPrivateCrtKey are equal:// if ((key1 instanceof RSAPrivateKey) &amp;&amp;//     (key2 instanceof RSAPrivateKey)) {//     if ((key1.getModulus().equals(key2.getModulus())) &amp;&amp;//         (key1.getPrivateExponent().equals(//                                      key2.getPrivateExponent()))) {//         return true;//     }// }return false;</code></pre><p>}Reading Base64-Encoded Certificates</p><p>The following example reads a file with Base64-encoded certificates, which are each bounded at the beginning by</p><p>-----BEGIN CERTIFICATE-----and at the end by-----END CERTIFICATE-----We convert the FileInputStream (which does not support mark and reset) to a ByteArrayInputStream (which supports those methods), so that each call to generateCertificate consumes only one certificate, and the read position of the input stream is positioned to the next certificate in the file:FileInputStream fis = new FileInputStream(filename);BufferedInputStream bis = new BufferedInputStream(fis);</p><p>CertificateFactory cf = CertificateFactory.getInstance(&quot;X.509&quot;);</p><p>while (bis.available() &gt; 0) {Certificate cert = cf.generateCertificate(bis);System.out.println(cert.toString());}Parsing a Certificate Reply</p><p>The following example parses a PKCS7-formatted certificate reply stored in a file and extracts all the certificates from it:</p><p>FileInputStream fis = new FileInputStream(filename);CertificateFactory cf = CertificateFactory.getInstance(&quot;X.509&quot;);Collection c = cf.generateCertificates(fis);Iterator i = c.iterator();while (i.hasNext()) {Certificate cert = (Certificate)i.next();System.out.println(cert);}Using Encryption</p><p>This section takes the user through the process of generating a key, creating and initializing a cipher object, encrypting a file, and then decrypting it. Throughout this example, we use the Advanced Encryption Standard (AES).</p><p>Generating a KeyTo create an AES key, we have to instantiate a KeyGenerator for AES. We do not specify a provider, because we do not care about a particular AES key generation implementation. Since we do not initialize the KeyGenerator, a system-provided source of randomness and a default keysize will be used to create the AES key:</p><pre><code>KeyGenerator keygen = KeyGenerator.getInstance(&quot;AES&quot;);SecretKey aesKey = keygen.generateKey();</code></pre><p>After the key has been generated, the same KeyGenerator object can be re-used to create further keys.</p><p>Creating a CipherThe next step is to create a Cipher instance. To do this, we use one of the getInstance factory methods of the Cipher class. We must specify the name of the requested transformation, which includes the following components, separated by slashes (/):</p><p>the algorithm namethe mode (optional)the padding scheme (optional)In this example, we create an AES cipher in Electronic Codebook mode, with PKCS5-style padding. We do not specify a provider, because we do not care about a particular implementation of the requested transformation.</p><p>The standard algorithm name for AES is &quot;AES&quot;, the standard name for the Electronic Codebook mode is &quot;ECB&quot;, and the standard name for PKCS5-style padding is &quot;PKCS5Padding&quot;:</p><pre><code>Cipher aesCipher;// Create the cipheraesCipher = Cipher.getInstance(&quot;AES/ECB/PKCS5Padding&quot;);</code></pre><p>We use the generated aesKey from above to initialize the Cipher object for encryption:</p><pre><code>// Initialize the cipher for encryptionaesCipher.init(Cipher.ENCRYPT_MODE, aesKey);// Our cleartextbyte[] cleartext = &quot;This is just an example&quot;.getBytes();// Encrypt the cleartextbyte[] ciphertext = aesCipher.doFinal(cleartext);// Initialize the same cipher for decryptionaesCipher.init(Cipher.DECRYPT_MODE, aesKey);// Decrypt the ciphertextbyte[] cleartext1 = aesCipher.doFinal(ciphertext);</code></pre><p>cleartext and cleartext1 are identical.</p><p>Using Password-Based Encryption</p><p>In this example, we prompt the user for a password from which we derive an encryption key.</p><p>It would seem logical to collect and store the password in an object of type java.lang.String. However, here&apos;s the caveat: Objects of type String are immutable, i.e., there are no methods defined that allow you to change (overwrite) or zero out the contents of a String after usage. This feature makes String objects unsuitable for storing security sensitive information such as user passwords. You should always collect and store security sensitive information in a char array instead.</p><p>For that reason, the javax.crypto.spec.PBEKeySpec class takes (and returns) a password as a char array. See the ReadPassword class in the sample code in Appendix D for one possible way of reading character array passwords from an input stream.</p><p>In order to use Password-Based Encryption (PBE) as defined in PKCS5, we have to specify a salt and an iteration count. The same salt and iteration count that are used for encryption must be used for decryption. Newer PBE algorithms use an iteration count of atleast 1000.<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">PBEKeySpec pbeKeySpec;</span><br><span class="line">PBEParameterSpec pbeParamSpec;</span><br><span class="line">SecretKeyFactory keyFac;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Salt</span></span><br><span class="line"><span class="keyword">byte</span>[] salt = {</span><br><span class="line">    (<span class="keyword">byte</span>)<span class="number">0xc7</span>, (<span class="keyword">byte</span>)<span class="number">0x73</span>, (<span class="keyword">byte</span>)<span class="number">0x21</span>, (<span class="keyword">byte</span>)<span class="number">0x8c</span>,</span><br><span class="line">    (<span class="keyword">byte</span>)<span class="number">0x7e</span>, (<span class="keyword">byte</span>)<span class="number">0xc8</span>, (<span class="keyword">byte</span>)<span class="number">0xee</span>, (<span class="keyword">byte</span>)<span class="number">0x99</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// Iteration count</span></span><br><span class="line"><span class="keyword">int</span> count = <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create PBE parameter set</span></span><br><span class="line">pbeParamSpec = <span class="keyword">new</span> PBEParameterSpec(salt, count);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Prompt user for encryption password.</span></span><br><span class="line"><span class="comment">// Collect user password as char array (using the</span></span><br><span class="line"><span class="comment">// &quot;readPassword&quot; method from above), and convert</span></span><br><span class="line"><span class="comment">// it into a SecretKey object, using a PBE key</span></span><br><span class="line"><span class="comment">// factory.</span></span><br><span class="line">System.out.print(<span class="string">&quot;Enter encryption password:  &quot;</span>);</span><br><span class="line">System.out.flush();</span><br><span class="line">pbeKeySpec = <span class="keyword">new</span> PBEKeySpec(readPassword(System.in));</span><br><span class="line">keyFac = SecretKeyFactory.getInstance(<span class="string">&quot;PBEWithHmacSHA256AndAES_256&quot;</span>);</span><br><span class="line">SecretKey pbeKey = keyFac.generateSecret(pbeKeySpec);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create PBE Cipher</span></span><br><span class="line">Cipher pbeCipher = Cipher.getInstance(<span class="string">&quot;PBEWithHmacSHA256AndAES_256&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Initialize PBE Cipher with key and parameters</span></span><br><span class="line">pbeCipher.init(Cipher.ENCRYPT_MODE, pbeKey, pbeParamSpec);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Our cleartext</span></span><br><span class="line"><span class="keyword">byte</span>[] cleartext = <span class="string">&quot;This is another example&quot;</span>.getBytes();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Encrypt the cleartext</span></span><br><span class="line"><span class="keyword">byte</span>[] ciphertext = pbeCipher.doFinal(cleartext);</span><br></pre></td></tr></table></figure></p><p>Using Key Agreement</p><p>Please refer to Appendix D for sample programs exercising the Diffie-Hellman key exchange between 2 and 3 parties.</p><p>Appendix A: Standard NamesThe JDK Security API requires and uses a set of standard names for algorithms, certificate and keystore types. The specification names previously found here in Appendix A and in the other security specifications (JSSE/CertPath/etc.) have been combined in the Standard Names document. This document also contains more information about the algorithm specifications. Specific provider information can be found in the Sun Provider Documentation.</p><p>Cryptographic implementations in the JDK are distributed through several different providers primarily for historical reasons (Sun, SunJSSE, SunJCE, SunRsaSign). Note these providers may not be available on all JDK implementations, and therefore, truly portable applications should call getInstance() without specifying specific providers. Applications specifying a particular provider may not be able to take advantage of native providers tuned for an underlying operating environment (such as PKCS or Microsoft&apos;s CAPI).</p><p>The SunPKCS11 provider itself does not contain any cryptographic algorithms, but instead, directs requests into an underlying PKCS11 implementation. The PKCS11 Reference Guide and the underlying PKCS11 implementation should be consulted to determine if a desired algorithm will be available through the PKCS11 provider. Likewise, on Windows systems, the SunMSCAPI provider does not provide any cryptographic functionality, but instead routes requests to the underlying Operating System for handling.</p><p>Appendix B: Jurisdiction Policy File FormatJCA represents its jurisdiction policy files as Java style policy files with corresponding permission statements. As described in Default Policy Implementation and Policy File Syntax, a Java policy file specifies what permissions are allowed for code from specified code sources. A permission represents access to a system resource. In the case of JCA, the &quot;resources&quot; are cryptography algorithms, and code sources do not need to be specified, because the cryptographic restrictions apply to all code.</p><p>A jurisdiction policy file consists of a very basic &quot;grant entry&quot; containing one or more &quot;permission entries.&quot;</p><p>grant {&lt;permission entries&gt;;};</p><p>The format of a permission entry in a jurisdiction policy file is:</p><p>permission &lt;crypto permission class name&gt;[ &lt;alg_name&gt;[[, &lt;exemption mechanism name&gt;][, &lt;maxKeySize&gt;[, &lt;AlgorithmParameterSpec class name&gt;,&lt;parameters for constructing anAlgorithmParameterSpec object&gt;]]]];A sample jurisdiction policy file that includes restricting the &quot;Blowfish&quot; algorithm to maximum key sizes of 64 bits is:</p><pre><code>grant {    permission javax.crypto.CryptoPermission &quot;Blowfish&quot;, 64;    // ...};</code></pre><p>A permission entry must begin with the word permission. The &lt;crypto permission class name&gt; in the template above would actually be a specific permission class name, such as javax.crypto.CryptoPermission. A crypto permission class reflects the ability of an application/applet to use certain algorithms with certain key sizes in certain environments. There are two crypto permission classes: CryptoPermission and CryptoAllPermission. The special CryptoAllPermission class implies all cryptography-related permissions, that is, it specifies that there are no cryptography-related restrictions.</p><p>The &lt;alg_name&gt;, when utilized, is a quoted string specifying the standard name (see Appendix A) of a cryptography algorithm, such as &quot;DES&quot; or &quot;RSA&quot;.</p><p>The &lt;exemption mechanism name&gt;, when specified, is a quoted string indicating an exemption mechanism which, if enforced, enables a reduction in cryptographic restrictions. Exemption mechanism names that can be used include &quot;KeyRecovery&quot; &quot;KeyEscrow&quot;, and &quot;KeyWeakening&quot;.</p><p>&lt;maxKeySize&gt; is an integer specifying the maximum key size (in bits) allowed for the specified algorithm.</p><p>For some algorithms it may not be sufficient to specify the algorithm strength in terms of just a key size. For example, in the case of the &quot;RC5&quot; algorithm, the number of rounds must also be considered. For algorithms whose strength needs to be expressed as more than a key size, the permission entry should also specify an AlgorithmParameterSpec class name (such as javax.crypto.spec.RC5ParameterSpec) and a list of parameters for constructing the specified AlgorithmParameterSpec object.</p><p>Items that appear in a permission entry must appear in the specified order. An entry is terminated with a semicolon.</p><p>Case is unimportant for the identifiers (grant, permission) but is significant for the &lt;crypto permission class name&gt; or for any string that is passed in as a value.</p><p>NOTE: An &quot;<em>&quot; can be used as a wildcard for any permission entry option. For example, an &quot;</em>&quot; (without the quotes) for an &lt;alg_name&gt; option means &quot;all algorithms.&quot;</p><p>Appendix C: Maximum Key Sizes Allowed by &quot;Strong&quot; Jurisdiction Policy FilesDue to import control restrictions, the jurisdiction policy files shipped with the Java SE Development Kit allow &quot;strong&quot; but limited cryptography to be used. For more info, please see Import Limits on Cryptographic Algorithms.</p><p>Appendix D: Sample ProgramsDiffie-Hellman Key Exchange between 2 Parties</p><p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Copyright (c) 1997, 2001, Oracle and/or its affiliates. All rights reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Redistribution and use in source and binary forms, with or without</span></span><br><span class="line"><span class="comment"> * modification, are permitted provided that the following conditions</span></span><br><span class="line"><span class="comment"> * are met:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   - Redistributions of source code must retain the above copyright</span></span><br><span class="line"><span class="comment"> *     notice, this list of conditions and the following disclaimer.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   - Redistributions in binary form must reproduce the above copyright</span></span><br><span class="line"><span class="comment"> *     notice, this list of conditions and the following disclaimer in the</span></span><br><span class="line"><span class="comment"> *     documentation and/or other materials provided with the distribution.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   - Neither the name of Oracle nor the names of its</span></span><br><span class="line"><span class="comment"> *     contributors may be used to endorse or promote products derived</span></span><br><span class="line"><span class="comment"> *     from this software without specific prior written permission.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS</span></span><br><span class="line"><span class="comment"> * IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,</span></span><br><span class="line"><span class="comment"> * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR</span></span><br><span class="line"><span class="comment"> * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR</span></span><br><span class="line"><span class="comment"> * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span></span><br><span class="line"><span class="comment"> * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span></span><br><span class="line"><span class="comment"> * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span></span><br><span class="line"><span class="comment"> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span></span><br><span class="line"><span class="comment"> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span></span><br><span class="line"><span class="comment"> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span></span><br><span class="line"><span class="comment"> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.math.BigInteger;</span><br><span class="line"><span class="keyword">import</span> java.security.*;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.*;</span><br><span class="line"><span class="keyword">import</span> java.security.interfaces.*;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.*;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.*;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.interfaces.*;</span><br><span class="line"><span class="keyword">import</span> com.sun.crypto.provider.SunJCE;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This program executes the Diffie-Hellman key agreement protocol</span></span><br><span class="line"><span class="comment"> * between 2 parties: Alice and Bob.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * By default, preconfigured parameters (1024-bit prime modulus and base</span></span><br><span class="line"><span class="comment"> * generator used by SKIP) are used.</span></span><br><span class="line"><span class="comment"> * If this program is called with the &quot;-gen&quot; option, a new set of</span></span><br><span class="line"><span class="comment"> * parameters is created.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DHKeyAgreement2</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">DHKeyAgreement2</span><span class="params">()</span> </span>{}</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String argv[])</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            String mode = <span class="string">&quot;USE_SKIP_DH_PARAMS&quot;</span>;</span><br><span class="line"></span><br><span class="line">            DHKeyAgreement2 keyAgree = <span class="keyword">new</span> DHKeyAgreement2();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (argv.length &gt; <span class="number">1</span>) {</span><br><span class="line">                keyAgree.usage();</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;Wrong number of command options&quot;</span>);</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (argv.length == <span class="number">1</span>) {</span><br><span class="line">                <span class="keyword">if</span> (!(argv[<span class="number">0</span>].equals(<span class="string">&quot;-gen&quot;</span>))) {</span><br><span class="line">                    keyAgree.usage();</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;Unrecognized flag: &quot;</span> + argv[<span class="number">0</span>]);</span><br><span class="line">                }</span><br><span class="line">                mode = <span class="string">&quot;GENERATE_DH_PARAMS&quot;</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            keyAgree.run(mode);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            System.err.println(<span class="string">&quot;Error: &quot;</span> + e);</span><br><span class="line">            System.exit(<span class="number">1</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String mode)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line"></span><br><span class="line">        DHParameterSpec dhSkipParamSpec;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mode.equals(<span class="string">&quot;GENERATE_DH_PARAMS&quot;</span>)) {</span><br><span class="line">            <span class="comment">// Some central authority creates new DH parameters</span></span><br><span class="line">            System.out.println</span><br><span class="line">                (<span class="string">&quot;Creating Diffie-Hellman parameters (takes VERY long) ...&quot;</span>);</span><br><span class="line">            AlgorithmParameterGenerator paramGen</span><br><span class="line">                = AlgorithmParameterGenerator.getInstance(<span class="string">&quot;DH&quot;</span>);</span><br><span class="line">            paramGen.init(<span class="number">512</span>);</span><br><span class="line">            AlgorithmParameters params = paramGen.generateParameters();</span><br><span class="line">            dhSkipParamSpec = (DHParameterSpec)params.getParameterSpec</span><br><span class="line">                (DHParameterSpec.class);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="comment">// use some pre-generated, default DH parameters</span></span><br><span class="line">            System.out.println(<span class="string">&quot;Using SKIP Diffie-Hellman parameters&quot;</span>);</span><br><span class="line">            dhSkipParamSpec = <span class="keyword">new</span> DHParameterSpec(skip1024Modulus,</span><br><span class="line">                                                  skip1024Base);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Alice creates her own DH key pair, using the DH parameters from</span></span><br><span class="line"><span class="comment">         * above</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ALICE: Generate DH keypair ...&quot;</span>);</span><br><span class="line">        KeyPairGenerator aliceKpairGen = KeyPairGenerator.getInstance(<span class="string">&quot;DH&quot;</span>);</span><br><span class="line">        aliceKpairGen.initialize(dhSkipParamSpec);</span><br><span class="line">        KeyPair aliceKpair = aliceKpairGen.generateKeyPair();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Alice creates and initializes her DH KeyAgreement object</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ALICE: Initialization ...&quot;</span>);</span><br><span class="line">        KeyAgreement aliceKeyAgree = KeyAgreement.getInstance(<span class="string">&quot;DH&quot;</span>);</span><br><span class="line">        aliceKeyAgree.init(aliceKpair.getPrivate());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Alice encodes her public key, and sends it over to Bob.</span></span><br><span class="line">        <span class="keyword">byte</span>[] alicePubKeyEnc = aliceKpair.getPublic().getEncoded();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Let&apos;s turn over to Bob. Bob has received Alice&apos;s public key</span></span><br><span class="line"><span class="comment">         * in encoded format.</span></span><br><span class="line"><span class="comment">         * He instantiates a DH public key from the encoded key material.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        KeyFactory bobKeyFac = KeyFactory.getInstance(<span class="string">&quot;DH&quot;</span>);</span><br><span class="line">        X509EncodedKeySpec x509KeySpec = <span class="keyword">new</span> X509EncodedKeySpec</span><br><span class="line">            (alicePubKeyEnc);</span><br><span class="line">        PublicKey alicePubKey = bobKeyFac.generatePublic(x509KeySpec);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Bob gets the DH parameters associated with Alice&apos;s public key.</span></span><br><span class="line"><span class="comment">         * He must use the same parameters when he generates his own key</span></span><br><span class="line"><span class="comment">         * pair.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        DHParameterSpec dhParamSpec = ((DHPublicKey)alicePubKey).getParams();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Bob creates his own DH key pair</span></span><br><span class="line">        System.out.println(<span class="string">&quot;BOB: Generate DH keypair ...&quot;</span>);</span><br><span class="line">        KeyPairGenerator bobKpairGen = KeyPairGenerator.getInstance(<span class="string">&quot;DH&quot;</span>);</span><br><span class="line">        bobKpairGen.initialize(dhParamSpec);</span><br><span class="line">        KeyPair bobKpair = bobKpairGen.generateKeyPair();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Bob creates and initializes his DH KeyAgreement object</span></span><br><span class="line">        System.out.println(<span class="string">&quot;BOB: Initialization ...&quot;</span>);</span><br><span class="line">        KeyAgreement bobKeyAgree = KeyAgreement.getInstance(<span class="string">&quot;DH&quot;</span>);</span><br><span class="line">        bobKeyAgree.init(bobKpair.getPrivate());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Bob encodes his public key, and sends it over to Alice.</span></span><br><span class="line">        <span class="keyword">byte</span>[] bobPubKeyEnc = bobKpair.getPublic().getEncoded();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Alice uses Bob&apos;s public key for the first (and only) phase</span></span><br><span class="line"><span class="comment">         * of her version of the DH</span></span><br><span class="line"><span class="comment">         * protocol.</span></span><br><span class="line"><span class="comment">         * Before she can do so, she has to instantiate a DH public key</span></span><br><span class="line"><span class="comment">         * from Bob&apos;s encoded key material.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        KeyFactory aliceKeyFac = KeyFactory.getInstance(<span class="string">&quot;DH&quot;</span>);</span><br><span class="line">        x509KeySpec = <span class="keyword">new</span> X509EncodedKeySpec(bobPubKeyEnc);</span><br><span class="line">        PublicKey bobPubKey = aliceKeyFac.generatePublic(x509KeySpec);</span><br><span class="line">        System.out.println(<span class="string">&quot;ALICE: Execute PHASE1 ...&quot;</span>);</span><br><span class="line">        aliceKeyAgree.doPhase(bobPubKey, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Bob uses Alice&apos;s public key for the first (and only) phase</span></span><br><span class="line"><span class="comment">         * of his version of the DH</span></span><br><span class="line"><span class="comment">         * protocol.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        System.out.println(<span class="string">&quot;BOB: Execute PHASE1 ...&quot;</span>);</span><br><span class="line">        bobKeyAgree.doPhase(alicePubKey, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * At this stage, both Alice and Bob have completed the DH key</span></span><br><span class="line"><span class="comment">         * agreement protocol.</span></span><br><span class="line"><span class="comment">         * Both generate the (same) shared secret.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">byte</span>[] aliceSharedSecret = aliceKeyAgree.generateSecret();</span><br><span class="line">        <span class="keyword">int</span> aliceLen = aliceSharedSecret.length;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] bobSharedSecret = <span class="keyword">new</span> <span class="keyword">byte</span>[aliceLen];</span><br><span class="line">        <span class="keyword">int</span> bobLen;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// show example of what happens if you</span></span><br><span class="line">            <span class="comment">// provide an output buffer that is too short</span></span><br><span class="line">            bobLen = bobKeyAgree.generateSecret(bobSharedSecret, <span class="number">1</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (ShortBufferException e) {</span><br><span class="line">            System.out.println(e.getMessage());</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// provide output buffer of required size</span></span><br><span class="line">        bobLen = bobKeyAgree.generateSecret(bobSharedSecret, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;Alice secret: &quot;</span> +</span><br><span class="line">          toHexString(aliceSharedSecret));</span><br><span class="line">        System.out.println(<span class="string">&quot;Bob secret: &quot;</span> +</span><br><span class="line">          toHexString(bobSharedSecret));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!java.util.Arrays.equals(aliceSharedSecret, bobSharedSecret))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;Shared secrets differ&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Shared secrets are the same&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Now let&apos;s return the shared secret as a SecretKey object</span></span><br><span class="line"><span class="comment">         * and use it for encryption. First, we generate SecretKeys for the</span></span><br><span class="line"><span class="comment">         * &quot;DES&quot; algorithm (based on the raw shared secret data) and</span></span><br><span class="line"><span class="comment">         * then we use DES in ECB mode</span></span><br><span class="line"><span class="comment">         * as the encryption algorithm. DES in ECB mode does not require any</span></span><br><span class="line"><span class="comment">         * parameters.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * Then we use DES in CBC mode, which requires an initialization</span></span><br><span class="line"><span class="comment">         * vector (IV) parameter. In CBC mode, you need to initialize the</span></span><br><span class="line"><span class="comment">         * Cipher object with an IV, which can be supplied using the</span></span><br><span class="line"><span class="comment">         * javax.crypto.spec.IvParameterSpec class. Note that you have to use</span></span><br><span class="line"><span class="comment">         * the same IV for encryption and decryption: If you use a different</span></span><br><span class="line"><span class="comment">         * IV for decryption than you used for encryption, decryption will</span></span><br><span class="line"><span class="comment">         * fail.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">NOTE:</span> If you do not specify an IV when you initialize the</span></span><br><span class="line"><span class="comment">         * Cipher object for encryption, the underlying implementation</span></span><br><span class="line"><span class="comment">         * will generate a random one, which you have to retrieve using the</span></span><br><span class="line"><span class="comment">         * javax.crypto.Cipher.getParameters() method, which returns an</span></span><br><span class="line"><span class="comment">         * instance of java.security.AlgorithmParameters. You need to transfer</span></span><br><span class="line"><span class="comment">         * the contents of that object (e.g., in encoded format, obtained via</span></span><br><span class="line"><span class="comment">         * the AlgorithmParameters.getEncoded() method) to the party who will</span></span><br><span class="line"><span class="comment">         * do the decryption. When initializing the Cipher for decryption,</span></span><br><span class="line"><span class="comment">         * the (reinstantiated) AlgorithmParameters object must be passed to</span></span><br><span class="line"><span class="comment">         * the Cipher.init() method.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Return shared secret as SecretKey object ...&quot;</span>);</span><br><span class="line">        <span class="comment">// Bob</span></span><br><span class="line">        <span class="comment">// <span class="doctag">NOTE:</span> The call to bobKeyAgree.generateSecret above reset the key</span></span><br><span class="line">        <span class="comment">// agreement object, so we call doPhase again prior to another</span></span><br><span class="line">        <span class="comment">// generateSecret call</span></span><br><span class="line">        bobKeyAgree.doPhase(alicePubKey, <span class="keyword">true</span>);</span><br><span class="line">        SecretKey bobDesKey = bobKeyAgree.generateSecret(<span class="string">&quot;DES&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Alice</span></span><br><span class="line">        <span class="comment">// <span class="doctag">NOTE:</span> The call to aliceKeyAgree.generateSecret above reset the key</span></span><br><span class="line">        <span class="comment">// agreement object, so we call doPhase again prior to another</span></span><br><span class="line">        <span class="comment">// generateSecret call</span></span><br><span class="line">        aliceKeyAgree.doPhase(bobPubKey, <span class="keyword">true</span>);</span><br><span class="line">        SecretKey aliceDesKey = aliceKeyAgree.generateSecret(<span class="string">&quot;DES&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Bob encrypts, using DES in ECB mode</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Cipher bobCipher = Cipher.getInstance(<span class="string">&quot;DES/ECB/PKCS5Padding&quot;</span>);</span><br><span class="line">        bobCipher.init(Cipher.ENCRYPT_MODE, bobDesKey);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] cleartext = <span class="string">&quot;This is just an example&quot;</span>.getBytes();</span><br><span class="line">        <span class="keyword">byte</span>[] ciphertext = bobCipher.doFinal(cleartext);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Alice decrypts, using DES in ECB mode</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Cipher aliceCipher = Cipher.getInstance(<span class="string">&quot;DES/ECB/PKCS5Padding&quot;</span>);</span><br><span class="line">        aliceCipher.init(Cipher.DECRYPT_MODE, aliceDesKey);</span><br><span class="line">        <span class="keyword">byte</span>[] recovered = aliceCipher.doFinal(ciphertext);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!java.util.Arrays.equals(cleartext, recovered))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;DES in CBC mode recovered text is &quot;</span> +</span><br><span class="line">              <span class="string">&quot;different from cleartext&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;DES in ECB mode recovered text is &quot;</span> +</span><br><span class="line">            <span class="string">&quot;same as cleartext&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Bob encrypts, using DES in CBC mode</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        bobCipher = Cipher.getInstance(<span class="string">&quot;DES/CBC/PKCS5Padding&quot;</span>);</span><br><span class="line">        bobCipher.init(Cipher.ENCRYPT_MODE, bobDesKey);</span><br><span class="line"></span><br><span class="line">        cleartext = <span class="string">&quot;This is just an example&quot;</span>.getBytes();</span><br><span class="line">        ciphertext = bobCipher.doFinal(cleartext);</span><br><span class="line">        <span class="comment">// Retrieve the parameter that was used, and transfer it to Alice in</span></span><br><span class="line">        <span class="comment">// encoded format</span></span><br><span class="line">        <span class="keyword">byte</span>[] encodedParams = bobCipher.getParameters().getEncoded();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Alice decrypts, using DES in CBC mode</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">// Instantiate AlgorithmParameters object from parameter encoding</span></span><br><span class="line">        <span class="comment">// obtained from Bob</span></span><br><span class="line">        AlgorithmParameters params = AlgorithmParameters.getInstance(<span class="string">&quot;DES&quot;</span>);</span><br><span class="line">        params.init(encodedParams);</span><br><span class="line">        aliceCipher = Cipher.getInstance(<span class="string">&quot;DES/CBC/PKCS5Padding&quot;</span>);</span><br><span class="line">        aliceCipher.init(Cipher.DECRYPT_MODE, aliceDesKey, params);</span><br><span class="line">        recovered = aliceCipher.doFinal(ciphertext);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!java.util.Arrays.equals(cleartext, recovered))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;DES in CBC mode recovered text is &quot;</span> +</span><br><span class="line">              <span class="string">&quot;different from cleartext&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;DES in CBC mode recovered text is &quot;</span> +</span><br><span class="line">            <span class="string">&quot;same as cleartext&quot;</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Converts a byte to hex digit and writes to the supplied buffer</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">byte2hex</span><span class="params">(<span class="keyword">byte</span> b, StringBuffer buf)</span> </span>{</span><br><span class="line">        <span class="keyword">char</span>[] hexChars = { <span class="string">&apos;0&apos;</span>, <span class="string">&apos;1&apos;</span>, <span class="string">&apos;2&apos;</span>, <span class="string">&apos;3&apos;</span>, <span class="string">&apos;4&apos;</span>, <span class="string">&apos;5&apos;</span>, <span class="string">&apos;6&apos;</span>, <span class="string">&apos;7&apos;</span>, <span class="string">&apos;8&apos;</span>,</span><br><span class="line">                            <span class="string">&apos;9&apos;</span>, <span class="string">&apos;A&apos;</span>, <span class="string">&apos;B&apos;</span>, <span class="string">&apos;C&apos;</span>, <span class="string">&apos;D&apos;</span>, <span class="string">&apos;E&apos;</span>, <span class="string">&apos;F&apos;</span> };</span><br><span class="line">        <span class="keyword">int</span> high = ((b &amp; <span class="number">0xf0</span>) &gt;&gt; <span class="number">4</span>);</span><br><span class="line">        <span class="keyword">int</span> low = (b &amp; <span class="number">0x0f</span>);</span><br><span class="line">        buf.append(hexChars[high]);</span><br><span class="line">        buf.append(hexChars[low]);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Converts a byte array to hex string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">toHexString</span><span class="params">(<span class="keyword">byte</span>[] block)</span> </span>{</span><br><span class="line">        StringBuffer buf = <span class="keyword">new</span> StringBuffer();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> len = block.length;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) {</span><br><span class="line">             byte2hex(block[i], buf);</span><br><span class="line">             <span class="keyword">if</span> (i &lt; len-<span class="number">1</span>) {</span><br><span class="line">                 buf.append(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">             }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> buf.toString();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Prints the usage of this test.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">usage</span><span class="params">()</span> </span>{</span><br><span class="line">        System.err.print(<span class="string">&quot;DHKeyAgreement usage: &quot;</span>);</span><br><span class="line">        System.err.println(<span class="string">&quot;[-gen]&quot;</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The 1024 bit Diffie-Hellman modulus values used by SKIP</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">byte</span> skip1024ModulusBytes[] = {</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0xF4</span>, (<span class="keyword">byte</span>)<span class="number">0x88</span>, (<span class="keyword">byte</span>)<span class="number">0xFD</span>, (<span class="keyword">byte</span>)<span class="number">0x58</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x4E</span>, (<span class="keyword">byte</span>)<span class="number">0x49</span>, (<span class="keyword">byte</span>)<span class="number">0xDB</span>, (<span class="keyword">byte</span>)<span class="number">0xCD</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x20</span>, (<span class="keyword">byte</span>)<span class="number">0xB4</span>, (<span class="keyword">byte</span>)<span class="number">0x9D</span>, (<span class="keyword">byte</span>)<span class="number">0xE4</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x91</span>, (<span class="keyword">byte</span>)<span class="number">0x07</span>, (<span class="keyword">byte</span>)<span class="number">0x36</span>, (<span class="keyword">byte</span>)<span class="number">0x6B</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x33</span>, (<span class="keyword">byte</span>)<span class="number">0x6C</span>, (<span class="keyword">byte</span>)<span class="number">0x38</span>, (<span class="keyword">byte</span>)<span class="number">0x0D</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x45</span>, (<span class="keyword">byte</span>)<span class="number">0x1D</span>, (<span class="keyword">byte</span>)<span class="number">0x0F</span>, (<span class="keyword">byte</span>)<span class="number">0x7C</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x88</span>, (<span class="keyword">byte</span>)<span class="number">0xB3</span>, (<span class="keyword">byte</span>)<span class="number">0x1C</span>, (<span class="keyword">byte</span>)<span class="number">0x7C</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x5B</span>, (<span class="keyword">byte</span>)<span class="number">0x2D</span>, (<span class="keyword">byte</span>)<span class="number">0x8E</span>, (<span class="keyword">byte</span>)<span class="number">0xF6</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0xF3</span>, (<span class="keyword">byte</span>)<span class="number">0xC9</span>, (<span class="keyword">byte</span>)<span class="number">0x23</span>, (<span class="keyword">byte</span>)<span class="number">0xC0</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x43</span>, (<span class="keyword">byte</span>)<span class="number">0xF0</span>, (<span class="keyword">byte</span>)<span class="number">0xA5</span>, (<span class="keyword">byte</span>)<span class="number">0x5B</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x18</span>, (<span class="keyword">byte</span>)<span class="number">0x8D</span>, (<span class="keyword">byte</span>)<span class="number">0x8E</span>, (<span class="keyword">byte</span>)<span class="number">0xBB</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x55</span>, (<span class="keyword">byte</span>)<span class="number">0x8C</span>, (<span class="keyword">byte</span>)<span class="number">0xB8</span>, (<span class="keyword">byte</span>)<span class="number">0x5D</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x38</span>, (<span class="keyword">byte</span>)<span class="number">0xD3</span>, (<span class="keyword">byte</span>)<span class="number">0x34</span>, (<span class="keyword">byte</span>)<span class="number">0xFD</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x7C</span>, (<span class="keyword">byte</span>)<span class="number">0x17</span>, (<span class="keyword">byte</span>)<span class="number">0x57</span>, (<span class="keyword">byte</span>)<span class="number">0x43</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0xA3</span>, (<span class="keyword">byte</span>)<span class="number">0x1D</span>, (<span class="keyword">byte</span>)<span class="number">0x18</span>, (<span class="keyword">byte</span>)<span class="number">0x6C</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0xDE</span>, (<span class="keyword">byte</span>)<span class="number">0x33</span>, (<span class="keyword">byte</span>)<span class="number">0x21</span>, (<span class="keyword">byte</span>)<span class="number">0x2C</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0xB5</span>, (<span class="keyword">byte</span>)<span class="number">0x2A</span>, (<span class="keyword">byte</span>)<span class="number">0xFF</span>, (<span class="keyword">byte</span>)<span class="number">0x3C</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0xE1</span>, (<span class="keyword">byte</span>)<span class="number">0xB1</span>, (<span class="keyword">byte</span>)<span class="number">0x29</span>, (<span class="keyword">byte</span>)<span class="number">0x40</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x18</span>, (<span class="keyword">byte</span>)<span class="number">0x11</span>, (<span class="keyword">byte</span>)<span class="number">0x8D</span>, (<span class="keyword">byte</span>)<span class="number">0x7C</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x84</span>, (<span class="keyword">byte</span>)<span class="number">0xA7</span>, (<span class="keyword">byte</span>)<span class="number">0x0A</span>, (<span class="keyword">byte</span>)<span class="number">0x72</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0xD6</span>, (<span class="keyword">byte</span>)<span class="number">0x86</span>, (<span class="keyword">byte</span>)<span class="number">0xC4</span>, (<span class="keyword">byte</span>)<span class="number">0x03</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x19</span>, (<span class="keyword">byte</span>)<span class="number">0xC8</span>, (<span class="keyword">byte</span>)<span class="number">0x07</span>, (<span class="keyword">byte</span>)<span class="number">0x29</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x7A</span>, (<span class="keyword">byte</span>)<span class="number">0xCA</span>, (<span class="keyword">byte</span>)<span class="number">0x95</span>, (<span class="keyword">byte</span>)<span class="number">0x0C</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0xD9</span>, (<span class="keyword">byte</span>)<span class="number">0x96</span>, (<span class="keyword">byte</span>)<span class="number">0x9F</span>, (<span class="keyword">byte</span>)<span class="number">0xAB</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0xD0</span>, (<span class="keyword">byte</span>)<span class="number">0x0A</span>, (<span class="keyword">byte</span>)<span class="number">0x50</span>, (<span class="keyword">byte</span>)<span class="number">0x9B</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x02</span>, (<span class="keyword">byte</span>)<span class="number">0x46</span>, (<span class="keyword">byte</span>)<span class="number">0xD3</span>, (<span class="keyword">byte</span>)<span class="number">0x08</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x3D</span>, (<span class="keyword">byte</span>)<span class="number">0x66</span>, (<span class="keyword">byte</span>)<span class="number">0xA4</span>, (<span class="keyword">byte</span>)<span class="number">0x5D</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x41</span>, (<span class="keyword">byte</span>)<span class="number">0x9F</span>, (<span class="keyword">byte</span>)<span class="number">0x9C</span>, (<span class="keyword">byte</span>)<span class="number">0x7C</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0xBD</span>, (<span class="keyword">byte</span>)<span class="number">0x89</span>, (<span class="keyword">byte</span>)<span class="number">0x4B</span>, (<span class="keyword">byte</span>)<span class="number">0x22</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x19</span>, (<span class="keyword">byte</span>)<span class="number">0x26</span>, (<span class="keyword">byte</span>)<span class="number">0xBA</span>, (<span class="keyword">byte</span>)<span class="number">0xAB</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0xA2</span>, (<span class="keyword">byte</span>)<span class="number">0x5E</span>, (<span class="keyword">byte</span>)<span class="number">0xC3</span>, (<span class="keyword">byte</span>)<span class="number">0x55</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0xE9</span>, (<span class="keyword">byte</span>)<span class="number">0x2F</span>, (<span class="keyword">byte</span>)<span class="number">0x78</span>, (<span class="keyword">byte</span>)<span class="number">0xC7</span></span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The SKIP 1024 bit modulus</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> BigInteger skip1024Modulus</span><br><span class="line">    = <span class="keyword">new</span> BigInteger(<span class="number">1</span>, skip1024ModulusBytes);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The base used with the SKIP 1024 bit modulus</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> BigInteger skip1024Base = BigInteger.valueOf(<span class="number">2</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p><p>Diffie-Hellman Key Exchange between 3 Parties<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Copyright (c) 1997, 2001, Oracle and/or its affiliates. All rights reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Redistribution and use in source and binary forms, with or without</span></span><br><span class="line"><span class="comment"> * modification, are permitted provided that the following conditions</span></span><br><span class="line"><span class="comment"> * are met:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   - Redistributions of source code must retain the above copyright</span></span><br><span class="line"><span class="comment"> *     notice, this list of conditions and the following disclaimer.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   - Redistributions in binary form must reproduce the above copyright</span></span><br><span class="line"><span class="comment"> *     notice, this list of conditions and the following disclaimer in the</span></span><br><span class="line"><span class="comment"> *     documentation and/or other materials provided with the distribution.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   - Neither the name of Oracle nor the names of its</span></span><br><span class="line"><span class="comment"> *     contributors may be used to endorse or promote products derived</span></span><br><span class="line"><span class="comment"> *     from this software without specific prior written permission.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS</span></span><br><span class="line"><span class="comment"> * IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,</span></span><br><span class="line"><span class="comment"> * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR</span></span><br><span class="line"><span class="comment"> * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR</span></span><br><span class="line"><span class="comment"> * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span></span><br><span class="line"><span class="comment"> * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span></span><br><span class="line"><span class="comment"> * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span></span><br><span class="line"><span class="comment"> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span></span><br><span class="line"><span class="comment"> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span></span><br><span class="line"><span class="comment"> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span></span><br><span class="line"><span class="comment"> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.math.BigInteger;</span><br><span class="line"><span class="keyword">import</span> java.security.*;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.*;</span><br><span class="line"><span class="keyword">import</span> java.security.interfaces.*;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.*;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.*;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.interfaces.*;</span><br><span class="line"><span class="keyword">import</span> com.sun.crypto.provider.SunJCE;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This program executes the Diffie-Hellman key agreement protocol</span></span><br><span class="line"><span class="comment"> * between 3 parties: Alice, Bob, and Carol.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * We use the same 1024-bit prime modulus and base generator that are</span></span><br><span class="line"><span class="comment"> * used by SKIP.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DHKeyAgreement3</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">DHKeyAgreement3</span><span class="params">()</span> </span>{}</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String argv[])</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            DHKeyAgreement3 keyAgree = <span class="keyword">new</span> DHKeyAgreement3();</span><br><span class="line">            keyAgree.run();</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            System.err.println(<span class="string">&quot;Error: &quot;</span> + e);</span><br><span class="line">            System.exit(<span class="number">1</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line"></span><br><span class="line">        DHParameterSpec dhSkipParamSpec;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;Using SKIP Diffie-Hellman parameters&quot;</span>);</span><br><span class="line">        dhSkipParamSpec = <span class="keyword">new</span> DHParameterSpec(skip1024Modulus, skip1024Base);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Alice creates her own DH key pair</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ALICE: Generate DH keypair ...&quot;</span>);</span><br><span class="line">        KeyPairGenerator aliceKpairGen = KeyPairGenerator.getInstance(<span class="string">&quot;DH&quot;</span>);</span><br><span class="line">        aliceKpairGen.initialize(dhSkipParamSpec);</span><br><span class="line">        KeyPair aliceKpair = aliceKpairGen.generateKeyPair();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Bob creates his own DH key pair</span></span><br><span class="line">        System.out.println(<span class="string">&quot;BOB: Generate DH keypair ...&quot;</span>);</span><br><span class="line">        KeyPairGenerator bobKpairGen = KeyPairGenerator.getInstance(<span class="string">&quot;DH&quot;</span>);</span><br><span class="line">        bobKpairGen.initialize(dhSkipParamSpec);</span><br><span class="line">        KeyPair bobKpair = bobKpairGen.generateKeyPair();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Carol creates her own DH key pair</span></span><br><span class="line">        System.out.println(<span class="string">&quot;CAROL: Generate DH keypair ...&quot;</span>);</span><br><span class="line">        KeyPairGenerator carolKpairGen = KeyPairGenerator.getInstance(<span class="string">&quot;DH&quot;</span>);</span><br><span class="line">        carolKpairGen.initialize(dhSkipParamSpec);</span><br><span class="line">        KeyPair carolKpair = carolKpairGen.generateKeyPair();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Alice initialize</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ALICE: Initialize ...&quot;</span>);</span><br><span class="line">        KeyAgreement aliceKeyAgree = KeyAgreement.getInstance(<span class="string">&quot;DH&quot;</span>);</span><br><span class="line">        aliceKeyAgree.init(aliceKpair.getPrivate());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Bob initialize</span></span><br><span class="line">        System.out.println(<span class="string">&quot;BOB: Initialize ...&quot;</span>);</span><br><span class="line">        KeyAgreement bobKeyAgree = KeyAgreement.getInstance(<span class="string">&quot;DH&quot;</span>);</span><br><span class="line">        bobKeyAgree.init(bobKpair.getPrivate());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Carol initialize</span></span><br><span class="line">        System.out.println(<span class="string">&quot;CAROL: Initialize ...&quot;</span>);</span><br><span class="line">        KeyAgreement carolKeyAgree = KeyAgreement.getInstance(<span class="string">&quot;DH&quot;</span>);</span><br><span class="line">        carolKeyAgree.init(carolKpair.getPrivate());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Alice uses Carol&apos;s public key</span></span><br><span class="line">        Key ac = aliceKeyAgree.doPhase(carolKpair.getPublic(), <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Bob uses Alice&apos;s public key</span></span><br><span class="line">        Key ba = bobKeyAgree.doPhase(aliceKpair.getPublic(), <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Carol uses Bob&apos;s public key</span></span><br><span class="line">        Key cb = carolKeyAgree.doPhase(bobKpair.getPublic(), <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Alice uses Carol&apos;s result from above</span></span><br><span class="line">        aliceKeyAgree.doPhase(cb, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Bob uses Alice&apos;s result from above</span></span><br><span class="line">        bobKeyAgree.doPhase(ac, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Carol uses Bob&apos;s result from above</span></span><br><span class="line">        carolKeyAgree.doPhase(ba, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Alice, Bob and Carol compute their secrets</span></span><br><span class="line">        <span class="keyword">byte</span>[] aliceSharedSecret = aliceKeyAgree.generateSecret();</span><br><span class="line">        System.out.println(<span class="string">&quot;Alice secret: &quot;</span> + toHexString(aliceSharedSecret));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] bobSharedSecret = bobKeyAgree.generateSecret();</span><br><span class="line">        System.out.println(<span class="string">&quot;Bob secret: &quot;</span> + toHexString(bobSharedSecret));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] carolSharedSecret = carolKeyAgree.generateSecret();</span><br><span class="line">        System.out.println(<span class="string">&quot;Carol secret: &quot;</span> + toHexString(carolSharedSecret));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Compare Alice and Bob</span></span><br><span class="line">        <span class="keyword">if</span> (!java.util.Arrays.equals(aliceSharedSecret, bobSharedSecret))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;Alice and Bob differ&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Alice and Bob are the same&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Compare Bob and Carol</span></span><br><span class="line">        <span class="keyword">if</span> (!java.util.Arrays.equals(bobSharedSecret, carolSharedSecret))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;Bob and Carol differ&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Bob and Carol are the same&quot;</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Converts a byte to hex digit and writes to the supplied buffer</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">byte2hex</span><span class="params">(<span class="keyword">byte</span> b, StringBuffer buf)</span> </span>{</span><br><span class="line">        <span class="keyword">char</span>[] hexChars = { <span class="string">&apos;0&apos;</span>, <span class="string">&apos;1&apos;</span>, <span class="string">&apos;2&apos;</span>, <span class="string">&apos;3&apos;</span>, <span class="string">&apos;4&apos;</span>, <span class="string">&apos;5&apos;</span>, <span class="string">&apos;6&apos;</span>, <span class="string">&apos;7&apos;</span>, <span class="string">&apos;8&apos;</span>,</span><br><span class="line">                            <span class="string">&apos;9&apos;</span>, <span class="string">&apos;A&apos;</span>, <span class="string">&apos;B&apos;</span>, <span class="string">&apos;C&apos;</span>, <span class="string">&apos;D&apos;</span>, <span class="string">&apos;E&apos;</span>, <span class="string">&apos;F&apos;</span> };</span><br><span class="line">        <span class="keyword">int</span> high = ((b &amp; <span class="number">0xf0</span>) &gt;&gt; <span class="number">4</span>);</span><br><span class="line">        <span class="keyword">int</span> low = (b &amp; <span class="number">0x0f</span>);</span><br><span class="line">        buf.append(hexChars[high]);</span><br><span class="line">        buf.append(hexChars[low]);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Converts a byte array to hex string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">toHexString</span><span class="params">(<span class="keyword">byte</span>[] block)</span> </span>{</span><br><span class="line">        StringBuffer buf = <span class="keyword">new</span> StringBuffer();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> len = block.length;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) {</span><br><span class="line">             byte2hex(block[i], buf);</span><br><span class="line">             <span class="keyword">if</span> (i &lt; len-<span class="number">1</span>) {</span><br><span class="line">                 buf.append(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">             }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> buf.toString();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Prints the usage of this test.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">usage</span><span class="params">()</span> </span>{</span><br><span class="line">        System.err.print(<span class="string">&quot;DHKeyAgreement usage: &quot;</span>);</span><br><span class="line">        System.err.println(<span class="string">&quot;[-gen]&quot;</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The 1024 bit Diffie-Hellman modulus values used by SKIP</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">byte</span> skip1024ModulusBytes[] = {</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0xF4</span>, (<span class="keyword">byte</span>)<span class="number">0x88</span>, (<span class="keyword">byte</span>)<span class="number">0xFD</span>, (<span class="keyword">byte</span>)<span class="number">0x58</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x4E</span>, (<span class="keyword">byte</span>)<span class="number">0x49</span>, (<span class="keyword">byte</span>)<span class="number">0xDB</span>, (<span class="keyword">byte</span>)<span class="number">0xCD</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x20</span>, (<span class="keyword">byte</span>)<span class="number">0xB4</span>, (<span class="keyword">byte</span>)<span class="number">0x9D</span>, (<span class="keyword">byte</span>)<span class="number">0xE4</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x91</span>, (<span class="keyword">byte</span>)<span class="number">0x07</span>, (<span class="keyword">byte</span>)<span class="number">0x36</span>, (<span class="keyword">byte</span>)<span class="number">0x6B</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x33</span>, (<span class="keyword">byte</span>)<span class="number">0x6C</span>, (<span class="keyword">byte</span>)<span class="number">0x38</span>, (<span class="keyword">byte</span>)<span class="number">0x0D</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x45</span>, (<span class="keyword">byte</span>)<span class="number">0x1D</span>, (<span class="keyword">byte</span>)<span class="number">0x0F</span>, (<span class="keyword">byte</span>)<span class="number">0x7C</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x88</span>, (<span class="keyword">byte</span>)<span class="number">0xB3</span>, (<span class="keyword">byte</span>)<span class="number">0x1C</span>, (<span class="keyword">byte</span>)<span class="number">0x7C</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x5B</span>, (<span class="keyword">byte</span>)<span class="number">0x2D</span>, (<span class="keyword">byte</span>)<span class="number">0x8E</span>, (<span class="keyword">byte</span>)<span class="number">0xF6</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0xF3</span>, (<span class="keyword">byte</span>)<span class="number">0xC9</span>, (<span class="keyword">byte</span>)<span class="number">0x23</span>, (<span class="keyword">byte</span>)<span class="number">0xC0</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x43</span>, (<span class="keyword">byte</span>)<span class="number">0xF0</span>, (<span class="keyword">byte</span>)<span class="number">0xA5</span>, (<span class="keyword">byte</span>)<span class="number">0x5B</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x18</span>, (<span class="keyword">byte</span>)<span class="number">0x8D</span>, (<span class="keyword">byte</span>)<span class="number">0x8E</span>, (<span class="keyword">byte</span>)<span class="number">0xBB</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x55</span>, (<span class="keyword">byte</span>)<span class="number">0x8C</span>, (<span class="keyword">byte</span>)<span class="number">0xB8</span>, (<span class="keyword">byte</span>)<span class="number">0x5D</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x38</span>, (<span class="keyword">byte</span>)<span class="number">0xD3</span>, (<span class="keyword">byte</span>)<span class="number">0x34</span>, (<span class="keyword">byte</span>)<span class="number">0xFD</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x7C</span>, (<span class="keyword">byte</span>)<span class="number">0x17</span>, (<span class="keyword">byte</span>)<span class="number">0x57</span>, (<span class="keyword">byte</span>)<span class="number">0x43</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0xA3</span>, (<span class="keyword">byte</span>)<span class="number">0x1D</span>, (<span class="keyword">byte</span>)<span class="number">0x18</span>, (<span class="keyword">byte</span>)<span class="number">0x6C</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0xDE</span>, (<span class="keyword">byte</span>)<span class="number">0x33</span>, (<span class="keyword">byte</span>)<span class="number">0x21</span>, (<span class="keyword">byte</span>)<span class="number">0x2C</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0xB5</span>, (<span class="keyword">byte</span>)<span class="number">0x2A</span>, (<span class="keyword">byte</span>)<span class="number">0xFF</span>, (<span class="keyword">byte</span>)<span class="number">0x3C</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0xE1</span>, (<span class="keyword">byte</span>)<span class="number">0xB1</span>, (<span class="keyword">byte</span>)<span class="number">0x29</span>, (<span class="keyword">byte</span>)<span class="number">0x40</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x18</span>, (<span class="keyword">byte</span>)<span class="number">0x11</span>, (<span class="keyword">byte</span>)<span class="number">0x8D</span>, (<span class="keyword">byte</span>)<span class="number">0x7C</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x84</span>, (<span class="keyword">byte</span>)<span class="number">0xA7</span>, (<span class="keyword">byte</span>)<span class="number">0x0A</span>, (<span class="keyword">byte</span>)<span class="number">0x72</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0xD6</span>, (<span class="keyword">byte</span>)<span class="number">0x86</span>, (<span class="keyword">byte</span>)<span class="number">0xC4</span>, (<span class="keyword">byte</span>)<span class="number">0x03</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x19</span>, (<span class="keyword">byte</span>)<span class="number">0xC8</span>, (<span class="keyword">byte</span>)<span class="number">0x07</span>, (<span class="keyword">byte</span>)<span class="number">0x29</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x7A</span>, (<span class="keyword">byte</span>)<span class="number">0xCA</span>, (<span class="keyword">byte</span>)<span class="number">0x95</span>, (<span class="keyword">byte</span>)<span class="number">0x0C</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0xD9</span>, (<span class="keyword">byte</span>)<span class="number">0x96</span>, (<span class="keyword">byte</span>)<span class="number">0x9F</span>, (<span class="keyword">byte</span>)<span class="number">0xAB</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0xD0</span>, (<span class="keyword">byte</span>)<span class="number">0x0A</span>, (<span class="keyword">byte</span>)<span class="number">0x50</span>, (<span class="keyword">byte</span>)<span class="number">0x9B</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x02</span>, (<span class="keyword">byte</span>)<span class="number">0x46</span>, (<span class="keyword">byte</span>)<span class="number">0xD3</span>, (<span class="keyword">byte</span>)<span class="number">0x08</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x3D</span>, (<span class="keyword">byte</span>)<span class="number">0x66</span>, (<span class="keyword">byte</span>)<span class="number">0xA4</span>, (<span class="keyword">byte</span>)<span class="number">0x5D</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x41</span>, (<span class="keyword">byte</span>)<span class="number">0x9F</span>, (<span class="keyword">byte</span>)<span class="number">0x9C</span>, (<span class="keyword">byte</span>)<span class="number">0x7C</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0xBD</span>, (<span class="keyword">byte</span>)<span class="number">0x89</span>, (<span class="keyword">byte</span>)<span class="number">0x4B</span>, (<span class="keyword">byte</span>)<span class="number">0x22</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0x19</span>, (<span class="keyword">byte</span>)<span class="number">0x26</span>, (<span class="keyword">byte</span>)<span class="number">0xBA</span>, (<span class="keyword">byte</span>)<span class="number">0xAB</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0xA2</span>, (<span class="keyword">byte</span>)<span class="number">0x5E</span>, (<span class="keyword">byte</span>)<span class="number">0xC3</span>, (<span class="keyword">byte</span>)<span class="number">0x55</span>,</span><br><span class="line">        (<span class="keyword">byte</span>)<span class="number">0xE9</span>, (<span class="keyword">byte</span>)<span class="number">0x2F</span>, (<span class="keyword">byte</span>)<span class="number">0x78</span>, (<span class="keyword">byte</span>)<span class="number">0xC7</span></span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The SKIP 1024 bit modulus</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> BigInteger skip1024Modulus</span><br><span class="line">    = <span class="keyword">new</span> BigInteger(<span class="number">1</span>, skip1024ModulusBytes);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The base used with the SKIP 1024 bit modulus</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> BigInteger skip1024Base = BigInteger.valueOf(<span class="number">2</span>);</span><br><span class="line">}</span><br><span class="line">Blowfish Cipher Example</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Copyright (c) 1997, 2001, Oracle and/or its affiliates. All rights reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Redistribution and use in source and binary forms, with or without</span></span><br><span class="line"><span class="comment"> * modification, are permitted provided that the following conditions</span></span><br><span class="line"><span class="comment"> * are met:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   - Redistributions of source code must retain the above copyright</span></span><br><span class="line"><span class="comment"> *     notice, this list of conditions and the following disclaimer.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   - Redistributions in binary form must reproduce the above copyright</span></span><br><span class="line"><span class="comment"> *     notice, this list of conditions and the following disclaimer in the</span></span><br><span class="line"><span class="comment"> *     documentation and/or other materials provided with the distribution.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   - Neither the name of Oracle nor the names of its</span></span><br><span class="line"><span class="comment"> *     contributors may be used to endorse or promote products derived</span></span><br><span class="line"><span class="comment"> *     from this software without specific prior written permission.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS</span></span><br><span class="line"><span class="comment"> * IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,</span></span><br><span class="line"><span class="comment"> * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR</span></span><br><span class="line"><span class="comment"> * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR</span></span><br><span class="line"><span class="comment"> * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span></span><br><span class="line"><span class="comment"> * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span></span><br><span class="line"><span class="comment"> * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span></span><br><span class="line"><span class="comment"> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span></span><br><span class="line"><span class="comment"> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span></span><br><span class="line"><span class="comment"> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span></span><br><span class="line"><span class="comment"> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.security.*;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.*;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This program generates a Blowfish key, retrieves its raw bytes, and</span></span><br><span class="line"><span class="comment"> * then reinstantiates a Blowfish key from the key bytes.</span></span><br><span class="line"><span class="comment"> * The reinstantiated key is used to initialize a Blowfish cipher for</span></span><br><span class="line"><span class="comment"> * encryption.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlowfishKey</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line"></span><br><span class="line">        KeyGenerator kgen = KeyGenerator.getInstance(<span class="string">&quot;Blowfish&quot;</span>);</span><br><span class="line">        SecretKey skey = kgen.generateKey();</span><br><span class="line">        <span class="keyword">byte</span>[] raw = skey.getEncoded();</span><br><span class="line">        SecretKeySpec skeySpec = <span class="keyword">new</span> SecretKeySpec(raw, <span class="string">&quot;Blowfish&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Cipher cipher = Cipher.getInstance(<span class="string">&quot;Blowfish&quot;</span>);</span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, skeySpec);</span><br><span class="line">        <span class="keyword">byte</span>[] encrypted =</span><br><span class="line">            cipher.doFinal(<span class="string">&quot;This is just an example&quot;</span>.getBytes());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p><p>HMAC-MD5 Example</p><p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Copyright (c) 1997, 2001, Oracle and/or its affiliates. All rights reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Redistribution and use in source and binary forms, with or without</span></span><br><span class="line"><span class="comment"> * modification, are permitted provided that the following conditions</span></span><br><span class="line"><span class="comment"> * are met:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   - Redistributions of source code must retain the above copyright</span></span><br><span class="line"><span class="comment"> *     notice, this list of conditions and the following disclaimer.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   - Redistributions in binary form must reproduce the above copyright</span></span><br><span class="line"><span class="comment"> *     notice, this list of conditions and the following disclaimer in the</span></span><br><span class="line"><span class="comment"> *     documentation and/or other materials provided with the distribution.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   - Neither the name of Oracle nor the names of its</span></span><br><span class="line"><span class="comment"> *     contributors may be used to endorse or promote products derived</span></span><br><span class="line"><span class="comment"> *     from this software without specific prior written permission.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS</span></span><br><span class="line"><span class="comment"> * IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,</span></span><br><span class="line"><span class="comment"> * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR</span></span><br><span class="line"><span class="comment"> * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR</span></span><br><span class="line"><span class="comment"> * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span></span><br><span class="line"><span class="comment"> * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span></span><br><span class="line"><span class="comment"> * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span></span><br><span class="line"><span class="comment"> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span></span><br><span class="line"><span class="comment"> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span></span><br><span class="line"><span class="comment"> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span></span><br><span class="line"><span class="comment"> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.security.*;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This program demonstrates how to generate a secret-key object for</span></span><br><span class="line"><span class="comment"> * HMAC-MD5, and initialize an HMAC-MD5 object with it.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">initMac</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Generate secret key for HMAC-MD5</span></span><br><span class="line">        KeyGenerator kg = KeyGenerator.getInstance(<span class="string">&quot;HmacMD5&quot;</span>);</span><br><span class="line">        SecretKey sk = kg.generateKey();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get instance of Mac object implementing HMAC-MD5, and</span></span><br><span class="line">        <span class="comment">// initialize it with the above secret key</span></span><br><span class="line">        Mac mac = Mac.getInstance(<span class="string">&quot;HmacMD5&quot;</span>);</span><br><span class="line">        mac.init(sk);</span><br><span class="line">        <span class="keyword">byte</span>[] result = mac.doFinal(<span class="string">&quot;Hi There&quot;</span>.getBytes());</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">Reading ASCII Passwords From an InputStream Example</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @(#)ReadPassword.java  1.1 06/06/07</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2006, Oracle and/or its affiliates. All rights reserved.</span></span><br><span class="line"><span class="comment"> * ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.security.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadPassword</span> </span>{</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Read a password from the InputStream &quot;in&quot;.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * As Strings are immutable, passwords should be stored as an array</span></span><br><span class="line"><span class="comment">     * of characters, which can be blanked out when no longer needed.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * If the provided InputStream is the System&apos;s Console, this method</span></span><br><span class="line"><span class="comment">     * uses the non-echoing readPassword() method of java.io.Console</span></span><br><span class="line"><span class="comment">     * (new to JDK 6).  If not, a fallback implementation is used.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">NOTE:</span>  For expository purposes, and because some applications do</span></span><br><span class="line"><span class="comment">     * not understand multi-byte characters, only 8-bit ASCII passwords</span></span><br><span class="line"><span class="comment">     * are handled here.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">NOTE:</span>  If a SecurityManager is used, the default standard</span></span><br><span class="line"><span class="comment">     * java.policy file found in the JDK (i.e.</span></span><br><span class="line"><span class="comment">     * &lt;java-home&gt;/lib/security/java.policy) allows reading the</span></span><br><span class="line"><span class="comment">     * line.separator property.  If your environment is different, this</span></span><br><span class="line"><span class="comment">     * code will need to be granted the appropriate privilege.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>   in</span></span><br><span class="line"><span class="comment">     *          the InputStream used to obtain the password.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  A character array containing the password or passphrase,</span></span><br><span class="line"><span class="comment">     *          not including the line-termination characters,</span></span><br><span class="line"><span class="comment">     *          or null if an end of stream has been reached.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span>  IOException</span></span><br><span class="line"><span class="comment">     *          if an I/O problem occurs</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span>[] readPassword(InputStream in)</span><br><span class="line">            <span class="keyword">throws</span> IOException {</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * If available, directly use the java.io.Console class to</span></span><br><span class="line"><span class="comment">         * avoid character echoing.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> (in == System.in &amp;&amp; System.console() != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="comment">// readPassword returns &quot;&quot; if you just print ENTER,</span></span><br><span class="line">            <span class="keyword">return</span> System.console().readPassword();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * If a console is not available, read the InputStream</span></span><br><span class="line"><span class="comment">         * directly.  This approach may cause password echoing.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * Since different operating systems have different End-Of-Line</span></span><br><span class="line"><span class="comment">         * (EOL) sequences, this algorithm should allow for</span></span><br><span class="line"><span class="comment">         * platform-independent implementations.  Typical EOL sequences</span></span><br><span class="line"><span class="comment">         * are a single line feed (&apos;\n&apos;), or a carriage return/linefeed</span></span><br><span class="line"><span class="comment">         * combination (&apos;\r\n&apos;).  However, some OS&apos;s use a single</span></span><br><span class="line"><span class="comment">         * a carriage return (&apos;\r&apos;), which complicates portability.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * Since we may not have the ability to push bytes back into the</span></span><br><span class="line"><span class="comment">         * InputStream, another approach is used here.  The javadoc for</span></span><br><span class="line"><span class="comment">         * &lt;code&gt;java.lang.System.getProperties()&lt;/code&gt; specifies that</span></span><br><span class="line"><span class="comment">         * the set of system properties will contain a system-specific</span></span><br><span class="line"><span class="comment">         * value for the &quot;line.separator&quot;.  Scan for this character</span></span><br><span class="line"><span class="comment">         * sequence instead of hard-coding a particular sequence.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Enclose the getProperty in a doPrivileged block to minimize</span></span><br><span class="line"><span class="comment">         * the call stack permission required.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">char</span> [] EOL = AccessController.doPrivileged(</span><br><span class="line">            <span class="keyword">new</span> PrivilegedAction&lt;<span class="keyword">char</span>[]&gt;() {</span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">char</span>[] run() {</span><br><span class="line">                    String s = System.getProperty(<span class="string">&quot;line.separator&quot;</span>);</span><br><span class="line">                    <span class="comment">// Shouldn&apos;t happen.</span></span><br><span class="line">                    <span class="keyword">if</span> (s == <span class="keyword">null</span>) {</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</span><br><span class="line">                            <span class="string">&quot;line.separator not defined&quot;</span>);</span><br><span class="line">                    }</span><br><span class="line">                    <span class="keyword">return</span> s.toCharArray();</span><br><span class="line">                }</span><br><span class="line">            });</span><br><span class="line"></span><br><span class="line">        <span class="keyword">char</span> [] buffer = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">128</span>];</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">int</span> len = <span class="number">0</span>;                <span class="comment">// len of data in buffer.</span></span><br><span class="line">            <span class="keyword">boolean</span> done = <span class="keyword">false</span>;       <span class="comment">// found the EOL sequence</span></span><br><span class="line">            <span class="keyword">int</span> b;                      <span class="comment">// byte read</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (!done) {</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                 * realloc if necessary</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="keyword">if</span> (len &gt;= buffer.length) {</span><br><span class="line">                    <span class="keyword">char</span> [] newbuffer = <span class="keyword">new</span> <span class="keyword">char</span>[len + <span class="number">128</span>];</span><br><span class="line">                    System.arraycopy(buffer, <span class="number">0</span>, newbuffer, <span class="number">0</span>, len);</span><br><span class="line">                    Arrays.fill(buffer, <span class="string">&apos; &apos;</span>);</span><br><span class="line">                    buffer = newbuffer;</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                 * End-of-Stream?</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="keyword">if</span> ((b = in.read()) == -<span class="number">1</span>) {</span><br><span class="line">                    <span class="comment">// Return as much as we have, null otherwise.</span></span><br><span class="line">                    <span class="keyword">if</span> (len == <span class="number">0</span>) {</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                    }</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    <span class="comment">/*</span></span><br><span class="line"><span class="comment">                     * <span class="doctag">NOTE:</span>  In the simple PBE example here,</span></span><br><span class="line"><span class="comment">                     * only 8 bit ASCII characters are handled.</span></span><br><span class="line"><span class="comment">                     */</span></span><br><span class="line">                    buffer[len++] = (<span class="keyword">char</span>) b;</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                 * check for the EOL sequence.  Do we have enough bytes?</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="keyword">if</span> (len &gt;= EOL.length) {</span><br><span class="line">                    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; EOL.length; i++) {</span><br><span class="line">                        <span class="keyword">if</span> (buffer[len - EOL.length + i] != EOL[i]) {</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                    done = (i == EOL.length);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * If we found the EOL, strip the EOL chars.</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">char</span> [] result = <span class="keyword">new</span> <span class="keyword">char</span>[done ? len - EOL.length : len];</span><br><span class="line">            System.arraycopy(buffer, <span class="number">0</span>, result, <span class="number">0</span>, result.length);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * Zero out the buffer.</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">if</span> (buffer != <span class="keyword">null</span>) {</span><br><span class="line">                Arrays.fill(buffer, <span class="string">&apos; &apos;</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&amp;#x539F;&amp;#x6587;&amp;#x5730;&amp;#x5740;&amp;#xFF1A;&lt;a href=&quot;http://docs.oracle.com/javase/8/docs/technotes/guides/security/crypto/CryptoSpec.html&quot; t
      
    
    </summary>
    
      <category term="java" scheme="https://yyhan.github.io/categories/java/"/>
    
    
      <category term="security" scheme="https://yyhan.github.io/tags/security/"/>
    
      <category term="jca" scheme="https://yyhan.github.io/tags/jca/"/>
    
  </entry>
  
  <entry>
    <title>java 安全体系</title>
    <link href="https://yyhan.github.io/2017/06/29/java-%E5%AE%89%E5%85%A8%E4%BD%93%E7%B3%BB/"/>
    <id>https://yyhan.github.io/2017/06/29/java-安全体系/</id>
    <published>2017-06-29T15:25:48.000Z</published>
    <updated>2017-06-29T17:29:41.496Z</updated>
    
    <content type="html"><![CDATA[<p>&#x539F;&#x6587;&#x5730;&#x5740;&#xFF1A;<a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/index.html" target="_blank" rel="noopener">Security</a></p><h1>Security</h1><p>Java security technology includes a large set of APIs, tools, and implementations of commonly-used security algorithms, mechanisms, and protocols. The Java security APIs span a wide range of areas, including cryptography, public key infrastructure, secure communication, authentication, and access control. Java security technology provides the developer with a comprehensive security framework for writing applications, and also provides the user or administrator with a a set of tools to securely manage applications.</p><p>Java&#x5B89;&#x5168;&#x6280;&#x672F;&#x5305;&#x62EC;&#x5927;&#x91CF;&#x7684;API&#xFF0C;&#x5DE5;&#x5177;&#x548C;&#x5E38;&#x7528;&#x5B89;&#x5168;&#x7B97;&#x6CD5;&#xFF0C;&#x673A;&#x5236;&#x548C;&#x534F;&#x8BAE;&#x7684;&#x5B9E;&#x73B0;&#x3002; Java&#x5B89;&#x5168;API&#x6DB5;&#x76D6;&#x8303;&#x56F4;&#x5E7F;&#x6CDB;&#x7684;&#x9886;&#x57DF;&#xFF0C;&#x5305;&#x62EC;&#x5BC6;&#x7801;&#x5B66;&#xFF0C;&#x516C;&#x94A5;&#x57FA;&#x7840;&#x8BBE;&#x65BD;&#xFF0C;&#x5B89;&#x5168;&#x901A;&#x4FE1;&#xFF0C;&#x8BA4;&#x8BC1;&#x548C;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x3002; Java&#x5B89;&#x5168;&#x6280;&#x672F;&#x4E3A;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x7F16;&#x5199;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x5168;&#x9762;&#x5B89;&#x5168;&#x6846;&#x67B6;&#xFF0C;&#x5E76;&#x4E3A;&#x7528;&#x6237;&#x6216;&#x7BA1;&#x7406;&#x5458;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x5957;&#x5B89;&#x5168;&#x7BA1;&#x7406;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x5DE5;&#x5177;&#x3002;</p><h1>Enhancements</h1><ul class="ui list"><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/enhancements-8.html" target="_blank" rel="noopener">JDK 8 &#x5B89;&#x5168;&#x589E;&#x5F3A;&#x529F;&#x80FD;</a></li><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/enhancements-7.html" target="_blank" rel="noopener">JDK 7 &#x5B89;&#x5168;&#x589E;&#x5F3A;&#x529F;&#x80FD;</a></li><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/enhancements-6.html" target="_blank" rel="noopener">JDK 6 &#x5B89;&#x5168;&#x589E;&#x5F3A;&#x529F;&#x80FD;</a></li><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/blacklistfeature.html" target="_blank" rel="noopener">&#x9ED1;&#x540D;&#x5355;jar&#x5305;&#x7279;&#x6027;</a></li><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/certpath/CertPathProgGuide.html#StS" target="_blank" rel="noopener">&#x7B7E;&#x540D;&#x65F6;&#x95F4;&#x6233;&#x652F;&#x6301;</a></li></ul><h1>&#x7A0B;&#x5E8F;&#x5458;&#x6307;&#x5357;</h1><h2>&#x901A;&#x7528;&#x90E8;&#x5206;</h2><ul class="ui list"><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/overview/jsoverview.html" target="_blank" rel="noopener">Java &#x5B89;&#x5168;&#x6982;&#x89C8;</a></li><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/spec/security-spec.doc.html" target="_blank" rel="noopener">&#x5B89;&#x5168;&#x67B6;&#x6784;</a></li><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/crypto/CryptoSpec.html" target="_blank" rel="noopener">Java&#x52A0;&#x5BC6;&#x4F53;&#x7CFB;&#x67B6;&#x6784;&#x53C2;&#x8003;&#x6307;&#x5357;&#xFF08;JCA&#xFF09;&#x53C2;&#x8003;&#x6307;&#x5357;</a></li><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/crypto/HowToImplAProvider.html" target="_blank" rel="noopener">&#x5982;&#x4F55;&#x5728;JCA&#x4E2D;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x63D0;&#x4F9B;&#x8005;</a></li><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html" target="_blank" rel="noopener">&#x6807;&#x51C6;&#x7B97;&#x6CD5;&#x540D;&#x79F0;</a></li><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/SunProviders.html" target="_blank" rel="noopener">Oracle &#x63D0;&#x4F9B;&#x8005;</a></li><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/permissions.html" target="_blank" rel="noopener">&#x653F;&#x7B56;&#x8BB8;&#x53EF;</a></li><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/PolicyFiles.html" target="_blank" rel="noopener">&#x9ED8;&#x8BA4;&#x7B56;&#x7565;&#x5B9E;&#x73B0;&#x548C;&#x7B56;&#x7565;&#x6587;&#x4EF6;&#x8BED;&#x6CD5;</a></li><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/doprivileged.html" target="_blank" rel="noopener">API for Privileged Blocks</a></li><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/deploy/client-security.html" target="_blank" rel="noopener">&#x914D;&#x7F6E;java &#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x5B89;&#x5168;&#x7B49;&#x7EA7;</a></li><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/troubleshooting-security.html" target="_blank" rel="noopener">&#x5B89;&#x5168;&#x6545;&#x969C;&#x6392;&#x9664;</a></li></ul><h2>Java &#x8BA4;&#x8BC1;&#x548C;&#x6388;&#x6743;&#x670D;&#x52A1; (JAAS)</h2><ul class="ui list"><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/jaas/JAASRefGuide.html" target="_blank" rel="noopener">JAAS &#x53C2;&#x8003;&#x6307;&#x5357;</a></li><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/jaas/tutorials/index.html" target="_blank" rel="noopener">JAAS &#x6559;&#x7A0B;</a></li><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/jaas/JAASLMDevGuide.html" target="_blank" rel="noopener">JAAS &#x767B;&#x5F55;&#x6A21;&#x5757;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x6307;&#x5357;</a></li></ul><h2>Java &#x901A;&#x7528;&#x5B89;&#x5168;&#x670D;&#x52A1; (Java GSS-API)</h2><ul class="ui list"><li>Java GSS-API and JAAS Tutorials for Use with Kerberos</li><li>Single Sign-on Using Kerberos in Java</li><li>Java GSS Security Features</li><li>Java GSS Advanced Security Programming</li><li>The Kerberos 5 GSS-API Mechanism</li></ul><h2>Java PKCS#11 &#x53C2;&#x8003;&#x6307;&#x5357;</h2><ul class="ui list"><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/p11guide.html" target="_blank" rel="noopener">Java PKCS#11 Reference Guide</a></li></ul><h2>Java &#x5B89;&#x5168;&#x5957;&#x63A5;&#x5B57;&#x6269;&#x5C55; (JSSE)</h2><ul class="ui list"><li>JSSE &#x53C2;&#x8003;&#x6307;&#x5357;</li></ul><h2>&#x516C;&#x94A5;&#x57FA;&#x7840;&#x8BBE;&#x65BD; (PKI)</h2><ul class="ui list"><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/certpath/CertPathProgGuide.html" target="_blank" rel="noopener">Java PKI &#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x6307;&#x5357;</a></li><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/cert3.html" target="_blank" rel="noopener">X.509 &#x8BC1;&#x4E66;&#x548C;&#x8BC1;&#x4E66;&#x540A;&#x9500;&#x5217;&#x8868;</a></li></ul><h2>&#x7B80;&#x5355;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x548C;&#x5B89;&#x5168;&#x5C42; (SASL)</h2><ul class="ui list"><li>The Java SASL API &#x5F00;&#x53D1;&#x548C;&#x90E8;&#x7F72;&#x6307;&#x5357;</li></ul><h2>XML &#x7535;&#x5B50;&#x7B7E;&#x540D;</h2><ul class="ui list"><li>The XML Digital Signature API Specification</li><li>The XML Digital Signature API Reference and Tutorial</li></ul><h1>API &#x89C4;&#x8303;</h1><h2>&#x901A;&#x7528;</h2><ul class="ui list"><li>java.security Package</li><li>javax.crypto Package</li><li>java.security.cert Package</li><li>java.security.spec Package</li><li>javax.crypto.spec Package</li><li>java.security.interfaces Package</li><li>javax.crypto.interfaces Package</li><li>javax.rmi.ssl Package</li></ul><h2>&#x8BA4;&#x8BC1;</h2><ul class="ui list"><li>java.security.cert Package</li></ul><h2>JAAS</h2><ul class="ui list"><li>javax.security.auth Package</li><li>javax.security.auth.callback Package</li><li>javax.security.auth.kerberos Package</li><li>javax.security.auth.login Package</li><li>javax.security.auth.spi Package</li><li>javax.security.auth.x500 Package</li><li>com.sun.security.auth Package</li><li>com.sun.security.auth.callback Package</li><li>com.sun.security.auth.login Package</li><li>com.sun.security.auth.module Package</li></ul><h2>Java GSS-API</h2><ul class="ui list"><li>org.ietf.jgss Package</li><li>com.sun.security.jgss Package</li></ul><h2>JSSE</h2><ul class="ui list"><li>javax.net Package</li><li>javax.net.ssl Package</li><li>javax.security.cert Package (Denigrated, use java.security.cert instead)</li></ul><h2>Java SASL</h2><ul class="ui list"><li>javax.security.sasl Package</li></ul><h2>SSL/TLS-based RMI Socket Factories</h2><ul class="ui list"><li>javax.rmi.ssl Package</li></ul><h2>XML Digital Signature</h2><ul class="ui list"><li>javax.xml.crypto Package</li><li>javax.xml.crypto.dom Package</li><li>javax.xml.crypto.dsig Package</li><li>javax.xml.crypto.dsig.dom Package</li><li>javax.xml.crypto.dsig.keyinfo Package</li><li>javax.xml.crypto.dsig.spec Package</li></ul><h2>Smart Card I/O</h2><ul class="ui list"><li>javax.smartcardio Package</li></ul><h1>Tools</h1><ul class="ui list"><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/SecurityToolsSummary.html" target="_blank" rel="noopener">&#x5B89;&#x5168;&#x5DE5;&#x5177;&#x7B80;&#x4ECB;</a></li><li>keytool (<a href="http://docs.oracle.com/javase/8/docs/technotes/tools/unix/keytool.html" target="_blank" rel="noopener">Solaris, Linux or Mac OS X</a>) (<a href="http://docs.oracle.com/javase/8/docs/technotes/tools/windows/keytool.html" target="_blank" rel="noopener">Windows</a>)</li><li>jarsigner (for Solaris, Linux or Mac OS X) (for Windows)</li><li>policytool (for Solaris, Unix, or Mac OS X) (for Windows)</li><li>kinit (for Windows)</li><li>klist (for Windows)</li><li>ktab (for Windows)</li></ul><h1>&#x6559;&#x7A0B;</h1><ul class="ui list"><li><a href="http://docs.oracle.com/javase/tutorial/" target="_blank" rel="noopener">Java &#x6559;&#x7A0B;</a>&#x4E2D;&#x7684;<a href="http://docs.oracle.com/javase/tutorial/security/index.html" target="_blank" rel="noopener">Java SE &#x5B89;&#x5168;&#x7279;&#x6027;</a></li><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/jaas/tutorials/index.html" target="_blank" rel="noopener">JAAS &#x6559;&#x7A0B;</a></li><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/jgss/tutorials/index.html" target="_blank" rel="noopener">Java GSS-API and JAAS Tutorials for Use with Kerberos</a></li><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/PolicyGuide.html" target="_blank" rel="noopener">&#x653F;&#x7B56;&#x5DE5;&#x5177;&#x7528;&#x6237;&#x6307;&#x5357;</a></li></ul><h1>More Information</h1><ul class="ui list"><li>The Java SE Security Home Page</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&amp;#x539F;&amp;#x6587;&amp;#x5730;&amp;#x5740;&amp;#xFF1A;&lt;a href=&quot;http://docs.oracle.com/javase/8/docs/technotes/guides/security/index.html&quot; target=&quot;_blan
      
    
    </summary>
    
      <category term="java" scheme="https://yyhan.github.io/categories/java/"/>
    
    
      <category term="security" scheme="https://yyhan.github.io/tags/security/"/>
    
      <category term="jca" scheme="https://yyhan.github.io/tags/jca/"/>
    
  </entry>
  
  <entry>
    <title>OpenSSL 生成证书</title>
    <link href="https://yyhan.github.io/2017/06/29/OpenSSL-%E7%94%9F%E6%88%90%E8%AF%81%E4%B9%A6/"/>
    <id>https://yyhan.github.io/2017/06/29/OpenSSL-生成证书/</id>
    <published>2017-06-28T16:22:07.000Z</published>
    <updated>2017-06-28T17:01:46.024Z</updated>
    
    <content type="html"><![CDATA[<h1>&#x751F;&#x6210;&#x6839;&#x8BC1;&#x4E66;&#x548C;&#x670D;&#x52A1;&#x5668;&#x8BC1;&#x4E66;</h1><p>1&#x3001;&#x751F;&#x6210;&#x6839;&#x8BC1;&#x4E66;RSA&#x5BC6;&#x94A5;&#x5BF9;</p><p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out ca.key 2048</span><br></pre></td></tr></table></figure></p><p>2&#x3001;&#x751F;&#x6210;&#x81EA;&#x7B7E;&#x540D;&#x6839;&#x8BC1;&#x4E66;</p><p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -x509 -days 365 -key a.key -out a.csr</span><br></pre></td></tr></table></figure></p><p>3&#x3001;&#x8F6C;&#x6362;&#x8BC1;&#x4E66;&#x683C;&#x5F0F;&#xFF08;&#x975E;&#x5FC5;&#x987B;&#xFF09;<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -<span class="keyword">in</span> ca.csr -out ca.crt</span><br></pre></td></tr></table></figure></p><p>4&#x3001;&#x751F;&#x6210;&#x670D;&#x52A1;&#x5668;&#x8BC1;&#x4E66;RSA&#x5BC6;&#x94A5;&#x5BF9;&#xFF1A;<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out server.key 2048</span><br></pre></td></tr></table></figure></p><p>5&#x3001;&#x751F;&#x6210;&#x670D;&#x52A1;&#x5668;&#x8BC1;&#x4E66;&#x7B7E;&#x540D;&#x8BF7;&#x6C42;<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -sha256 -key server.key -out server.csr</span><br></pre></td></tr></table></figure></p><p>6&#x3001;&#x5BF9;&#x670D;&#x52A1;&#x5668;&#x8BC1;&#x4E66;&#x7B7E;&#x540D;<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -<span class="keyword">in</span> server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out server.crt -days 30 -sha256 -extfile v3.ext</span><br></pre></td></tr></table></figure></p><p><code>v3.ext</code> &#x6307;&#x5B9A;&#x57DF;&#x540D;&#x7B49;&#x4FE1;&#x606F;<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">authorityKeyIdentifier</span>=keyid,issuer</span><br><span class="line"><span class="attr">basicConstraints</span>=CA:<span class="literal">FALSE</span></span><br><span class="line"><span class="attr">keyUsage</span> = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment</span><br><span class="line"><span class="attr">subjectAltName</span> = @alt_names</span><br><span class="line"></span><br><span class="line"><span class="section">[alt_names]</span></span><br><span class="line">DNS.1 = it.jubaopay.com</span><br><span class="line">DNS.2 = b.jubaopay.com</span><br><span class="line">DNS.3 = oa.jubaopay.com</span><br></pre></td></tr></table></figure></p><p>&#x8C37;&#x6B4C;&#x6D4F;&#x89C8;&#x5668;&#x4F7F;&#x7528;<code>SAN (Subject Alternative Name)</code>&#x66FF;&#x4EE3;&#x4E86;<code>CN</code>&#x6765;&#x9A8C;&#x8BC1;&#x57DF;&#x540D;&#xFF0C;&#x6240;&#x4EE5;&#x5FC5;&#x987B;&#x8981;&#x8FD9;&#x6837;&#x641E;</p><p>7&#x3001;&#x8F6C;&#x6362;&#x8BC1;&#x4E66;&#x683C;&#x5F0F;&#xFF08;&#x975E;&#x5FC5;&#x987B;&#xFF09;<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -<span class="keyword">in</span> nginxCert.pem -out nginx.crt</span><br></pre></td></tr></table></figure></p><h1>&#x5E38;&#x7528;&#x547D;&#x4EE4;</h1><h2>&#x8BC1;&#x4E66;&#x683C;&#x5F0F;&#x8F6C;&#x6362;</h2><p>&#x8F6C;&#x6362;&#x8BC1;&#x4E66;&#x683C;&#x5F0F;&#xFF08;<code>pem -&gt; crt</code>&#xFF09;<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -<span class="keyword">in</span> server.pem -out server.crt</span><br></pre></td></tr></table></figure></p><p>&#x8F6C;&#x6362;&#x8BC1;&#x4E66;&#x683C;&#x5F0F;&#xFF08;<code>pem -&gt; key</code>&#xFF09;<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl rsa -<span class="keyword">in</span> server.pem -out server.key</span><br></pre></td></tr></table></figure></p><h2>&#x67E5;&#x770B;&#x8BC1;&#x4E66;&#x5185;&#x5BB9;</h2><p>&#x67E5;&#x770B;<code>crt</code>&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#xFF1A;<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -text -<span class="keyword">in</span> server.crt -noout</span><br></pre></td></tr></table></figure></p><p>&#x67E5;&#x770B;<code>csr</code>&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#xFF1A;<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -text -<span class="keyword">in</span> server.csr -noout</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1&gt;&amp;#x751F;&amp;#x6210;&amp;#x6839;&amp;#x8BC1;&amp;#x4E66;&amp;#x548C;&amp;#x670D;&amp;#x52A1;&amp;#x5668;&amp;#x8BC1;&amp;#x4E66;&lt;/h1&gt;
&lt;p&gt;1&amp;#x3001;&amp;#x751F;&amp;#x6210;&amp;#x6839;&amp;#x8BC
      
    
    </summary>
    
      <category term="工具使用" scheme="https://yyhan.github.io/categories/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/"/>
    
    
      <category term="openssl" scheme="https://yyhan.github.io/tags/openssl/"/>
    
      <category term="https" scheme="https://yyhan.github.io/tags/https/"/>
    
      <category term="ca" scheme="https://yyhan.github.io/tags/ca/"/>
    
      <category term="证书" scheme="https://yyhan.github.io/tags/%E8%AF%81%E4%B9%A6/"/>
    
  </entry>
  
  <entry>
    <title>CryptoJS 使用示例</title>
    <link href="https://yyhan.github.io/2017/06/27/CryptoJS-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B/"/>
    <id>https://yyhan.github.io/2017/06/27/CryptoJS-使用示例/</id>
    <published>2017-06-27T15:51:37.000Z</published>
    <updated>2017-06-27T16:17:57.211Z</updated>
    
    <content type="html"><![CDATA[<h1>&#x5B57;&#x7B26;&#x4E32;&#x7F16;&#x89E3;&#x7801;</h1><p>&#x6240;&#x6709;&#x7684;&#x7F16;&#x89E3;&#x7801;&#x5668;&#xFF0C;&#x90FD;&#x6709;<code>stringify(wordArray)</code>&#x548C;<code>parse(str)</code>&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#x3002;<code>stringify</code>&#x65B9;&#x6CD5;&#x7528;&#x4E8E;&#x5C06;<code>WordArray</code>&#x5BF9;&#x8C61;&#x8F6C;&#x6362;&#x4E3A;&#x76F8;&#x5E94;&#x7F16;&#x7801;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;<code>parse</code>&#x65B9;&#x6CD5;&#x7528;&#x4E8E;&#x89E3;&#x7801;&#x76EE;&#x6807;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;<code>WordArray</code>&#x5BF9;&#x8C61;&#x3002;</p><h2>Base64</h2><p>&#x5C06;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x8F6C;&#x6362;&#x4E3A;Base64&#x5B57;&#x7B26;&#x4E32;&#x65F6;&#xFF0C;&#x5FC5;&#x987B;&#x5148;&#x8F6C;&#x6362;&#x4E3A;<code>WordArray</code>&#x5BF9;&#x8C61;&#xFF0C;&#x518D;&#x8F6C;&#x6362;&#x4E3A;Base64&#x5B57;&#x7B26;&#x4E32;&#x3002;<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Base64 &#x57FA;&#x672C;&#x4F7F;&#x7528;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> plainTxt = <span class="string">&quot;hello base64&quot;</span>; <span class="comment">// &#x6D4B;&#x8BD5;&#x5B57;&#x7B26;&#x4E32;</span></span><br><span class="line"><span class="keyword">var</span> plainTxtToWA = CryptoJS.enc.Utf8.parse(plainTxt); <span class="comment">// &#x8F6C;&#x6362;&#x4E3A; WordArray</span></span><br><span class="line"><span class="keyword">var</span> base64Str = CryptoJS.enc.Base64.stringify(base64TestStrToWordArray); <span class="comment">// &#x8F6C;&#x6362;&#x4E3A;base64&#x5B57;&#x7B26;&#x4E32;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(plainTxt);</span><br><span class="line"><span class="built_in">console</span>.log(plainTxtToWA);</span><br><span class="line"><span class="built_in">console</span>.log(base64Str);</span><br></pre></td></tr></table></figure></p><h1>&#x6458;&#x8981;&#x7B97;&#x6CD5;</h1><h2>MD5</h2><p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> plainTxt = <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> md5Res = CryptoJS.MD5(plainTxt); <span class="comment">// MD5&#x7ED3;&#x679C;&#x662F;&#x4E00;&#x4E2A; CryptoJS.lib.WordArray &#x5BF9;&#x8C61;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(md5Res.toString()); <span class="comment">// WordArray.toString() &#x9ED8;&#x8BA4;&#x8F6C;&#x6362;&#x4E3A;hex&#x5B57;&#x7B26;&#x4E32;</span></span><br><span class="line"><span class="built_in">console</span>.log(md5Res.toString(CryptoJS.enc.Hex)); <span class="comment">// md5 &#x7ED3;&#x679C;&#x8F6C;&#x4E3A;hex&#x5B57;&#x7B26;&#x4E32;</span></span><br><span class="line"><span class="built_in">console</span>.log(md5Res.toString(CryptoJS.enc.Base64)); <span class="comment">// md5 &#x7ED3;&#x679C;&#x8F6C;&#x4E3A;base64&#x5B57;&#x7B26;&#x4E32;</span></span><br></pre></td></tr></table></figure></p><h1>&#x52A0;&#x89E3;&#x5BC6;</h1><h2>AES</h2><p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ciphertext = CryptoJS.AES.encrypt(</span><br><span class="line">    <span class="string">&apos;plain text&apos;</span>, <span class="comment">// &#x9700;&#x8981;&#x52A0;&#x5BC6;&#x7684;&#x660E;&#x6587;</span></span><br><span class="line">    <span class="string">&apos;secret key&apos;</span>, <span class="comment">// &#x52A0;&#x5BC6;&#x5BC6;&#x94A5;</span></span><br><span class="line">    {</span><br><span class="line">        mode: CBC, <span class="comment">// AES&#x5DE5;&#x4F5C;&#x6A21;&#x5F0F;, &#x9ED8;&#x8BA4; CBC</span></span><br><span class="line">        padding: Pkcs7, <span class="comment">// &#x586B;&#x5145;&#x65B9;&#x5F0F;, &#x9ED8;&#x8BA4; Pkcs7</span></span><br><span class="line">        iv: <span class="literal">null</span>  <span class="comment">// AES &#x5411;&#x91CF;</span></span><br><span class="line">    }</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1&gt;&amp;#x5B57;&amp;#x7B26;&amp;#x4E32;&amp;#x7F16;&amp;#x89E3;&amp;#x7801;&lt;/h1&gt;
&lt;p&gt;&amp;#x6240;&amp;#x6709;&amp;#x7684;&amp;#x7F16;&amp;#x89E3;&amp;#x7801;&amp;#x5668;&amp;#xFF0C;&amp;#x90FD;&amp;#x6709
      
    
    </summary>
    
      <category term="javascript" scheme="https://yyhan.github.io/categories/javascript/"/>
    
    
      <category term="CryptoJS" scheme="https://yyhan.github.io/tags/CryptoJS/"/>
    
      <category term="AES" scheme="https://yyhan.github.io/tags/AES/"/>
    
      <category term="BASE64" scheme="https://yyhan.github.io/tags/BASE64/"/>
    
      <category term="MD5" scheme="https://yyhan.github.io/tags/MD5/"/>
    
      <category term="SHA" scheme="https://yyhan.github.io/tags/SHA/"/>
    
  </entry>
  
  <entry>
    <title>CryptoJS 使用指南</title>
    <link href="https://yyhan.github.io/2017/06/27/CryptoJS-%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"/>
    <id>https://yyhan.github.io/2017/06/27/CryptoJS-使用指南/</id>
    <published>2017-06-27T14:12:56.000Z</published>
    <updated>2017-06-27T16:40:32.020Z</updated>
    
    <content type="html"><![CDATA[<p>CryptoJS &#x662F;&#x4E00;&#x4E2A;&#x5F00;&#x6E90;&#x7684;JavaScript&#x6807;&#x51C6;&#x5BC6;&#x7801;&#x5B66;&#x5E93;&#x3002;</p><h1>Node.js(install)</h1><p>&#x4F9D;&#x8D56;&#xFF1A;</p><ul class="ui list"><li>Node.js</li><li>npm</li></ul><p>&#x5B89;&#x88C5;&#x547D;&#x4EE4;&#xFF1A;<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install crypto-js</span><br></pre></td></tr></table></figure></p><h1>&#x4F7F;&#x7528;&#x793A;&#x4F8B;</h1><h2>ES6 &#x4E2D;&#x4F7F;&#x7528;</h2><p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sha256 <span class="keyword">from</span> <span class="string">&apos;crypto-js/sha256&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> hmacSHA512 <span class="keyword">from</span> <span class="string">&apos;crypto-js/hmac-sha512&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> Base64 <span class="keyword">from</span> <span class="string">&apos;crypto-js/enc-base64&apos;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> message, nonce, path, privateKey; <span class="comment">// ...</span></span><br><span class="line"><span class="keyword">const</span> hashDigest = sha256(nonce + message);</span><br><span class="line"><span class="keyword">const</span> hmacDigest = Base64.stringify(hmacSHA512(path + hashDigest, privateKey));</span><br></pre></td></tr></table></figure></p><h2>&#x5728;&#x6A21;&#x5757;&#x7CFB;&#x7EDF;&#x4E2D;&#x4F7F;&#x7528;</h2><p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> AES = <span class="built_in">require</span>(<span class="string">&quot;crypto-js/aes&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> SHA256 = <span class="built_in">require</span>(<span class="string">&quot;crypto-js/sha256&quot;</span>);</span><br><span class="line">...</span><br><span class="line"><span class="built_in">console</span>.log(SHA256(<span class="string">&quot;Message&quot;</span>));</span><br></pre></td></tr></table></figure></p><h2>&#x5BFC;&#x5165;&#x6240;&#x6709;&#x7684;&#x6A21;&#x5757;</h2><p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> CryptoJS = <span class="built_in">require</span>(<span class="string">&quot;crypto-js&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(CryptoJS.HmacSHA1(<span class="string">&quot;Message&quot;</span>, <span class="string">&quot;Key&quot;</span>));</span><br></pre></td></tr></table></figure></p><h2>&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x4F7F;&#x7528;</h2><p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;path-to/bower_components/crypto-js/crypto-js.js&quot;</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> encrypted = CryptoJS.AES(...);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> encrypted = CryptoJS.SHA256(...);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h1>API</h1><h2>&#x6587;&#x672C;&#x52A0;&#x89E3;&#x5BC6;</h2><p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> CryptoJS = <span class="built_in">require</span>(<span class="string">&quot;crypto-js&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Encrypt</span></span><br><span class="line"><span class="keyword">var</span> ciphertext = CryptoJS.AES.encrypt(<span class="string">&apos;my message&apos;</span>, <span class="string">&apos;secret key 123&apos;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Decrypt</span></span><br><span class="line"><span class="keyword">var</span> bytes  = CryptoJS.AES.decrypt(ciphertext.toString(), <span class="string">&apos;secret key 123&apos;</span>);</span><br><span class="line"><span class="keyword">var</span> plaintext = bytes.toString(CryptoJS.enc.Utf8);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(plaintext);</span><br></pre></td></tr></table></figure></p><h2>&#x5BF9;&#x8C61;&#x7C7B;&#x578B;&#x52A0;&#x89E3;&#x5BC6;</h2><p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> CryptoJS = <span class="built_in">require</span>(<span class="string">&quot;crypto-js&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> data = [{<span class="attr">id</span>: <span class="number">1</span>}, {<span class="attr">id</span>: <span class="number">2</span>}]</span><br><span class="line"></span><br><span class="line"><span class="comment">// Encrypt</span></span><br><span class="line"><span class="keyword">var</span> ciphertext = CryptoJS.AES.encrypt(<span class="built_in">JSON</span>.stringify(data), <span class="string">&apos;secret key 123&apos;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Decrypt</span></span><br><span class="line"><span class="keyword">var</span> bytes  = CryptoJS.AES.decrypt(ciphertext.toString(), <span class="string">&apos;secret key 123&apos;</span>);</span><br><span class="line"><span class="keyword">var</span> decryptedData = <span class="built_in">JSON</span>.parse(bytes.toString(CryptoJS.enc.Utf8));</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(decryptedData);</span><br></pre></td></tr></table></figure></p><h2>&#x5E93;&#x547D;&#x540D;&#x7A7A;&#x95F4;</h2><h3>Base</h3><p>&#x539F;&#x578B;&#x7EE7;&#x627F;&#x7684;&#x57FA;&#x7840;&#x5BF9;&#x8C61;&#x3002;CryptoJS&#x5E93;&#x4E2D;&#xFF0C;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x4E86;&#x4E00;&#x5957;&#x7EE7;&#x627F;&#x673A;&#x5236;&#x3002;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CryptoJS.lib.Base</span><br></pre></td></tr></table></figure></p><h3>WordArray</h3><p>&#x4E00;&#x4E2A;32&#x4F4D;&#x5B57;&#x7684;&#x6570;&#x7EC4;&#x3002;&#x7EE7;&#x627F;<code>Base</code>&#x3002;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CryptoJS.lib.WordArray</span><br></pre></td></tr></table></figure></p><p>&#x8F6C;&#x6362;&#x4E3A;&#x5B57;&#x7B26;&#x4E32;&#xFF1A;<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> string = wordArray + <span class="string">&apos;&apos;</span>;</span><br><span class="line"><span class="keyword">var</span> string = wordArray.toString();</span><br><span class="line"><span class="keyword">var</span> string = wordArray.toString(CryptoJS.enc.Utf8);</span><br></pre></td></tr></table></figure></p><p><code>toString()</code>&#x65B9;&#x6CD5;&#x6709;&#x4E00;&#x4E2A;<code>encoder</code>&#x53C2;&#x6570;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;<code>CryptoJS.enc.Hex</code>&#x3002;</p><h3>BufferedBlockAlgorithm</h3><p>&#x7F13;&#x51B2;&#x5757;&#x7B97;&#x6CD5;&#x62BD;&#x8C61;&#x6A21;&#x677F;&#x3002;&#x7EE7;&#x627F;<code>Base</code>&#x3002;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CryptoJS.lib.BufferedBlockAlgorithm</span><br></pre></td></tr></table></figure></p><h3>Hasher</h3><p>hash&#x7B97;&#x6CD5;&#x62BD;&#x8C61;&#x6A21;&#x677F;&#x3002;&#x7EE7;&#x627F;<code>BufferedBlockAlgorithm</code>&#x3002;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CryptoJS.lib.Hasher</span><br></pre></td></tr></table></figure></p><h2>&#x7F16;&#x7801;&#x5668;</h2><h3>Hex</h3><p>&#x63D0;&#x4F9B;16&#x8FDB;&#x5236;&#x7F16;&#x89E3;&#x7801;&#x652F;&#x6301;&#x3002;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CryptoJS.enc.Hex</span><br></pre></td></tr></table></figure></p><h3>Latin1</h3><p><code>ISO 8859-1</code>&#xFF0C;&#x6B63;&#x5F0F;&#x7F16;&#x53F7;&#x4E3A;<code>ISO/IEC 8859-1:1998</code>&#xFF0C;&#x53C8;&#x79F0;<code>Latin-1</code>&#x6216;<code>&#x201C;&#x897F;&#x6B27;&#x8BED;&#x8A00;&#x201D;</code>&#xFF0C;&#x662F;&#x56FD;&#x9645;&#x6807;&#x51C6;&#x5316;&#x7EC4;&#x7EC7;&#x5185;<code>ISO/IEC 8859</code>&#x7684;&#x7B2C;&#x4E00;&#x4E2A;<code>8&#x4F4D;&#x5B57;&#x7B26;&#x96C6;</code>&#x3002;&#x5B83;&#x4EE5;ASCII&#x4E3A;&#x57FA;&#x7840;&#xFF0C;&#x5728;&#x7A7A;&#x7F6E;&#x7684;<code>0xA0-0xFF</code>&#x7684;&#x8303;&#x56F4;&#x5185;&#xFF0C;&#x52A0;&#x5165;96&#x4E2A;&#x5B57;&#x6BCD;&#x53CA;&#x7B26;&#x53F7;&#xFF0C;&#x85C9;&#x4EE5;&#x4F9B;&#x4F7F;&#x7528;&#x9644;&#x52A0;&#x7B26;&#x53F7;&#x7684;&#x62C9;&#x4E01;&#x5B57;&#x6BCD;&#x8BED;&#x8A00;&#x4F7F;&#x7528;&#x3002;<a href="https://zh.wikipedia.org/wiki/ISO/IEC_8859-1" target="_blank" rel="noopener">&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;</a>&#x3002;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CryptoJS.enc.Hex</span><br></pre></td></tr></table></figure></p><h3>Utf8</h3><p>&#x63D0;&#x4F9B;UTF-8&#x7F16;&#x89E3;&#x7801;&#x652F;&#x6301;&#x3002;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CryptoJS.enc.Utf8</span><br></pre></td></tr></table></figure></p><h1>&#x6A21;&#x5757;&#x5217;&#x8868;</h1><h2>&#x6838;&#x5FC3;&#x6A21;&#x5757;</h2><ul class="ui list"><li><code>crypto-js/core</code></li><li><code>crypto-js/x64-core</code></li><li><code>crypto-js/lib-typedarrays</code></li></ul><h2>&#x54C8;&#x5E0C;&#x7B97;&#x6CD5;&#x6A21;&#x5757;</h2><ul class="ui list"><li><code>crypto-js/md5</code></li><li><code>crypto-js/sha1</code></li><li><code>crypto-js/sha256</code></li><li><code>crypto-js/sha224</code></li><li><code>crypto-js/sha512</code></li><li><code>crypto-js/sha384</code></li><li><code>crypto-js/sha3</code></li><li><code>crypto-js/ripemd160</code></li></ul><h2>HMAC&#x7B97;&#x6CD5;&#x6A21;&#x5757;</h2><ul class="ui list"><li><code>crypto-js/hmac-md5</code></li><li><code>crypto-js/hmac-sha1</code></li><li><code>crypto-js/hmac-sha256</code></li><li><code>crypto-js/hmac-sha224</code></li><li><code>crypto-js/hmac-sha512</code></li><li><code>crypto-js/hmac-sha384</code></li><li><code>crypto-js/hmac-sha3</code></li><li><code>crypto-js/hmac-ripemd160</code></li></ul><h2>PBKDF2&#x7B97;&#x6CD5;</h2><ul class="ui list"><li><code>crypto-js/pbkdf2</code></li></ul><h2>&#x52A0;&#x89E3;&#x5BC6;&#x6A21;&#x5757;</h2><ul class="ui list"><li><code>crypto-js/aes</code></li><li><code>crypto-js/tripledes</code></li><li><code>crypto-js/rc4</code></li><li><code>crypto-js/rabbit</code></li><li><code>crypto-js/rabbit-legacy</code></li><li><code>crypto-js/evpkdf</code></li></ul><h2>&#x683C;&#x5F0F;&#x5316;&#x6A21;&#x5757;</h2><ul class="ui list"><li><code>crypto-js/format-openssl</code></li><li><code>crypto-js/format-hex</code></li></ul><h2>&#x7F16;&#x89E3;&#x7801;&#x6A21;&#x5757;</h2><ul class="ui list"><li><code>crypto-js/enc-latin1</code></li><li><code>crypto-js/enc-utf8</code></li><li><code>crypto-js/enc-hex</code></li><li><code>crypto-js/enc-utf16</code></li><li><code>crypto-js/enc-base64</code></li></ul><h2>&#x5DE5;&#x4F5C;&#x6A21;&#x5F0F;&#x6A21;&#x5757;</h2><ul class="ui list"><li><code>crypto-js/mode-cfb</code></li><li><code>crypto-js/mode-ctr</code></li><li><code>crypto-js/mode-ctr-gladman</code></li><li><code>crypto-js/mode-ofb</code></li><li><code>crypto-js/mode-ecb</code></li></ul><h2>&#x586B;&#x5145;&#x65B9;&#x5F0F;&#x6A21;&#x5757;</h2><ul class="ui list"><li><code>crypto-js/pad-pkcs7</code></li><li><code>crypto-js/pad-ansix923</code></li><li><code>crypto-js/pad-iso10126</code></li><li><code>crypto-js/pad-iso97971</code></li><li><code>crypto-js/pad-zeropadding</code></li><li><code>crypto-js/pad-nopadding</code></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CryptoJS &amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x5F00;&amp;#x6E90;&amp;#x7684;JavaScript&amp;#x6807;&amp;#x51C6;&amp;#x5BC6;&amp;#x7801;&amp;#x5B66;&amp;#x5E93;&amp;#x3002;&lt;/p&gt;
&lt;h1&gt;Node.
      
    
    </summary>
    
      <category term="javascript" scheme="https://yyhan.github.io/categories/javascript/"/>
    
    
      <category term="CryptoJS" scheme="https://yyhan.github.io/tags/CryptoJS/"/>
    
      <category term="AES" scheme="https://yyhan.github.io/tags/AES/"/>
    
      <category term="BASE64" scheme="https://yyhan.github.io/tags/BASE64/"/>
    
      <category term="MD5" scheme="https://yyhan.github.io/tags/MD5/"/>
    
      <category term="SHA" scheme="https://yyhan.github.io/tags/SHA/"/>
    
  </entry>
  
  <entry>
    <title>java AES使用</title>
    <link href="https://yyhan.github.io/2017/06/26/java-AES%E4%BD%BF%E7%94%A8/"/>
    <id>https://yyhan.github.io/2017/06/26/java-AES使用/</id>
    <published>2017-06-26T12:59:59.000Z</published>
    <updated>2017-06-26T15:02:46.304Z</updated>
    
    <content type="html"><![CDATA[<p>java&#x63D0;&#x4F9B;AES&#x7B97;&#x6CD5;&#x652F;&#x6301;&#x3002;&#x652F;&#x6301;&#x7684;&#x5BC6;&#x94A5;&#x957F;&#x5EA6;&#x4E3A;&#xFF1A;<code>128, 192, &#x6216;256&#x4F4D;</code>&#x3002;&#x7531;&#x4E8E;&#x7F8E;&#x56FD;&#x8FDB;&#x51FA;&#x53E3;&#x9650;&#x5236;&#xFF0C;&#x9ED8;&#x8BA4;&#x7684;jre&#x53EA;&#x652F;&#x6301;<code>128</code>&#x4F4D;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;16&#x4E2A;&#x5B57;&#x8282;&#x7684;&#x5BC6;&#x94A5;&#x3002;</p><p>&#x652F;&#x6301;&#x7684;&#x5DE5;&#x4F5C;&#x6A21;&#x5F0F;&#xFF1A;</p><ul class="ui list"><li>NONE</li><li>CBC</li><li>CCM</li><li>CFB, CFBx</li><li>CTR</li><li>CTS</li><li>ECB</li><li>GCM</li><li>OFB, OFBx</li><li>PCBC</li></ul><p>&#x652F;&#x6301;&#x7684;&#x586B;&#x5145;&#x65B9;&#x5F0F;&#xFF1A;</p><ul class="ui list"><li>NoPadding</li><li>ISO10126Padding</li><li>OAEPPadding</li><li>PKCS1Padding</li><li>PKCS5Padding</li><li>SSL3Padding</li></ul><p>&#x5F53;&#x4F7F;&#x7528;<code>Cipher.getInstance(&quot;AES&quot;)</code>&#x65F6;&#xFF0C;&#x9ED8;&#x8BA4;&#x83B7;&#x53D6;&#x7684;&#x662F;<code>AES/ECB/PKCS5Padding</code>&#x5BF9;&#x5E94;&#x7684;&#x5B9E;&#x4F8B;&#x3002;&#x5B9E;&#x9645;&#x4F7F;&#x7528;&#x4E2D;&#x8FD9;&#x91CC;&#x4E00;&#x5B9A;&#x8981;&#x6CE8;&#x610F;&#x4E00;&#x4E0B;&#xFF0C;&#x5EFA;&#x8BAE;&#x5B9E;&#x9645;&#x5E94;&#x7528;&#x4E2D;&#x4E00;&#x5B9A;&#x8981;&#x663E;&#x793A;&#x6307;&#x5B9A;&#x5DE5;&#x4F5C;&#x6A21;&#x5F0F;&#x548C;&#x586B;&#x5145;&#x65B9;&#x5F0F;&#x3002;&#x82E5;&#x4E0D;&#x663E;&#x793A;&#x6307;&#x5B9A;&#xFF0C;&#x5728;&#x8DE8;&#x8BED;&#x8A00;&#x3001;&#x8DE8;&#x7C7B;&#x5E93;&#x6216;&#x8DE8;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x65F6;&#xFF0C;&#x5BB9;&#x6613;&#x8E29;&#x5751;&#x3002;</p><h1>java aes&#x793A;&#x4F8B;</h1><p>java &#x7248;&#x672C; &#xFF1A; 1.8&#x3002;<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cloudin.commons.security;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.BadPaddingException;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.IllegalBlockSizeException;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.NoSuchPaddingException;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.IvParameterSpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.security.InvalidAlgorithmParameterException;</span><br><span class="line"><span class="keyword">import</span> java.security.InvalidKeyException;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by YFHan on 2017/4/4 0004.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AESHelper</span> </span>{</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x7B97;&#x6CD5;&#x540D;&#x79F0;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ALGORITHM_NAME =<span class="string">&quot;AES&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * java aes &#x7B97;&#x6CD5;&#x9ED8;&#x8BA4;&#x5DE5;&#x4F5C;&#x6A21;&#x5F0F;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_MODE = <span class="string">&quot;ECB&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * java aes &#x7B97;&#x6CD5;&#x9ED8;&#x8BA4;&#x586B;&#x5145;&#x65B9;&#x5F0F;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_PADDING = <span class="string">&quot;PKCS5Padding&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * java aes &#x7B97;&#x6CD5;&#x9ED8;&#x8BA4;&#x7684;&#x5BC6;&#x7801;&#x5B9E;&#x4F8B;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_CHIPHER_INSTANCE = <span class="string">&quot;AES/ECB/PKCS5Padding&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x5BF9;&#x6307;&#x5B9A;&#x5185;&#x5BB9;&#x4F7F;&#x7528;&#x6307;&#x5B9A;&#x79D8;&#x94A5;&#x8FDB;&#x884C;AES(128)&#x52A0;&#x5BC6;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;&#x52A0;&#x5BC6;&#x540E;&#x7684;&#x5B57;&#x8282;&#x6570;&#x7EC4;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> content  &#x5F85;&#x52A0;&#x5BC6;&#x7684;&#x5185;&#x5BB9;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password &#x52A0;&#x5BC6;&#x79D8;&#x94A5;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] encrypt(<span class="keyword">byte</span>[] content, <span class="keyword">byte</span>[] password) {</span><br><span class="line">        Cipher cp = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            SecretKeySpec skeySpec = <span class="keyword">new</span> SecretKeySpec(password, ALGORITHM_NAME);</span><br><span class="line">            cp = Cipher.getInstance(DEFAULT_CHIPHER_INSTANCE); <span class="comment">// &#x7B97;&#x6CD5;/&#x6A21;&#x5F0F;/&#x586B;&#x5145;</span></span><br><span class="line">            cp.init(Cipher.ENCRYPT_MODE, skeySpec, <span class="keyword">new</span> IvParameterSpec(<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">16</span>]));</span><br><span class="line">            <span class="keyword">return</span> cp.doFinal(content);</span><br><span class="line"></span><br><span class="line">        } <span class="keyword">catch</span> (NoSuchAlgorithmException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">catch</span> (NoSuchPaddingException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">catch</span> (InvalidKeyException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">catch</span> (BadPaddingException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">catch</span> (IllegalBlockSizeException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">catch</span> (InvalidAlgorithmParameterException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x5BF9;&#x6307;&#x5B9A;&#x5185;&#x5BB9;&#x4F7F;&#x7528;&#x6307;&#x5B9A;&#x79D8;&#x94A5;&#x8FDB;&#x884C;AES(128)&#x89E3;&#x5BC6;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;&#x89E3;&#x5BC6;&#x540E;&#x7684;&#x5B57;&#x8282;&#x6570;&#x7EC4;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> content  &#x5F85;&#x89E3;&#x5BC6;&#x7684;&#x5185;&#x5BB9;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password &#x89E3;&#x5BC6;&#x79D8;&#x94A5;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] decrypt(<span class="keyword">byte</span>[] content, <span class="keyword">byte</span>[] password) {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            SecretKeySpec skeySpec = <span class="keyword">new</span> SecretKeySpec(password, ALGORITHM_NAME);</span><br><span class="line">            Cipher cp = Cipher.getInstance(DEFAULT_CHIPHER_INSTANCE); <span class="comment">// &#x7B97;&#x6CD5;/&#x6A21;&#x5F0F;/&#x586B;&#x5145;</span></span><br><span class="line">            cp.init(Cipher.DECRYPT_MODE, skeySpec, <span class="keyword">new</span> IvParameterSpec(<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">16</span>]));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> cp.doFinal(content);</span><br><span class="line">        } <span class="keyword">catch</span> (NoSuchAlgorithmException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">catch</span> (NoSuchPaddingException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">catch</span> (InvalidKeyException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">catch</span> (BadPaddingException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">catch</span> (IllegalBlockSizeException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">catch</span> (InvalidAlgorithmParameterException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p><h1>&#x5E38;&#x89C1;&#x95EE;&#x9898;</h1><h2>java aes&#x5BC6;&#x94A5;&#x957F;&#x5EA6;&#x9650;&#x5236;</h2><p>&#x7531;&#x4E8E;&#x7F8E;&#x56FD;&#x8FDB;&#x51FA;&#x53E3;&#x9650;&#x5236;&#xFF0C;jre&#x81EA;&#x5E26;&#x7684;aes&#x7B97;&#x6CD5;&#x9650;&#x5236;&#x4E86;&#x5BC6;&#x94A5;&#x957F;&#x5EA6;&#x4E3A;16&#x5B57;&#x8282;&#x3002;&#x8FD9;&#x65F6;&#x9700;&#x8981;&#x4F7F;&#x7528;JCE&#x65E0;&#x9650;&#x5236;&#x6743;&#x9650;&#x7B56;&#x7565;&#x7684;jar&#x5305;&#x8986;&#x76D6;jvm&#x81EA;&#x5E26;&#x7684;jar&#x5305;&#x3002;</p><p>&#x4E0B;&#x8F7D;&#x5730;&#x5740;: <a href="http://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html" target="_blank" rel="noopener">http://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html</a></p><h2>java &#x548C; js&#x4E92;&#x76F8;&#x52A0;&#x89E3;&#x5BC6;&#x95EE;&#x9898;</h2><p>java&#x548C;js&#x4E92;&#x76F8;&#x52A0;&#x89E3;&#x5BC6;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x6307;&#x5B9A;&#x5DE5;&#x4F5C;&#x6A21;&#x5F0F;&#x548C;&#x586B;&#x5145;&#x65B9;&#x5F0F;&#xFF0C;&#x4F1A;&#x5931;&#x8D25;&#x3002;&#x5728;js&#x4E2D;&#xFF0C;&#x4E00;&#x822C;&#x4F7F;&#x7528;<a href="https://github.com/brix/crypto-js" target="_blank" rel="noopener">crypto-js</a>&#x5E93;&#x6765;&#x52A0;&#x89E3;&#x5BC6;&#x3002;&#x4F46;&#x662F;&#x8BE5;&#x7C7B;&#x5E93;&#x9ED8;&#x8BA4;&#x7684;&#x5DE5;&#x4F5C;&#x6A21;&#x5F0F;&#x662F;<code>CBC</code>&#xFF0C;&#x9ED8;&#x8BA4;&#x586B;&#x5145;&#x65B9;&#x5F0F;<code>PKCS7</code>&#xFF0C;&#x4E0E;java&#x7684;&#x9ED8;&#x8BA4;&#x65B9;&#x5F0F;&#x4E0D;&#x4E00;&#x81F4;&#x3002;</p><p>&#x5F88;&#x591A;&#x540C;&#x5B66;&#x5728;&#x4F7F;&#x7528;AES&#x7B97;&#x6CD5;&#x65F6;&#xFF0C;&#x4E0D;&#x663E;&#x793A;&#x6307;&#x5B9A;&#x5DE5;&#x4F5C;&#x6A21;&#x5F0F;&#x548C;&#x586B;&#x5145;&#x65B9;&#x5F0F;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x5C31;&#x4F1A;&#x5C61;&#x5C61;&#x51FA;&#x9519;&#x3002;&#x95EE;&#x9898;&#x5C31;&#x51FA;&#x5728;java&#x548C;js&#xFF08;crypto-js&#xFF09;&#x9ED8;&#x8BA4;&#x7684;&#x5DE5;&#x4F5C;&#x6A21;&#x5F0F;&#x548C;&#x586B;&#x5145;&#x65B9;&#x5F0F;&#x4E0D;&#x4E00;&#x81F4;&#x3002;&#x8FD9;&#x91CC;&#x53EA;&#x8981;&#x5C06;&#x4E24;&#x8005;&#x7684;&#x5DE5;&#x4F5C;&#x6A21;&#x5F0F;&#x548C;&#x586B;&#x5145;&#x6307;&#x5B9A;&#x4E00;&#x6837;&#x5373;&#x53EF;&#x3002;</p><p>&#x63A8;&#x8350;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;&#xFF1A;js&#x91C7;&#x7528;<code>AES/CBC/ZeroPadding</code>&#x65B9;&#x5F0F;&#x52A0;&#x5BC6;&#x3002;&#x7531;&#x4E8E;java&#x6CA1;&#x6709;&#x63D0;&#x4F9B;<code>ZeroPadding</code>&#x586B;&#x5145;&#x65B9;&#x5F0F;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>AES/CBC/NoPadding</code>&#x65B9;&#x5F0F;&#x89E3;&#x5BC6;&#xFF0C;&#x89E3;&#x5BC6;&#x540E;&#x4ECE;&#x540E;&#x5F80;&#x524D;&#x4F9D;&#x6B21;&#x5254;&#x9664;<code>0x00</code>&#x7684;&#x5B57;&#x8282;&#xFF0C;&#x9047;&#x5230;&#x975E;<code>0x00</code>&#x7684;&#x5B57;&#x8282;&#x65F6;&#x505C;&#x6B62;&#x3002;&#x5269;&#x4E0B;&#x7684;&#x5B57;&#x8282;&#x5C31;&#x662F;&#x89E3;&#x5BC6;&#x540E;&#x7684;&#x7ED3;&#x679C;&#x3002;&#x4E0D;&#x8FC7;&#xFF0C;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x539F;&#x59CB;&#x6587;&#x672C;&#x8F6C;byte&#x6570;&#x7EC4;&#x540E;&#xFF0C;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5B57;&#x8282;&#x4E0D;&#x80FD;&#x662F;<code>0x00</code>&#x3002;&#x5982;&#x679C;&#x662F;java&#x52A0;&#x5BC6;&#xFF0C;js&#x89E3;&#x5BC6;&#xFF0C;&#x5C06;&#x8FC7;&#x7A0B;&#x53CD;&#x8FC7;&#x6765;&#x5373;&#x53EF;&#x3002;</p><h1>&#x53C2;&#x8003;</h1><ul class="ui list"><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html" target="_blank" rel="noopener">java&#x5BC6;&#x7801;&#x5B66;&#x4F53;&#x7CFB;&#x6807;&#x51C6;&#x7B97;&#x6CD5;&#x540D;&#x79F0;-jdk8</a></li><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/crypto/CryptoSpec.html" target="_blank" rel="noopener">java &#x5BC6;&#x7801;&#x5B66;&#x4F53;&#x7CFB;&#x6307;&#x5357;</a></li><li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/index.html" target="_blank" rel="noopener">java &#x5B89;&#x5168;&#x76F8;&#x5173;&#x6307;&#x5357;&#x7D22;&#x5F15;</a></li><li><a href="http://jaq.alibaba.com/community/art/show?articleid=209" target="_blank" rel="noopener">Android&#x5E94;&#x7528;&#x5B89;&#x5168;&#x5F00;&#x53D1;&#x4E4B;&#x6D45;&#x8C08;&#x52A0;&#x5BC6;&#x7B97;&#x6CD5;&#x7684;&#x5751;</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;java&amp;#x63D0;&amp;#x4F9B;AES&amp;#x7B97;&amp;#x6CD5;&amp;#x652F;&amp;#x6301;&amp;#x3002;&amp;#x652F;&amp;#x6301;&amp;#x7684;&amp;#x5BC6;&amp;#x94A5;&amp;#x957F;&amp;#x5EA6;&amp;#x4E3A;&amp;#xFF1A;&lt;c
      
    
    </summary>
    
      <category term="java" scheme="https://yyhan.github.io/categories/java/"/>
    
    
      <category term="java" scheme="https://yyhan.github.io/tags/java/"/>
    
      <category term="AES" scheme="https://yyhan.github.io/tags/AES/"/>
    
  </entry>
  
  <entry>
    <title>hessian 2.0 序列化协议</title>
    <link href="https://yyhan.github.io/2017/06/18/hessian-2-0-%E5%BA%8F%E5%88%97%E5%8C%96%E5%8D%8F%E8%AE%AE/"/>
    <id>https://yyhan.github.io/2017/06/18/hessian-2-0-序列化协议/</id>
    <published>2017-06-18T03:05:53.000Z</published>
    <updated>2017-06-26T16:42:05.615Z</updated>
    
    <content type="html"><![CDATA[<p>Hessian 2.0 &#x5E8F;&#x5217;&#x5316;&#x534F;&#x8BAE;&#x7FFB;&#x8BD1;&#xFF0C;&#x539F;&#x6587;&#x94FE;&#x63A5;<a href="http://hessian.caucho.com/doc/hessian-serialization.html" target="_blank" rel="noopener">http://hessian.caucho.com/doc/hessian-serialization.html</a></p><h1>&#x4ECB;&#x7ECD;</h1><p>Hessian&#x662F;&#x4E00;&#x79CD;&#x52A8;&#x6001;&#x7C7B;&#x578B;&#x7684;&#x3001;&#x91C7;&#x7528;&#x4E8C;&#x8FDB;&#x5236;&#x5E8F;&#x5217;&#x5316;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x88AB;&#x8BBE;&#x8BA1;&#x4E3A;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x4F20;&#x8F93;&#x7684;Web&#x670D;&#x52A1;&#x534F;&#x8BAE;&#x3002;</p><h1>&#x8BBE;&#x8BA1;&#x76EE;&#x6807;</h1><p>Hessian&#x662F;&#x52A8;&#x6001;&#x7C7B;&#x578B;&#x7684;&#xFF0C;&#x7D27;&#x51D1;&#x7684;&#xFF0C;&#x53EF;&#x8DE8;&#x8BED;&#x8A00;&#x79FB;&#x690D;&#x7684;&#x3002;</p><p>Hessian&#x534F;&#x8BAE;&#x6709;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;:</p><ul class="ui list"><li>It must self-describe the serialized types, i.e. not require external schema or interface definitions.</li><li>It must be language-independent, including supporting scripting languages.</li><li>It must be readable or writable in a single pass.</li><li>It must be as compact as possible.</li><li>It must be simple so it can be effectively tested and implemented.</li><li>It must be as fast as possible.</li><li>It must support Unicode strings.</li><li>It must support 8-bit binary data without escaping or using attachments.</li><li>It must support encryption, compression, signature, and transaction context envelopes.</li></ul><h1>Hessian &#x8BED;&#x6CD5;</h1><h2>&#x5E8F;&#x5217;&#x5316;&#x8BED;&#x6CD5;</h2><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">           # starting production</span><br><span class="line">top        ::= value</span><br><span class="line"></span><br><span class="line">           # 8-bit binary data split into 64k chunks</span><br><span class="line">binary     ::= x41 b1 b0 &lt;binary-data&gt; binary # non-final chunk</span><br><span class="line">           ::= &apos;B&apos; b1 b0 &lt;binary-data&gt;        # final chunk</span><br><span class="line">           ::= [x20-x2f] &lt;binary-data&gt;        # binary data of</span><br><span class="line">                                                 #  length 0-15</span><br><span class="line">           ::= [x34-x37] &lt;binary-data&gt;        # binary data of</span><br><span class="line">                                                 #  length 0-1023</span><br><span class="line"></span><br><span class="line">           # boolean true/false</span><br><span class="line">boolean    ::= &apos;T&apos;</span><br><span class="line">           ::= &apos;F&apos;</span><br><span class="line"></span><br><span class="line">           # definition for an object (compact map)</span><br><span class="line">class-def  ::= &apos;C&apos; string int string*</span><br><span class="line"></span><br><span class="line">           # time in UTC encoded as 64-bit long milliseconds since</span><br><span class="line">           #  epoch</span><br><span class="line">date       ::= x4a b7 b6 b5 b4 b3 b2 b1 b0</span><br><span class="line">           ::= x4b b3 b2 b1 b0       # minutes since epoch</span><br><span class="line"></span><br><span class="line">           # 64-bit IEEE double</span><br><span class="line">double     ::= &apos;D&apos; b7 b6 b5 b4 b3 b2 b1 b0</span><br><span class="line">           ::= x5b                   # 0.0</span><br><span class="line">           ::= x5c                   # 1.0</span><br><span class="line">           ::= x5d b0                # byte cast to double</span><br><span class="line">                                     #  (-128.0 to 127.0)</span><br><span class="line">           ::= x5e b1 b0             # short cast to double</span><br><span class="line">           ::= x5f b3 b2 b1 b0       # 32-bit float cast to double</span><br><span class="line"></span><br><span class="line">           # 32-bit signed integer</span><br><span class="line">int        ::= &apos;I&apos; b3 b2 b1 b0</span><br><span class="line">           ::= [x80-xbf]             # -x10 to x3f</span><br><span class="line">           ::= [xc0-xcf] b0          # -x800 to x7ff</span><br><span class="line">           ::= [xd0-xd7] b1 b0       # -x40000 to x3ffff</span><br><span class="line"></span><br><span class="line">           # list/vector</span><br><span class="line">list       ::= x55 type value* &apos;Z&apos;   # variable-length list</span><br><span class="line">   ::= &apos;V&apos; type int value*   # fixed-length list</span><br><span class="line">           ::= x57 value* &apos;Z&apos;        # variable-length untyped list</span><br><span class="line">           ::= x58 int value*        # fixed-length untyped list</span><br><span class="line">   ::= [x70-77] type value*  # fixed-length typed list</span><br><span class="line">   ::= [x78-7f] value*       # fixed-length untyped list</span><br><span class="line"></span><br><span class="line">           # 64-bit signed long integer</span><br><span class="line">long       ::= &apos;L&apos; b7 b6 b5 b4 b3 b2 b1 b0</span><br><span class="line">           ::= [xd8-xef]             # -x08 to x0f</span><br><span class="line">           ::= [xf0-xff] b0          # -x800 to x7ff</span><br><span class="line">           ::= [x38-x3f] b1 b0       # -x40000 to x3ffff</span><br><span class="line">           ::= x59 b3 b2 b1 b0       # 32-bit integer cast to long</span><br><span class="line"></span><br><span class="line">           # map/object</span><br><span class="line">map        ::= &apos;M&apos; type (value value)* &apos;Z&apos;  # key, value map pairs</span><br><span class="line">   ::= &apos;H&apos; (value value)* &apos;Z&apos;       # untyped key, value</span><br><span class="line"></span><br><span class="line">           # null value</span><br><span class="line">null       ::= &apos;N&apos;</span><br><span class="line"></span><br><span class="line">           # Object instance</span><br><span class="line">object     ::= &apos;O&apos; int value*</span><br><span class="line">   ::= [x60-x6f] value*</span><br><span class="line"></span><br><span class="line">           # value reference (e.g. circular trees and graphs)</span><br><span class="line">ref        ::= x51 int            # reference to nth map/list/object</span><br><span class="line"></span><br><span class="line">           # UTF-8 encoded character string split into 64k chunks</span><br><span class="line">string     ::= x52 b1 b0 &lt;utf8-data&gt; string  # non-final chunk</span><br><span class="line">           ::= &apos;S&apos; b1 b0 &lt;utf8-data&gt;         # string of length</span><br><span class="line">                                             #  0-65535</span><br><span class="line">           ::= [x00-x1f] &lt;utf8-data&gt;         # string of length</span><br><span class="line">                                             #  0-31</span><br><span class="line">           ::= [x30-x34] &lt;utf8-data&gt;         # string of length</span><br><span class="line">                                             #  0-1023</span><br><span class="line"></span><br><span class="line">           # map/list types for OO languages</span><br><span class="line">type       ::= string                        # type name</span><br><span class="line">           ::= int                           # type reference</span><br><span class="line"></span><br><span class="line">           # main production</span><br><span class="line">value      ::= null</span><br><span class="line">           ::= binary</span><br><span class="line">           ::= boolean</span><br><span class="line">           ::= class-def value</span><br><span class="line">           ::= date</span><br><span class="line">           ::= double</span><br><span class="line">           ::= int</span><br><span class="line">           ::= list</span><br><span class="line">           ::= long</span><br><span class="line">           ::= map</span><br><span class="line">           ::= object</span><br><span class="line">           ::= ref</span><br><span class="line">           ::= string</span><br></pre></td></tr></table></figure></p><h1>&#x5E8F;&#x5217;&#x5316;</h1><p>Hessian&#x7684;&#x5BF9;&#x8C61;&#x5E8F;&#x5217;&#x5316;&#x6709;8&#x4E2A;&#x539F;&#x59CB;&#x7C7B;&#x578B;:</p><ul class="ui list"><li>raw binary data</li><li>boolean</li><li>64-bit millisecond date</li><li>64-bit double</li><li>32-bit int</li><li>64-bit long</li><li>null</li><li>UTF8-encoded string</li></ul><p>&#x5B83;&#x6709;3&#x4E2A;&#x9012;&#x5F52;&#x7C7B;&#x578B;:</p><ul class="ui list"><li>list for lists and arrays</li><li>map for maps and dictionaries</li><li>object for objects</li></ul><p>&#x6700;&#x540E;&#xFF0C;&#x5B83;&#x6709;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x7684;&#x6784;&#x9020;:</p><ul class="ui list"><li>ref for shared and circular object references.</li></ul><p>Hessian 2.0 &#x6709;&#x4E09;&#x4E2A;&#x5185;&#x7F6E;&#x5F15;&#x7528;&#x7C7B;&#x578B;&#x6620;&#x5C04;:</p><ul class="ui list"><li>An object/list reference map.</li><li>An class definition reference map.</li><li>A type (class name) reference map.</li></ul><h2>&#x4E8C;&#x8FDB;&#x5236;&#x6570;&#x636E;</h2><p>&#x4E8C;&#x8FDB;&#x5236;&#x6570;&#x636E;&#x8BED;&#x6CD5;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">binary ::= b b1 b0 &lt;binary-data&gt; binary</span><br><span class="line">       ::= B b1 b0 &lt;binary-data&gt;</span><br><span class="line">       ::= [x20-x2f] &lt;binary-data&gt;</span><br></pre></td></tr></table></figure></p><p>&#x4E8C;&#x8FDB;&#x5236;&#x6570;&#x636E;&#x4F7F;&#x7528;&#x5757;&#x7F16;&#x7801;&#x3002;&#x516B;&#x8FDB;&#x5236; <code>0x42(&apos;B&apos;)</code>&#x7F16;&#x7801;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5757;&#xFF0C;<code>0x62(&apos;b&apos;)</code>&#x8868;&#x793A;&#x9664;&#x4E86;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5757;&#x4EE5;&#x5916;&#x7684;&#x5757;&#x3002;&#x6BCF;&#x4E2A;&#x5757;&#x90FD;&#x6709;&#x4E00;&#x4E2A;16&#x4F4D;&#x7684;&#x957F;&#x5EA6;&#x503C;&#x3002;&#x957F;&#x5EA6;&#x503C;&#x516C;&#x5F0F;&#xFF1A;</p><p>len = 256 * b1 + b0</p><h3>&#x538B;&#x7F29;&#x77ED;&#x4E8C;&#x8FDB;&#x5236;</h3><p>&#x957F;&#x5EA6;&#x5C0F;&#x4E8E;15&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x6570;&#x636E;&#x91C7;&#x7528;&#x4E00;&#x4E2A;&#x516B;&#x8FDB;&#x5236;&#x6570;&#x636E;&#x8868;&#x793A;&#x957F;&#x5EA6;&#xFF0C;&#x8BE5;&#x516B;&#x8FDB;&#x5236;&#x6570;&#x636E;&#x53D6;&#x503C;&#x8303;&#x56F4;&#xFF1A;[x20-x2f]&#xFF0C;&#x957F;&#x5EA6;&#x503C;&#x516C;&#x5F0F;&#xFF1A;</p><p>len = code - 0x20</p><h3>&#x4E8C;&#x8FDB;&#x5236;&#x793A;&#x4F8B;</h3><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">x20               # 0&#x957F;&#x5EA6;&#x4E8C;&#x8FDB;&#x5236;&#x6570;&#x636E;</span><br><span class="line"></span><br><span class="line">x23 x01 x02 x03   # 3&#x4E2A;&#x516B;&#x5B57;&#x8282;&#x6570;&#x636E;</span><br><span class="line"></span><br><span class="line">B x10 x00 ....    # 4k &#x7ED3;&#x5C3E;&#x6570;&#x636E;&#x5757;</span><br><span class="line"></span><br><span class="line">b x04 x00 ....    # 1k &#x975E;&#x7ED3;&#x5C3E;&#x6570;&#x636E;&#x5757;</span><br></pre></td></tr></table></figure></p><h2>boolean</h2><p>Boolean&#x8BED;&#x6CD5;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">boolean ::= T</span><br><span class="line">        ::= F</span><br></pre></td></tr></table></figure></p><p>&#x5B57;&#x8282; <code>&apos;F&apos;</code> &#x8868;&#x793A;<code>false</code>&#xFF0C;&#x5B57;&#x8282; <code>&apos;T&apos;</code> &#x8868;&#x793A;<code>true</code></p><h3>Boolean &#x793A;&#x4F8B;</h3><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">T   # true</span><br><span class="line">F   # false</span><br></pre></td></tr></table></figure></p><h2>date</h2><p>Date &#x8BED;&#x6CD5;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">date ::= x4a b7 b6 b5 b4 b3 b2 b1 b0</span><br><span class="line">     ::= x4b b4 b3 b2 b1 b0</span><br></pre></td></tr></table></figure></p><p>&#x65E5;&#x671F;&#x7C7B;&#x578B;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;64&#x4F4D;&#x7684;<code>long</code>&#x6570;&#x503C;&#x8868;&#x793A;&#x4ECE;<code>1970-01-01 00:00:00</code>&#x4EE5;&#x6765;&#x7ECF;&#x8FC7;&#x7684;&#x6BEB;&#x79D2;&#x6570;&#x3002;</p><h3>&#x538B;&#x7F29;&#xFF1A;&#x4F7F;&#x7528;&#x5206;&#x949F;&#x8868;&#x793A;&#x65E5;&#x671F;</h3><p>&#x7B2C;&#x4E8C;&#x79CD;&#x65B9;&#x5F0F;&#x662F;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;32&#x4F4D;&#x7684;<code>int</code>&#x6570;&#x503C;&#x8868;&#x793A;&#x4ECE;<code>1970-01-01 00:00</code>&#x4EE5;&#x6765;&#x7ECF;&#x8FC7;&#x7684;&#x5206;&#x949F;&#x6570;&#x3002;</p><h3>&#x65E5;&#x671F; &#x793A;&#x4F8B;</h3><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x4a x00 x00 x00 xd0 x4b x92 x84 xb8   # 09:51:31 1998&#x5E74;5&#x6708;8&#x65E5;UTC</span><br><span class="line"></span><br><span class="line">x4b x4b x92 x0b xa0                   # 09:51:00 1998&#x5E74;5&#x6708;8&#x65E5;UTC</span><br></pre></td></tr></table></figure></p><h2>double</h2><p>Double &#x8BED;&#x6CD5;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">double ::= D b7 b6 b5 b4 b3 b2 b1 b0</span><br><span class="line">       ::= x5b</span><br><span class="line">       ::= x5c</span><br><span class="line">       ::= x5d b0</span><br><span class="line">       ::= x5e b1 b0</span><br><span class="line">       ::= x5f b3 b2 b1 b0</span><br></pre></td></tr></table></figure></p><p>&#x4E00;&#x4E2A;64&#x4F4D;&#x7684;IEEE&#x6807;&#x51C6;&#x7684;&#x6D6E;&#x70B9;&#x6570;&#x3002;</p><h3>&#x538B;&#x7F29;&#xFF1A;double zero</h3><p>double&#x7C7B;&#x578B;&#x7684;<code>0.0</code>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5B57;&#x8282;<code>x5b</code>&#x8868;&#x793A;&#x3002;</p><h3>&#x538B;&#x7F29;&#xFF1A;double one</h3><p>double&#x7C7B;&#x578B;&#x7684;<code>1.0</code>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5B57;&#x8282;<code>x5c</code>&#x8868;&#x793A;&#x3002;</p><h3>&#x538B;&#x7F29;: double octet</h3><p>&#x4ECB;&#x4E8E;<code>-128.0</code> &#x548C; <code>127.0</code> &#x4E4B;&#x95F4;&#xFF0C;&#x4E14;&#x6CA1;&#x6709;&#x5C0F;&#x6570;&#x90E8;&#x5206;&#x7684;double&#x6570;&#x503C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E24;&#x4E2A;&#x5B57;&#x8282;&#x8868;&#x793A;&#x3002;&#x8F6C;&#x6362;&#x516C;&#x5F0F;&#xFF1A;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value = (double) b0</span><br></pre></td></tr></table></figure></p><h3>&#x538B;&#x7F29;: double short</h3><p>&#x4ECB;&#x4E8E;<code>-32768.0</code> &#x548C; <code>32767.0</code> &#x4E4B;&#x95F4;&#xFF0C;&#x4E14;&#x6CA1;&#x6709;&#x5C0F;&#x6570;&#x90E8;&#x5206;&#x7684;double&#x6570;&#x503C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E09;&#x4E2A;&#x5B57;&#x8282;&#x8868;&#x793A;&#x3002;&#x8F6C;&#x6362;&#x516C;&#x5F0F;&#xFF1A;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value = (double) (256 * b1 + b0)</span><br></pre></td></tr></table></figure></p><h3>&#x538B;&#x7F29;: double float</h3><p>Doubles which are equivalent to their 32-bit float representation can be represented as the 4-octet float and then cast to double.</p><h3>Double &#x793A;&#x4F8B;</h3><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">x5b          # 0.0</span><br><span class="line">x5c          # 1.0</span><br><span class="line"></span><br><span class="line">x5d x00      # 0.0</span><br><span class="line">x5d x80      # -128.0</span><br><span class="line">x5d x7f      # 127.0</span><br><span class="line"></span><br><span class="line">x5e x00 x00  # 0.0</span><br><span class="line">x5e x80 x00  # -32768.0</span><br><span class="line">x5e x7f xff  # 32767.0</span><br><span class="line"></span><br><span class="line">D x40 x28 x80 x00 x00 x00 x00 x00  # 12.25</span><br></pre></td></tr></table></figure></p><h2>int</h2><p>Integer &#x8BED;&#x6CD5;&#xFF1A;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int ::= &apos;I&apos; b3 b2 b1 b0</span><br><span class="line">    ::= [x80-xbf]</span><br><span class="line">    ::= [xc0-xcf] b0</span><br><span class="line">    ::= [xd0-xd7] b1 b0</span><br></pre></td></tr></table></figure></p><p>A 32-bit signed integer. An integer is represented by the octet x49 (&apos;I&apos;) followed by the 4 octets of the integer in big-endian order.</p><p>value = (b3 &lt;&lt; 24) + (b2 &lt;&lt; 16) + (b1 &lt;&lt; 8) + b0;</p><h3>&#x538B;&#x7F29;&#xFF1A;&#x5355;&#x5B57;&#x8282;&#x6574;&#x6570;</h3><p>&#x4ECB;&#x4E8E;<code>-16</code> &#x548C; <code>47</code> &#x4E4B;&#x95F4;&#x7684;&#x6574;&#x6570;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5355;&#x4E2A;&#x4F4D;&#x4E8E;<code>[x80, xbf]</code>&#x8303;&#x56F4;&#x5185;&#x7684;&#x5B57;&#x8282;&#x8868;&#x793A;&#x3002;&#x8F6C;&#x6362;&#x516C;&#x5F0F;&#xFF1A;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value = code - 0x90</span><br></pre></td></tr></table></figure></p><h3>&#x538B;&#x7F29;&#xFF1A;&#x53CC;&#x5B57;&#x8282;&#x6574;&#x6570;</h3><p>&#x4ECB;&#x4E8E;<code>-2048</code> &#x548C; <code>2047</code> &#x4E4B;&#x95F4;&#x7684;&#x6574;&#x6570;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E24;&#x4E2A;&#x5B57;&#x8282;&#x8868;&#x793A;&#xFF0C;&#x9996;&#x5B57;&#x8282;&#x4F4D;&#x4E8E;<code>[xc0, xcf]</code>&#x8303;&#x56F4;&#x5185;&#x3002;&#x8F6C;&#x6362;&#x516C;&#x5F0F;&#xFF1A;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value = ((code - 0xc8) &lt;&lt; 8) + b0;</span><br></pre></td></tr></table></figure></p><h3>&#x538B;&#x7F29;&#xFF1A;&#x4E09;&#x5B57;&#x8282;&#x6574;&#x6570;</h3><p>&#x4ECB;&#x4E8E;<code>-262144</code> &#x548C; <code>262143</code> &#x4E4B;&#x95F4;&#x7684;&#x6574;&#x6570;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E09;&#x4E2A;&#x5B57;&#x8282;&#x8868;&#x793A;&#xFF0C;&#x9996;&#x5B57;&#x8282;&#x4F4D;&#x4E8E;<code>[xd0, xd7]</code>&#x8303;&#x56F4;&#x5185;&#x3002;&#x8F6C;&#x6362;&#x516C;&#x5F0F;&#xFF1A;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value = ((code - 0xd4) &lt;&lt; 16) + (b1 &lt;&lt; 8) + b0;</span><br></pre></td></tr></table></figure></p><h3>Integer &#x793A;&#x4F8B;</h3><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">x90                # 0</span><br><span class="line">x80                # -16</span><br><span class="line">xbf                # 47</span><br><span class="line"></span><br><span class="line">xc8 x00            # 0</span><br><span class="line">xc0 x00            # -2048</span><br><span class="line">xc7 x00            # -256</span><br><span class="line">xcf xff            # 2047</span><br><span class="line"></span><br><span class="line">xd4 x00 x00        # 0</span><br><span class="line">xd0 x00 x00        # -262144</span><br><span class="line">xd7 xff xff        # 262143</span><br><span class="line"></span><br><span class="line">I x00 x00 x00 x00  # 0</span><br><span class="line">I x00 x00 x01 x2c  # 300</span><br></pre></td></tr></table></figure></p><h2>list</h2><p>List &#x8BED;&#x6CD5;</p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">list ::= x55 type value* &apos;Z&apos;   # variable-length list</span><br><span class="line">     ::= &apos;V&apos; type int value*   # fixed-length list</span><br><span class="line">     ::= x57 value* &apos;Z&apos;        # variable-length untyped list</span><br><span class="line">     ::= x58 int value*        # fixed-length untyped list</span><br><span class="line">     ::= [x70-77] type value*  # fixed-length typed list</span><br><span class="line">     ::= [x78-7f] value*       # fixed-length untyped list</span><br></pre></td></tr></table></figure></p><p>An ordered list, like an array. The two list productions are a fixed-length list and a variable length list. Both lists have a type. The type string may be an arbitrary UTF-8 string understood by the service.</p><p>Each list item is added to the reference list to handle shared and circular elements. See the ref element.</p><p>Any parser expecting a list must also accept a null or a shared ref.</p><p>The valid values of type are not specified in this document and may depend on the specific application. For example, a server implemented in a language with static typing which exposes an Hessian interface can use the type information to instantiate the specific array type. On the other hand, a server written in a dynamicly-typed language would likely ignore the contents of type entirely and create a generic array.</p><h3>Compact: fixed length list</h3><p>Hessian 2.0 allows a compact form of the list for successive lists of the same type where the length is known beforehand. The type and length are encoded by integers, where the type is a reference to an earlier specified type.</p><h3>List &#x793A;&#x4F8B;</h3><p>&#x5E8F;&#x5217;&#x5316;&#x4E00;&#x4E2A;&#x6574;&#x6570;&#x6570;&#x7EC4;: int[] = {0, 1}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">V                    # fixed length, typed list</span><br><span class="line">  x04 [int           # encoding of int[] type</span><br><span class="line">  x92                # length = 2</span><br><span class="line">  x90                # integer 0</span><br><span class="line">  x91                # integer 1</span><br></pre></td></tr></table></figure></p><p>&#x53EF;&#x53D8;&#x957F;&#x5EA6;&#xFF0C;&#x65E0;&#x7C7B;&#x578B;&#xFF1A; list = {0, 1}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x57                  # variable-length, untyped</span><br><span class="line">  x90                # integer 0</span><br><span class="line">  x91                # integer 1</span><br><span class="line">  Z</span><br></pre></td></tr></table></figure></p><p>&#x56FA;&#x5B9A;&#x957F;&#x5EA6;&#xFF0C;&#x9650;&#x5236;&#x7C7B;&#x578B;&#xFF1A;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">x72                # typed list length=2</span><br><span class="line">  x04 [int         # type for int[] (save as type #0)</span><br><span class="line">  x90              # integer 0</span><br><span class="line">  x91              # integer 1</span><br><span class="line"></span><br><span class="line">x73                # typed list length = 3</span><br><span class="line">  x90              # type reference to int[] (integer #0)</span><br><span class="line">  x92              # integer 2</span><br><span class="line">  x93              # integer 3</span><br><span class="line">  x94              # integer 4</span><br></pre></td></tr></table></figure></p><h2>long</h2><p>Long &#x8BED;&#x6CD5;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">long ::= L b7 b6 b5 b4 b3 b2 b1 b0</span><br><span class="line">     ::= [xd8-xef]</span><br><span class="line">     ::= [xf0-xff] b0</span><br><span class="line">     ::= [x38-x3f] b1 b0</span><br><span class="line">     ::= x4c b3 b2 b1 b0</span><br></pre></td></tr></table></figure></p><p>A 64-bit signed integer. An long is represented by the octet x4c (&apos;L&apos; ) followed by the 8-bytes of the integer in big-endian order.</p><p>64&#x4F4D;&#x6709;&#x7B26;&#x53F7;&#x7684;&#x6574;&#x6570;&#x3002;&#x4E00;&#x4E2A;long&#x7C7B;&#x578B;&#x6570;&#x503C;&#x4F7F;&#x7528;&#x5B57;&#x8282;<code>0x4c(&apos;L&apos;)</code>&#x5F00;&#x5934;&#xFF0C;&#x540E;&#x9762;&#x8DDF;&#x7740;8&#x4E2A;&#x5B57;&#x8282;&#x7684;&#x5927;&#x7AEF;&#x6574;&#x6570;&#x8868;&#x793A;&#x3002;</p><h3>&#x538B;&#x7F29;&#xFF1A;&#x5355;&#x5B57;&#x8282;long</h3><p>Longs between -8 and 15 are represented by a single octet in the range xd8 to xef.</p><p>&#x4ECB;&#x4E8E;<code>-8</code>&#x5230;<code>15</code>&#x4E4B;&#x95F4;&#x7684;long&#x7C7B;&#x578B;&#xFF0C;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x53D6;&#x503C;&#x8303;&#x56F4;&#x5728;<code>[0xd8, 0xef]</code>&#x7684;&#x516B;&#x8FDB;&#x5236;&#x8868;&#x793A;&#x3002;&#x8F6C;&#x6362;&#x516C;&#x5F0F;&#xFF1A;</p><p>value = (code - 0xe0)</p><h3>&#x538B;&#x7F29;&#xFF1A;&#x53CC;&#x5B57;&#x8282;long</h3><p>Longs between -2048 and 2047 are encoded in two octets with the leading byte in the range xf0 to xff.</p><p>&#x4ECB;&#x4E8E;<code>-2048</code>&#x5230;<code>2047</code>&#x4E4B;&#x95F4;&#x7684;long&#x7C7B;&#x578B;&#xFF0C;&#x4F7F;&#x7528;&#x4E24;&#x4E2A;&#x516B;&#x8FDB;&#x5236;&#x6570;&#x503C;&#x8868;&#x793A;&#xFF0C;&#x5176;&#x4E2D;&#x9996;&#x5B57;&#x8282;&#x53D6;&#x503C;&#x8303;&#x56F4;&#x5728;<code>[0xf0, 0xff]</code>&#x3002;&#x8F6C;&#x6362;&#x516C;&#x5F0F;&#xFF1A;</p><p>value = ((code - 0xf8) &lt;&lt; 8) + b0</p><h3>&#x538B;&#x7F29;&#xFF1A;&#x4E09;&#x5B57;&#x8282;long</h3><p>Longs between -262144 and 262143 are encoded in three octets with the leading byte in the range x38 to x3f.</p><p>&#x4ECB;&#x4E8E;<code>-262144</code>&#x5230;<code>262143</code>&#x4E4B;&#x95F4;&#x7684;long&#x7C7B;&#x578B;&#xFF0C;&#x4F7F;&#x7528;&#x4E09;&#x4E2A;&#x516B;&#x8FDB;&#x5236;&#x6570;&#x503C;&#x8868;&#x793A;&#xFF0C;&#x5176;&#x4E2D;&#x9996;&#x5B57;&#x8282;&#x53D6;&#x503C;&#x8303;&#x56F4;&#x5728;<code>[0x38, 0x3f]</code>&#x3002;&#x8F6C;&#x6362;&#x516C;&#x5F0F;&#xFF1A;</p><p>value = ((code - 0x3c) &lt;&lt; 16) + (b1 &lt;&lt; 8) + b0</p><h3>&#x538B;&#x7F29;&#xFF1A;&#x56DB;&#x5B57;&#x8282;long</h3><p>Longs between which fit into 32-bits are encoded in five octets with the leading byte x4c.</p><p>&#x4E0D;&#x8D85;&#x8FC7;32&#x4F4D;&#x7684;long&#x7C7B;&#x578B;&#x6570;&#x503C;&#xFF0C;&#x91C7;&#x7528;5&#x4E2A;&#x5B57;&#x8282;&#x7F16;&#x7801;&#xFF0C;&#x5176;&#x4E2D;&#x9996;&#x5B57;&#x8282;&#x4E3A;<code>0x4c</code>&#x3002;&#x8F6C;&#x6362;&#x516C;&#x5F0F;&#xFF1A;</p><p>value = (b3 &lt;&lt; 24) + (b2 &lt;&lt; 16) + (b1 &lt;&lt; 8) + b0</p><h3>Long &#x793A;&#x4F8B;</h3><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">xe0                  # 0</span><br><span class="line">xd8                  # -8</span><br><span class="line">xef                  # 15</span><br><span class="line"></span><br><span class="line">xf8 x00              # 0</span><br><span class="line">xf0 x00              # -2048</span><br><span class="line">xf7 x00              # -256</span><br><span class="line">xff xff              # 2047</span><br><span class="line"></span><br><span class="line">x3c x00 x00          # 0</span><br><span class="line">x38 x00 x00          # -262144</span><br><span class="line">x3f xff xff          # 262143</span><br><span class="line"></span><br><span class="line">x4c x00 x00 x00 x00  # 0</span><br><span class="line">x4c x00 x00 x01 x2c  # 300</span><br><span class="line"></span><br><span class="line">L x00 x00 x00 x00 x00 x00 x01 x2c  # 300</span><br></pre></td></tr></table></figure></p><h2>map</h2><p>Map &#x8BED;&#x6CD5;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map        ::= M type (value value)* Z</span><br></pre></td></tr></table></figure></p><p>Represents serialized maps and can represent objects. The type element describes the type of the map.</p><p>&#x4EE3;&#x8868;&#x4E00;&#x4E2A;&#x5E8F;&#x5217;&#x5316;&#x7684;map&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x3002;type&#x5143;&#x7D20;&#x63CF;&#x8FF0;&#x4E86;map&#x7684;&#x7C7B;&#x578B;&#x3002;</p><p>The type may be empty, i.e. a zero length. The parser is responsible for choosing a type if one is not specified. For objects, unrecognized keys will be ignored.</p><p><code>type</code>&#x5143;&#x7D20;&#x53EF;&#x80FD;&#x4E3A;&#x7A7A;&#xFF0C;&#x5373;&#x96F6;&#x957F;&#x5EA6;&#x3002;&#x5F53;type&#x672A;&#x6307;&#x5B9A;&#x65F6;&#xFF0C;&#x7531;&#x89E3;&#x6790;&#x5668;&#x8D1F;&#x8D23;&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#x3002;&#x5BF9;&#x4E8E;<code>object</code>&#xFF0C;&#x4E0D;&#x80FD;&#x8BC6;&#x522B;&#x7684;key&#x5C06;&#x4F1A;&#x88AB;&#x5FFD;&#x7565;&#x3002;</p><p>Each map is added to the reference list. Any time the parser expects a map, it must also be able to support a null or a ref.</p><p>&#x6BCF;&#x4E00;&#x4E2A;&#x6620;&#x5C04;&#x90FD;&#x5C06;&#x88AB;&#x6DFB;&#x52A0;&#x5230;&#x53C2;&#x8003;&#x96C6;&#x5408;&#x4E2D;&#x3002;&#x4EFB;&#x4F55;&#x65F6;&#x5019;&#xFF0C;&#x89E3;&#x6790;&#x5668;&#x90FD;&#x671F;&#x671B;&#x6709;&#x4E00;&#x4E2A;&#x6620;&#x5C04;&#xFF0C;&#x5B83;&#x5FC5;&#x987B;&#x652F;&#x6301;<code>null</code>&#x6216;&#x8005;&#x4E00;&#x4E2A;&#x5F15;&#x7528;&#x3002;</p><p>The type is chosen by the service.</p><p>&#x7C7B;&#x578B;&#x7531;service&#x9009;&#x62E9;&#x3002;</p><h3>Map &#x793A;&#x4F8B;</h3><p>&#x7A00;&#x758F;&#x6570;&#x7EC4;&#xFF1A;<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">map = <span class="keyword">new</span> HashMap();</span><br><span class="line">map.put(<span class="keyword">new</span> Integer(<span class="number">1</span>), <span class="string">&quot;fee&quot;</span>);</span><br><span class="line">map.put(<span class="keyword">new</span> Integer(<span class="number">16</span>), <span class="string">&quot;fie&quot;</span>);</span><br><span class="line">map.put(<span class="keyword">new</span> Integer(<span class="number">256</span>), <span class="string">&quot;foe&quot;</span>);</span><br></pre></td></tr></table></figure></p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">H           # untyped map (HashMap for Java)</span><br><span class="line">  x91       # 1</span><br><span class="line">  x03 fee   # &quot;fee&quot;</span><br><span class="line"></span><br><span class="line">  xa0       # 16</span><br><span class="line">  x03 fie   # &quot;fie&quot;</span><br><span class="line"></span><br><span class="line">  xc9 x00   # 256</span><br><span class="line">  x03 foe   # &quot;foe&quot;</span><br><span class="line"></span><br><span class="line">  Z</span><br></pre></td></tr></table></figure></p><p>Java&#x5BF9;&#x8C61;&#x7684;map&#x8868;&#x793A;&#xFF1A;</p><p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>{</span><br><span class="line">  String color = <span class="string">&quot;aquamarine&quot;</span>;</span><br><span class="line">  String model = <span class="string">&quot;Beetle&quot;</span>;</span><br><span class="line">  <span class="keyword">int</span> mileage = <span class="number">65536</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">M</span><br><span class="line">  x13 com.caucho.test.Car  # type</span><br><span class="line"></span><br><span class="line">  x05 color                # color field</span><br><span class="line">  x0a aquamarine</span><br><span class="line"></span><br><span class="line">  x05 model                # model field</span><br><span class="line">  x06 Beetle</span><br><span class="line"></span><br><span class="line">  x07 mileage              # mileage field</span><br><span class="line">  I x00 x01 x00 x00</span><br><span class="line">  Z</span><br></pre></td></tr></table></figure></p><h2>null</h2><p>Null &#x8BED;&#x6CD5;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">null ::= N</span><br></pre></td></tr></table></figure></p><p>Null &#x8868;&#x793A;&#x7A7A;&#x6307;&#x9488;&#x3002;&#x5B57;&#x8282; <code>&apos;N&apos;</code> &#x8868;&#x793A;<code>null</code>&#x503C;&#x3002;</p><h2>object</h2><p>Object &#x8BED;&#x6CD5;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class-def  ::= &apos;C&apos; string int string*</span><br><span class="line"></span><br><span class="line">object     ::= &apos;O&apos; int value*</span><br><span class="line">           ::= [x60-x6f] value*</span><br></pre></td></tr></table></figure></p><h3>&#x538B;&#x7F29;: class definition</h3><p>Hessian 2.0 has a compact object form where the field names are only serialized once.</p><p>Hessian 2.0&#x5177;&#x6709;&#x7D27;&#x51D1;&#x7684;&#x5BF9;&#x8C61;&#x5F62;&#x5F0F;&#xFF0C;&#x5176;&#x4E2D;&#x5B57;&#x6BB5;&#x540D;&#x79F0;&#x4EC5;&#x88AB;&#x5E8F;&#x5217;&#x5316;&#x4E00;&#x6B21;&#x3002;</p><p>Following objects only need to serialize their values.</p><p>&#x4E4B;&#x540E;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x5E8F;&#x5217;&#x5316;&#x5B83;&#x4EEC;&#x7684;&#x503C;&#x3002;</p><p>The object definition includes a mandatory type string, the number of fields, and the field names. The object definition is stored in the object definition map and will be referenced by object instances with an integer reference.</p><h3>&#x538B;&#x7F29;: object instantiation</h3><p>Hessian 2.0 has a compact object form where the field names are only serialized once. Following objects only need to serialize their values.</p><p>Hessian 2.0&#x5177;&#x6709;&#x7D27;&#x51D1;&#x7684;&#x5BF9;&#x8C61;&#x5F62;&#x5F0F;&#xFF0C;&#x5176;&#x4E2D;&#x5B57;&#x6BB5;&#x540D;&#x79F0;&#x4EC5;&#x88AB;&#x5E8F;&#x5217;&#x5316;&#x4E00;&#x6B21;&#x3002;</p><p>The object instantiation creates a new object based on a previous definition. The integer value refers to the object definition.</p><p>&#x5BF9;&#x8C61;&#x5B9E;&#x4F8B;&#x57FA;&#x4E8E;&#x524D;&#x9762;&#x7684;&#x5B9A;&#x4E49;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x5BF9;&#x8C61;&#x3002;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x6574;&#x6570;&#x6307;&#x5411;&#x5BF9;&#x8C61;&#x7684;&#x5B9A;&#x4E49;&#x3002;</p><h3>Object &#x793A;&#x4F8B;</h3><p>Object &#x5E8F;&#x5217;&#x5316;&#xFF1A;<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>{</span><br><span class="line">  String color;</span><br><span class="line">  String model;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">out.writeObject(<span class="keyword">new</span> Car(<span class="string">&quot;red&quot;</span>, <span class="string">&quot;corvette&quot;</span>));</span><br><span class="line">out.writeObject(<span class="keyword">new</span> Car(<span class="string">&quot;green&quot;</span>, <span class="string">&quot;civic&quot;</span>));</span><br></pre></td></tr></table></figure></p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">C                        # object definition (#0)</span><br><span class="line">  x0b example.Car        # type is example.Car</span><br><span class="line">  x92                    # two fields</span><br><span class="line">  x05 color              # color field name</span><br><span class="line">  x05 model              # model field name</span><br><span class="line"></span><br><span class="line">O                        # object def (long form)</span><br><span class="line">  x90                    # object definition #0</span><br><span class="line">  x03 red                # color field value</span><br><span class="line">  x08 corvette           # model field value</span><br><span class="line"></span><br><span class="line">x60                      # object def #0 (short form)</span><br><span class="line">  x05 green              # color field value</span><br><span class="line">  x05 civic              # model field value</span><br></pre></td></tr></table></figure></p><p>&#x679A;&#x4E3E;&#x7C7B;&#x578B;&#xFF1A;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> enum Color {</span><br><span class="line">  RED,</span><br><span class="line">  GREEN,</span><br><span class="line">  BLUE,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">out.writeObject(Color.RED);</span><br><span class="line">out.writeObject(Color.GREEN);</span><br><span class="line">out.writeObject(Color.BLUE);</span><br><span class="line">out.writeObject(Color.GREEN);</span><br></pre></td></tr></table></figure></p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">C                         # class definition #0</span><br><span class="line">  x0b example.Color       # type is example.Color</span><br><span class="line">  x91                     # one field</span><br><span class="line">  x04 name                # enumeration field is &quot;name&quot;</span><br><span class="line"></span><br><span class="line">x60                       # object #0 (class def #0)</span><br><span class="line">  x03 RED                 # RED value</span><br><span class="line"></span><br><span class="line">x60                       # object #1 (class def #0)</span><br><span class="line">  x90                     # object definition ref #0</span><br><span class="line">  x05 GREEN               # GREEN value</span><br><span class="line"></span><br><span class="line">x60                       # object #2 (class def #0)</span><br><span class="line">  x04 BLUE                # BLUE value</span><br><span class="line"></span><br><span class="line">x51 x91                   # object ref #1, i.e. Color.GREEN</span><br></pre></td></tr></table></figure></p><h2>ref</h2><p>Ref &#x8BED;&#x6CD5;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ref ::= x51 int</span><br></pre></td></tr></table></figure></p><p>An integer referring to a previous list, map, or object instance. As each list, map or object is read from the input stream, it is assigned the integer position in the stream, i.e. the first list or map is &apos;0&apos;, the next is &apos;1&apos;, etc. A later ref can then use the previous object. Writers MAY generate refs. Parsers MUST be able to recognize them.</p><p>&#x4E00;&#x4E2A;&#x6574;&#x6570;&#x6307;&#x5411;&#x4E00;&#x4E2A;&#x524D;&#x9762;&#x7684;list&#x3001;map&#x6216;&#x8005;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x5B9E;&#x4F8B;&#x3002;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E00;&#x4E2A;&#x4ECE;&#x8F93;&#x5165;&#x6D41;&#x4E2D;&#x8BFB;&#x5230;&#x7684;list&#x3001;map&#x6216;&#x8005;&#x5BF9;&#x8C61;&#xFF0C;&#x5B83;&#x90FD;&#x88AB;&#x6307;&#x5B9A;&#x4E86;&#x4E00;&#x4E2A;&#x6574;&#x6570;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x5373;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;list&#x6216;map&#x7684;&#x4F4D;&#x7F6E;&#x662F;<code>0</code>&#xFF0C;&#x4E0B;&#x4E00;&#x4E2A;&#x662F;<code>1</code>,&#x7B49;&#x7B49;&#x3002;&#x540E;&#x9762;&#x7684;&#x5F15;&#x7528;&#x53EF;&#x4EE5;&#x6307;&#x5411;&#x524D;&#x9762;&#x7684;&#x5BF9;&#x8C61;&#x3002;&#x5199;&#x5165;&#x5668;&#x53EF;&#x80FD;&#x4F1A;&#x751F;&#x6210;&#x5F15;&#x7528;&#xFF0C;&#x89E3;&#x6790;&#x5668;&#x4E00;&#x5B9A;&#x8981;&#x80FD;&#x591F;&#x6CE8;&#x518C;&#x5B83;&#x4EEC;&#x3002;</p><p>&#x8BD1;&#x8005;&#x6CE8;&#xFF1A;<code>ref</code>&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x6307;&#x9488;&#x3002;</p><p>ref can refer to incompletely-read items. For example, a circular linked-list will refer to the first link before the entire list has been read.</p><p>ref&#x53EF;&#x4EE5;&#x6307;&#x5411;&#x4E00;&#x4E2A;&#x5DF2;&#x7ECF;&#x8BFB;&#x53D6;&#x5B8C;&#x7684;&#x9879;&#x3002;&#x4F8B;&#x5982;&#xFF1A;&#x4E00;&#x4E2A;&#x5FAA;&#x73AF;&#x94FE;&#x8868;&#x5728;&#x6574;&#x4E2A;&#x8BFB;&#x53D6;&#x5B8C;&#x4E4B;&#x524D;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x6307;&#x5411;&#x7B2C;&#x4E00;&#x4E2A;&#x94FE;&#x63A5;&#x3002;</p><p>A possible implementation would add each map, list, and object to an array as it is read. The ref will return the corresponding value from the array. To support circular structures, the implementation would store the map, list or object immediately, before filling in the contents.</p><p>Each map or list is stored into an array as it is parsed. ref selects one of the stored objects. The first object is numbered &apos;0&apos;.</p><h3>Ref &#x793A;&#x4F8B;</h3><p>Circular list<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">list = new LinkedList();</span><br><span class="line">list.data = 1;</span><br><span class="line">list.tail = list;</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">C</span><br><span class="line">  x0a LinkedList</span><br><span class="line">  x92</span><br><span class="line">  x04 head</span><br><span class="line">  x04 tail</span><br><span class="line"></span><br><span class="line">o x90      # object stores ref #0</span><br><span class="line">  x91      # data = 1</span><br><span class="line">  x51 x90  # next field refers to itself, i.e. ref #0</span><br></pre></td></tr></table></figure></p><p>ref only refers to list, map and objects elements. Strings and binary data, in particular, will only share references if they&apos;re wrapped in a list or map.</p><h3>string</h3><p>String &#x8BED;&#x6CD5;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">string ::= x52 b1 b0 &lt;utf8-data&gt; string</span><br><span class="line">       ::= S b1 b0 &lt;utf8-data&gt;</span><br><span class="line">       ::= [x00-x1f] &lt;utf8-data&gt;</span><br><span class="line">       ::= [x30-x33] b0 &lt;utf8-data&gt;</span><br></pre></td></tr></table></figure></p><p>A 16-bit unicode character string encoded in UTF-8. Strings are encoded in chunks. x53 (&apos;S&apos;) represents the final chunk and x52 (&apos;R&apos;) represents any non-final chunk. Each chunk has a 16-bit unsigned integer length value.</p><p>String&#x662F;&#x4EE5;UTF-8&#x7F16;&#x7801;&#x7684;16&#x4F4D;&#x7684;unicode&#x5B57;&#x7B26;&#x4E32;&#x3002;String&#x4F7F;&#x7528;&#x5757;&#x7F16;&#x7801;&#x3002;<code>0x53(&apos;S&apos;)</code>&#x8868;&#x793A;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5757;&#xFF0C;<code>0x52(&apos;R&apos;)</code>&#x8868;&#x793A;&#x9664;&#x4E86;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5757;&#x4EE5;&#x5916;&#x7684;&#x5757;&#x3002;&#x6BCF;&#x4E2A;&#x5757;&#x90FD;&#x6709;&#x4E00;&#x4E2A;16&#x4F4D;&#x7684;&#x957F;&#x5EA6;&#x503C;&#x3002;</p><p>The length is the number of 16-bit characters, which may be different than the number of bytes.</p><p>&#x957F;&#x5EA6;&#x662F;&#x6307;16&#x4F4D;&#x5B57;&#x7B26;&#x7684;&#x957F;&#x5EA6;&#xFF0C;&#x53EF;&#x80FD;&#x548C;&#x5B57;&#x8282;&#x7684;&#x6570;&#x91CF;&#x4E0D;&#x4E00;&#x6837;&#x3002;</p><p>String chunks may not split surrogate pairs.</p><h3>&#x538B;&#x7F29;: short strings</h3><p>Strings with length less than 32 may be encoded with a single octet length [x00-x1f].</p><p>&#x957F;&#x5EA6;&#x5C11;&#x4E8E;32&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x8303;&#x56F4;&#x5728;<code>[x00-x1f]</code>&#x7684;&#x516B;&#x8FDB;&#x5236;&#x6570;&#x503C;&#x7F16;&#x7801;&#x5B83;&#x7684;&#x957F;&#x5EA6;&#x3002;&#x8BA1;&#x7B97;&#x516C;&#x5F0F;&#xFF1A;</p><p>value = code</p><h2>String &#x793A;&#x4F8B;</h2><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">x00                 # &quot;&quot;, empty string</span><br><span class="line">x05 hello           # &quot;hello&quot;</span><br><span class="line">x01 xc3 x83         # &quot;\u00c3&quot;</span><br><span class="line"></span><br><span class="line">S x00 x05 hello     # &quot;hello&quot; in long form</span><br><span class="line"></span><br><span class="line">x52 x00 x07 hello,  # &quot;hello, world&quot; split into two chunks</span><br><span class="line">x05 world</span><br></pre></td></tr></table></figure></p><h2>type</h2><p>Type &#x8BED;&#x6CD5;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">type ::= string</span><br><span class="line">     ::= int</span><br></pre></td></tr></table></figure></p><p>A <code>map</code> or <code>list</code> includes a type attribute indicating the type name of the map or list for object-oriented languages.</p><p>Each type is added to the <code>type map</code> for future reference.</p><h2>&#x538B;&#x7F29;: type &#x5F15;&#x7528;</h2><p>Repeated type strings MAY use the <code>type map</code> to refer to a previously used type. The type reference is zero-based over all the types encountered during parsing.</p><h1>&#x5F15;&#x7528;&#x6620;&#x5C04;</h1><p>Hessian 2.0 &#x6709;&#x4E09;&#x79CD;&#x5185;&#x7F6E;&#x5F15;&#x7528;&#x6620;&#x5C04;:</p><ul class="ui list"><li>An map/object/list reference map.</li><li>An class definition map.</li><li>A type (class name) map.</li></ul><p>The value reference map lets Hessian support arbitrary graphs, and recursive and circular data structures.</p><p>The class and type maps improve Hessian efficiency by avoiding repetition of common string data.</p><h2>&#x503C;&#x5F15;&#x7528;</h2><p>Hessian supports arbitrary graphs by adding <code>list</code>, <code>object</code>, and <code>map</code> as it encounters them in the bytecode stream.</p><p>Parsers MUST store each list, object and map in the reference map as they are encountered.</p><p>The stored objects can be used with a ref bytecode.</p><h2>class &#x5F15;&#x7528;</h2><p>Each <code>object definition</code> is automatically added to the class-map. Parsers MUST add a class definition to the class map as each is encountered. Following object instances will refer to the defined class.</p><h2>type &#x5F15;&#x7528;</h2><p>The <code>type</code> strings for <code>map</code> and <code>list</code> values are stored in a type map for reference.</p><p>Parsers MUST add a type string to the type map as each is encountered.</p><h1>&#x5B57;&#x8282;&#x6620;&#x5C04;</h1><p>Hessian is organized as a bytecode protocol. A Hessian reader is essentially a switch statement on the initial octet.</p><p>&#x5B57;&#x8282;&#x7F16;&#x7801;&#xFF1A;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">x00 - x1f    # utf-8 string length 0-32</span><br><span class="line">x20 - x2f    # binary data length 0-16</span><br><span class="line">x30 - x33    # utf-8 string length 0-1023</span><br><span class="line">x34 - x37    # binary data length 0-1023</span><br><span class="line">x38 - x3f    # three-octet compact long (-x40000 to x3ffff)</span><br><span class="line">x40          # reserved (expansion/escape)</span><br><span class="line">x41          # 8-bit binary data non-final chunk (&apos;A&apos;)</span><br><span class="line">x42          # 8-bit binary data final chunk (&apos;B&apos;)</span><br><span class="line">x43          # object type definition (&apos;C&apos;)</span><br><span class="line">x44          # 64-bit IEEE encoded double (&apos;D&apos;)</span><br><span class="line">x45          # reserved</span><br><span class="line">x46          # boolean false (&apos;F&apos;)</span><br><span class="line">x47          # reserved</span><br><span class="line">x48          # untyped map (&apos;H&apos;)</span><br><span class="line">x49          # 32-bit signed integer (&apos;I&apos;)</span><br><span class="line">x4a          # 64-bit UTC millisecond date</span><br><span class="line">x4b          # 32-bit UTC minute date</span><br><span class="line">x4c          # 64-bit signed long integer (&apos;L&apos;)</span><br><span class="line">x4d          # map with type (&apos;M&apos;)</span><br><span class="line">x4e          # null (&apos;N&apos;)</span><br><span class="line">x4f          # object instance (&apos;O&apos;)</span><br><span class="line">x50          # reserved</span><br><span class="line">x51          # reference to map/list/object - integer (&apos;Q&apos;)</span><br><span class="line">x52          # utf-8 string non-final chunk (&apos;R&apos;)</span><br><span class="line">x53          # utf-8 string final chunk (&apos;S&apos;)</span><br><span class="line">x54          # boolean true (&apos;T&apos;)</span><br><span class="line">x55          # variable-length list/vector (&apos;U&apos;)</span><br><span class="line">x56          # fixed-length list/vector (&apos;V&apos;)</span><br><span class="line">x57          # variable-length untyped list/vector (&apos;W&apos;)</span><br><span class="line">x58          # fixed-length untyped list/vector (&apos;X&apos;)</span><br><span class="line">x59          # long encoded as 32-bit int (&apos;Y&apos;)</span><br><span class="line">x5a          # list/map terminator (&apos;Z&apos;)</span><br><span class="line">x5b          # double 0.0</span><br><span class="line">x5c          # double 1.0</span><br><span class="line">x5d          # double represented as byte (-128.0 to 127.0)</span><br><span class="line">x5e          # double represented as short (-32768.0 to 327676.0)</span><br><span class="line">x5f          # double represented as float</span><br><span class="line">x60 - x6f    # object with direct type</span><br><span class="line">x70 - x77    # fixed list with direct length</span><br><span class="line">x78 - x7f    # fixed untyped list with direct length</span><br><span class="line">x80 - xbf    # one-octet compact int (-x10 to x3f, x90 is 0)</span><br><span class="line">xc0 - xcf    # two-octet compact int (-x800 to x7ff)</span><br><span class="line">xd0 - xd7    # three-octet compact int (-x40000 to x3ffff)</span><br><span class="line">xd8 - xef    # one-octet compact long (-x8 to xf, xe0 is 0)</span><br><span class="line">xf0 - xff    # two-octet compact long (-x800 to x7ff, xf8 is 0)</span><br></pre></td></tr></table></figure></p><h1>&#x4F5C;&#x8005;&#x8054;&#x7CFB;&#x65B9;&#x5F0F;</h1><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Scott Ferguson</span><br><span class="line">Caucho Technology Inc.</span><br><span class="line">P.O. Box 9001</span><br><span class="line">La Jolla, CA 92038</span><br><span class="line">USA</span><br><span class="line">Email: ferg@caucho.com</span><br></pre></td></tr></table></figure></p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Emil Ong</span><br><span class="line">Caucho Technology Inc.</span><br><span class="line">P.O. Box 9001</span><br><span class="line">La Jolla, CA 92038</span><br><span class="line">USA</span><br><span class="line">Email: emil@caucho.com</span><br></pre></td></tr></table></figure></p><h1>Full Copyright Statement</h1><p>Copyright &#xA9; The IETF Trust (2007).</p><p>This document is subject to the rights, licenses and restrictions contained in BCP 78, and except as set forth therein, the authors retain all their rights.</p><p>This document and the information contained herein are provided on an &#x201C;AS IS&#x201D; basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.</p><h1>Intellectual Property</h1><p>The IETF takes no position regarding the validity or scope of any Intellectual Property Rights or other rights that might be claimed to pertain to the implementation or use of the technology described in this document or the extent to which any license under such rights might or might not be available; nor does it represent that it has made any independent effort to identify any such rights. Information on the procedures with respect to rights in RFC documents can be found in BCP 78 and BCP 79.</p><p>Copies of IPR disclosures made to the IETF Secretariat and any assurances of licenses to be made available, or the result of an attempt made to obtain a general license or permission for the use of such proprietary rights by implementers or users of this specification can be obtained from the IETF on-line IPR repository at http://www.ietf.org/ipr.</p><p>The IETF invites any interested party to bring to its attention any copyrights, patents or patent applications, or other proprietary rights that may cover technology that may be required to implement this standard. Please address the information to the IETF at ietf-ipr@ietf.org.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Hessian 2.0 &amp;#x5E8F;&amp;#x5217;&amp;#x5316;&amp;#x534F;&amp;#x8BAE;&amp;#x7FFB;&amp;#x8BD1;&amp;#xFF0C;&amp;#x539F;&amp;#x6587;&amp;#x94FE;&amp;#x63A5;&lt;a href=&quot;http://hessian.cauch
      
    
    </summary>
    
      <category term="java" scheme="https://yyhan.github.io/categories/java/"/>
    
    
      <category term="hessian" scheme="https://yyhan.github.io/tags/hessian/"/>
    
      <category term="序列化" scheme="https://yyhan.github.io/tags/%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>Spring MVC基本配置</title>
    <link href="https://yyhan.github.io/2017/06/15/Spring-MVC%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE/"/>
    <id>https://yyhan.github.io/2017/06/15/Spring-MVC基本配置/</id>
    <published>2017-06-15T14:25:45.000Z</published>
    <updated>2017-06-15T14:57:09.491Z</updated>
    
    <summary type="html">
    
    </summary>
    
      <category term="spring" scheme="https://yyhan.github.io/categories/spring/"/>
    
    
      <category term="java" scheme="https://yyhan.github.io/tags/java/"/>
    
      <category term="spring" scheme="https://yyhan.github.io/tags/spring/"/>
    
  </entry>
  
  <entry>
    <title>hessian 常见问题</title>
    <link href="https://yyhan.github.io/2017/06/15/hessian-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/"/>
    <id>https://yyhan.github.io/2017/06/15/hessian-常见问题/</id>
    <published>2017-06-15T13:22:54.000Z</published>
    <updated>2017-06-15T14:24:28.866Z</updated>
    
    <content type="html"><![CDATA[<h1>hessian&#x63A5;&#x53E3;&#x670D;&#x52A1;&#x7AEF;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x5BF9;&#x8C61;&#x4E0D;&#x4E00;&#x81F4;&#x95EE;&#x9898;</h1><h2>&#x5B57;&#x6BB5;&#x6570;&#x91CF;&#x4E0D;&#x4E00;&#x81F4;</h2><p>hessian&#x5141;&#x8BB8;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x5BF9;&#x8C61;&#x5B57;&#x6BB5;&#x4E0D;&#x4E00;&#x81F4;&#xFF0C;&#x589E;&#x52A0;&#x3001;&#x5220;&#x9664;&#x5B57;&#x6BB5;&#x90FD;&#x4E0D;&#x5F71;&#x54CD;&#xFF0C;&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x540C;&#x540D;&#x5B57;&#x6BB5;&#xFF0C;&#x5FC5;&#x987B;&#x4FDD;&#x8BC1;&#x5B57;&#x6BB5;&#x7C7B;&#x578B;&#x4E00;&#x81F4;&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x62A5;&#x5F02;&#x5E38;&#xFF1A;</p><ul class="ui list"><li>&#x4F8B;&#x5982;&#x670D;&#x52A1;&#x7AEF;&#x4E3A;BigDecimal&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x4E3A;int&#xFF1A;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">com.caucho.hessian.client.HessianRuntimeException: com.caucho.hessian.io.HessianFieldException: com.demo.entity.DemoBean.number: expected integer at 0x43 java.math.BigDecimal (1233456)</span><br></pre></td></tr></table></figure></li></ul><h2>&#x63A5;&#x53E3;&#x8FD4;&#x56DE;&#x503C;&#x7C7B;&#x578B;&#x4E0D;&#x4E00;&#x81F4;</h2><p>&#x5F53;&#x670D;&#x52A1;&#x7AEF;&#x8FD4;&#x56DE;&#x5BF9;&#x8C61;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x671F;&#x671B;&#x83B7;&#x53D6;&#x7684;&#x5BF9;&#x8C61;&#x4E0D;&#x4E00;&#x81F4;&#x65F6;&#xFF0C;&#x6BD4;&#x5982;&#x670D;&#x52A1;&#x7AEF;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#x4E3A;A&#xFF0C;&#x4F46;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x63A5;&#x53D7;&#x7684;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#x4E3A;B&#xFF0C;&#x6B64;&#x65F6;hessian&#x4F7F;&#x7528;map&#x6620;&#x5C04;&#x7684;&#x65B9;&#x5F0F;&#x89E3;&#x6790;&#xFF0C;&#x6839;&#x636E;&#x5B57;&#x6BB5;&#x540D;&#x6620;&#x5C04;&#xFF0C;&#x4F46;&#x662F;&#x4F1A;&#x8BB0;&#x5F55;&#x4E00;&#x4E9B;&#x8B66;&#x544A;&#x65E5;&#x5FD7;&#xFF1A;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[2017-06-15 22:17:00,267] &#x8B66;&#x544A; com.caucho.hessian.io.SerializerFactory getDeserializer - Hessian/Burlap: &apos;com.demo.entity.DemoBean&apos; is an unknown class in sun.misc.Launcher$AppClassLoader@18b4aac2:</span><br><span class="line">java.lang.ClassNotFoundException: com.demo.entity.DemoBean </span><br><span class="line">[2017-06-15 22:17:00,282] &#x8F83;&#x8BE6;&#x7EC6; com.caucho.hessian.io.SerializerFactory getDeserializer - java.lang.ClassNotFoundException: com.demo.entity.DemoBean </span><br><span class="line">[2017-06-15 22:17:01,194] &#x8B66;&#x544A; com.caucho.hessian.io.SerializerFactory getDeserializer - Hessian/Burlap: &apos;com.demo.entity.DemoBean&apos; is an unknown class in sun.misc.Launcher$AppClassLoader@18b4aac2:</span><br><span class="line">java.lang.ClassNotFoundException: com.demo.entity.DemoBean </span><br><span class="line">[2017-06-15 22:17:01,194] &#x8F83;&#x8BE6;&#x7EC6; com.caucho.hessian.io.SerializerFactory getDeserializer - java.lang.ClassNotFoundException: com.demo.entity.DemoBean </span><br><span class="line">MyHessianServlet.getDeserializer: com.demo.entity.Demo2Bean</span><br><span class="line">[2017-06-15 22:17:01,196] &#x8BE6;&#x7EC6; com.caucho.hessian.io.SerializerFactory getObjectDeserializer - hessian: expected deserializer &apos;com.demo.entity.Demo2Bean&apos; at &apos;com.demo.entity.DemoBean&apos; (java.util.HashMap)</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1&gt;hessian&amp;#x63A5;&amp;#x53E3;&amp;#x670D;&amp;#x52A1;&amp;#x7AEF;&amp;#x548C;&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&amp;#x5BF9;&amp;#x8C61;&amp;#x4E0D;&amp;#x4E00;&amp;#x81F4;&amp;#x95EE;&amp;#x9898;&lt;
      
    
    </summary>
    
      <category term="hessian" scheme="https://yyhan.github.io/categories/hessian/"/>
    
    
      <category term="java" scheme="https://yyhan.github.io/tags/java/"/>
    
      <category term="hessian" scheme="https://yyhan.github.io/tags/hessian/"/>
    
  </entry>
  
  <entry>
    <title>hessian 序列化BigDecimal问题</title>
    <link href="https://yyhan.github.io/2017/06/13/hessian-%E5%BA%8F%E5%88%97%E5%8C%96BigDecimal%E9%97%AE%E9%A2%98/"/>
    <id>https://yyhan.github.io/2017/06/13/hessian-序列化BigDecimal问题/</id>
    <published>2017-06-13T14:49:43.000Z</published>
    <updated>2017-06-18T13:16:02.180Z</updated>
    
    <content type="html"><![CDATA[<p>hessian&#x5904;&#x7406;BigDecimal&#x65F6;&#xFF0C;&#x9ED8;&#x8BA4;&#x5C06;BigDecimal&#x4F5C;&#x4E3A;Object&#x5BF9;&#x8C61;&#x5904;&#x7406;&#xFF0C;&#x5C1D;&#x8BD5;&#x5C06;BigDecimal&#x7684;&#x5404;&#x4E2A;&#x5B57;&#x6BB5;&#x5E8F;&#x5217;&#x5316;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;&#x4F20;&#x8F93;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x7684;BigDecimal&#x4F4D;0&#x3002;</p><p>&#x76EE;&#x524D;&#x6709;&#x4E09;&#x79CD;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF1A;</p><ul class="ui list"><li>&#x5BF9;hessian&#x91CD;&#x65B0;&#x6253;&#x5305;</li><li>&#x5B9E;&#x73B0;&#x76EE;&#x6807;&#x5BF9;&#x8C61;&#x7684;&#x5E8F;&#x5217;&#x5316;&#x548C;&#x5E8F;&#x5217;&#x5316;&#x63A5;&#x53E3;</li><li>&#x6DFB;&#x52A0;&#x81EA;&#x5B9A;&#x4E49;&#x7684;<code>AbstractSerializerFactory</code></li></ul><h1>&#x5BF9;hessian&#x91CD;&#x65B0;&#x6253;&#x5305;</h1><p>&#x521B;&#x5EFA;<code>META-INF/hessian/serializers</code>&#x6587;&#x4EF6;&#xFF0C;&#x5728;&#x8BE5;&#x6587;&#x4EF6;&#x4E2D;&#x6DFB;&#x52A0;:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.math.BigDecimal=com.caucho.hessian.io.StringValueSerializer</span><br></pre></td></tr></table></figure></p><p>&#x521B;&#x5EFA;<code>META-INF/hessian/deserializers</code>&#x6587;&#x4EF6;&#xFF0C;&#x5728;&#x8BE5;&#x6587;&#x4EF6;&#x4E2D;&#x6DFB;&#x52A0;:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.math.BigDecimal=com.caucho.hessian.io.BigDecimalDeserializer</span><br></pre></td></tr></table></figure></p><p>&#x6307;&#x5B9A;&#x4F7F;&#x7528;<code>StringValueSerializer</code>&#x5E8F;&#x5217;&#x5316;BigDecimal&#x5BF9;&#x8C61;&#xFF0C;&#x4F7F;&#x7528;<code>BigDecimalDeserializer</code>&#x53CD;&#x5E8F;&#x5217;&#x5316;BigDecimal&#x5BF9;&#x8C61;&#x3002;</p><h1>&#x5B9E;&#x73B0;&#x76EE;&#x6807;&#x5BF9;&#x8C61;&#x7684;&#x5E8F;&#x5217;&#x5316;&#x548C;&#x5E8F;&#x5217;&#x5316;&#x63A5;&#x53E3;</h1><p>&#x5B9E;&#x73B0;&#x76EE;&#x6807;&#x5BF9;&#x8C61;&#x7684;&#x5E8F;&#x5217;&#x5316;&#xFF08;<code>com.caucho.hessian.io.Serializer</code>&#xFF09;&#x548C;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x63A5;&#x53E3;&#xFF08;<code>com.caucho.hessian.io.Deserializer</code>&#xFF09;&#x3002;</p><ul class="ui list"><li>&#x5E8F;&#x5217;&#x5316;&#x7684;&#x7C7B;&#x540D;&#x5FC5;&#x987B;&#x4E3A; <code>cl.getName() + &quot;HessianSerializer&quot;</code></li><li>&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x7684;&#x7C7B;&#x540D;&#x5FC5;&#x987B;&#x4E3A; <code>cl.getName() + &quot;HessianDeserializer&quot;</code></li><li>&#x540C;&#x65F6;&#x5FC5;&#x987B;&#x548C;&#x76EE;&#x6807;&#x7C7B;&#x7684;&#x5305;&#x8DEF;&#x5F84;&#x5B8C;&#x5168;&#x4E00;&#x81F4;&#x3002;</li></ul><h1>&#x6DFB;&#x52A0;&#x81EA;&#x5B9A;&#x4E49;&#x7684;<code>AbstractSerializerFactory</code></h1><p>&#x5B9E;&#x73B0;&#x81EA;&#x5DF1;&#x7684;&#x5E8F;&#x5217;&#x5316;&#x5DE5;&#x5382;&#x7C7B;&#xFF0C;&#x5E76;&#x6DFB;&#x52A0;&#x5230;&#x9ED8;&#x8BA4;&#x7684;&#x5E8F;&#x5217;&#x5316;&#x5DE5;&#x5382;&#x4E2D;&#x3002;&#x6709;&#x4E09;&#x5904;&#x6539;&#x52A8;&#xFF1A;</p><ul class="ui list"><li><p>&#x81EA;&#x5B9A;&#x4E49;<code>AbstractSerializerFactory</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cloudin.hessian.support;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.caucho.hessian.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by YFHan on 2017/6/15 0015.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAbstractSerializerFactory</span> <span class="keyword">extends</span> <span class="title">AbstractSerializerFactory</span> </span>{</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Serializer&gt; serializerMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Deserializer&gt; deserializerMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyAbstractSerializerFactory</span><span class="params">()</span> </span>{</span><br><span class="line">        serializerMap.put(BigDecimal.class.getName(), <span class="keyword">new</span> StringValueSerializer());</span><br><span class="line">        deserializerMap.put(BigDecimal.class.getName(), <span class="keyword">new</span> BigDecimalDeserializer());</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Serializer <span class="title">getSerializer</span><span class="params">(Class cl)</span> <span class="keyword">throws</span> HessianProtocolException </span>{</span><br><span class="line">        <span class="keyword">return</span> serializerMap.get(cl.getName());</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Deserializer <span class="title">getDeserializer</span><span class="params">(Class cl)</span> <span class="keyword">throws</span> HessianProtocolException </span>{</span><br><span class="line">        <span class="keyword">return</span> deserializerMap.get(cl.getName());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p></li><li><p>&#x81EA;&#x5B9A;&#x4E49;<code>HessianServlet</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cloudin.hessian.support;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.caucho.hessian.io.*;</span><br><span class="line"><span class="keyword">import</span> com.caucho.hessian.server.HessianServlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &#x81EA;&#x5B9A;&#x4E49;HessianServlet</span></span><br><span class="line"><span class="comment"> * Created by YFHan on 2017/6/12 0012.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyHessianServlet</span> <span class="keyword">extends</span> <span class="title">HessianServlet</span> </span>{</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> SerializerFactory serializerFactory;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(javax.servlet.ServletConfig config)</span> <span class="keyword">throws</span> ServletException </span>{</span><br><span class="line">        <span class="keyword">super</span>.init(config);</span><br><span class="line">        serializerFactory = <span class="keyword">super</span>.getSerializerFactory();</span><br><span class="line">        serializerFactory.addFactory(<span class="keyword">new</span> MyAbstractSerializerFactory());</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SerializerFactory <span class="title">getSerializerFactory</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> serializerFactory;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p></li><li><p>&#x5411;<code>HessianProxyFactory</code>&#x4E2D;&#x6DFB;&#x52A0;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x5E8F;&#x5217;&#x5316;&#x5DE5;&#x5382;&#x5B9E;&#x4F8B;<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HessianProxyFactory hessianProxyFactory = <span class="keyword">new</span> HessianProxyFactory();</span><br><span class="line">hessianProxyFactory.getSerializerFactory().addFactory(<span class="keyword">new</span> MyAbstractSerializerFactory());</span><br></pre></td></tr></table></figure></p></li></ul><h2>&#x603B;&#x7ED3;</h2><ul class="ui list"><li>&#x7B2C;&#x4E00;&#x79CD;&#x65B9;&#x6848;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x5199;&#x4EFB;&#x4F55;&#x4EE3;&#x7801;&#xFF0C;&#x4F46;&#x662F;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x7EF4;&#x62A4;hessian&#x7684;&#x6253;&#x5305;</li><li>&#x7B2C;&#x4E8C;&#x79CD;&#x65B9;&#x6848;&#xFF0C;&#x81EA;&#x5B9A;&#x4E49;&#x7A0B;&#x5EA6;&#x5F88;&#x9AD8;&#xFF0C;&#x4F46;&#x662F;&#x9700;&#x8981;&#x5BF9;hessian&#x7684;&#x5E8F;&#x5217;&#x5316;&#x534F;&#x8BAE;&#x975E;&#x5E38;&#x4E86;&#x89E3;&#xFF0C;&#x4F46;&#x662F;&#x5DE5;&#x4F5C;&#x91CF;&#x5F88;&#x5927;&#xFF0C;&#x4E00;&#x822C;&#x4E0D;&#x7528;</li><li>&#x7B2C;&#x4E09;&#x79CD;&#x65B9;&#x6848;&#x548C;&#x7B2C;&#x4E00;&#x79CD;&#x65B9;&#x6848;&#x539F;&#x7406;&#x4E00;&#x81F4;&#xFF0C;&#x867D;&#x7136;&#x9700;&#x8981;&#x4E9B;&#x4EE3;&#x7801;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x4E9B;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x62BD;&#x51FA;&#x4F5C;&#x4E3A;&#x56E2;&#x961F;&#x516C;&#x5171;&#x4EE3;&#x7801;&#xFF0C;&#x57FA;&#x672C;&#x4E0D;&#x9700;&#x8981;&#x8DDF;&#x968F;hessian&#x7248;&#x672C;&#x5347;&#x7EA7;&#x800C;&#x505A;&#x51FA;&#x6539;&#x52A8;&#xFF0C;&#x540C;&#x65F6;&#x5982;&#x679C;&#x6709;&#x9700;&#x8981;&#xFF0C;&#x53EF;&#x4EE5;&#x968F;&#x65F6;&#x6DFB;&#x52A0;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x5E8F;&#x5217;&#x5316;&#x65B9;&#x5F0F;&#x3002;</li></ul><p>&#x4E2A;&#x4EBA;&#x6BD4;&#x8F83;&#x63A8;&#x8350;&#x7B2C;&#x4E09;&#x79CD;&#x65B9;&#x5F0F;&#x3002;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;hessian&amp;#x5904;&amp;#x7406;BigDecimal&amp;#x65F6;&amp;#xFF0C;&amp;#x9ED8;&amp;#x8BA4;&amp;#x5C06;BigDecimal&amp;#x4F5C;&amp;#x4E3A;Object&amp;#x5BF9;&amp;#x8C61;&amp;#x5904;&amp;#x7406;
      
    
    </summary>
    
      <category term="hessian" scheme="https://yyhan.github.io/categories/hessian/"/>
    
    
      <category term="java" scheme="https://yyhan.github.io/tags/java/"/>
    
      <category term="hessian" scheme="https://yyhan.github.io/tags/hessian/"/>
    
      <category term="BigDecimal" scheme="https://yyhan.github.io/tags/BigDecimal/"/>
    
  </entry>
  
  <entry>
    <title>hessian 序列化和反序列化</title>
    <link href="https://yyhan.github.io/2017/06/11/hessian-%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <id>https://yyhan.github.io/2017/06/11/hessian-序列化和反序列化/</id>
    <published>2017-06-10T17:29:48.000Z</published>
    <updated>2017-06-18T13:21:23.447Z</updated>
    
    <content type="html"><![CDATA[<h1>hessian&#x8BF7;&#x6C42;&#x4EE3;&#x7406;</h1><p>com.caucho.hessian.client.HessianProxy.invoke(Object proxy, Method method, Object []args); // &#x901A;&#x8FC7;&#x4EE3;&#x7406;&#x65B9;&#x5F0F;&#x8C03;&#x7528;&#x8FDC;&#x7A0B;&#x65B9;&#x6CD5;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;</p><p>com.caucho.hessian.io.Hessian2Input.readReply(Class expectedClass); // &#x8BFB;&#x53D6;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;readObject(Class cl); // &#x8BFB;&#x53D6;&#x4E00;&#x4E2A;&#x7C7B;&#x5BF9;&#x8C61;</p><h1>&#x5E8F;&#x5217;&#x5316;&#x5668;&#x67E5;&#x627E;&#x6D41;&#x7A0B;</h1><ul class="ui list"><li>1&#x3001;&#x901A;&#x8FC7; <code>SerializerFactory.getObjectSerializer(object.getClass())</code> &#xFF0C;&#x83B7;&#x53D6;&#x76EE;&#x6807;&#x5BF9;&#x8C61;&#x7684;&#x5E8F;&#x5217;&#x5316;&#x5668;<ul><li>1.1&#x3001;&#x8C03;&#x7528; <code>SerializerFactory.getSerializer(Class cl)</code> &#x83B7;&#x53D6;&#x76EE;&#x6807;&#x7C7B;&#x7684;&#x5E8F;&#x5217;&#x5316;&#x5668;</li><li>1.2&#x3001;&#x5982;&#x679C; <code>_cachedSerializerMap</code> &#x7F13;&#x5B58;&#x4E2D;&#x6709;&#xFF0C;&#x5219;&#x53D6;&#x7F13;&#x5B58;&#x7684;&#x5E8F;&#x5217;&#x5316;&#x5668;</li><li>1.3&#x3001;&#x5982;&#x679C;&#x7F13;&#x5B58;&#x6CA1;&#x6709;&#xFF0C;&#x8C03;&#x7528; <code>SerializerFactory.loadSerializer(Class&lt;?&gt; cl)</code> &#x83B7;&#x53D6;&#x76EE;&#x6807;&#x7C7B;&#x7684;&#x5E8F;&#x5217;&#x5316;&#x5668;</li><li>1.4&#x3001;&#x904D;&#x5386; <code>SerializerFactory._factories</code>&#xFF08;&#x81EA;&#x884C;&#x6DFB;&#x52A0;&#x7684;&#x5E8F;&#x5217;&#x5316;&#x5668;&#x5DE5;&#x5382;&#xFF09;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x4E00;&#x4E2A;&#x5DE5;&#x5382;&#x63D0;&#x4F9B;&#x76EE;&#x6807;&#x7C7B;&#x7684;&#x5E8F;&#x5217;&#x5316;&#x5668;&#xFF0C;&#x5C31;&#x91C7;&#x7528;&#x8BE5;&#x5DE5;&#x5382;&#x63D0;&#x4F9B;&#x7684;&#x5E8F;&#x5217;&#x5316;&#x5668;</li><li>1.5&#x3001;&#x5426;&#x5219;&#xFF08;1.4&#xFF09;&#xFF0C;&#x8C03;&#x7528; <code>SerializerFactory</code> &#x521D;&#x59CB;&#x5316;&#x65F6;&#x6784;&#x9020;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x5E8F;&#x5217;&#x5316;&#x5DE5;&#x5382; <code>ContextSerializerFactory.getSerializer(Class cl)</code> &#x67E5;&#x8BE2;&#x5E8F;&#x5217;&#x5316;&#x5668;&#xFF0C;&#x5982;&#x679C;&#x627E;&#x5230;&#xFF0C;&#x5C31;&#x91C7;&#x7528;</li><li>1.6&#x3001;&#x5426;&#x5219;&#xFF08;1.5&#xFF09;&#xFF0C;&#x5C31;&#x4F7F;&#x7528;<code>&#x76EE;&#x6807;&#x7C7B;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;</code>&#x6784;&#x9020; <code>ContextSerializerFactory</code>&#xFF0C;&#x5E76;&#x901A;&#x8FC7;&#x8BE5;&#x5E8F;&#x5217;&#x5316;&#x5DE5;&#x5382;&#x7684;<code>getCustomSerializer()</code>&#x67E5;&#x8BE2;&#x5E8F;&#x5217;&#x5316;&#x5668;&#xFF0C;&#x5982;&#x679C;&#x627E;&#x5230;&#xFF0C;&#x5C31;&#x91C7;&#x7528;<ul><li>1.6.1&#x3001;<code>Class.forName(cl.getName() + &quot;HessianSerializer&quot;, false, cl.getClassLoader())</code>&#x83B7;&#x53D6;&#x5E8F;&#x5217;&#x5316;&#x5668;</li></ul></li><li>1.7&#x3001;&#x5426;&#x5219;&#xFF08;1.6&#xFF09;&#xFF0C;&#x5982;&#x679C;&#x76EE;&#x6807;&#x7C7B;&#x662F;<code>com.caucho.hessian.io.HessianRemoteObject</code>&#x7C7B;&#x578B;&#x6216;&#x5176;&#x5B50;&#x7C7B;&#xFF0C;&#x8FD4;&#x56DE;<code>com.caucho.hessian.io.RemoteSerializer</code></li><li>1.8&#x3001;&#x5426;&#x5219;&#xFF08;1.7&#xFF09;&#xFF0C;&#x5982;&#x679C;&#x76EE;&#x6807;&#x7C7B;&#x662F;<code>com.caucho.burlap.io.BurlapRemoteObject</code>&#x7C7B;&#x578B;&#x6216;&#x5176;&#x5B50;&#x7C7B;&#xFF0C;&#x8FD4;&#x56DE;<code>com.caucho.hessian.io.RemoteSerializer</code></li><li>1.9&#x3001;&#x5426;&#x5219;&#xFF08;1.8&#xFF09;&#xFF0C;&#x5982;&#x679C;&#x76EE;&#x6807;&#x7C7B;&#x62E5;&#x6709;&#x540D;&#x4E3A;<code>writeReplace</code>&#x7684;&#x65E0;&#x53C2;&#x65B9;&#x6CD5;&#xFF0C;&#x5C31;&#x6839;&#x636E;&#x8BE5;&#x65B9;&#x6CD5;&#x6784;&#x9020;&#x4E00;&#x4E2A;<code>WriteReplaceSerializer</code>&#x8FD4;&#x56DE;</li><li>1.10&#x3001;&#x5426;&#x5219;&#xFF08;1.9&#xFF09;&#xFF0C;&#x5982;&#x679C;&#x76EE;&#x6807;&#x7C7B;&#x662F;<code>Map</code>&#xFF0C;&#x8FD4;&#x56DE;<code>MapSerializer</code>&#xFF08;&#x61D2;&#x52A0;&#x8F7D;&#xFF09;</li><li>1.11&#x3001;&#x5426;&#x5219;&#xFF08;1.10&#xFF09;&#xFF0C;&#x5982;&#x679C;&#x76EE;&#x6807;&#x7C7B;&#x662F;<code>Collection</code>&#xFF0C;&#x8FD4;&#x56DE;<code>CollectionSerializer</code>* &#xFF08;&#x61D2;&#x52A0;&#x8F7D;&#xFF09;</li><li>1.12&#x3001;&#x5426;&#x5219;&#xFF08;1.11&#xFF09;&#xFF0C;<code>Array&#x3001;InputStream&#x3001;Iterator&#x3001;Calendar&#x3001;* Enumeration&#x3001;Enum&#x3001;Annotation</code>&#x5206;&#x522B;&#x8FD4;&#x56DE;&#x5BF9;&#x5E94;&#x7684;&#x5185;&#x7F6E;&#x5E8F;&#x5217;&#x5316;&#x5668;</li><li>1.13&#x3001;&#x5426;&#x5219;&#xFF08;1.12&#xFF09;&#xFF0C;&#x8C03;&#x7528;<code>SerializerFactory.getDefaultSerializer(Class cl)</code>&#x8FD4;&#x56DE;&#x9ED8;&#x8BA4;&#x7684;&#x5E8F;&#x5217;&#x5316;&#x5668;<ul><li>1.13.1&#x3001;&#x5982;&#x679C; <code>_defaultSerializer</code> &#x4E0D;&#x4E3A;&#x7A7A;&#xFF0C;&#x5C31;&#x91C7;&#x7528;</li><li>1.13.2&#x3001;&#x5982;&#x679C;&#x76EE;&#x6807;&#x7C7B;&#x578B;&#x672A;&#x5B9E;&#x73B0;<code>Serializable</code>&#x63A5;&#x53E3;&#xFF0C;&#x4E14;&#x8BBE;&#x7F6E;&#x4E86;&#x7981;&#x6B62;&#x2018;&#x4E0D;&#x652F;&#x6301;&#x5E8F;&#x5217;&#x5316;&#x7684;&#x7C7B;&#x2019;&#x7684;&#x72B6;&#x6001;<code>_isAllowNonSerializable</code>&#xFF0C;&#x5C06;&#x8DD1;&#x51FA;&#x5F02;&#x5E38;<code>IllegalStateException</code></li><li>1.13.3&#x3001;&#x5982;&#x679C;&#x542F;&#x7528;&#x4E86;&#x4E0D;&#x5B89;&#x5168;&#x7684;&#x5E8F;&#x5217;&#x5316;&#x5668;&#xFF0C;&#x5E76;&#x4E14;&#x76EE;&#x6807;&#x7C7B;&#x6CA1;&#x6709;&#x540D;&#x4E3A;<code>writeReplace</code>&#x7684;&#x65E0;&#x53C2;&#x65B9;&#x6CD5;&#xFF0C;&#x5C31;&#x6784;&#x9020;&#x4E00;&#x4E2A;<code>UnsafeSerializer</code>&#x5E76;&#x8FD4;&#x56DE;<ul><li>1.13.3.1&#x3001;&#x5982;&#x679C;&#x76EE;&#x6807;&#x7C7B;&#x8BBE;&#x7F6E;&#x4E86;&#x6CE8;&#x89E3;<code>HessianUnshared</code>&#xFF08;&#x4E0D;&#x68C0;&#x6D4B;&#x91CD;&#x590D;&#x6216;&#x5FAA;&#x73AF;&#x5F15;&#x7528;&#xFF09;&#xFF0C;&#x6784;&#x9020;&#x4E00;&#x4E2A;<code>UnsafeUnsharedSerializer</code>&#x5E76;&#x8FD4;&#x56DE;</li><li>1.13.3.2&#x3001;&#x5426;&#x5219;&#xFF0C;&#x6784;&#x9020;&#x4E00;&#x4E2A;<code>UnsafeSerializer</code>&#x5E76;&#x8FD4;&#x56DE;</li></ul></li><li>1.13.4&#x3001;&#x5426;&#x5219;&#xFF0C;&#x6784;&#x9020;&#x4E00;&#x4E2A;<code>JavaSerializer</code>&#x5E76;&#x8FD4;&#x56DE;<ul><li>1.13.4.1&#x3001;&#x5982;&#x679C;&#x76EE;&#x6807;&#x7C7B;&#x8BBE;&#x7F6E;&#x4E86;&#x6CE8;&#x89E3;<code>HessianUnshared</code>&#xFF08;&#x4E0D;&#x68C0;&#x6D4B;&#x91CD;&#x590D;&#x6216;&#x5FAA;&#x73AF;&#x5F15;&#x7528;&#xFF09;&#xFF0C;&#x6784;&#x9020;&#x4E00;&#x4E2A;<code>JavaUnsharedSerializer</code>&#x5E76;&#x8FD4;&#x56DE;</li><li>1.13.4.2&#x3001;&#x5426;&#x5219;&#xFF0C;&#x6784;&#x9020;&#x4E00;&#x4E2A;<code>JavaSerializer</code>&#x5E76;&#x8FD4;&#x56DE;</li></ul></li></ul></li><li>1.4&#x3001;&#x5C06;&#x5F97;&#x5230;&#x7684;&#x5E8F;&#x5217;&#x5316;&#x5668;&#x653E;&#x5165;&#x7F13;&#x5B58;</li></ul></li></ul><p>JavaSerializer &#x548C; UnsafeSerializer &#x7684;&#x533A;&#x522B;&#xFF1A;JavaSerializer&#xFF1A;&#x901A;&#x8FC7;&#x53CD;&#x5C04;&#x673A;&#x5236;&#x83B7;&#x53D6;&#x5B57;&#x6BB5;&#x503C;UnsafeSerializer&#xFF1A;&#x901A;&#x8FC7;<code>sun.misc.Unsafe</code>&#x83B7;&#x53D6;&#x5B57;&#x6BB5;&#x7684;&#x503C;</p><h1>&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x8FC7;&#x7A0B;</h1><p>1&#x3001;&#x4F7F;&#x7528;InputStream&#x6784;&#x9020;<code>AbstractHessianInput</code>&#x5BF9;&#x8C61;2&#x3001;&#x8C03;&#x7528;<code>AbstractHessianInput.readReply(Class expectedClass)</code>&#x8BFB;&#x53D6;&#x4E00;&#x4E2A;&#x54CD;&#x5E94;&#x5BF9;&#x8C61;3&#x3001;&#x5982;&#x679C;tag=&apos;R&apos;&#xFF0C;&#x8C03;&#x7528;<code>readObject(Class cl)</code>&#x8BFB;&#x53D6;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;4&#x3001;<code>readObjectDefinition(Class&lt;?&gt; cl)</code>&#x8BFB;&#x53D6;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x5B9A;&#x4E49;4.1&#x3001;<code>SerializerFactory.getObjectDeserializer(String type, Class cl)</code>&#x83B7;&#x53D6;&#x4E00;&#x4E2A;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x5668;&#xFF0C;&#x5982;&#x679C;cl&#x4E3A;null &#x6216; cl&#x548C;&#x5E8F;&#x5217;&#x5316;&#x5668;&#x652F;&#x6301;&#x7684;&#x7C7B;&#x578B;&#x4E00;&#x81F4; &#x7B49;&#x60C5;&#x51B5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x8BE5;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x5668;4.1.1&#x3001;<code>SerializerFactory.getObjectDeserializer(String type)</code>&#x83B7;&#x53D6;&#x4E00;&#x4E2A;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x5668;4.1.1.1&#x3001;<code>SerializerFactory.getDeserializer(String type)</code>&#x83B7;&#x53D6;&#x4E00;&#x4E2A;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x5668;4.1.1.1.1&#x3001;&#x5982;&#x679C;type&#x4E3A;<code>[</code>&#x5F00;&#x5934;&#xFF0C;&#x5C31;&#x6784;&#x9020;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x5668;&#xFF0C;&#x6570;&#x7EC4;&#x5185;&#x5BB9;&#xFF0C;&#x4F7F;&#x7528;type.substring(1)&#xFF0C;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x8C03;&#x7528;&#x672C;&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x3002;4.1.1.1.2&#x3001;&#x5426;&#x5219;&#x901A;&#x8FC7;&#x53CD;&#x5C04;<code>Class.forName</code>&#x5F97;&#x5230;type&#x5BF9;&#x5E94;&#x7684;&#x5B9E;&#x4F53;&#x7C7B;&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528;&#x5F97;&#x5230;&#x7684;&#x5B9E;&#x4F53;&#x7C7B;&#x8C03;&#x7528;<code>SerializerFactory.getDeserializer(Class cl)</code>&#x83B7;&#x53D6;&#x4E00;&#x4E2A;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x5668;4.2&#x3001;&#x5982;&#x679C;4.1.1&#x5F97;&#x5230;&#x7684;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x5668;&#x4E0D;&#x7B26;&#x5408;&#x8981;&#x6C42;&#xFF0C;&#x5C31;&#x8C03;&#x7528;<code>SerializerFactory.getDeserializer(Class cl)</code>&#x83B7;&#x53D6;&#x4E00;&#x4E2A;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x5668;4.2.1&#x3001;&#x8C03;&#x7528;<code>SerializerFactory.loadDeserializer(Class cl)</code>&#x83B7;&#x53D6;&#x4E00;&#x4E2A;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x5668;4.2.1.1&#x3001;&#x904D;&#x5386; <code>SerializerFactory._factories</code>&#xFF08;&#x81EA;&#x884C;&#x6DFB;&#x52A0;&#x7684;&#x5E8F;&#x5217;&#x5316;&#x5668;&#x5DE5;&#x5382;&#xFF09;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x4E00;&#x4E2A;&#x5DE5;&#x5382;&#x63D0;&#x4F9B;&#x76EE;&#x6807;&#x7C7B;&#x7684;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x5668;&#xFF0C;&#x5C31;&#x91C7;&#x7528;&#x8BE5;&#x5DE5;&#x5382;&#x63D0;&#x4F9B;&#x7684;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x5668;4.2.1.2&#x3001;&#x8C03;&#x7528; <code>SerializerFactory</code> &#x521D;&#x59CB;&#x5316;&#x65F6;&#x6784;&#x9020;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x5E8F;&#x5217;&#x5316;&#x5DE5;&#x5382; <code>ContextSerializerFactory.getDeserializer(String className)</code> &#x67E5;&#x8BE2;&#x5E8F;&#x53CD;&#x5217;&#x5316;&#x5668;&#xFF0C;&#x5982;&#x679C;&#x627E;&#x5230;&#xFF0C;&#x5C31;&#x91C7;&#x7528;4.2.1.3&#x3001;&#x4F7F;&#x7528;<code>&#x76EE;&#x6807;&#x7C7B;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;</code>&#x6784;&#x9020; <code>ContextSerializerFactory</code>&#xFF0C;&#x5E76;&#x901A;&#x8FC7;&#x8BE5;&#x5E8F;&#x5217;&#x5316;&#x5DE5;&#x5382;&#x7684;<code>getCustomDeserializer()</code>&#x67E5;&#x8BE2;&#x5E8F;&#x5217;&#x5316;&#x5668;&#xFF0C;&#x5982;&#x679C;&#x627E;&#x5230;&#xFF0C;&#x5C31;&#x91C7;&#x7528;4.2.1.4&#x3001;Collection&#x3001;Map&#x3001;Iterator&#x3001;Annotation&#x3001;Interface&#xFF08;&#x4F7F;&#x7528;ObjectDeserializer&#xFF09;&#x3001;Array&#x3001;Enumeration&#x3001;Enum&#x3001;Class&#x90FD;&#x6709;&#x5185;&#x7F6E;&#x5BF9;&#x5E94;&#x7684;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x5668;4.2.1.5&#x3001;&#x8C03;&#x7528;<code>SerializerFactory.getDefaultDeserializer(Class cl)</code>&#x8FD4;&#x56DE;&#x9ED8;&#x8BA4;&#x7684;&#x5E8F;&#x5217;&#x5316;&#x5668;4.2.1.5.1&#x3001;&#x5982;&#x679C;&#x76EE;&#x6807;&#x7C7B;&#x578B;&#x4E3A;<code>InputStream</code>&#xFF0C;&#x4F7F;&#x7528;<code>InputStreamDeserializer.DESER</code>&#x4F5C;&#x4E3A;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x5668;4.2.1.5.2&#x3001;&#x5982;&#x679C;&#x542F;&#x7528;&#x4E86;&#x4E0D;&#x5B89;&#x5168;&#x7684;&#x5E8F;&#x5217;&#x5316;&#x5668;&#xFF0C;&#x4F7F;&#x7528;<code>UnsafeDeserializer(cl)</code>4.2.1.5.2.1&#x3001;&#x5982;&#x679C;&#x76EE;&#x6807;&#x7C7B;&#x578B;&#x6709;&#x540D;&#x4E3A;<code>readResolve</code>&#x7684;&#x65E0;&#x53C2;&#x65B9;&#x6CD5;&#xFF0C;&#x6807;&#x8BB0;<code>_readResolve.setAccessible(true)</code>4.2.1.5.3&#x3001;&#x5426;&#x5219;&#xFF0C;&#x4F7F;&#x7528;<code>JavaDeserializer(cl)</code>4.2.1.5.3.1&#x3001;&#x5982;&#x679C;&#x76EE;&#x6807;&#x7C7B;&#x578B;&#x6709;&#x540D;&#x4E3A;<code>readResolve</code>&#x7684;&#x65E0;&#x53C2;&#x65B9;&#x6CD5;&#xFF0C;&#x6807;&#x8BB0;<code>_readResolve.setAccessible(true)</code>5&#x3001;<code>readObjectInstance(Class&lt;?&gt; cl, ObjectDefinition def)</code>&#x6839;&#x636E;&#x4E0A;&#x4E00;&#x6B65;&#x7684;&#x7ED3;&#x679C;&#x8BFB;&#x53D6;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x5B9E;&#x4F8B;</p><h1>&#x7279;&#x6B8A;&#x95EE;&#x9898;</h1><h2>&#x5BA2;&#x6237;&#x7AEF;&#x4E0E;&#x670D;&#x52A1;&#x7AEF;&#x5B57;&#x6BB5;&#x4E0D;&#x4E00;&#x81F4;</h2><p>1&#x3001;&#x5BA2;&#x6237;&#x7AEF;&#x591A;&#x4E00;&#x4E2A;&#x5B57;&#x6BB5;&#xFF0C;&#x8BE5;&#x5B57;&#x6BB5;&#x53D6;JVM&#x9ED8;&#x8BA4;&#x503C;2&#x3001;&#x5BA2;&#x6237;&#x7AEF;&#x7F3A;&#x5931;&#x5B57;&#x6BB5;&#xFF0C;&#x8BE5;&#x5B57;&#x6BB5;&#x4E0D;&#x89E3;&#x6790;3&#x3001;&#x89E3;&#x6790;&#x65F6;&#x8BFB;&#x53D6;&#x5BF9;&#x8C61;&#x7C7B;&#x578B;&#xFF0C;&#x4EE5;&#x8FD4;&#x56DE;&#x7684;&#x6570;&#x636E;&#x4E2D;&#x6307;&#x5B9A;&#x7684;&#x7C7B;&#x578B;&#x4E3A;&#x51C6;</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1&gt;hessian&amp;#x8BF7;&amp;#x6C42;&amp;#x4EE3;&amp;#x7406;&lt;/h1&gt;
&lt;p&gt;com.caucho.hessian.client.HessianProxy.invoke(Object proxy, Method method, Object []args
      
    
    </summary>
    
      <category term="hessian" scheme="https://yyhan.github.io/categories/hessian/"/>
    
    
      <category term="java" scheme="https://yyhan.github.io/tags/java/"/>
    
      <category term="hessian" scheme="https://yyhan.github.io/tags/hessian/"/>
    
  </entry>
  
  <entry>
    <title>Spring @Value注解</title>
    <link href="https://yyhan.github.io/2017/05/16/Spring-Value/"/>
    <id>https://yyhan.github.io/2017/05/16/Spring-Value/</id>
    <published>2017-05-16T15:45:22.000Z</published>
    <updated>2017-06-18T13:21:21.385Z</updated>
    
    <content type="html"><![CDATA[<p>Spring @Value&#x6CE8;&#x89E3;&#x7684;&#x7528;&#x6CD5;&#x3002;</p><h1>&#x57FA;&#x672C;&#x4F7F;&#x7528;</h1><p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value</span>(<span class="string">&quot;${user.name}&quot;</span>)</span><br></pre></td></tr></table></figure></p><h1>SpELl&#x65B9;&#x5F0F;</h1><p><code>systemProperties</code>&#x662F;spring&#x81EA;&#x52A8;&#x6CE8;&#x5165;&#x7684;&#x7CFB;&#x7EDF;&#x53D8;&#x91CF;&#x96C6;&#x5408;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x81EA;&#x5DF1;&#x6CE8;&#x5165;&#x7684;&#x53D8;&#x91CF;&#x96C6;&#x5408;&#x3002;<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value</span>(<span class="string">&quot;#{systemProperties[&apos;user.name&apos;]}&quot;</span>)</span><br></pre></td></tr></table></figure></p><h1>&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x503C;</h1><p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value</span>(<span class="string">&quot;${user.name:root}&quot;</span>)</span><br></pre></td></tr></table></figure></p><h1>SpEl&#x65B9;&#x5F0F;&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x503C;</h1><p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value</span>(<span class="string">&quot;#{systemProperties[&apos;user.name&apos;] ?: &apos;root&apos;}&quot;</span>) <span class="comment">//&#x6CE8;&#x610F;&#x5B57;&#x7B26;&#x4E32;&#x8981;&#x52A0;&#x5355;&#x5F15;&#x53F7;</span></span><br></pre></td></tr></table></figure></p><h1>&#x8BBE;&#x7F6E;null&#x503C;</h1><p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value</span>(<span class="string">&quot;${user.name:#{null}}&quot;</span>) <span class="comment">//&#x6DF7;&#x5408;&#x65B9;&#x5F0F;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">&quot;#{systemProperties[&apos;user.name&apos;] ?: null}&quot;</span>) <span class="comment">//&#x7EAF;SpEl&#x65B9;&#x5F0F;</span></span><br></pre></td></tr></table></figure></p><h1>&#x68C0;&#x67E5;&#x662F;&#x5426;&#x4E3A;null&#x6216;&#x8005;&#x7A7A;&#x5B57;&#x7B26;&#x4E32;</h1><p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value</span>(value = <span class="string">&quot;#{systemProperties[&apos;user.name&apos;] == null ? null : &apos;&apos;.equals(systemProperties[&apos;user.name&apos;]) ? null : systemProperties[&apos;user.name&apos;]}&quot;</span>)</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Spring @Value&amp;#x6CE8;&amp;#x89E3;&amp;#x7684;&amp;#x7528;&amp;#x6CD5;&amp;#x3002;&lt;/p&gt;
&lt;h1&gt;&amp;#x57FA;&amp;#x672C;&amp;#x4F7F;&amp;#x7528;&lt;/h1&gt;
&lt;p&gt;&lt;figure class=&quot;highlight j
      
    
    </summary>
    
      <category term="spring" scheme="https://yyhan.github.io/categories/spring/"/>
    
    
      <category term="java" scheme="https://yyhan.github.io/tags/java/"/>
    
      <category term="spring" scheme="https://yyhan.github.io/tags/spring/"/>
    
      <category term="value" scheme="https://yyhan.github.io/tags/value/"/>
    
      <category term="注解" scheme="https://yyhan.github.io/tags/%E6%B3%A8%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title>Log4j2配置</title>
    <link href="https://yyhan.github.io/2017/05/16/Log4j2%E9%85%8D%E7%BD%AE/"/>
    <id>https://yyhan.github.io/2017/05/16/Log4j2配置/</id>
    <published>2017-05-16T15:25:40.000Z</published>
    <updated>2017-09-24T15:01:55.594Z</updated>
    
    <content type="html"><![CDATA[<h1>&#x4F7F;&#x7528;xml&#x65B9;&#x5F0F;&#x521D;&#x59CB;&#x5316;Log4j2</h1><p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">&quot;WARN&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Property</span> <span class="attr">name</span>=<span class="string">&quot;log.dir&quot;</span>&gt;</span>D:/logs/demo<span class="tag">&lt;/<span class="name">Property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &#x63A7;&#x5236;&#x53F0;appender --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">&quot;Console&quot;</span> <span class="attr">target</span>=<span class="string">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level %logger - %msg %ex %n&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">&quot;appFileLog&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;${log.dir}/app.log&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">filePattern</span>=<span class="string">&quot;${log.dir}/app-%d{yyyy-MM-dd}.log&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level %logger - %msg %ex %n&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &#x9ED8;&#x8BA4;&#x65E5;&#x5FD7;&#x7EA7;&#x522B; debug --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">&quot;debug&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- &#x9ED8;&#x8BA4;&#x65E5;&#x5FD7;&#x8F93;&#x51FA;&#x5230; &#x63A7;&#x5236;&#x53F0; --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;Console&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;appFileLog&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &#x6253;&#x5370;spring info&#x65E5;&#x5FD7; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.springframework&quot;</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h1>&#x4F7F;&#x7528;java&#x65B9;&#x5F0F;&#x521D;&#x59CB;&#x5316;Log4j2</h1><p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.utils.log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.Level;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.LogManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.core.Appender;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.core.LoggerContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.core.appender.ConsoleAppender;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.core.config.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.core.config.builder.api.ConfigurationBuilder;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.core.config.builder.api.ConfigurationBuilderFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.core.config.builder.api.RootLoggerComponentBuilder;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.core.config.builder.impl.BuiltConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.core.layout.PatternLayout;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * log4j2 &#x5DE5;&#x5177;&#x7C7B;&#xFF0C;&#x63D0;&#x4F9B;java&#x65B9;&#x5F0F;&#x521D;&#x59CB;&#x5316;log4j2&#xFF0C;&#x6216;&#x8005;&#x5176;&#x4ED6;&#x64CD;&#x4F5C;log4j2&#x7684;&#x65B9;&#x6CD5;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Log4jHelper</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LoggerContext loggerContext = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_APPENDER = <span class="string">&quot;STDOUT&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">resetSimpleRootLogger</span><span class="params">(String rootLoggerLevel)</span> </span>{</span><br><span class="line">        resetSimpleRootLogger(rootLoggerLevel, <span class="keyword">true</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x91CD;&#x7F6E;&#x4E00;&#x4E2A;&#x7B80;&#x5316;&#x7684;rootLogger&#xFF0C;&#x5C06;&#x6240;&#x6709;&#x65E5;&#x5FD7;&#x8F93;&#x51FA;&#x7684;&#x63A7;&#x5236;&#x53F0;&#x3002;&#x5F53;&#x65E0;&#x6CD5;&#x786E;&#x5B9A; log4j2 &#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x52A0;&#x8F7D;&#x65F6;&#xFF0C;&#x53EF;&#x7528;&#x6B64;&#x65B9;&#x6CD5;&#x3002;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rootLoggerLevel     rootLogger &#x65E5;&#x5FD7;&#x7EA7;&#x522B;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> isRemoveOldAppender &#x662F;&#x5426;&#x79FB;&#x9664;&#x73B0;&#x6709;&#x7684;appender</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">resetSimpleRootLogger</span><span class="params">(String rootLoggerLevel, <span class="keyword">boolean</span> isRemoveOldAppender)</span> </span>{</span><br><span class="line">        loggerContext = (LoggerContext) LogManager.getContext(<span class="keyword">false</span>);</span><br><span class="line">        Configuration config = loggerContext.getConfiguration();</span><br><span class="line"></span><br><span class="line">        ConsoleAppender.Builder builder = ConsoleAppender.newBuilder();</span><br><span class="line">        builder.withName(DEFAULT_APPENDER).withLayout(PatternLayout.newBuilder().withPattern(<span class="string">&quot;%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level %logger - %msg %ex %n&quot;</span>).build());</span><br><span class="line">        Appender stdoutAppender = builder.setTarget(ConsoleAppender.Target.SYSTEM_OUT).build();</span><br><span class="line"></span><br><span class="line">        config.addAppender(stdoutAppender);</span><br><span class="line"></span><br><span class="line">        LoggerConfig rootLoggerConfig = config.getRootLogger();</span><br><span class="line">        <span class="keyword">if</span> (isRemoveOldAppender) {</span><br><span class="line">            Map&lt;String, Appender&gt; appenderMap = rootLoggerConfig.getAppenders();</span><br><span class="line">            <span class="keyword">if</span> (!appenderMap.isEmpty()) {</span><br><span class="line">                <span class="keyword">for</span> (String key : appenderMap.keySet()) {</span><br><span class="line">                    rootLoggerConfig.removeAppender(key);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        rootLoggerConfig.setLevel(Level.valueOf(rootLoggerLevel));</span><br><span class="line">        rootLoggerConfig.addAppender(stdoutAppender, Level.DEBUG, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        loggerContext.updateLoggers();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x521D;&#x59CB;&#x5316;Log4j2 &#xFF0C;&#x9700;&#x8981;&#x786E;&#x4FDD;&#x8BE5;&#x65B9;&#x6CD5;&#x5728;&#x6240;&#x6709;&#x65E5;&#x5FD7;&#x64CD;&#x4F5C;&#x524D;&#x6267;&#x884C;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rootLoggerLevel &#x9876;&#x7EA7;logger &#x65E5;&#x5FD7;&#x7EA7;&#x522B;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(String rootLoggerLevel)</span> </span>{</span><br><span class="line">        ConfigurationBuilder&lt;BuiltConfiguration&gt; builder = ConfigurationBuilderFactory.newConfigurationBuilder();</span><br><span class="line">        builder.setStatusLevel(Level.WARN);</span><br><span class="line">        builder.setConfigurationName(<span class="string">&quot;Log4jHelper&quot;</span>);</span><br><span class="line">        builder.add(</span><br><span class="line">                builder.newAppender(DEFAULT_APPENDER, <span class="string">&quot;CONSOLE&quot;</span>)</span><br><span class="line">                        .addAttribute(<span class="string">&quot;target&quot;</span>, ConsoleAppender.Target.SYSTEM_OUT)</span><br><span class="line">                        .add(</span><br><span class="line">                                builder.newLayout(<span class="string">&quot;PatternLayout&quot;</span>)</span><br><span class="line">                                        .addAttribute(<span class="string">&quot;pattern&quot;</span>, <span class="string">&quot;%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg %ex %n&quot;</span>)</span><br><span class="line">                        ));</span><br><span class="line">        builder.add(builder.newLogger(<span class="string">&quot;org.apache.logging.log4j&quot;</span>, Level.DEBUG)</span><br><span class="line">                .add(builder.newAppenderRef(DEFAULT_APPENDER)));</span><br><span class="line"></span><br><span class="line">        builder.add(builder.newRootLogger(Level.DEBUG).add(builder.newAppenderRef(<span class="string">&quot;STDOUT&quot;</span>)));</span><br><span class="line">        loggerContext = Configurator.initialize(builder.build());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>{</span><br><span class="line">        init(<span class="string">&quot;DEBUG&quot;</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x5411;&#x5F53;&#x524D; log4j2 &#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;logger&#xFF0C;&#x8BE5;logger&#x4F1A;&#x88AB;&#x8F93;&#x51FA;&#x5230;&#x63A7;&#x5236;&#x53F0;&#x3002;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name  logger &#x540D;&#x79F0;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> level &#x65E5;&#x5FD7;&#x7EA7;&#x522B;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addLogger</span><span class="params">(String name, String level)</span> </span>{</span><br><span class="line">        addLogger(name, level, DEFAULT_APPENDER);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x5411;&#x5F53;&#x524D; log4j2 &#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;logger</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name         logger &#x540D;&#x79F0;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> level        &#x65E5;&#x5FD7;&#x7EA7;&#x522B;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> appenderName appenderName</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addLogger</span><span class="params">(String name, String level, String appenderName)</span> </span>{</span><br><span class="line">        <span class="keyword">final</span> Configuration config = loggerContext.getConfiguration();</span><br><span class="line"></span><br><span class="line">        Appender stdoutAppender = config.getAppender(appenderName);</span><br><span class="line"></span><br><span class="line">        LoggerConfig loggerConfig = LoggerConfig.createLogger(<span class="keyword">false</span>, Level.DEBUG, name, <span class="string">&quot;false&quot;</span>, <span class="keyword">new</span> AppenderRef[]{}, <span class="keyword">new</span> Property[]{}, config, <span class="keyword">null</span>);</span><br><span class="line">        loggerConfig.addAppender(stdoutAppender, Level.valueOf(level), <span class="keyword">null</span>);</span><br><span class="line">        loggerConfig.setLevel(Level.valueOf(level));</span><br><span class="line">        loggerConfig.setAdditive(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">        config.addLogger(name, loggerConfig);</span><br><span class="line"></span><br><span class="line">        loggerContext.updateLoggers();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x8BBE;&#x7F6E;root&#x65E5;&#x5FD7;&#x7EA7;&#x522B;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> loggerName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> level</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setRootLevel</span><span class="params">(String level)</span> </span>{</span><br><span class="line">        Configuration config = loggerContext.getConfiguration();</span><br><span class="line">        LoggerConfig loggerConfig = config.getRootLogger();</span><br><span class="line">        loggerConfig.setLevel(Level.valueOf(level));</span><br><span class="line">        loggerContext.updateLoggers();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x8BBE;&#x7F6E;&#x65E5;&#x5FD7;&#x7EA7;&#x522B;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> loggerName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> level</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setLevel</span><span class="params">(String loggerName, String level)</span> </span>{</span><br><span class="line">        Configuration config = loggerContext.getConfiguration();</span><br><span class="line">        LoggerConfig loggerConfig = config.getLoggerConfig(loggerName);</span><br><span class="line">        loggerConfig.setLevel(Level.valueOf(level));</span><br><span class="line">        loggerContext.updateLoggers();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line"></span><br><span class="line"><span class="comment">//        Log4jHelper.resetSimpleRootLogger(&quot;debug&quot;);</span></span><br><span class="line">        Log4jHelper.init();</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">        Log4jHelper.addLogger(<span class="string">&quot;accessLog&quot;</span>, <span class="string">&quot;info&quot;</span>);</span><br><span class="line">        Logger accessLog = LogManager.getLogger(<span class="string">&quot;accessLog&quot;</span>);</span><br><span class="line">        accessLog.debug(<span class="string">&quot;accessLog: debug&quot;</span>);</span><br><span class="line">        accessLog.info(<span class="string">&quot;accessLog: info&quot;</span>);</span><br><span class="line">        accessLog.error(<span class="string">&quot;accessLog: error&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Logger rootLogger = LogManager.getRootLogger();</span><br><span class="line"></span><br><span class="line">        rootLogger.debug(<span class="string">&quot;rootLogger: debug&quot;</span>);</span><br><span class="line">        rootLogger.info(<span class="string">&quot;rootLogger: info&quot;</span>);</span><br><span class="line">        rootLogger.error(<span class="string">&quot;rootLogger: error&quot;</span>);</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1&gt;&amp;#x4F7F;&amp;#x7528;xml&amp;#x65B9;&amp;#x5F0F;&amp;#x521D;&amp;#x59CB;&amp;#x5316;Log4j2&lt;/h1&gt;
&lt;p&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;p
      
    
    </summary>
    
      <category term="log4j2" scheme="https://yyhan.github.io/categories/log4j2/"/>
    
    
      <category term="java" scheme="https://yyhan.github.io/tags/java/"/>
    
      <category term="log4j2" scheme="https://yyhan.github.io/tags/log4j2/"/>
    
  </entry>
  
</feed>
